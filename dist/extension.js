"use strict";var iJ=Object.create;var d_=Object.defineProperty;var sJ=Object.getOwnPropertyDescriptor;var aJ=Object.getOwnPropertyNames;var cJ=Object.getPrototypeOf,uJ=Object.prototype.hasOwnProperty;var A=(t,e)=>()=>(t&&(e=t(t=0)),e);var g=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),To=(t,e)=>{for(var r in e)d_(t,r,{get:e[r],enumerable:!0})},RD=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of aJ(e))!uJ.call(t,o)&&o!==r&&d_(t,o,{get:()=>e[o],enumerable:!(n=sJ(e,o))||n.enumerable});return t};var It=(t,e,r)=>(r=t!=null?iJ(cJ(t)):{},RD(e||!t||!t.__esModule?d_(r,"default",{value:t,enumerable:!0}):r,t)),I=t=>RD(d_({},"__esModule",{value:!0}),t);var Ke,DD,X,Vi,mf=A(()=>{(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let i={};for(let s of o)i[s]=s;return i},t.getValidEnumValues=o=>{let i=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),s={};for(let a of i)s[a]=o[a];return t.objectValues(s)},t.objectValues=o=>t.objectKeys(o).map(function(i){return o[i]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let i=[];for(let s in o)Object.prototype.hasOwnProperty.call(o,s)&&i.push(s);return i},t.find=(o,i)=>{for(let s of o)if(i(s))return s},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,i=" | "){return o.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}t.joinValues=n,t.jsonStringifyReplacer=(o,i)=>typeof i=="bigint"?i.toString():i})(Ke||(Ke={}));(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(DD||(DD={}));X=Ke.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Vi=t=>{switch(typeof t){case"undefined":return X.undefined;case"string":return X.string;case"number":return Number.isNaN(t)?X.nan:X.number;case"boolean":return X.boolean;case"function":return X.function;case"bigint":return X.bigint;case"symbol":return X.symbol;case"object":return Array.isArray(t)?X.array:t===null?X.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?X.promise:typeof Map<"u"&&t instanceof Map?X.map:typeof Set<"u"&&t instanceof Set?X.set:typeof Date<"u"&&t instanceof Date?X.date:X.object;default:return X.unknown}}});var D,Dn,f_=A(()=>{mf();D=Ke.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Dn=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(i){return i.message},n={_errors:[]},o=i=>{for(let s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(o);else if(s.code==="invalid_return_type")o(s.returnTypeError);else if(s.code==="invalid_arguments")o(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let a=n,c=0;for(;c<s.path.length;){let u=s.path[c];c===s.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(s))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ke.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r=Object.create(null),n=[];for(let o of this.issues)if(o.path.length>0){let i=o.path[0];r[i]=r[i]||[],r[i].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Dn.create=t=>new Dn(t)});var lJ,Us,f$=A(()=>{f_();mf();lJ=(t,e)=>{let r;switch(t.code){case D.invalid_type:t.received===X.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case D.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Ke.jsonStringifyReplacer)}`;break;case D.unrecognized_keys:r=`Unrecognized key(s) in object: ${Ke.joinValues(t.keys,", ")}`;break;case D.invalid_union:r="Invalid input";break;case D.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Ke.joinValues(t.options)}`;break;case D.invalid_enum_value:r=`Invalid enum value. Expected ${Ke.joinValues(t.options)}, received '${t.received}'`;break;case D.invalid_arguments:r="Invalid function arguments";break;case D.invalid_return_type:r="Invalid function return type";break;case D.invalid_date:r="Invalid date";break;case D.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Ke.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case D.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case D.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case D.custom:r="Invalid input";break;case D.invalid_intersection_types:r="Intersection results could not be merged";break;case D.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case D.not_finite:r="Number must be finite";break;default:r=e.defaultError,Ke.assertNever(t)}return{message:r}},Us=lJ});function hf(){return dJ}var dJ,m_=A(()=>{f$();dJ=Us});function W(t,e){let r=hf(),n=h_({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Us?void 0:Us].filter(o=>!!o)});t.common.issues.push(n)}var h_,Lr,ge,nl,tn,m$,h$,Fa,gf,g$=A(()=>{m_();f$();h_=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,i=[...r,...o.path||[]],s={...o,path:i};if(o.message!==void 0)return{...o,path:i,message:o.message};let a="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)a=u(s,{data:e,defaultError:a}).message;return{...o,path:i,message:a}};Lr=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return ge;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let i=await o.key,s=await o.value;n.push({key:i,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:i,value:s}=o;if(i.status==="aborted"||s.status==="aborted")return ge;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||o.alwaysSet)&&(n[i.value]=s.value)}return{status:e.value,value:n}}},ge=Object.freeze({status:"aborted"}),nl=t=>({status:"dirty",value:t}),tn=t=>({status:"valid",value:t}),m$=t=>t.status==="aborted",h$=t=>t.status==="dirty",Fa=t=>t.status==="valid",gf=t=>typeof Promise<"u"&&t instanceof Promise});var qD=A(()=>{});var oe,UD=A(()=>{(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(oe||(oe={}))});function Te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(s,a)=>{let{message:c}=t;return s.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:s.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}function ZD(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function CJ(t){return new RegExp(`^${ZD(t)}$`)}function TJ(t){let e=`${LD}T${ZD(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function IJ(t,e){return!!((e==="v4"||!e)&&wJ.test(t)||(e==="v6"||!e)&&SJ.test(t))}function EJ(t,e){if(!yJ.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function OJ(t,e){return!!((e==="v4"||!e)&&xJ.test(t)||(e==="v6"||!e)&&kJ.test(t))}function jJ(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,i=Number.parseInt(t.toFixed(o).replace(".","")),s=Number.parseInt(e.toFixed(o).replace(".",""));return i%s/10**o}function ol(t){if(t instanceof qn){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=Eo.create(ol(n))}return new qn({...t._def,shape:()=>e})}else return t instanceof Ls?new Ls({...t._def,type:ol(t.element)}):t instanceof Eo?Eo.create(ol(t.unwrap())):t instanceof Ki?Ki.create(ol(t.unwrap())):t instanceof Hi?Hi.create(t.items.map(e=>ol(e))):t}function _$(t,e){let r=Vi(t),n=Vi(e);if(t===e)return{valid:!0,data:t};if(r===X.object&&n===X.object){let o=Ke.objectKeys(e),i=Ke.objectKeys(t).filter(a=>o.indexOf(a)!==-1),s={...t,...e};for(let a of i){let c=_$(t[a],e[a]);if(!c.valid)return{valid:!1};s[a]=c.data}return{valid:!0,data:s}}else if(r===X.array&&n===X.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let i=0;i<t.length;i++){let s=t[i],a=e[i],c=_$(s,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===X.date&&n===X.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}function VD(t,e){return new pl({values:t,typeName:fe.ZodEnum,...Te(e)})}var Qn,BD,ze,pJ,fJ,mJ,hJ,gJ,yJ,vJ,_J,bJ,y$,wJ,xJ,SJ,kJ,$J,AJ,LD,PJ,il,yf,vf,_f,bf,wf,sl,al,xf,Bs,li,Sf,Ls,qn,cl,Fi,v$,ul,Hi,b$,kf,$f,w$,ll,dl,pl,fl,Ha,Oo,Eo,Ki,ml,hl,Af,g_,y_,gl,Nve,fe,zve,Rve,Mve,Dve,qve,Uve,Bve,Lve,Zve,Vve,Fve,Hve,Kve,Wve,NJ,Gve,Jve,Xve,Yve,Qve,e_e,t_e,r_e,n_e,o_e,i_e,s_e,a_e,c_e,u_e,l_e,d_e,p_e,f_e,FD=A(()=>{f_();m_();UD();g$();mf();Qn=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},BD=(t,e)=>{if(Fa(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Dn(t.common.issues);return this._error=r,this._error}}};ze=class{get description(){return this._def.description}_getType(e){return Vi(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Vi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Lr,ctx:{common:e.parent.common,data:e.data,parsedType:Vi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(gf(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vi(e)},o=this._parseSync({data:e,path:n.path,parent:n});return BD(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vi(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Fa(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Fa(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vi(e)},o=this._parse({data:e,path:n.path,parent:n}),i=await(gf(o)?o:Promise.resolve(o));return BD(n,i)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,i)=>{let s=e(o),a=()=>i.addIssue({code:D.custom,...n(o)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(a(),!1)):s?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new Oo({schema:this,typeName:fe.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Eo.create(this,this._def)}nullable(){return Ki.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ls.create(this)}promise(){return Ha.create(this,this._def)}or(e){return cl.create([this,e],this._def)}and(e){return ul.create(this,e,this._def)}transform(e){return new Oo({...Te(this._def),schema:this,typeName:fe.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new ml({...Te(this._def),innerType:this,defaultValue:r,typeName:fe.ZodDefault})}brand(){return new g_({typeName:fe.ZodBranded,type:this,...Te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new hl({...Te(this._def),innerType:this,catchValue:r,typeName:fe.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return y_.create(this,e)}readonly(){return gl.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},pJ=/^c[^\s-]{8,}$/i,fJ=/^[0-9a-z]+$/,mJ=/^[0-9A-HJKMNP-TV-Z]{26}$/i,hJ=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,gJ=/^[a-z0-9_-]{21}$/i,yJ=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,vJ=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_J=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,bJ="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",wJ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,xJ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,SJ=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,kJ=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,$J=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AJ=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,LD="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",PJ=new RegExp(`^${LD}$`);il=class t extends ze{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==X.string){let i=this._getOrReturnCtx(e);return W(i,{code:D.invalid_type,expected:X.string,received:i.parsedType}),ge}let n=new Lr,o;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(o=this._getOrReturnCtx(e,o),W(o,{code:D.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(o=this._getOrReturnCtx(e,o),W(o,{code:D.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let s=e.data.length>i.value,a=e.data.length<i.value;(s||a)&&(o=this._getOrReturnCtx(e,o),s?W(o,{code:D.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&W(o,{code:D.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")_J.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"email",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")y$||(y$=new RegExp(bJ,"u")),y$.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"emoji",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")hJ.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"uuid",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")gJ.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"nanoid",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")pJ.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"cuid",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")fJ.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"cuid2",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")mJ.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"ulid",code:D.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),W(o,{validation:"url",code:D.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"regex",code:D.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?TJ(i).test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?PJ.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?CJ(i).test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{code:D.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?vJ.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"duration",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?IJ(e.data,i.version)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"ip",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?EJ(e.data,i.alg)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"jwt",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?OJ(e.data,i.version)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"cidr",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?$J.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"base64",code:D.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?AJ.test(e.data)||(o=this._getOrReturnCtx(e,o),W(o,{validation:"base64url",code:D.invalid_string,message:i.message}),n.dirty()):Ke.assertNever(i);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:D.invalid_string,...oe.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...oe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...oe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...oe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...oe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...oe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...oe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...oe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...oe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...oe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...oe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...oe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...oe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...oe.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...oe.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...oe.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...oe.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...oe.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...oe.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...oe.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...oe.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...oe.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...oe.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...oe.errToObj(r)})}nonempty(e){return this.min(1,oe.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};il.create=t=>new il({checks:[],typeName:fe.ZodString,coerce:t?.coerce??!1,...Te(t)});yf=class t extends ze{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==X.number){let i=this._getOrReturnCtx(e);return W(i,{code:D.invalid_type,expected:X.number,received:i.parsedType}),ge}let n,o=new Lr;for(let i of this._def.checks)i.kind==="int"?Ke.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:D.invalid_type,expected:"integer",received:"float",message:i.message}),o.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),o.dirty()):i.kind==="multipleOf"?jJ(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:D.not_finite,message:i.message}),o.dirty()):Ke.assertNever(i);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,oe.toString(r))}gt(e,r){return this.setLimit("min",e,!1,oe.toString(r))}lte(e,r){return this.setLimit("max",e,!0,oe.toString(r))}lt(e,r){return this.setLimit("max",e,!1,oe.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:oe.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:oe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:oe.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:oe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:oe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:oe.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ke.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};yf.create=t=>new yf({checks:[],typeName:fe.ZodNumber,coerce:t?.coerce||!1,...Te(t)});vf=class t extends ze{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==X.bigint)return this._getInvalidInput(e);let n,o=new Lr;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),o.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),W(n,{code:D.not_multiple_of,multipleOf:i.value,message:i.message}),o.dirty()):Ke.assertNever(i);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return W(r,{code:D.invalid_type,expected:X.bigint,received:r.parsedType}),ge}gte(e,r){return this.setLimit("min",e,!0,oe.toString(r))}gt(e,r){return this.setLimit("min",e,!1,oe.toString(r))}lte(e,r){return this.setLimit("max",e,!0,oe.toString(r))}lt(e,r){return this.setLimit("max",e,!1,oe.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:oe.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};vf.create=t=>new vf({checks:[],typeName:fe.ZodBigInt,coerce:t?.coerce??!1,...Te(t)});_f=class extends ze{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==X.boolean){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:X.boolean,received:n.parsedType}),ge}return tn(e.data)}};_f.create=t=>new _f({typeName:fe.ZodBoolean,coerce:t?.coerce||!1,...Te(t)});bf=class t extends ze{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==X.date){let i=this._getOrReturnCtx(e);return W(i,{code:D.invalid_type,expected:X.date,received:i.parsedType}),ge}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return W(i,{code:D.invalid_date}),ge}let n=new Lr,o;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(o=this._getOrReturnCtx(e,o),W(o,{code:D.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(o=this._getOrReturnCtx(e,o),W(o,{code:D.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):Ke.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:oe.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:oe.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};bf.create=t=>new bf({checks:[],coerce:t?.coerce||!1,typeName:fe.ZodDate,...Te(t)});wf=class extends ze{_parse(e){if(this._getType(e)!==X.symbol){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:X.symbol,received:n.parsedType}),ge}return tn(e.data)}};wf.create=t=>new wf({typeName:fe.ZodSymbol,...Te(t)});sl=class extends ze{_parse(e){if(this._getType(e)!==X.undefined){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:X.undefined,received:n.parsedType}),ge}return tn(e.data)}};sl.create=t=>new sl({typeName:fe.ZodUndefined,...Te(t)});al=class extends ze{_parse(e){if(this._getType(e)!==X.null){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:X.null,received:n.parsedType}),ge}return tn(e.data)}};al.create=t=>new al({typeName:fe.ZodNull,...Te(t)});xf=class extends ze{constructor(){super(...arguments),this._any=!0}_parse(e){return tn(e.data)}};xf.create=t=>new xf({typeName:fe.ZodAny,...Te(t)});Bs=class extends ze{constructor(){super(...arguments),this._unknown=!0}_parse(e){return tn(e.data)}};Bs.create=t=>new Bs({typeName:fe.ZodUnknown,...Te(t)});li=class extends ze{_parse(e){let r=this._getOrReturnCtx(e);return W(r,{code:D.invalid_type,expected:X.never,received:r.parsedType}),ge}};li.create=t=>new li({typeName:fe.ZodNever,...Te(t)});Sf=class extends ze{_parse(e){if(this._getType(e)!==X.undefined){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:X.void,received:n.parsedType}),ge}return tn(e.data)}};Sf.create=t=>new Sf({typeName:fe.ZodVoid,...Te(t)});Ls=class t extends ze{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==X.array)return W(r,{code:D.invalid_type,expected:X.array,received:r.parsedType}),ge;if(o.exactLength!==null){let s=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(s||a)&&(W(r,{code:s?D.too_big:D.too_small,minimum:a?o.exactLength.value:void 0,maximum:s?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(W(r,{code:D.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(W(r,{code:D.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,a)=>o.type._parseAsync(new Qn(r,s,r.path,a)))).then(s=>Lr.mergeArray(n,s));let i=[...r.data].map((s,a)=>o.type._parseSync(new Qn(r,s,r.path,a)));return Lr.mergeArray(n,i)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:oe.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:oe.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:oe.toString(r)}})}nonempty(e){return this.min(1,e)}};Ls.create=(t,e)=>new Ls({type:t,minLength:null,maxLength:null,exactLength:null,typeName:fe.ZodArray,...Te(e)});qn=class t extends ze{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=Ke.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==X.object){let u=this._getOrReturnCtx(e);return W(u,{code:D.invalid_type,expected:X.object,received:u.parsedType}),ge}let{status:n,ctx:o}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof li&&this._def.unknownKeys==="strip"))for(let u in o.data)s.includes(u)||a.push(u);let c=[];for(let u of s){let l=i[u],d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Qn(o,d,o.path,u)),alwaysSet:u in o.data})}if(this._def.catchall instanceof li){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:o.data[l]}});else if(u==="strict")a.length>0&&(W(o,{code:D.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Qn(o,d,o.path,l)),alwaysSet:l in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,p=await l.value;u.push({key:d,value:p,alwaysSet:l.alwaysSet})}return u}).then(u=>Lr.mergeObjectSync(n,u)):Lr.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return oe.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:oe.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:fe.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of Ke.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of Ke.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return ol(this)}partial(e){let r={};for(let n of Ke.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of Ke.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof Eo;)i=i._def.innerType;r[n]=i}return new t({...this._def,shape:()=>r})}keyof(){return VD(Ke.objectKeys(this.shape))}};qn.create=(t,e)=>new qn({shape:()=>t,unknownKeys:"strip",catchall:li.create(),typeName:fe.ZodObject,...Te(e)});qn.strictCreate=(t,e)=>new qn({shape:()=>t,unknownKeys:"strict",catchall:li.create(),typeName:fe.ZodObject,...Te(e)});qn.lazycreate=(t,e)=>new qn({shape:t,unknownKeys:"strip",catchall:li.create(),typeName:fe.ZodObject,...Te(e)});cl=class extends ze{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let s=i.map(a=>new Dn(a.ctx.common.issues));return W(r,{code:D.invalid_union,unionErrors:s}),ge}if(r.common.async)return Promise.all(n.map(async i=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(o);{let i,s=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:u}),u.common.issues.length&&s.push(u.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;let a=s.map(c=>new Dn(c));return W(r,{code:D.invalid_union,unionErrors:a}),ge}}get options(){return this._def.options}};cl.create=(t,e)=>new cl({options:t,typeName:fe.ZodUnion,...Te(e)});Fi=t=>t instanceof ll?Fi(t.schema):t instanceof Oo?Fi(t.innerType()):t instanceof dl?[t.value]:t instanceof pl?t.options:t instanceof fl?Ke.objectValues(t.enum):t instanceof ml?Fi(t._def.innerType):t instanceof sl?[void 0]:t instanceof al?[null]:t instanceof Eo?[void 0,...Fi(t.unwrap())]:t instanceof Ki?[null,...Fi(t.unwrap())]:t instanceof g_||t instanceof gl?Fi(t.unwrap()):t instanceof hl?Fi(t._def.innerType):[],v$=class t extends ze{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==X.object)return W(r,{code:D.invalid_type,expected:X.object,received:r.parsedType}),ge;let n=this.discriminator,o=r.data[n],i=this.optionsMap.get(o);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(W(r,{code:D.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ge)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let i of r){let s=Fi(i.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of s){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,i)}}return new t({typeName:fe.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...Te(n)})}};ul=class extends ze{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(i,s)=>{if(m$(i)||m$(s))return ge;let a=_$(i.value,s.value);return a.valid?((h$(i)||h$(s))&&r.dirty(),{status:r.value,value:a.data}):(W(n,{code:D.invalid_intersection_types}),ge)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,s])=>o(i,s)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};ul.create=(t,e,r)=>new ul({left:t,right:e,typeName:fe.ZodIntersection,...Te(r)});Hi=class t extends ze{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==X.array)return W(n,{code:D.invalid_type,expected:X.array,received:n.parsedType}),ge;if(n.data.length<this._def.items.length)return W(n,{code:D.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ge;!this._def.rest&&n.data.length>this._def.items.length&&(W(n,{code:D.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let i=[...n.data].map((s,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Qn(n,s,n.path,a)):null}).filter(s=>!!s);return n.common.async?Promise.all(i).then(s=>Lr.mergeArray(r,s)):Lr.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Hi.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Hi({items:t,typeName:fe.ZodTuple,rest:null,...Te(e)})};b$=class t extends ze{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==X.object)return W(n,{code:D.invalid_type,expected:X.object,received:n.parsedType}),ge;let o=[],i=this._def.keyType,s=this._def.valueType;for(let a in n.data)o.push({key:i._parse(new Qn(n,a,n.path,a)),value:s._parse(new Qn(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?Lr.mergeObjectAsync(r,o):Lr.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof ze?new t({keyType:e,valueType:r,typeName:fe.ZodRecord,...Te(n)}):new t({keyType:il.create(),valueType:e,typeName:fe.ZodRecord,...Te(r)})}},kf=class extends ze{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==X.map)return W(n,{code:D.invalid_type,expected:X.map,received:n.parsedType}),ge;let o=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map(([a,c],u)=>({key:o._parse(new Qn(n,a,n.path,[u,"key"])),value:i._parse(new Qn(n,c,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of s){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return ge;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of s){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return ge;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};kf.create=(t,e,r)=>new kf({valueType:e,keyType:t,typeName:fe.ZodMap,...Te(r)});$f=class t extends ze{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==X.set)return W(n,{code:D.invalid_type,expected:X.set,received:n.parsedType}),ge;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(W(n,{code:D.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(W(n,{code:D.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let i=this._def.valueType;function s(c){let u=new Set;for(let l of c){if(l.status==="aborted")return ge;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((c,u)=>i._parse(new Qn(n,c,n.path,u)));return n.common.async?Promise.all(a).then(c=>s(c)):s(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:oe.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:oe.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};$f.create=(t,e)=>new $f({valueType:t,minSize:null,maxSize:null,typeName:fe.ZodSet,...Te(e)});w$=class t extends ze{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==X.function)return W(r,{code:D.invalid_type,expected:X.function,received:r.parsedType}),ge;function n(a,c){return h_({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,hf(),Us].filter(u=>!!u),issueData:{code:D.invalid_arguments,argumentsError:c}})}function o(a,c){return h_({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,hf(),Us].filter(u=>!!u),issueData:{code:D.invalid_return_type,returnTypeError:c}})}let i={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof Ha){let a=this;return tn(async function(...c){let u=new Dn([]),l=await a._def.args.parseAsync(c,i).catch(f=>{throw u.addIssue(n(c,f)),u}),d=await Reflect.apply(s,this,l);return await a._def.returns._def.type.parseAsync(d,i).catch(f=>{throw u.addIssue(o(d,f)),u})})}else{let a=this;return tn(function(...c){let u=a._def.args.safeParse(c,i);if(!u.success)throw new Dn([n(c,u.error)]);let l=Reflect.apply(s,this,u.data),d=a._def.returns.safeParse(l,i);if(!d.success)throw new Dn([o(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Hi.create(e).rest(Bs.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Hi.create([]).rest(Bs.create()),returns:r||Bs.create(),typeName:fe.ZodFunction,...Te(n)})}},ll=class extends ze{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};ll.create=(t,e)=>new ll({getter:t,typeName:fe.ZodLazy,...Te(e)});dl=class extends ze{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return W(r,{received:r.data,code:D.invalid_literal,expected:this._def.value}),ge}return{status:"valid",value:e.data}}get value(){return this._def.value}};dl.create=(t,e)=>new dl({value:t,typeName:fe.ZodLiteral,...Te(e)});pl=class t extends ze{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return W(r,{expected:Ke.joinValues(n),received:r.parsedType,code:D.invalid_type}),ge}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return W(r,{received:r.data,code:D.invalid_enum_value,options:n}),ge}return tn(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};pl.create=VD;fl=class extends ze{_parse(e){let r=Ke.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==X.string&&n.parsedType!==X.number){let o=Ke.objectValues(r);return W(n,{expected:Ke.joinValues(o),received:n.parsedType,code:D.invalid_type}),ge}if(this._cache||(this._cache=new Set(Ke.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=Ke.objectValues(r);return W(n,{received:n.data,code:D.invalid_enum_value,options:o}),ge}return tn(e.data)}get enum(){return this._def.values}};fl.create=(t,e)=>new fl({values:t,typeName:fe.ZodNativeEnum,...Te(e)});Ha=class extends ze{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==X.promise&&r.common.async===!1)return W(r,{code:D.invalid_type,expected:X.promise,received:r.parsedType}),ge;let n=r.parsedType===X.promise?r.data:Promise.resolve(r.data);return tn(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Ha.create=(t,e)=>new Ha({type:t,typeName:fe.ZodPromise,...Te(e)});Oo=class extends ze{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===fe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,i={addIssue:s=>{W(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),o.type==="preprocess"){let s=o.transform(n.data,i);if(n.common.async)return Promise.resolve(s).then(async a=>{if(r.value==="aborted")return ge;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?ge:c.status==="dirty"?nl(c.value):r.value==="dirty"?nl(c.value):c});{if(r.value==="aborted")return ge;let a=this._def.schema._parseSync({data:s,path:n.path,parent:n});return a.status==="aborted"?ge:a.status==="dirty"?nl(a.value):r.value==="dirty"?nl(a.value):a}}if(o.type==="refinement"){let s=a=>{let c=o.refinement(a,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ge:(a.status==="dirty"&&r.dirty(),s(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?ge:(a.status==="dirty"&&r.dirty(),s(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Fa(s))return ge;let a=o.transform(s.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>Fa(s)?Promise.resolve(o.transform(s.value,i)).then(a=>({status:r.value,value:a})):ge);Ke.assertNever(o)}};Oo.create=(t,e,r)=>new Oo({schema:t,typeName:fe.ZodEffects,effect:e,...Te(r)});Oo.createWithPreprocess=(t,e,r)=>new Oo({schema:e,effect:{type:"preprocess",transform:t},typeName:fe.ZodEffects,...Te(r)});Eo=class extends ze{_parse(e){return this._getType(e)===X.undefined?tn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Eo.create=(t,e)=>new Eo({innerType:t,typeName:fe.ZodOptional,...Te(e)});Ki=class extends ze{_parse(e){return this._getType(e)===X.null?tn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ki.create=(t,e)=>new Ki({innerType:t,typeName:fe.ZodNullable,...Te(e)});ml=class extends ze{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===X.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};ml.create=(t,e)=>new ml({innerType:t,typeName:fe.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Te(e)});hl=class extends ze{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return gf(o)?o.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Dn(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Dn(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};hl.create=(t,e)=>new hl({innerType:t,typeName:fe.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Te(e)});Af=class extends ze{_parse(e){if(this._getType(e)!==X.nan){let n=this._getOrReturnCtx(e);return W(n,{code:D.invalid_type,expected:X.nan,received:n.parsedType}),ge}return{status:"valid",value:e.data}}};Af.create=t=>new Af({typeName:fe.ZodNaN,...Te(t)});g_=class extends ze{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},y_=class t extends ze{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?ge:i.status==="dirty"?(r.dirty(),nl(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?ge:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:fe.ZodPipeline})}},gl=class extends ze{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Fa(o)&&(o.value=Object.freeze(o.value)),o);return gf(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};gl.create=(t,e)=>new gl({innerType:t,typeName:fe.ZodReadonly,...Te(e)});Nve={object:qn.lazycreate};(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(fe||(fe={}));zve=il.create,Rve=yf.create,Mve=Af.create,Dve=vf.create,qve=_f.create,Uve=bf.create,Bve=wf.create,Lve=sl.create,Zve=al.create,Vve=xf.create,Fve=Bs.create,Hve=li.create,Kve=Sf.create,Wve=Ls.create,NJ=qn.create,Gve=qn.strictCreate,Jve=cl.create,Xve=v$.create,Yve=ul.create,Qve=Hi.create,e_e=b$.create,t_e=kf.create,r_e=$f.create,n_e=w$.create,o_e=ll.create,i_e=dl.create,s_e=pl.create,a_e=fl.create,c_e=Ha.create,u_e=Oo.create,l_e=Eo.create,d_e=Ki.create,p_e=Oo.createWithPreprocess,f_e=y_.create});var x$=A(()=>{m_();g$();qD();mf();FD();f_()});var Pf=A(()=>{x$();x$()});function S(t,e,r){function n(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(t))return;a._zod.traits.add(t),e(a,c);let u=s.prototype,l=Object.keys(u);for(let d=0;d<l.length;d++){let p=l[d];p in a||(a[p]=u[p].bind(a))}}let o=r?.Parent??Object;class i extends o{}Object.defineProperty(i,"name",{value:t});function s(a){var c;let u=r?.Parent?new i:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(s,"name",{value:t}),s}function yr(t){return t&&Object.assign(v_,t),v_}var __,di,Ka,v_,yl=A(()=>{__=Object.freeze({status:"aborted"});di=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Ka=class extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}},v_={}});var q={};To(q,{BIGINT_FORMAT_RANGES:()=>O$,Class:()=>k$,NUMBER_FORMAT_RANGES:()=>E$,aborted:()=>Hs,allowsEval:()=>P$,assert:()=>BJ,assertEqual:()=>MJ,assertIs:()=>qJ,assertNever:()=>UJ,assertNotEqual:()=>DJ,assignProp:()=>Vs,base64ToUint8Array:()=>QD,base64urlToUint8Array:()=>YJ,cached:()=>_l,captureStackTrace:()=>w_,cleanEnum:()=>XJ,cleanRegex:()=>If,clone:()=>rn,cloneDef:()=>ZJ,createTransparentProxy:()=>GJ,defineLazy:()=>Ie,esc:()=>b_,escapeRegex:()=>eo,extend:()=>GD,finalizeIssue:()=>hn,floatSafeRemainder:()=>$$,getElementAtPath:()=>VJ,getEnumValues:()=>Tf,getLengthableOrigin:()=>jf,getParsedType:()=>WJ,getSizableOrigin:()=>Of,hexToUint8Array:()=>e7,isObject:()=>Wa,isPlainObject:()=>Fs,issue:()=>bl,joinValues:()=>me,jsonStringifyReplacer:()=>vl,merge:()=>JJ,mergeDefs:()=>Wi,normalizeParams:()=>F,nullish:()=>Zs,numKeys:()=>KJ,objectClone:()=>LJ,omit:()=>WD,optionalKeys:()=>I$,parsedType:()=>ye,partial:()=>XD,pick:()=>KD,prefixIssues:()=>Un,primitiveTypes:()=>T$,promiseAllObject:()=>FJ,propertyKeyTypes:()=>Ef,randomString:()=>HJ,required:()=>YD,safeExtend:()=>JD,shallowClone:()=>C$,slugify:()=>A$,stringifyPrimitive:()=>he,uint8ArrayToBase64:()=>eq,uint8ArrayToBase64url:()=>QJ,uint8ArrayToHex:()=>t7,unwrapMessage:()=>Cf});function MJ(t){return t}function DJ(t){return t}function qJ(t){}function UJ(t){throw new Error("Unexpected value in exhaustive check")}function BJ(t){}function Tf(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function me(t,e="|"){return t.map(r=>he(r)).join(e)}function vl(t,e){return typeof e=="bigint"?e.toString():e}function _l(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function Zs(t){return t==null}function If(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function $$(t,e){let r=(t.toString().split(".")[1]||"").length,n=e.toString(),o=(n.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(n)){let c=n.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}let i=r>o?r:o,s=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}function Ie(t,e,r){let n;Object.defineProperty(t,e,{get(){if(n!==HD)return n===void 0&&(n=HD,n=r()),n},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function LJ(t){return Object.create(Object.getPrototypeOf(t),Object.getOwnPropertyDescriptors(t))}function Vs(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function Wi(...t){let e={};for(let r of t){let n=Object.getOwnPropertyDescriptors(r);Object.assign(e,n)}return Object.defineProperties({},e)}function ZJ(t){return Wi(t._zod.def)}function VJ(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function FJ(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let i=0;i<e.length;i++)o[e[i]]=n[i];return o})}function HJ(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function b_(t){return JSON.stringify(t)}function A$(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}function Wa(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Fs(t){if(Wa(t)===!1)return!1;let e=t.constructor;if(e===void 0||typeof e!="function")return!0;let r=e.prototype;return!(Wa(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function C$(t){return Fs(t)?{...t}:Array.isArray(t)?[...t]:t}function KJ(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function eo(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function rn(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function F(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function GJ(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,i){return e??(e=t()),Reflect.set(e,n,o,i)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function he(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function I$(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}function KD(t,e){let r=t._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");let i=Wi(t._zod.def,{get shape(){let s={};for(let a in e){if(!(a in r.shape))throw new Error(`Unrecognized key: "${a}"`);e[a]&&(s[a]=r.shape[a])}return Vs(this,"shape",s),s},checks:[]});return rn(t,i)}function WD(t,e){let r=t._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");let i=Wi(t._zod.def,{get shape(){let s={...t._zod.def.shape};for(let a in e){if(!(a in r.shape))throw new Error(`Unrecognized key: "${a}"`);e[a]&&delete s[a]}return Vs(this,"shape",s),s},checks:[]});return rn(t,i)}function GD(t,e){if(!Fs(e))throw new Error("Invalid input to extend: expected a plain object");let r=t._zod.def.checks;if(r&&r.length>0){let i=t._zod.def.shape;for(let s in e)if(Object.getOwnPropertyDescriptor(i,s)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}let o=Wi(t._zod.def,{get shape(){let i={...t._zod.def.shape,...e};return Vs(this,"shape",i),i}});return rn(t,o)}function JD(t,e){if(!Fs(e))throw new Error("Invalid input to safeExtend: expected a plain object");let r=Wi(t._zod.def,{get shape(){let n={...t._zod.def.shape,...e};return Vs(this,"shape",n),n}});return rn(t,r)}function JJ(t,e){let r=Wi(t._zod.def,{get shape(){let n={...t._zod.def.shape,...e._zod.def.shape};return Vs(this,"shape",n),n},get catchall(){return e._zod.def.catchall},checks:[]});return rn(t,r)}function XD(t,e,r){let o=e._zod.def.checks;if(o&&o.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");let s=Wi(e._zod.def,{get shape(){let a=e._zod.def.shape,c={...a};if(r)for(let u in r){if(!(u in a))throw new Error(`Unrecognized key: "${u}"`);r[u]&&(c[u]=t?new t({type:"optional",innerType:a[u]}):a[u])}else for(let u in a)c[u]=t?new t({type:"optional",innerType:a[u]}):a[u];return Vs(this,"shape",c),c},checks:[]});return rn(e,s)}function YD(t,e,r){let n=Wi(e._zod.def,{get shape(){let o=e._zod.def.shape,i={...o};if(r)for(let s in r){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(i[s]=new t({type:"nonoptional",innerType:o[s]}))}else for(let s in o)i[s]=new t({type:"nonoptional",innerType:o[s]});return Vs(this,"shape",i),i}});return rn(e,n)}function Hs(t,e=0){if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function Un(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function Cf(t){return typeof t=="string"?t:t?.message}function hn(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=Cf(t.inst?._zod.def?.error?.(t))??Cf(e?.error?.(t))??Cf(r.customError?.(t))??Cf(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Of(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function jf(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function ye(t){let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"nan":"number";case"object":{if(t===null)return"null";if(Array.isArray(t))return"array";let r=t;if(r&&Object.getPrototypeOf(r)!==Object.prototype&&"constructor"in r&&r.constructor)return r.constructor.name}}return e}function bl(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function XJ(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function QD(t){let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function eq(t){let e="";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function YJ(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-e.length%4)%4);return QD(e+r)}function QJ(t){return eq(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function e7(t){let e=t.replace(/^0x/,"");if(e.length%2!==0)throw new Error("Invalid hex string length");let r=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)r[n/2]=Number.parseInt(e.slice(n,n+2),16);return r}function t7(t){return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}var HD,w_,P$,WJ,Ef,T$,E$,O$,k$,ae=A(()=>{HD=Symbol("evaluating");w_="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};P$=_l(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});WJ=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Ef=new Set(["string","number","symbol"]),T$=new Set(["string","number","bigint","boolean","symbol","undefined"]);E$={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},O$={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};k$=class{constructor(...e){}}});function S_(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function k_(t,e=r=>r.message){let r={_errors:[]},n=o=>{for(let i of o.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(s=>n({issues:s}));else if(i.code==="invalid_key")n({issues:i.issues});else if(i.code==="invalid_element")n({issues:i.issues});else if(i.path.length===0)r._errors.push(e(i));else{let s=r,a=0;for(;a<i.path.length;){let c=i.path[a];a===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(e(i))):s[c]=s[c]||{_errors:[]},s=s[c],a++}}};return n(t),r}var tq,x_,Nf,j$=A(()=>{yl();ae();tq=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,vl,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},x_=S("$ZodError",tq),Nf=S("$ZodError",tq,{Parent:Error})});var zf,Rf,Mf,Df,qf,wl,Uf,Bf,rq,nq,oq,iq,sq,aq,cq,uq,N$=A(()=>{yl();j$();ae();zf=t=>(e,r,n,o)=>{let i=n?Object.assign(n,{async:!1}):{async:!1},s=e._zod.run({value:r,issues:[]},i);if(s instanceof Promise)throw new di;if(s.issues.length){let a=new(o?.Err??t)(s.issues.map(c=>hn(c,i,yr())));throw w_(a,o?.callee),a}return s.value},Rf=zf(Nf),Mf=t=>async(e,r,n,o)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){let a=new(o?.Err??t)(s.issues.map(c=>hn(c,i,yr())));throw w_(a,o?.callee),a}return s.value},Df=Mf(Nf),qf=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new di;return i.issues.length?{success:!1,error:new(t??x_)(i.issues.map(s=>hn(s,o,yr())))}:{success:!0,data:i.value}},wl=qf(Nf),Uf=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new t(i.issues.map(s=>hn(s,o,yr())))}:{success:!0,data:i.value}},Bf=Uf(Nf),rq=t=>(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return zf(t)(e,r,o)},nq=t=>(e,r,n)=>zf(t)(e,r,n),oq=t=>async(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Mf(t)(e,r,o)},iq=t=>async(e,r,n)=>Mf(t)(e,r,n),sq=t=>(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return qf(t)(e,r,o)},aq=t=>(e,r,n)=>qf(t)(e,r,n),cq=t=>async(e,r,n)=>{let o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Uf(t)(e,r,o)},uq=t=>async(e,r,n)=>Uf(t)(e,r,n)});var to={};To(to,{base64:()=>J$,base64url:()=>$_,bigint:()=>rA,boolean:()=>oA,browserEmail:()=>l7,cidrv4:()=>W$,cidrv6:()=>G$,cuid:()=>z$,cuid2:()=>R$,date:()=>Y$,datetime:()=>eA,domain:()=>f7,duration:()=>B$,e164:()=>X$,email:()=>Z$,emoji:()=>V$,extendedDuration:()=>n7,guid:()=>L$,hex:()=>m7,hostname:()=>p7,html5Email:()=>a7,idnEmail:()=>u7,integer:()=>nA,ipv4:()=>F$,ipv6:()=>H$,ksuid:()=>q$,lowercase:()=>aA,mac:()=>K$,md5_base64:()=>g7,md5_base64url:()=>y7,md5_hex:()=>h7,nanoid:()=>U$,null:()=>iA,number:()=>A_,rfc5322Email:()=>c7,sha1_base64:()=>_7,sha1_base64url:()=>b7,sha1_hex:()=>v7,sha256_base64:()=>x7,sha256_base64url:()=>S7,sha256_hex:()=>w7,sha384_base64:()=>$7,sha384_base64url:()=>A7,sha384_hex:()=>k7,sha512_base64:()=>C7,sha512_base64url:()=>T7,sha512_hex:()=>P7,string:()=>tA,time:()=>Q$,ulid:()=>M$,undefined:()=>sA,unicodeEmail:()=>lq,uppercase:()=>cA,uuid:()=>Ga,uuid4:()=>o7,uuid6:()=>i7,uuid7:()=>s7,xid:()=>D$});function V$(){return new RegExp(d7,"u")}function pq(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Q$(t){return new RegExp(`^${pq(t)}$`)}function eA(t){let e=pq({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${dq}T(?:${n})$`)}function Lf(t,e){return new RegExp(`^[A-Za-z0-9+/]{${t}}${e}$`)}function Zf(t){return new RegExp(`^[A-Za-z0-9_-]{${t}}$`)}var z$,R$,M$,D$,q$,U$,B$,n7,L$,Ga,o7,i7,s7,Z$,a7,c7,lq,u7,l7,d7,F$,H$,K$,W$,G$,J$,$_,p7,f7,X$,dq,Y$,tA,rA,nA,A_,oA,iA,sA,aA,cA,m7,h7,g7,y7,v7,_7,b7,w7,x7,S7,k7,$7,A7,P7,C7,T7,P_=A(()=>{ae();z$=/^[cC][^\s-]{8,}$/,R$=/^[0-9a-z]+$/,M$=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,D$=/^[0-9a-vA-V]{20}$/,q$=/^[A-Za-z0-9]{27}$/,U$=/^[a-zA-Z0-9_-]{21}$/,B$=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,n7=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,L$=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Ga=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,o7=Ga(4),i7=Ga(6),s7=Ga(7),Z$=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,a7=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,c7=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,lq=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,u7=lq,l7=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,d7="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";F$=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,H$=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,K$=t=>{let e=eo(t??":");return new RegExp(`^(?:[0-9A-F]{2}${e}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${e}){5}[0-9a-f]{2}$`)},W$=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,G$=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,J$=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,$_=/^[A-Za-z0-9_-]*$/,p7=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,f7=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,X$=/^\+[1-9]\d{6,14}$/,dq="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Y$=new RegExp(`^${dq}$`);tA=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},rA=/^-?\d+n?$/,nA=/^-?\d+$/,A_=/^-?\d+(?:\.\d+)?$/,oA=/^(?:true|false)$/i,iA=/^null$/i,sA=/^undefined$/i,aA=/^[^A-Z]*$/,cA=/^[^a-z]*$/,m7=/^[0-9a-fA-F]*$/;h7=/^[0-9a-fA-F]{32}$/,g7=Lf(22,"=="),y7=Zf(22),v7=/^[0-9a-fA-F]{40}$/,_7=Lf(27,"="),b7=Zf(27),w7=/^[0-9a-fA-F]{64}$/,x7=Lf(43,"="),S7=Zf(43),k7=/^[0-9a-fA-F]{96}$/,$7=Lf(64,""),A7=Zf(64),P7=/^[0-9a-fA-F]{128}$/,C7=Lf(86,"=="),T7=Zf(86)});function fq(t,e,r){t.issues.length&&e.issues.push(...Un(r,t.issues))}var vt,mq,uA,lA,hq,gq,yq,vq,_q,bq,wq,xq,Sq,Vf,kq,$q,Aq,Pq,Cq,Tq,Iq,Eq,Oq,C_=A(()=>{yl();P_();ae();vt=S("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),mq={number:"number",bigint:"bigint",object:"date"},uA=S("$ZodCheckLessThan",(t,e)=>{vt.init(t,e);let r=mq[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,i=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<i&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),lA=S("$ZodCheckGreaterThan",(t,e)=>{vt.init(t,e);let r=mq[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,i=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>i&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),hq=S("$ZodCheckMultipleOf",(t,e)=>{vt.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):$$(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),gq=S("$ZodCheckNumberFormat",(t,e)=>{vt.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,i]=E$[e.format];t._zod.onattach.push(s=>{let a=s._zod.bag;a.format=e.format,a.minimum=o,a.maximum=i,r&&(a.pattern=nA)}),t._zod.check=s=>{let a=s.value;if(r){if(!Number.isInteger(a)){s.issues.push({expected:n,format:e.format,code:"invalid_type",continue:!1,input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?s.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,inclusive:!0,continue:!e.abort}):s.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,inclusive:!0,continue:!e.abort});return}}a<o&&s.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>i&&s.issues.push({origin:"number",input:a,code:"too_big",maximum:i,inclusive:!0,inst:t,continue:!e.abort})}}),yq=S("$ZodCheckBigIntFormat",(t,e)=>{vt.init(t,e);let[r,n]=O$[e.format];t._zod.onattach.push(o=>{let i=o._zod.bag;i.format=e.format,i.minimum=r,i.maximum=n}),t._zod.check=o=>{let i=o.value;i<r&&o.issues.push({origin:"bigint",input:i,code:"too_small",minimum:r,inclusive:!0,inst:t,continue:!e.abort}),i>n&&o.issues.push({origin:"bigint",input:i,code:"too_big",maximum:n,inclusive:!0,inst:t,continue:!e.abort})}}),vq=S("$ZodCheckMaxSize",(t,e)=>{var r;vt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Zs(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;o.size<=e.maximum||n.issues.push({origin:Of(o),code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),_q=S("$ZodCheckMinSize",(t,e)=>{var r;vt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Zs(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;o.size>=e.minimum||n.issues.push({origin:Of(o),code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),bq=S("$ZodCheckSizeEquals",(t,e)=>{var r;vt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Zs(o)&&o.size!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.size,o.maximum=e.size,o.size=e.size}),t._zod.check=n=>{let o=n.value,i=o.size;if(i===e.size)return;let s=i>e.size;n.issues.push({origin:Of(o),...s?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),wq=S("$ZodCheckMaxLength",(t,e)=>{var r;vt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Zs(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let s=jf(o);n.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),xq=S("$ZodCheckMinLength",(t,e)=>{var r;vt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Zs(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let s=jf(o);n.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Sq=S("$ZodCheckLengthEquals",(t,e)=>{var r;vt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Zs(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,i=o.length;if(i===e.length)return;let s=jf(o),a=i>e.length;n.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Vf=S("$ZodCheckStringFormat",(t,e)=>{var r,n;vt.init(t,e),t._zod.onattach.push(o=>{let i=o._zod.bag;i.format=e.format,e.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),kq=S("$ZodCheckRegex",(t,e)=>{Vf.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),$q=S("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=aA),Vf.init(t,e)}),Aq=S("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=cA),Vf.init(t,e)}),Pq=S("$ZodCheckIncludes",(t,e)=>{vt.init(t,e);let r=eo(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),Cq=S("$ZodCheckStartsWith",(t,e)=>{vt.init(t,e);let r=new RegExp(`^${eo(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),Tq=S("$ZodCheckEndsWith",(t,e)=>{vt.init(t,e);let r=new RegExp(`.*${eo(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});Iq=S("$ZodCheckProperty",(t,e)=>{vt.init(t,e),t._zod.check=r=>{let n=e.schema._zod.run({value:r.value[e.property],issues:[]},{});if(n instanceof Promise)return n.then(o=>fq(o,r,e.property));fq(n,r,e.property)}}),Eq=S("$ZodCheckMimeType",(t,e)=>{vt.init(t,e);let r=new Set(e.mime);t._zod.onattach.push(n=>{n._zod.bag.mime=e.mime}),t._zod.check=n=>{r.has(n.value.type)||n.issues.push({code:"invalid_value",values:e.mime,input:n.value.type,inst:t,continue:!e.abort})}}),Oq=S("$ZodCheckOverwrite",(t,e)=>{vt.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}})});var T_,dA=A(()=>{T_=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(s=>s),o=Math.min(...n.map(s=>s.length-s.trimStart().length)),i=n.map(s=>s.slice(o)).map(s=>" ".repeat(this.indent*2)+s);for(let s of i)this.content.push(s)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(i=>`  ${i}`)];return new e(...r,o.join(`
`))}}});var Nq,pA=A(()=>{Nq={major:4,minor:3,patch:6}});function Hq(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}function I7(t){if(!$_.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Hq(r)}function E7(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}function zq(t,e,r){t.issues.length&&e.issues.push(...Un(r,t.issues)),e.value[r]=t.value}function N_(t,e,r,n,o){if(t.issues.length){if(o&&!(r in n))return;e.issues.push(...Un(r,t.issues))}t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}function Kq(t){let e=Object.keys(t.shape);for(let n of e)if(!t.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);let r=I$(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}}function Wq(t,e,r,n,o,i){let s=[],a=o.keySet,c=o.catchall._zod,u=c.def.type,l=c.optout==="optional";for(let d in e){if(a.has(d))continue;if(u==="never"){s.push(d);continue}let p=c.run({value:e[d],issues:[]},n);p instanceof Promise?t.push(p.then(f=>N_(f,r,d,e,l))):N_(p,r,d,e,l)}return s.length&&r.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:i}),t.length?Promise.all(t).then(()=>r):r}function Rq(t,e,r,n){for(let i of t)if(i.issues.length===0)return e.value=i.value,e;let o=t.filter(i=>!Hs(i));return o.length===1?(e.value=o[0].value,o[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(i=>i.issues.map(s=>hn(s,n,yr())))}),e)}function Mq(t,e,r,n){let o=t.filter(i=>i.issues.length===0);return o.length===1?(e.value=o[0].value,e):(o.length===0?e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(i=>i.issues.map(s=>hn(s,n,yr())))}):e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:[],inclusive:!1}),e)}function fA(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Fs(t)&&Fs(e)){let r=Object.keys(e),n=Object.keys(t).filter(i=>r.indexOf(i)!==-1),o={...t,...e};for(let i of n){let s=fA(t[i],e[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};o[i]=s.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],i=e[n],s=fA(o,i);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Dq(t,e,r){let n=new Map,o;for(let a of e.issues)if(a.code==="unrecognized_keys"){o??(o=a);for(let c of a.keys)n.has(c)||n.set(c,{}),n.get(c).l=!0}else t.issues.push(a);for(let a of r.issues)if(a.code==="unrecognized_keys")for(let c of a.keys)n.has(c)||n.set(c,{}),n.get(c).r=!0;else t.issues.push(a);let i=[...n].filter(([,a])=>a.l&&a.r).map(([a])=>a);if(i.length&&o&&t.issues.push({...o,keys:i}),Hs(t))return t;let s=fA(e.value,r.value);if(!s.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return t.value=s.data,t}function I_(t,e,r){t.issues.length&&e.issues.push(...Un(r,t.issues)),e.value[r]=t.value}function qq(t,e,r,n,o,i,s){t.issues.length&&(Ef.has(typeof n)?r.issues.push(...Un(n,t.issues)):r.issues.push({code:"invalid_key",origin:"map",input:o,inst:i,issues:t.issues.map(a=>hn(a,s,yr()))})),e.issues.length&&(Ef.has(typeof n)?r.issues.push(...Un(n,e.issues)):r.issues.push({origin:"map",code:"invalid_element",input:o,inst:i,key:n,issues:e.issues.map(a=>hn(a,s,yr()))})),r.value.set(t.value,e.value)}function Uq(t,e){t.issues.length&&e.issues.push(...t.issues),e.value.add(t.value)}function Bq(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}function Lq(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}function Zq(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}function E_(t,e,r){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},r)}function O_(t,e,r){if(t.issues.length)return t.aborted=!0,t;if((r.direction||"forward")==="forward"){let o=e.transform(t.value,t);return o instanceof Promise?o.then(i=>j_(t,i,e.out,r)):j_(t,o,e.out,r)}else{let o=e.reverseTransform(t.value,t);return o instanceof Promise?o.then(i=>j_(t,i,e.in,r)):j_(t,o,e.in,r)}}function j_(t,e,r,n){return t.issues.length?(t.aborted=!0,t):r._zod.run({value:e,issues:t.issues},n)}function Vq(t){return t.value=Object.freeze(t.value),t}function Fq(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(bl(o))}}var Ae,Ja,ft,mA,hA,gA,yA,vA,_A,bA,wA,xA,SA,kA,$A,AA,PA,CA,TA,IA,EA,OA,jA,NA,zA,RA,MA,DA,z_,qA,Ff,R_,UA,BA,LA,ZA,VA,FA,HA,KA,WA,GA,Gq,Jq,Hf,JA,XA,YA,M_,QA,eP,tP,rP,nP,oP,iP,D_,sP,aP,cP,uP,lP,dP,pP,fP,mP,Kf,hP,gP,yP,vP,_P,bP,wP=A(()=>{C_();yl();dA();N$();P_();ae();pA();ae();Ae=S("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=Nq;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let i of o._zod.onattach)i(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,a,c)=>{let u=Hs(s),l;for(let d of a){if(d._zod.def.when){if(!d._zod.def.when(s))continue}else if(u)continue;let p=s.issues.length,f=d._zod.check(s);if(f instanceof Promise&&c?.async===!1)throw new di;if(l||f instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await f,s.issues.length!==p&&(u||(u=Hs(s,p)))});else{if(s.issues.length===p)continue;u||(u=Hs(s,p))}}return l?l.then(()=>s):s},i=(s,a,c)=>{if(Hs(s))return s.aborted=!0,s;let u=o(a,n,c);if(u instanceof Promise){if(c.async===!1)throw new di;return u.then(l=>t._zod.parse(l,c))}return t._zod.parse(u,c)};t._zod.run=(s,a)=>{if(a.skipChecks)return t._zod.parse(s,a);if(a.direction==="backward"){let u=t._zod.parse({value:s.value,issues:[]},{...a,skipChecks:!0});return u instanceof Promise?u.then(l=>i(l,s,a)):i(u,s,a)}let c=t._zod.parse(s,a);if(c instanceof Promise){if(a.async===!1)throw new di;return c.then(u=>o(u,n,a))}return o(c,n,a)}}Ie(t,"~standard",()=>({validate:o=>{try{let i=wl(t,o);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return Bf(t,o).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}))}),Ja=S("$ZodString",(t,e)=>{Ae.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??tA(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),ft=S("$ZodStringFormat",(t,e)=>{Vf.init(t,e),Ja.init(t,e)}),mA=S("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=L$),ft.init(t,e)}),hA=S("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Ga(n))}else e.pattern??(e.pattern=Ga());ft.init(t,e)}),gA=S("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Z$),ft.init(t,e)}),yA=S("$ZodURL",(t,e)=>{ft.init(t,e),t._zod.check=r=>{try{let n=r.value.trim(),o=new URL(n);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),e.normalize?r.value=o.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),vA=S("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=V$()),ft.init(t,e)}),_A=S("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=U$),ft.init(t,e)}),bA=S("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=z$),ft.init(t,e)}),wA=S("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=R$),ft.init(t,e)}),xA=S("$ZodULID",(t,e)=>{e.pattern??(e.pattern=M$),ft.init(t,e)}),SA=S("$ZodXID",(t,e)=>{e.pattern??(e.pattern=D$),ft.init(t,e)}),kA=S("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=q$),ft.init(t,e)}),$A=S("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=eA(e)),ft.init(t,e)}),AA=S("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=Y$),ft.init(t,e)}),PA=S("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=Q$(e)),ft.init(t,e)}),CA=S("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=B$),ft.init(t,e)}),TA=S("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=F$),ft.init(t,e),t._zod.bag.format="ipv4"}),IA=S("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=H$),ft.init(t,e),t._zod.bag.format="ipv6",t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),EA=S("$ZodMAC",(t,e)=>{e.pattern??(e.pattern=K$(e.delimiter)),ft.init(t,e),t._zod.bag.format="mac"}),OA=S("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=W$),ft.init(t,e)}),jA=S("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=G$),ft.init(t,e),t._zod.check=r=>{let n=r.value.split("/");try{if(n.length!==2)throw new Error;let[o,i]=n;if(!i)throw new Error;let s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${o}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});NA=S("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=J$),ft.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=r=>{Hq(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});zA=S("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=$_),ft.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=r=>{I7(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),RA=S("$ZodE164",(t,e)=>{e.pattern??(e.pattern=X$),ft.init(t,e)});MA=S("$ZodJWT",(t,e)=>{ft.init(t,e),t._zod.check=r=>{E7(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}}),DA=S("$ZodCustomStringFormat",(t,e)=>{ft.init(t,e),t._zod.check=r=>{e.fn(r.value)||r.issues.push({code:"invalid_format",format:e.format,input:r.value,inst:t,continue:!e.abort})}}),z_=S("$ZodNumber",(t,e)=>{Ae.init(t,e),t._zod.pattern=t._zod.bag.pattern??A_,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...i?{received:i}:{}}),r}}),qA=S("$ZodNumberFormat",(t,e)=>{gq.init(t,e),z_.init(t,e)}),Ff=S("$ZodBoolean",(t,e)=>{Ae.init(t,e),t._zod.pattern=oA,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}}),R_=S("$ZodBigInt",(t,e)=>{Ae.init(t,e),t._zod.pattern=rA,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=BigInt(r.value)}catch{}return typeof r.value=="bigint"||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:t}),r}}),UA=S("$ZodBigIntFormat",(t,e)=>{yq.init(t,e),R_.init(t,e)}),BA=S("$ZodSymbol",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return typeof o=="symbol"||r.issues.push({expected:"symbol",code:"invalid_type",input:o,inst:t}),r}}),LA=S("$ZodUndefined",(t,e)=>{Ae.init(t,e),t._zod.pattern=sA,t._zod.values=new Set([void 0]),t._zod.optin="optional",t._zod.optout="optional",t._zod.parse=(r,n)=>{let o=r.value;return typeof o>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:o,inst:t}),r}}),ZA=S("$ZodNull",(t,e)=>{Ae.init(t,e),t._zod.pattern=iA,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}}),VA=S("$ZodAny",(t,e)=>{Ae.init(t,e),t._zod.parse=r=>r}),FA=S("$ZodUnknown",(t,e)=>{Ae.init(t,e),t._zod.parse=r=>r}),HA=S("$ZodNever",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)}),KA=S("$ZodVoid",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return typeof o>"u"||r.issues.push({expected:"void",code:"invalid_type",input:o,inst:t}),r}}),WA=S("$ZodDate",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=new Date(r.value)}catch{}let o=r.value,i=o instanceof Date;return i&&!Number.isNaN(o.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:o,...i?{received:"Invalid Date"}:{},inst:t}),r}});GA=S("$ZodArray",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let i=[];for(let s=0;s<o.length;s++){let a=o[s],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?i.push(c.then(u=>zq(u,r,s))):zq(c,r,s)}return i.length?Promise.all(i).then(()=>r):r}});Gq=S("$ZodObject",(t,e)=>{if(Ae.init(t,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){let a=e.shape;Object.defineProperty(e,"shape",{get:()=>{let c={...a};return Object.defineProperty(e,"shape",{value:c}),c}})}let n=_l(()=>Kq(e));Ie(t._zod,"propValues",()=>{let a=e.shape,c={};for(let u in a){let l=a[u]._zod;if(l.values){c[u]??(c[u]=new Set);for(let d of l.values)c[u].add(d)}}return c});let o=Wa,i=e.catchall,s;t._zod.parse=(a,c)=>{s??(s=n.value);let u=a.value;if(!o(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:t}),a;a.value={};let l=[],d=s.shape;for(let p of s.keys){let f=d[p],h=f._zod.optout==="optional",m=f._zod.run({value:u[p],issues:[]},c);m instanceof Promise?l.push(m.then(y=>N_(y,a,p,u,h))):N_(m,a,p,u,h)}return i?Wq(l,u,a,c,n.value,t):l.length?Promise.all(l).then(()=>a):a}}),Jq=S("$ZodObjectJIT",(t,e)=>{Gq.init(t,e);let r=t._zod.parse,n=_l(()=>Kq(e)),o=p=>{let f=new T_(["shape","payload","ctx"]),h=n.value,m=x=>{let C=b_(x);return`shape[${C}]._zod.run({ value: input[${C}], issues: [] }, ctx)`};f.write("const input = payload.value;");let y=Object.create(null),v=0;for(let x of h.keys)y[x]=`key_${v++}`;f.write("const newResult = {};");for(let x of h.keys){let C=y[x],$=b_(x),xe=p[x]?._zod?.optout==="optional";f.write(`const ${C} = ${m(x)};`),xe?f.write(`
        if (${C}.issues.length) {
          if (${$} in input) {
            payload.issues = payload.issues.concat(${C}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${$}, ...iss.path] : [${$}]
            })));
          }
        }
        
        if (${C}.value === undefined) {
          if (${$} in input) {
            newResult[${$}] = undefined;
          }
        } else {
          newResult[${$}] = ${C}.value;
        }
        
      `):f.write(`
        if (${C}.issues.length) {
          payload.issues = payload.issues.concat(${C}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${$}, ...iss.path] : [${$}]
          })));
        }
        
        if (${C}.value === undefined) {
          if (${$} in input) {
            newResult[${$}] = undefined;
          }
        } else {
          newResult[${$}] = ${C}.value;
        }
        
      `)}f.write("payload.value = newResult;"),f.write("return payload;");let b=f.compile();return(x,C)=>b(p,x,C)},i,s=Wa,a=!v_.jitless,u=a&&P$.value,l=e.catchall,d;t._zod.parse=(p,f)=>{d??(d=n.value);let h=p.value;return s(h)?a&&u&&f?.async===!1&&f.jitless!==!0?(i||(i=o(e.shape)),p=i(p,f),l?Wq([],h,p,f,d,t):p):r(p,f):(p.issues.push({expected:"object",code:"invalid_type",input:h,inst:t}),p)}});Hf=S("$ZodUnion",(t,e)=>{Ae.init(t,e),Ie(t._zod,"optin",()=>e.options.some(o=>o._zod.optin==="optional")?"optional":void 0),Ie(t._zod,"optout",()=>e.options.some(o=>o._zod.optout==="optional")?"optional":void 0),Ie(t._zod,"values",()=>{if(e.options.every(o=>o._zod.values))return new Set(e.options.flatMap(o=>Array.from(o._zod.values)))}),Ie(t._zod,"pattern",()=>{if(e.options.every(o=>o._zod.pattern)){let o=e.options.map(i=>i._zod.pattern);return new RegExp(`^(${o.map(i=>If(i.source)).join("|")})$`)}});let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let c of e.options){let u=c._zod.run({value:o.value,issues:[]},i);if(u instanceof Promise)a.push(u),s=!0;else{if(u.issues.length===0)return u;a.push(u)}}return s?Promise.all(a).then(c=>Rq(c,o,t,i)):Rq(a,o,t,i)}});JA=S("$ZodXor",(t,e)=>{Hf.init(t,e),e.inclusive=!1;let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let c of e.options){let u=c._zod.run({value:o.value,issues:[]},i);u instanceof Promise?(a.push(u),s=!0):a.push(u)}return s?Promise.all(a).then(c=>Mq(c,o,t,i)):Mq(a,o,t,i)}}),XA=S("$ZodDiscriminatedUnion",(t,e)=>{e.inclusive=!1,Hf.init(t,e);let r=t._zod.parse;Ie(t._zod,"propValues",()=>{let o={};for(let i of e.options){let s=i._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let[a,c]of Object.entries(s)){o[a]||(o[a]=new Set);for(let u of c)o[a].add(u)}}return o});let n=_l(()=>{let o=e.options,i=new Map;for(let s of o){let a=s._zod.propValues?.[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let c of a){if(i.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);i.set(c,s)}}return i});t._zod.parse=(o,i)=>{let s=o.value;if(!Wa(s))return o.issues.push({code:"invalid_type",expected:"object",input:s,inst:t}),o;let a=n.value.get(s?.[e.discriminator]);return a?a._zod.run(o,i):e.unionFallback?r(o,i):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:s,path:[e.discriminator],inst:t}),o)}}),YA=S("$ZodIntersection",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,i=e.left._zod.run({value:o,issues:[]},n),s=e.right._zod.run({value:o,issues:[]},n);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([c,u])=>Dq(r,c,u)):Dq(r,i,s)}});M_=S("$ZodTuple",(t,e)=>{Ae.init(t,e);let r=e.items;t._zod.parse=(n,o)=>{let i=n.value;if(!Array.isArray(i))return n.issues.push({input:i,inst:t,expected:"tuple",code:"invalid_type"}),n;n.value=[];let s=[],a=[...r].reverse().findIndex(l=>l._zod.optin!=="optional"),c=a===-1?0:r.length-a;if(!e.rest){let l=i.length>r.length,d=i.length<c-1;if(l||d)return n.issues.push({...l?{code:"too_big",maximum:r.length,inclusive:!0}:{code:"too_small",minimum:r.length},input:i,inst:t,origin:"array"}),n}let u=-1;for(let l of r){if(u++,u>=i.length&&u>=c)continue;let d=l._zod.run({value:i[u],issues:[]},o);d instanceof Promise?s.push(d.then(p=>I_(p,n,u))):I_(d,n,u)}if(e.rest){let l=i.slice(r.length);for(let d of l){u++;let p=e.rest._zod.run({value:d,issues:[]},o);p instanceof Promise?s.push(p.then(f=>I_(f,n,u))):I_(p,n,u)}}return s.length?Promise.all(s).then(()=>n):n}});QA=S("$ZodRecord",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Fs(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let i=[],s=e.keyType._zod.values;if(s){r.value={};let a=new Set;for(let u of s)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){a.add(typeof u=="number"?u.toString():u);let l=e.valueType._zod.run({value:o[u],issues:[]},n);l instanceof Promise?i.push(l.then(d=>{d.issues.length&&r.issues.push(...Un(u,d.issues)),r.value[u]=d.value})):(l.issues.length&&r.issues.push(...Un(u,l.issues)),r.value[u]=l.value)}let c;for(let u in o)a.has(u)||(c=c??[],c.push(u));c&&c.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:c})}else{r.value={};for(let a of Reflect.ownKeys(o)){if(a==="__proto__")continue;let c=e.keyType._zod.run({value:a,issues:[]},n);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof a=="string"&&A_.test(a)&&c.issues.length){let d=e.keyType._zod.run({value:Number(a),issues:[]},n);if(d instanceof Promise)throw new Error("Async schemas not supported in object keys currently");d.issues.length===0&&(c=d)}if(c.issues.length){e.mode==="loose"?r.value[a]=o[a]:r.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(d=>hn(d,n,yr())),input:a,path:[a],inst:t});continue}let l=e.valueType._zod.run({value:o[a],issues:[]},n);l instanceof Promise?i.push(l.then(d=>{d.issues.length&&r.issues.push(...Un(a,d.issues)),r.value[c.value]=d.value})):(l.issues.length&&r.issues.push(...Un(a,l.issues)),r.value[c.value]=l.value)}}return i.length?Promise.all(i).then(()=>r):r}}),eP=S("$ZodMap",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!(o instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:o,inst:t}),r;let i=[];r.value=new Map;for(let[s,a]of o){let c=e.keyType._zod.run({value:s,issues:[]},n),u=e.valueType._zod.run({value:a,issues:[]},n);c instanceof Promise||u instanceof Promise?i.push(Promise.all([c,u]).then(([l,d])=>{qq(l,d,r,s,o,t,n)})):qq(c,u,r,s,o,t,n)}return i.length?Promise.all(i).then(()=>r):r}});tP=S("$ZodSet",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!(o instanceof Set))return r.issues.push({input:o,inst:t,expected:"set",code:"invalid_type"}),r;let i=[];r.value=new Set;for(let s of o){let a=e.valueType._zod.run({value:s,issues:[]},n);a instanceof Promise?i.push(a.then(c=>Uq(c,r))):Uq(a,r)}return i.length?Promise.all(i).then(()=>r):r}});rP=S("$ZodEnum",(t,e)=>{Ae.init(t,e);let r=Tf(e.entries),n=new Set(r);t._zod.values=n,t._zod.pattern=new RegExp(`^(${r.filter(o=>Ef.has(typeof o)).map(o=>typeof o=="string"?eo(o):o.toString()).join("|")})$`),t._zod.parse=(o,i)=>{let s=o.value;return n.has(s)||o.issues.push({code:"invalid_value",values:r,input:s,inst:t}),o}}),nP=S("$ZodLiteral",(t,e)=>{if(Ae.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");let r=new Set(e.values);t._zod.values=r,t._zod.pattern=new RegExp(`^(${e.values.map(n=>typeof n=="string"?eo(n):n?eo(n.toString()):String(n)).join("|")})$`),t._zod.parse=(n,o)=>{let i=n.value;return r.has(i)||n.issues.push({code:"invalid_value",values:e.values,input:i,inst:t}),n}}),oP=S("$ZodFile",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;return o instanceof File||r.issues.push({expected:"file",code:"invalid_type",input:o,inst:t}),r}}),iP=S("$ZodTransform",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Ka(t.constructor.name);let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(s=>(r.value=s,r));if(o instanceof Promise)throw new di;return r.value=o,r}});D_=S("$ZodOptional",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",t._zod.optout="optional",Ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${If(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>{if(e.innerType._zod.optin==="optional"){let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>Bq(i,r.value)):Bq(o,r.value)}return r.value===void 0?r:e.innerType._zod.run(r,n)}}),sP=S("$ZodExactOptional",(t,e)=>{D_.init(t,e),Ie(t._zod,"values",()=>e.innerType._zod.values),Ie(t._zod,"pattern",()=>e.innerType._zod.pattern),t._zod.parse=(r,n)=>e.innerType._zod.run(r,n)}),aP=S("$ZodNullable",(t,e)=>{Ae.init(t,e),Ie(t._zod,"optin",()=>e.innerType._zod.optin),Ie(t._zod,"optout",()=>e.innerType._zod.optout),Ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${If(r.source)}|null)$`):void 0}),Ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),cP=S("$ZodDefault",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",Ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>Lq(i,e)):Lq(o,e)}});uP=S("$ZodPrefault",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",Ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),lP=S("$ZodNonOptional",(t,e)=>{Ae.init(t,e),Ie(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>Zq(i,t)):Zq(o,t)}});dP=S("$ZodSuccess",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Ka("ZodSuccess");let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>(r.value=i.issues.length===0,r)):(r.value=o.issues.length===0,r)}}),pP=S("$ZodCatch",(t,e)=>{Ae.init(t,e),Ie(t._zod,"optin",()=>e.innerType._zod.optin),Ie(t._zod,"optout",()=>e.innerType._zod.optout),Ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(i=>(r.value=i.value,i.issues.length&&(r.value=e.catchValue({...r,error:{issues:i.issues.map(s=>hn(s,n,yr()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(i=>hn(i,n,yr()))},input:r.value}),r.issues=[]),r)}}),fP=S("$ZodNaN",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>((typeof r.value!="number"||!Number.isNaN(r.value))&&r.issues.push({input:r.value,inst:t,expected:"nan",code:"invalid_type"}),r)}),mP=S("$ZodPipe",(t,e)=>{Ae.init(t,e),Ie(t._zod,"values",()=>e.in._zod.values),Ie(t._zod,"optin",()=>e.in._zod.optin),Ie(t._zod,"optout",()=>e.out._zod.optout),Ie(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if(n.direction==="backward"){let i=e.out._zod.run(r,n);return i instanceof Promise?i.then(s=>E_(s,e.in,n)):E_(i,e.in,n)}let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(i=>E_(i,e.out,n)):E_(o,e.out,n)}});Kf=S("$ZodCodec",(t,e)=>{Ae.init(t,e),Ie(t._zod,"values",()=>e.in._zod.values),Ie(t._zod,"optin",()=>e.in._zod.optin),Ie(t._zod,"optout",()=>e.out._zod.optout),Ie(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if((n.direction||"forward")==="forward"){let i=e.in._zod.run(r,n);return i instanceof Promise?i.then(s=>O_(s,e,n)):O_(i,e,n)}else{let i=e.out._zod.run(r,n);return i instanceof Promise?i.then(s=>O_(s,e,n)):O_(i,e,n)}}});hP=S("$ZodReadonly",(t,e)=>{Ae.init(t,e),Ie(t._zod,"propValues",()=>e.innerType._zod.propValues),Ie(t._zod,"values",()=>e.innerType._zod.values),Ie(t._zod,"optin",()=>e.innerType?._zod?.optin),Ie(t._zod,"optout",()=>e.innerType?._zod?.optout),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(Vq):Vq(o)}});gP=S("$ZodTemplateLiteral",(t,e)=>{Ae.init(t,e);let r=[];for(let n of e.parts)if(typeof n=="object"&&n!==null){if(!n._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...n._zod.traits].shift()}`);let o=n._zod.pattern instanceof RegExp?n._zod.pattern.source:n._zod.pattern;if(!o)throw new Error(`Invalid template literal part: ${n._zod.traits}`);let i=o.startsWith("^")?1:0,s=o.endsWith("$")?o.length-1:o.length;r.push(o.slice(i,s))}else if(n===null||T$.has(typeof n))r.push(eo(`${n}`));else throw new Error(`Invalid template literal part: ${n}`);t._zod.pattern=new RegExp(`^${r.join("")}$`),t._zod.parse=(n,o)=>typeof n.value!="string"?(n.issues.push({input:n.value,inst:t,expected:"string",code:"invalid_type"}),n):(t._zod.pattern.lastIndex=0,t._zod.pattern.test(n.value)||n.issues.push({input:n.value,inst:t,code:"invalid_format",format:e.format??"template_literal",pattern:t._zod.pattern.source}),n)}),yP=S("$ZodFunction",(t,e)=>(Ae.init(t,e),t._def=e,t._zod.def=e,t.implement=r=>{if(typeof r!="function")throw new Error("implement() must be called with a function");return function(...n){let o=t._def.input?Rf(t._def.input,n):n,i=Reflect.apply(r,this,o);return t._def.output?Rf(t._def.output,i):i}},t.implementAsync=r=>{if(typeof r!="function")throw new Error("implementAsync() must be called with a function");return async function(...n){let o=t._def.input?await Df(t._def.input,n):n,i=await Reflect.apply(r,this,o);return t._def.output?await Df(t._def.output,i):i}},t._zod.parse=(r,n)=>typeof r.value!="function"?(r.issues.push({code:"invalid_type",expected:"function",input:r.value,inst:t}),r):(t._def.output&&t._def.output._zod.def.type==="promise"?r.value=t.implementAsync(r.value):r.value=t.implement(r.value),r),t.input=(...r)=>{let n=t.constructor;return Array.isArray(r[0])?new n({type:"function",input:new M_({type:"tuple",items:r[0],rest:r[1]}),output:t._def.output}):new n({type:"function",input:r[0],output:t._def.output})},t.output=r=>{let n=t.constructor;return new n({type:"function",input:t._def.input,output:r})},t)),vP=S("$ZodPromise",(t,e)=>{Ae.init(t,e),t._zod.parse=(r,n)=>Promise.resolve(r.value).then(o=>e.innerType._zod.run({value:o,issues:[]},n))}),_P=S("$ZodLazy",(t,e)=>{Ae.init(t,e),Ie(t._zod,"innerType",()=>e.getter()),Ie(t._zod,"pattern",()=>t._zod.innerType?._zod?.pattern),Ie(t._zod,"propValues",()=>t._zod.innerType?._zod?.propValues),Ie(t._zod,"optin",()=>t._zod.innerType?._zod?.optin??void 0),Ie(t._zod,"optout",()=>t._zod.innerType?._zod?.optout??void 0),t._zod.parse=(r,n)=>t._zod.innerType._zod.run(r,n)}),bP=S("$ZodCustom",(t,e)=>{vt.init(t,e),Ae.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(i=>Fq(i,r,n,t));Fq(o,r,n,t)}})});var Xq=A(()=>{ae()});var Yq=A(()=>{ae()});var Qq=A(()=>{ae()});var e4=A(()=>{ae()});var t4=A(()=>{ae()});var r4=A(()=>{ae()});var n4=A(()=>{ae()});var o4=A(()=>{ae()});function xP(){return{localeError:j7()}}var j7,SP=A(()=>{ae();j7=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"},map:{unit:"entries",verb:"to have"}};function e(o){return t[o]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},n={nan:"NaN"};return o=>{switch(o.code){case"invalid_type":{let i=n[o.expected]??o.expected,s=ye(o.input),a=n[s]??s;return`Invalid input: expected ${i}, received ${a}`}case"invalid_value":return o.values.length===1?`Invalid input: expected ${he(o.values[0])}`:`Invalid option: expected one of ${me(o.values,"|")}`;case"too_big":{let i=o.inclusive?"<=":"<",s=e(o.origin);return s?`Too big: expected ${o.origin??"value"} to have ${i}${o.maximum.toString()} ${s.unit??"elements"}`:`Too big: expected ${o.origin??"value"} to be ${i}${o.maximum.toString()}`}case"too_small":{let i=o.inclusive?">=":">",s=e(o.origin);return s?`Too small: expected ${o.origin} to have ${i}${o.minimum.toString()} ${s.unit}`:`Too small: expected ${o.origin} to be ${i}${o.minimum.toString()}`}case"invalid_format":{let i=o;return i.format==="starts_with"?`Invalid string: must start with "${i.prefix}"`:i.format==="ends_with"?`Invalid string: must end with "${i.suffix}"`:i.format==="includes"?`Invalid string: must include "${i.includes}"`:i.format==="regex"?`Invalid string: must match pattern ${i.pattern}`:`Invalid ${r[i.format]??o.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${o.divisor}`;case"unrecognized_keys":return`Unrecognized key${o.keys.length>1?"s":""}: ${me(o.keys,", ")}`;case"invalid_key":return`Invalid key in ${o.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${o.origin}`;default:return"Invalid input"}}}});var i4=A(()=>{ae()});var s4=A(()=>{ae()});var a4=A(()=>{ae()});var c4=A(()=>{ae()});var u4=A(()=>{ae()});var l4=A(()=>{ae()});var d4=A(()=>{ae()});var p4=A(()=>{ae()});var f4=A(()=>{ae()});var m4=A(()=>{ae()});var h4=A(()=>{ae()});var g4=A(()=>{ae()});var y4=A(()=>{ae()});var v4=A(()=>{ae()});var kP=A(()=>{ae()});var _4=A(()=>{kP()});var b4=A(()=>{ae()});var w4=A(()=>{ae()});var x4=A(()=>{ae()});var S4=A(()=>{ae()});var k4=A(()=>{ae()});var $4=A(()=>{ae()});var A4=A(()=>{ae()});var P4=A(()=>{ae()});var C4=A(()=>{ae()});var T4=A(()=>{ae()});var I4=A(()=>{ae()});var E4=A(()=>{ae()});var O4=A(()=>{ae()});var j4=A(()=>{ae()});var N4=A(()=>{ae()});var z4=A(()=>{ae()});var $P=A(()=>{ae()});var R4=A(()=>{$P()});var M4=A(()=>{ae()});var D4=A(()=>{ae()});var q4=A(()=>{ae()});var U4=A(()=>{ae()});var B4=A(()=>{ae()});var L4=A(()=>{ae()});var q_=A(()=>{Xq();Yq();Qq();e4();t4();r4();n4();o4();SP();i4();s4();a4();c4();u4();l4();d4();p4();f4();m4();h4();g4();y4();v4();_4();kP();b4();w4();x4();S4();k4();$4();A4();P4();C4();T4();I4();E4();O4();j4();N4();z4();R4();$P();M4();D4();q4();U4();B4();L4()});function CP(){return new PP}var Z4,PP,nn,Wf=A(()=>{PP=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...r){let n=r[0];return this._map.set(e,n),n&&typeof n=="object"&&"id"in n&&this._idmap.set(n.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};delete n.id;let o={...n,...this._map.get(e)};return Object.keys(o).length?o:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};(Z4=globalThis).__zod_globalRegistry??(Z4.__zod_globalRegistry=CP());nn=globalThis.__zod_globalRegistry});function TP(t,e){return new t({type:"string",...F(e)})}function IP(t,e){return new t({type:"string",coerce:!0,...F(e)})}function U_(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...F(e)})}function Gf(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...F(e)})}function B_(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...F(e)})}function L_(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...F(e)})}function Z_(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...F(e)})}function V_(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...F(e)})}function Jf(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...F(e)})}function F_(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...F(e)})}function H_(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...F(e)})}function K_(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...F(e)})}function W_(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...F(e)})}function G_(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...F(e)})}function J_(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...F(e)})}function X_(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...F(e)})}function Y_(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...F(e)})}function Q_(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...F(e)})}function EP(t,e){return new t({type:"string",format:"mac",check:"string_format",abort:!1,...F(e)})}function eb(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...F(e)})}function tb(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...F(e)})}function rb(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...F(e)})}function nb(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...F(e)})}function ob(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...F(e)})}function ib(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...F(e)})}function OP(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...F(e)})}function jP(t,e){return new t({type:"string",format:"date",check:"string_format",...F(e)})}function NP(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...F(e)})}function zP(t,e){return new t({type:"string",format:"duration",check:"string_format",...F(e)})}function RP(t,e){return new t({type:"number",checks:[],...F(e)})}function MP(t,e){return new t({type:"number",coerce:!0,checks:[],...F(e)})}function DP(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...F(e)})}function qP(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float32",...F(e)})}function UP(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float64",...F(e)})}function BP(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"int32",...F(e)})}function LP(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"uint32",...F(e)})}function ZP(t,e){return new t({type:"boolean",...F(e)})}function VP(t,e){return new t({type:"boolean",coerce:!0,...F(e)})}function FP(t,e){return new t({type:"bigint",...F(e)})}function HP(t,e){return new t({type:"bigint",coerce:!0,...F(e)})}function KP(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...F(e)})}function WP(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...F(e)})}function GP(t,e){return new t({type:"symbol",...F(e)})}function JP(t,e){return new t({type:"undefined",...F(e)})}function XP(t,e){return new t({type:"null",...F(e)})}function YP(t){return new t({type:"any"})}function QP(t){return new t({type:"unknown"})}function e1(t,e){return new t({type:"never",...F(e)})}function t1(t,e){return new t({type:"void",...F(e)})}function r1(t,e){return new t({type:"date",...F(e)})}function n1(t,e){return new t({type:"date",coerce:!0,...F(e)})}function o1(t,e){return new t({type:"nan",...F(e)})}function Gi(t,e){return new uA({check:"less_than",...F(e),value:t,inclusive:!1})}function Bn(t,e){return new uA({check:"less_than",...F(e),value:t,inclusive:!0})}function Ji(t,e){return new lA({check:"greater_than",...F(e),value:t,inclusive:!1})}function on(t,e){return new lA({check:"greater_than",...F(e),value:t,inclusive:!0})}function i1(t){return Ji(0,t)}function s1(t){return Gi(0,t)}function a1(t){return Bn(0,t)}function c1(t){return on(0,t)}function Xa(t,e){return new hq({check:"multiple_of",...F(e),value:t})}function Ya(t,e){return new vq({check:"max_size",...F(e),maximum:t})}function Xi(t,e){return new _q({check:"min_size",...F(e),minimum:t})}function xl(t,e){return new bq({check:"size_equals",...F(e),size:t})}function Sl(t,e){return new wq({check:"max_length",...F(e),maximum:t})}function Ks(t,e){return new xq({check:"min_length",...F(e),minimum:t})}function kl(t,e){return new Sq({check:"length_equals",...F(e),length:t})}function Xf(t,e){return new kq({check:"string_format",format:"regex",...F(e),pattern:t})}function Yf(t){return new $q({check:"string_format",format:"lowercase",...F(t)})}function Qf(t){return new Aq({check:"string_format",format:"uppercase",...F(t)})}function em(t,e){return new Pq({check:"string_format",format:"includes",...F(e),includes:t})}function tm(t,e){return new Cq({check:"string_format",format:"starts_with",...F(e),prefix:t})}function rm(t,e){return new Tq({check:"string_format",format:"ends_with",...F(e),suffix:t})}function u1(t,e,r){return new Iq({check:"property",property:t,schema:e,...F(r)})}function nm(t,e){return new Eq({check:"mime_type",mime:t,...F(e)})}function pi(t){return new Oq({check:"overwrite",tx:t})}function om(t){return pi(e=>e.normalize(t))}function im(){return pi(t=>t.trim())}function sm(){return pi(t=>t.toLowerCase())}function am(){return pi(t=>t.toUpperCase())}function sb(){return pi(t=>A$(t))}function V4(t,e,r){return new t({type:"array",element:e,...F(r)})}function l1(t,e){return new t({type:"file",...F(e)})}function d1(t,e,r){let n=F(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function p1(t,e,r){return new t({type:"custom",check:"custom",fn:e,...F(r)})}function f1(t){let e=M7(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(bl(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(bl(o))}},t(r.value,r)));return e}function M7(t,e){let r=new vt({check:"custom",...F(e)});return r._zod.check=t,r}function m1(t){let e=new vt({check:"describe"});return e._zod.onattach=[r=>{let n=nn.get(r)??{};nn.add(r,{...n,description:t})}],e._zod.check=()=>{},e}function h1(t){let e=new vt({check:"meta"});return e._zod.onattach=[r=>{let n=nn.get(r)??{};nn.add(r,{...n,...t})}],e._zod.check=()=>{},e}function g1(t,e){let r=F(e),n=r.truthy??["true","1","yes","on","y","enabled"],o=r.falsy??["false","0","no","off","n","disabled"];r.case!=="sensitive"&&(n=n.map(f=>typeof f=="string"?f.toLowerCase():f),o=o.map(f=>typeof f=="string"?f.toLowerCase():f));let i=new Set(n),s=new Set(o),a=t.Codec??Kf,c=t.Boolean??Ff,u=t.String??Ja,l=new u({type:"string",error:r.error}),d=new c({type:"boolean",error:r.error}),p=new a({type:"pipe",in:l,out:d,transform:((f,h)=>{let m=f;return r.case!=="sensitive"&&(m=m.toLowerCase()),i.has(m)?!0:s.has(m)?!1:(h.issues.push({code:"invalid_value",expected:"stringbool",values:[...i,...s],input:h.value,inst:p,continue:!1}),{})}),reverseTransform:((f,h)=>f===!0?n[0]||"true":o[0]||"false"),error:r.error});return p}function $l(t,e,r,n={}){let o=F(n),i={...F(n),check:"string_format",type:"string",format:e,fn:typeof r=="function"?r:a=>r.test(a),...o};return r instanceof RegExp&&(i.pattern=r),new t(i)}var F4=A(()=>{C_();Wf();wP();ae()});function ab(t){let e=t?.target??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:t?.metadata??nn,target:e,unrepresentable:t?.unrepresentable??"throw",override:t?.override??(()=>{}),io:t?.io??"output",counter:0,seen:new Map,cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0}}function Et(t,e,r={path:[],schemaPath:[]}){var n;let o=t._zod.def,i=e.seen.get(t);if(i)return i.count++,r.schemaPath.includes(t)&&(i.cycle=r.path),i.schema;let s={schema:{},count:1,cycle:void 0,path:r.path};e.seen.set(t,s);let a=t._zod.toJSONSchema?.();if(a)s.schema=a;else{let l={...r,schemaPath:[...r.schemaPath,t],path:r.path};if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,s.schema,l);else{let p=s.schema,f=e.processors[o.type];if(!f)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${o.type}`);f(t,e,p,l)}let d=t._zod.parent;d&&(s.ref||(s.ref=d),Et(d,e,l),e.seen.get(d).isParent=!0)}let c=e.metadataRegistry.get(t);return c&&Object.assign(s.schema,c),e.io==="input"&&sn(t)&&(delete s.schema.examples,delete s.schema.default),e.io==="input"&&s.schema._prefault&&((n=s.schema).default??(n.default=s.schema._prefault)),delete s.schema._prefault,e.seen.get(t).schema}function cb(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=new Map;for(let s of t.seen.entries()){let a=t.metadataRegistry.get(s[0])?.id;if(a){let c=n.get(a);if(c&&c!==s[0])throw new Error(`Duplicate schema id "${a}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);n.set(a,s[0])}}let o=s=>{let a=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){let d=t.external.registry.get(s[0])?.id,p=t.external.uri??(h=>h);if(d)return{ref:p(d)};let f=s[1].defId??s[1].schema.id??`schema${t.counter++}`;return s[1].defId=f,{defId:f,ref:`${p("__shared")}#/${a}/${f}`}}if(s[1]===r)return{ref:"#"};let u=`#/${a}/`,l=s[1].schema.id??`__schema${t.counter++}`;return{defId:l,ref:u+l}},i=s=>{if(s[1].schema.$ref)return;let a=s[1],{ref:c,defId:u}=o(s);a.def={...a.schema},u&&(a.defId=u);let l=a.schema;for(let d in l)delete l[d];l.$ref=c};if(t.cycles==="throw")for(let s of t.seen.entries()){let a=s[1];if(a.cycle)throw new Error(`Cycle detected: #/${a.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let s of t.seen.entries()){let a=s[1];if(e===s[0]){i(s);continue}if(t.external){let u=t.external.registry.get(s[0])?.id;if(e!==s[0]&&u){i(s);continue}}if(t.metadataRegistry.get(s[0])?.id){i(s);continue}if(a.cycle){i(s);continue}if(a.count>1&&t.reused==="ref"){i(s);continue}}}function ub(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=s=>{let a=t.seen.get(s);if(a.ref===null)return;let c=a.def??a.schema,u={...c},l=a.ref;if(a.ref=null,l){n(l);let p=t.seen.get(l),f=p.schema;if(f.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(f)):Object.assign(c,f),Object.assign(c,u),s._zod.parent===l)for(let m in c)m==="$ref"||m==="allOf"||m in u||delete c[m];if(f.$ref&&p.def)for(let m in c)m==="$ref"||m==="allOf"||m in p.def&&JSON.stringify(c[m])===JSON.stringify(p.def[m])&&delete c[m]}let d=s._zod.parent;if(d&&d!==l){n(d);let p=t.seen.get(d);if(p?.schema.$ref&&(c.$ref=p.schema.$ref,p.def))for(let f in c)f==="$ref"||f==="allOf"||f in p.def&&JSON.stringify(c[f])===JSON.stringify(p.def[f])&&delete c[f]}t.override({zodSchema:s,jsonSchema:c,path:a.path??[]})};for(let s of[...t.seen.entries()].reverse())n(s[0]);let o={};if(t.target==="draft-2020-12"?o.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?o.$schema="http://json-schema.org/draft-04/schema#":t.target,t.external?.uri){let s=t.external.registry.get(e)?.id;if(!s)throw new Error("Schema is missing an `id` property");o.$id=t.external.uri(s)}Object.assign(o,r.def??r.schema);let i=t.external?.defs??{};for(let s of t.seen.entries()){let a=s[1];a.def&&a.defId&&(i[a.defId]=a.def)}t.external||Object.keys(i).length>0&&(t.target==="draft-2020-12"?o.$defs=i:o.definitions=i);try{let s=JSON.parse(JSON.stringify(o));return Object.defineProperty(s,"~standard",{value:{...e["~standard"],jsonSchema:{input:cm(e,"input",t.processors),output:cm(e,"output",t.processors)}},enumerable:!1,writable:!1}),s}catch{throw new Error("Error converting schema to JSON.")}}function sn(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let n=t._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return sn(n.element,r);if(n.type==="set")return sn(n.valueType,r);if(n.type==="lazy")return sn(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return sn(n.innerType,r);if(n.type==="intersection")return sn(n.left,r)||sn(n.right,r);if(n.type==="record"||n.type==="map")return sn(n.keyType,r)||sn(n.valueType,r);if(n.type==="pipe")return sn(n.in,r)||sn(n.out,r);if(n.type==="object"){for(let o in n.shape)if(sn(n.shape[o],r))return!0;return!1}if(n.type==="union"){for(let o of n.options)if(sn(o,r))return!0;return!1}if(n.type==="tuple"){for(let o of n.items)if(sn(o,r))return!0;return!!(n.rest&&sn(n.rest,r))}return!1}var H4,cm,um=A(()=>{Wf();H4=(t,e={})=>r=>{let n=ab({...r,processors:e});return Et(t,n),cb(n,t),ub(n,t)},cm=(t,e,r={})=>n=>{let{libraryOptions:o,target:i}=n??{},s=ab({...o??{},target:i,io:e,processors:r});return Et(t,s),cb(s,t),ub(s,t)}});var D7,K4,W4,G4,J4,X4,Y4,Q4,e2,t2,r2,n2,o2,i2,s2,a2,c2,u2,l2,d2,p2,f2,m2,h2,g2,y2,y1,v2,_2,b2,w2,x2,S2,k2,$2,A2,P2,C2,v1,T2,Al=A(()=>{um();ae();D7={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},K4=(t,e,r,n)=>{let o=r;o.type="string";let{minimum:i,maximum:s,format:a,patterns:c,contentEncoding:u}=t._zod.bag;if(typeof i=="number"&&(o.minLength=i),typeof s=="number"&&(o.maxLength=s),a&&(o.format=D7[a]??a,o.format===""&&delete o.format,a==="time"&&delete o.format),u&&(o.contentEncoding=u),c&&c.size>0){let l=[...c];l.length===1?o.pattern=l[0].source:l.length>1&&(o.allOf=[...l.map(d=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:d.source}))])}},W4=(t,e,r,n)=>{let o=r,{minimum:i,maximum:s,format:a,multipleOf:c,exclusiveMaximum:u,exclusiveMinimum:l}=t._zod.bag;typeof a=="string"&&a.includes("int")?o.type="integer":o.type="number",typeof l=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.minimum=l,o.exclusiveMinimum=!0):o.exclusiveMinimum=l),typeof i=="number"&&(o.minimum=i,typeof l=="number"&&e.target!=="draft-04"&&(l>=i?delete o.minimum:delete o.exclusiveMinimum)),typeof u=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.maximum=u,o.exclusiveMaximum=!0):o.exclusiveMaximum=u),typeof s=="number"&&(o.maximum=s,typeof u=="number"&&e.target!=="draft-04"&&(u<=s?delete o.maximum:delete o.exclusiveMaximum)),typeof c=="number"&&(o.multipleOf=c)},G4=(t,e,r,n)=>{r.type="boolean"},J4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},X4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},Y4=(t,e,r,n)=>{e.target==="openapi-3.0"?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"},Q4=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},e2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},t2=(t,e,r,n)=>{r.not={}},r2=(t,e,r,n)=>{},n2=(t,e,r,n)=>{},o2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},i2=(t,e,r,n)=>{let o=t._zod.def,i=Tf(o.entries);i.every(s=>typeof s=="number")&&(r.type="number"),i.every(s=>typeof s=="string")&&(r.type="string"),r.enum=i},s2=(t,e,r,n)=>{let o=t._zod.def,i=[];for(let s of o.values)if(s===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof s=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");i.push(Number(s))}else i.push(s);if(i.length!==0)if(i.length===1){let s=i[0];r.type=s===null?"null":typeof s,e.target==="draft-04"||e.target==="openapi-3.0"?r.enum=[s]:r.const=s}else i.every(s=>typeof s=="number")&&(r.type="number"),i.every(s=>typeof s=="string")&&(r.type="string"),i.every(s=>typeof s=="boolean")&&(r.type="boolean"),i.every(s=>s===null)&&(r.type="null"),r.enum=i},a2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},c2=(t,e,r,n)=>{let o=r,i=t._zod.pattern;if(!i)throw new Error("Pattern not found in template literal");o.type="string",o.pattern=i.source},u2=(t,e,r,n)=>{let o=r,i={type:"string",format:"binary",contentEncoding:"binary"},{minimum:s,maximum:a,mime:c}=t._zod.bag;s!==void 0&&(i.minLength=s),a!==void 0&&(i.maxLength=a),c?c.length===1?(i.contentMediaType=c[0],Object.assign(o,i)):(Object.assign(o,i),o.anyOf=c.map(u=>({contentMediaType:u}))):Object.assign(o,i)},l2=(t,e,r,n)=>{r.type="boolean"},d2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},p2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},f2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},m2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},h2=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},g2=(t,e,r,n)=>{let o=r,i=t._zod.def,{minimum:s,maximum:a}=t._zod.bag;typeof s=="number"&&(o.minItems=s),typeof a=="number"&&(o.maxItems=a),o.type="array",o.items=Et(i.element,e,{...n,path:[...n.path,"items"]})},y2=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="object",o.properties={};let s=i.shape;for(let u in s)o.properties[u]=Et(s[u],e,{...n,path:[...n.path,"properties",u]});let a=new Set(Object.keys(s)),c=new Set([...a].filter(u=>{let l=i.shape[u]._zod;return e.io==="input"?l.optin===void 0:l.optout===void 0}));c.size>0&&(o.required=Array.from(c)),i.catchall?._zod.def.type==="never"?o.additionalProperties=!1:i.catchall?i.catchall&&(o.additionalProperties=Et(i.catchall,e,{...n,path:[...n.path,"additionalProperties"]})):e.io==="output"&&(o.additionalProperties=!1)},y1=(t,e,r,n)=>{let o=t._zod.def,i=o.inclusive===!1,s=o.options.map((a,c)=>Et(a,e,{...n,path:[...n.path,i?"oneOf":"anyOf",c]}));i?r.oneOf=s:r.anyOf=s},v2=(t,e,r,n)=>{let o=t._zod.def,i=Et(o.left,e,{...n,path:[...n.path,"allOf",0]}),s=Et(o.right,e,{...n,path:[...n.path,"allOf",1]}),a=u=>"allOf"in u&&Object.keys(u).length===1,c=[...a(i)?i.allOf:[i],...a(s)?s.allOf:[s]];r.allOf=c},_2=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="array";let s=e.target==="draft-2020-12"?"prefixItems":"items",a=e.target==="draft-2020-12"||e.target==="openapi-3.0"?"items":"additionalItems",c=i.items.map((p,f)=>Et(p,e,{...n,path:[...n.path,s,f]})),u=i.rest?Et(i.rest,e,{...n,path:[...n.path,a,...e.target==="openapi-3.0"?[i.items.length]:[]]}):null;e.target==="draft-2020-12"?(o.prefixItems=c,u&&(o.items=u)):e.target==="openapi-3.0"?(o.items={anyOf:c},u&&o.items.anyOf.push(u),o.minItems=c.length,u||(o.maxItems=c.length)):(o.items=c,u&&(o.additionalItems=u));let{minimum:l,maximum:d}=t._zod.bag;typeof l=="number"&&(o.minItems=l),typeof d=="number"&&(o.maxItems=d)},b2=(t,e,r,n)=>{let o=r,i=t._zod.def;o.type="object";let s=i.keyType,c=s._zod.bag?.patterns;if(i.mode==="loose"&&c&&c.size>0){let l=Et(i.valueType,e,{...n,path:[...n.path,"patternProperties","*"]});o.patternProperties={};for(let d of c)o.patternProperties[d.source]=l}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(o.propertyNames=Et(i.keyType,e,{...n,path:[...n.path,"propertyNames"]})),o.additionalProperties=Et(i.valueType,e,{...n,path:[...n.path,"additionalProperties"]});let u=s._zod.values;if(u){let l=[...u].filter(d=>typeof d=="string"||typeof d=="number");l.length>0&&(o.required=l)}},w2=(t,e,r,n)=>{let o=t._zod.def,i=Et(o.innerType,e,n),s=e.seen.get(t);e.target==="openapi-3.0"?(s.ref=o.innerType,r.nullable=!0):r.anyOf=[i,{type:"null"}]},x2=(t,e,r,n)=>{let o=t._zod.def;Et(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},S2=(t,e,r,n)=>{let o=t._zod.def;Et(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,r.default=JSON.parse(JSON.stringify(o.defaultValue))},k2=(t,e,r,n)=>{let o=t._zod.def;Et(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,e.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(o.defaultValue)))},$2=(t,e,r,n)=>{let o=t._zod.def;Et(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType;let s;try{s=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=s},A2=(t,e,r,n)=>{let o=t._zod.def,i=e.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;Et(i,e,n);let s=e.seen.get(t);s.ref=i},P2=(t,e,r,n)=>{let o=t._zod.def;Et(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType,r.readOnly=!0},C2=(t,e,r,n)=>{let o=t._zod.def;Et(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},v1=(t,e,r,n)=>{let o=t._zod.def;Et(o.innerType,e,n);let i=e.seen.get(t);i.ref=o.innerType},T2=(t,e,r,n)=>{let o=t._zod.innerType;Et(o,e,n);let i=e.seen.get(t);i.ref=o}});var I2=A(()=>{Al();um()});var E2=A(()=>{});var ir=A(()=>{yl();N$();j$();wP();C_();pA();ae();P_();q_();Wf();dA();F4();um();Al();I2();E2()});var b1=A(()=>{ir()});var lb=A(()=>{ir();ae();b1()});var j2=A(()=>{ir()});var w1=A(()=>{ir();lb()});var N2=A(()=>{ir();lb()});var x1=A(()=>{ir();b1();lb();j2();ir();Al();q_();w1();w1();N2()});var S1=A(()=>{x1();x1()});function Pl(t){return!!t._zod}function No(t,e){return Pl(t)?wl(t,e):t.safeParse(e)}function db(t){if(!t)return;let e;if(Pl(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function M2(t){if(Pl(t)){let i=t._zod?.def;if(i){if(i.value!==void 0)return i.value;if(Array.isArray(i.values)&&i.values.length>0)return i.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var pb=A(()=>{Pf();S1()});var fb={};To(fb,{endsWith:()=>rm,gt:()=>Ji,gte:()=>on,includes:()=>em,length:()=>kl,lowercase:()=>Yf,lt:()=>Gi,lte:()=>Bn,maxLength:()=>Sl,maxSize:()=>Ya,mime:()=>nm,minLength:()=>Ks,minSize:()=>Xi,multipleOf:()=>Xa,negative:()=>s1,nonnegative:()=>c1,nonpositive:()=>a1,normalize:()=>om,overwrite:()=>pi,positive:()=>i1,property:()=>u1,regex:()=>Xf,size:()=>xl,slugify:()=>sb,startsWith:()=>tm,toLowerCase:()=>sm,toUpperCase:()=>am,trim:()=>im,uppercase:()=>Qf});var mb=A(()=>{ir()});var Qa={};To(Qa,{ZodISODate:()=>A1,ZodISODateTime:()=>k1,ZodISODuration:()=>I1,ZodISOTime:()=>C1,date:()=>P1,datetime:()=>$1,duration:()=>E1,time:()=>T1});function $1(t){return OP(k1,t)}function P1(t){return jP(A1,t)}function T1(t){return NP(C1,t)}function E1(t){return zP(I1,t)}var k1,A1,C1,I1,lm=A(()=>{ir();pm();k1=S("ZodISODateTime",(t,e)=>{$A.init(t,e),_t.init(t,e)});A1=S("ZodISODate",(t,e)=>{AA.init(t,e),_t.init(t,e)});C1=S("ZodISOTime",(t,e)=>{PA.init(t,e),_t.init(t,e)});I1=S("ZodISODuration",(t,e)=>{CA.init(t,e),_t.init(t,e)})});var D2,hxe,Ln,O1=A(()=>{ir();ir();ae();D2=(t,e)=>{x_.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>k_(t,r)},flatten:{value:r=>S_(t,r)},addIssue:{value:r=>{t.issues.push(r),t.message=JSON.stringify(t.issues,vl,2)}},addIssues:{value:r=>{t.issues.push(...r),t.message=JSON.stringify(t.issues,vl,2)}},isEmpty:{get(){return t.issues.length===0}}})},hxe=S("ZodError",D2),Ln=S("ZodError",D2,{Parent:Error})});var q2,U2,B2,L2,Z2,V2,F2,H2,K2,W2,G2,J2,j1=A(()=>{ir();O1();q2=zf(Ln),U2=Mf(Ln),B2=qf(Ln),L2=Uf(Ln),Z2=rq(Ln),V2=nq(Ln),F2=oq(Ln),H2=iq(Ln),K2=sq(Ln),W2=aq(Ln),G2=cq(Ln),J2=uq(Ln)});var dm={};To(dm,{ZodAny:()=>tU,ZodArray:()=>iU,ZodBase64:()=>G1,ZodBase64URL:()=>J1,ZodBigInt:()=>vm,ZodBigIntFormat:()=>Q1,ZodBoolean:()=>ym,ZodCIDRv4:()=>K1,ZodCIDRv6:()=>W1,ZodCUID:()=>U1,ZodCUID2:()=>B1,ZodCatch:()=>$U,ZodCodec:()=>sC,ZodCustom:()=>kb,ZodCustomStringFormat:()=>hm,ZodDate:()=>_b,ZodDefault:()=>_U,ZodDiscriminatedUnion:()=>aU,ZodE164:()=>X1,ZodEmail:()=>R1,ZodEmoji:()=>D1,ZodEnum:()=>fm,ZodExactOptional:()=>gU,ZodFile:()=>mU,ZodFunction:()=>NU,ZodGUID:()=>hb,ZodIPv4:()=>F1,ZodIPv6:()=>H1,ZodIntersection:()=>cU,ZodJWT:()=>Y1,ZodKSUID:()=>V1,ZodLazy:()=>EU,ZodLiteral:()=>fU,ZodMAC:()=>X2,ZodMap:()=>dU,ZodNaN:()=>PU,ZodNanoID:()=>q1,ZodNever:()=>nU,ZodNonOptional:()=>oC,ZodNull:()=>eU,ZodNullable:()=>vU,ZodNumber:()=>gm,ZodNumberFormat:()=>Cl,ZodObject:()=>bb,ZodOptional:()=>nC,ZodPipe:()=>iC,ZodPrefault:()=>wU,ZodPromise:()=>jU,ZodReadonly:()=>CU,ZodRecord:()=>Sb,ZodSet:()=>pU,ZodString:()=>mm,ZodStringFormat:()=>_t,ZodSuccess:()=>kU,ZodSymbol:()=>Y2,ZodTemplateLiteral:()=>IU,ZodTransform:()=>hU,ZodTuple:()=>uU,ZodType:()=>Ee,ZodULID:()=>L1,ZodURL:()=>vb,ZodUUID:()=>Yi,ZodUndefined:()=>Q2,ZodUnion:()=>wb,ZodUnknown:()=>rU,ZodVoid:()=>oU,ZodXID:()=>Z1,ZodXor:()=>sU,_ZodString:()=>z1,_default:()=>bU,_function:()=>GX,any:()=>eC,array:()=>V,base64:()=>hX,base64url:()=>gX,bigint:()=>PX,boolean:()=>lt,catch:()=>AU,check:()=>JX,cidrv4:()=>fX,cidrv6:()=>mX,codec:()=>HX,cuid:()=>iX,cuid2:()=>sX,custom:()=>aC,date:()=>jX,describe:()=>XX,discriminatedUnion:()=>xb,e164:()=>yX,email:()=>J7,emoji:()=>nX,enum:()=>Zr,exactOptional:()=>yU,file:()=>LX,float32:()=>SX,float64:()=>kX,function:()=>GX,guid:()=>X7,hash:()=>xX,hex:()=>wX,hostname:()=>bX,httpUrl:()=>rX,instanceof:()=>QX,int:()=>N1,int32:()=>$X,int64:()=>CX,intersection:()=>bm,ipv4:()=>lX,ipv6:()=>pX,json:()=>tY,jwt:()=>vX,keyof:()=>NX,ksuid:()=>uX,lazy:()=>OU,literal:()=>ie,looseObject:()=>dr,looseRecord:()=>DX,mac:()=>dX,map:()=>qX,meta:()=>YX,nan:()=>FX,nanoid:()=>oX,nativeEnum:()=>BX,never:()=>tC,nonoptional:()=>SU,null:()=>_m,nullable:()=>gb,nullish:()=>ZX,number:()=>Xe,object:()=>H,optional:()=>Rt,partialRecord:()=>MX,pipe:()=>yb,prefault:()=>xU,preprocess:()=>$b,promise:()=>WX,readonly:()=>TU,record:()=>Ot,refine:()=>zU,set:()=>UX,strictObject:()=>zX,string:()=>_,stringFormat:()=>_X,stringbool:()=>eY,success:()=>VX,superRefine:()=>RU,symbol:()=>IX,templateLiteral:()=>KX,transform:()=>rC,tuple:()=>lU,uint32:()=>AX,uint64:()=>TX,ulid:()=>aX,undefined:()=>EX,union:()=>mt,unknown:()=>bt,url:()=>M1,uuid:()=>Y7,uuidv4:()=>Q7,uuidv6:()=>eX,uuidv7:()=>tX,void:()=>OX,xid:()=>cX,xor:()=>RX});function _(t){return TP(mm,t)}function J7(t){return U_(R1,t)}function X7(t){return Gf(hb,t)}function Y7(t){return B_(Yi,t)}function Q7(t){return L_(Yi,t)}function eX(t){return Z_(Yi,t)}function tX(t){return V_(Yi,t)}function M1(t){return Jf(vb,t)}function rX(t){return Jf(vb,{protocol:/^https?$/,hostname:to.domain,...q.normalizeParams(t)})}function nX(t){return F_(D1,t)}function oX(t){return H_(q1,t)}function iX(t){return K_(U1,t)}function sX(t){return W_(B1,t)}function aX(t){return G_(L1,t)}function cX(t){return J_(Z1,t)}function uX(t){return X_(V1,t)}function lX(t){return Y_(F1,t)}function dX(t){return EP(X2,t)}function pX(t){return Q_(H1,t)}function fX(t){return eb(K1,t)}function mX(t){return tb(W1,t)}function hX(t){return rb(G1,t)}function gX(t){return nb(J1,t)}function yX(t){return ob(X1,t)}function vX(t){return ib(Y1,t)}function _X(t,e,r={}){return $l(hm,t,e,r)}function bX(t){return $l(hm,"hostname",to.hostname,t)}function wX(t){return $l(hm,"hex",to.hex,t)}function xX(t,e){let r=e?.enc??"hex",n=`${t}_${r}`,o=to[n];if(!o)throw new Error(`Unrecognized hash format: ${n}`);return $l(hm,n,o,e)}function Xe(t){return RP(gm,t)}function N1(t){return DP(Cl,t)}function SX(t){return qP(Cl,t)}function kX(t){return UP(Cl,t)}function $X(t){return BP(Cl,t)}function AX(t){return LP(Cl,t)}function lt(t){return ZP(ym,t)}function PX(t){return FP(vm,t)}function CX(t){return KP(Q1,t)}function TX(t){return WP(Q1,t)}function IX(t){return GP(Y2,t)}function EX(t){return JP(Q2,t)}function _m(t){return XP(eU,t)}function eC(){return YP(tU)}function bt(){return QP(rU)}function tC(t){return e1(nU,t)}function OX(t){return t1(oU,t)}function jX(t){return r1(_b,t)}function V(t,e){return V4(iU,t,e)}function NX(t){let e=t._zod.def.shape;return Zr(Object.keys(e))}function H(t,e){let r={type:"object",shape:t??{},...q.normalizeParams(e)};return new bb(r)}function zX(t,e){return new bb({type:"object",shape:t,catchall:tC(),...q.normalizeParams(e)})}function dr(t,e){return new bb({type:"object",shape:t,catchall:bt(),...q.normalizeParams(e)})}function mt(t,e){return new wb({type:"union",options:t,...q.normalizeParams(e)})}function RX(t,e){return new sU({type:"union",options:t,inclusive:!1,...q.normalizeParams(e)})}function xb(t,e,r){return new aU({type:"union",options:e,discriminator:t,...q.normalizeParams(r)})}function bm(t,e){return new cU({type:"intersection",left:t,right:e})}function lU(t,e,r){let n=e instanceof Ae,o=n?r:e,i=n?e:null;return new uU({type:"tuple",items:t,rest:i,...q.normalizeParams(o)})}function Ot(t,e,r){return new Sb({type:"record",keyType:t,valueType:e,...q.normalizeParams(r)})}function MX(t,e,r){let n=rn(t);return n._zod.values=void 0,new Sb({type:"record",keyType:n,valueType:e,...q.normalizeParams(r)})}function DX(t,e,r){return new Sb({type:"record",keyType:t,valueType:e,mode:"loose",...q.normalizeParams(r)})}function qX(t,e,r){return new dU({type:"map",keyType:t,valueType:e,...q.normalizeParams(r)})}function UX(t,e){return new pU({type:"set",valueType:t,...q.normalizeParams(e)})}function Zr(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new fm({type:"enum",entries:r,...q.normalizeParams(e)})}function BX(t,e){return new fm({type:"enum",entries:t,...q.normalizeParams(e)})}function ie(t,e){return new fU({type:"literal",values:Array.isArray(t)?t:[t],...q.normalizeParams(e)})}function LX(t){return l1(mU,t)}function rC(t){return new hU({type:"transform",transform:t})}function Rt(t){return new nC({type:"optional",innerType:t})}function yU(t){return new gU({type:"optional",innerType:t})}function gb(t){return new vU({type:"nullable",innerType:t})}function ZX(t){return Rt(gb(t))}function bU(t,e){return new _U({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():q.shallowClone(e)}})}function xU(t,e){return new wU({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():q.shallowClone(e)}})}function SU(t,e){return new oC({type:"nonoptional",innerType:t,...q.normalizeParams(e)})}function VX(t){return new kU({type:"success",innerType:t})}function AU(t,e){return new $U({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}function FX(t){return o1(PU,t)}function yb(t,e){return new iC({type:"pipe",in:t,out:e})}function HX(t,e,r){return new sC({type:"pipe",in:t,out:e,transform:r.decode,reverseTransform:r.encode})}function TU(t){return new CU({type:"readonly",innerType:t})}function KX(t,e){return new IU({type:"template_literal",parts:t,...q.normalizeParams(e)})}function OU(t){return new EU({type:"lazy",getter:t})}function WX(t){return new jU({type:"promise",innerType:t})}function GX(t){return new NU({type:"function",input:Array.isArray(t?.input)?lU(t?.input):t?.input??V(bt()),output:t?.output??bt()})}function JX(t){let e=new vt({check:"custom"});return e._zod.check=t,e}function aC(t,e){return d1(kb,t??(()=>!0),e)}function zU(t,e={}){return p1(kb,t,e)}function RU(t){return f1(t)}function QX(t,e={}){let r=new kb({type:"custom",check:"custom",fn:n=>n instanceof t,abort:!0,...q.normalizeParams(e)});return r._zod.bag.Class=t,r._zod.check=n=>{n.value instanceof t||n.issues.push({code:"invalid_type",expected:t.name,input:n.value,inst:r,path:[...r._zod.def.path??[]]})},r}function tY(t){let e=OU(()=>mt([_(t),Xe(),lt(),_m(),V(e),Ot(_(),e)]));return e}function $b(t,e){return yb(rC(t),e)}var Ee,z1,mm,_t,R1,hb,Yi,vb,D1,q1,U1,B1,L1,Z1,V1,F1,X2,H1,K1,W1,G1,J1,X1,Y1,hm,gm,Cl,ym,vm,Q1,Y2,Q2,eU,tU,rU,nU,oU,_b,iU,bb,wb,sU,aU,cU,uU,Sb,dU,pU,fm,fU,mU,hU,nC,gU,vU,_U,wU,oC,kU,$U,PU,iC,sC,CU,IU,EU,jU,NU,kb,XX,YX,eY,pm=A(()=>{ir();ir();Al();um();mb();lm();j1();Ee=S("ZodType",(t,e)=>(Ae.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:cm(t,"input"),output:cm(t,"output")}}),t.toJSONSchema=H4(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone(q.mergeDefs(e,{checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),{parent:!0}),t.with=t.check,t.clone=(r,n)=>rn(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t)),t.parse=(r,n)=>q2(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>B2(t,r,n),t.parseAsync=async(r,n)=>U2(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>L2(t,r,n),t.spa=t.safeParseAsync,t.encode=(r,n)=>Z2(t,r,n),t.decode=(r,n)=>V2(t,r,n),t.encodeAsync=async(r,n)=>F2(t,r,n),t.decodeAsync=async(r,n)=>H2(t,r,n),t.safeEncode=(r,n)=>K2(t,r,n),t.safeDecode=(r,n)=>W2(t,r,n),t.safeEncodeAsync=async(r,n)=>G2(t,r,n),t.safeDecodeAsync=async(r,n)=>J2(t,r,n),t.refine=(r,n)=>t.check(zU(r,n)),t.superRefine=r=>t.check(RU(r)),t.overwrite=r=>t.check(pi(r)),t.optional=()=>Rt(t),t.exactOptional=()=>yU(t),t.nullable=()=>gb(t),t.nullish=()=>Rt(gb(t)),t.nonoptional=r=>SU(t,r),t.array=()=>V(t),t.or=r=>mt([t,r]),t.and=r=>bm(t,r),t.transform=r=>yb(t,rC(r)),t.default=r=>bU(t,r),t.prefault=r=>xU(t,r),t.catch=r=>AU(t,r),t.pipe=r=>yb(t,r),t.readonly=()=>TU(t),t.describe=r=>{let n=t.clone();return nn.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return nn.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return nn.get(t);let n=t.clone();return nn.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t.apply=r=>r(t),t)),z1=S("_ZodString",(t,e)=>{Ja.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(n,o,i)=>K4(t,n,o,i);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(Xf(...n)),t.includes=(...n)=>t.check(em(...n)),t.startsWith=(...n)=>t.check(tm(...n)),t.endsWith=(...n)=>t.check(rm(...n)),t.min=(...n)=>t.check(Ks(...n)),t.max=(...n)=>t.check(Sl(...n)),t.length=(...n)=>t.check(kl(...n)),t.nonempty=(...n)=>t.check(Ks(1,...n)),t.lowercase=n=>t.check(Yf(n)),t.uppercase=n=>t.check(Qf(n)),t.trim=()=>t.check(im()),t.normalize=(...n)=>t.check(om(...n)),t.toLowerCase=()=>t.check(sm()),t.toUpperCase=()=>t.check(am()),t.slugify=()=>t.check(sb())}),mm=S("ZodString",(t,e)=>{Ja.init(t,e),z1.init(t,e),t.email=r=>t.check(U_(R1,r)),t.url=r=>t.check(Jf(vb,r)),t.jwt=r=>t.check(ib(Y1,r)),t.emoji=r=>t.check(F_(D1,r)),t.guid=r=>t.check(Gf(hb,r)),t.uuid=r=>t.check(B_(Yi,r)),t.uuidv4=r=>t.check(L_(Yi,r)),t.uuidv6=r=>t.check(Z_(Yi,r)),t.uuidv7=r=>t.check(V_(Yi,r)),t.nanoid=r=>t.check(H_(q1,r)),t.guid=r=>t.check(Gf(hb,r)),t.cuid=r=>t.check(K_(U1,r)),t.cuid2=r=>t.check(W_(B1,r)),t.ulid=r=>t.check(G_(L1,r)),t.base64=r=>t.check(rb(G1,r)),t.base64url=r=>t.check(nb(J1,r)),t.xid=r=>t.check(J_(Z1,r)),t.ksuid=r=>t.check(X_(V1,r)),t.ipv4=r=>t.check(Y_(F1,r)),t.ipv6=r=>t.check(Q_(H1,r)),t.cidrv4=r=>t.check(eb(K1,r)),t.cidrv6=r=>t.check(tb(W1,r)),t.e164=r=>t.check(ob(X1,r)),t.datetime=r=>t.check($1(r)),t.date=r=>t.check(P1(r)),t.time=r=>t.check(T1(r)),t.duration=r=>t.check(E1(r))});_t=S("ZodStringFormat",(t,e)=>{ft.init(t,e),z1.init(t,e)}),R1=S("ZodEmail",(t,e)=>{gA.init(t,e),_t.init(t,e)});hb=S("ZodGUID",(t,e)=>{mA.init(t,e),_t.init(t,e)});Yi=S("ZodUUID",(t,e)=>{hA.init(t,e),_t.init(t,e)});vb=S("ZodURL",(t,e)=>{yA.init(t,e),_t.init(t,e)});D1=S("ZodEmoji",(t,e)=>{vA.init(t,e),_t.init(t,e)});q1=S("ZodNanoID",(t,e)=>{_A.init(t,e),_t.init(t,e)});U1=S("ZodCUID",(t,e)=>{bA.init(t,e),_t.init(t,e)});B1=S("ZodCUID2",(t,e)=>{wA.init(t,e),_t.init(t,e)});L1=S("ZodULID",(t,e)=>{xA.init(t,e),_t.init(t,e)});Z1=S("ZodXID",(t,e)=>{SA.init(t,e),_t.init(t,e)});V1=S("ZodKSUID",(t,e)=>{kA.init(t,e),_t.init(t,e)});F1=S("ZodIPv4",(t,e)=>{TA.init(t,e),_t.init(t,e)});X2=S("ZodMAC",(t,e)=>{EA.init(t,e),_t.init(t,e)});H1=S("ZodIPv6",(t,e)=>{IA.init(t,e),_t.init(t,e)});K1=S("ZodCIDRv4",(t,e)=>{OA.init(t,e),_t.init(t,e)});W1=S("ZodCIDRv6",(t,e)=>{jA.init(t,e),_t.init(t,e)});G1=S("ZodBase64",(t,e)=>{NA.init(t,e),_t.init(t,e)});J1=S("ZodBase64URL",(t,e)=>{zA.init(t,e),_t.init(t,e)});X1=S("ZodE164",(t,e)=>{RA.init(t,e),_t.init(t,e)});Y1=S("ZodJWT",(t,e)=>{MA.init(t,e),_t.init(t,e)});hm=S("ZodCustomStringFormat",(t,e)=>{DA.init(t,e),_t.init(t,e)});gm=S("ZodNumber",(t,e)=>{z_.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(n,o,i)=>W4(t,n,o,i),t.gt=(n,o)=>t.check(Ji(n,o)),t.gte=(n,o)=>t.check(on(n,o)),t.min=(n,o)=>t.check(on(n,o)),t.lt=(n,o)=>t.check(Gi(n,o)),t.lte=(n,o)=>t.check(Bn(n,o)),t.max=(n,o)=>t.check(Bn(n,o)),t.int=n=>t.check(N1(n)),t.safe=n=>t.check(N1(n)),t.positive=n=>t.check(Ji(0,n)),t.nonnegative=n=>t.check(on(0,n)),t.negative=n=>t.check(Gi(0,n)),t.nonpositive=n=>t.check(Bn(0,n)),t.multipleOf=(n,o)=>t.check(Xa(n,o)),t.step=(n,o)=>t.check(Xa(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});Cl=S("ZodNumberFormat",(t,e)=>{qA.init(t,e),gm.init(t,e)});ym=S("ZodBoolean",(t,e)=>{Ff.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>G4(t,r,n,o)});vm=S("ZodBigInt",(t,e)=>{R_.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(n,o,i)=>J4(t,n,o,i),t.gte=(n,o)=>t.check(on(n,o)),t.min=(n,o)=>t.check(on(n,o)),t.gt=(n,o)=>t.check(Ji(n,o)),t.gte=(n,o)=>t.check(on(n,o)),t.min=(n,o)=>t.check(on(n,o)),t.lt=(n,o)=>t.check(Gi(n,o)),t.lte=(n,o)=>t.check(Bn(n,o)),t.max=(n,o)=>t.check(Bn(n,o)),t.positive=n=>t.check(Ji(BigInt(0),n)),t.negative=n=>t.check(Gi(BigInt(0),n)),t.nonpositive=n=>t.check(Bn(BigInt(0),n)),t.nonnegative=n=>t.check(on(BigInt(0),n)),t.multipleOf=(n,o)=>t.check(Xa(n,o));let r=t._zod.bag;t.minValue=r.minimum??null,t.maxValue=r.maximum??null,t.format=r.format??null});Q1=S("ZodBigIntFormat",(t,e)=>{UA.init(t,e),vm.init(t,e)});Y2=S("ZodSymbol",(t,e)=>{BA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>X4(t,r,n,o)});Q2=S("ZodUndefined",(t,e)=>{LA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Q4(t,r,n,o)});eU=S("ZodNull",(t,e)=>{ZA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>Y4(t,r,n,o)});tU=S("ZodAny",(t,e)=>{VA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>r2(t,r,n,o)});rU=S("ZodUnknown",(t,e)=>{FA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>n2(t,r,n,o)});nU=S("ZodNever",(t,e)=>{HA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>t2(t,r,n,o)});oU=S("ZodVoid",(t,e)=>{KA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>e2(t,r,n,o)});_b=S("ZodDate",(t,e)=>{WA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(n,o,i)=>o2(t,n,o,i),t.min=(n,o)=>t.check(on(n,o)),t.max=(n,o)=>t.check(Bn(n,o));let r=t._zod.bag;t.minDate=r.minimum?new Date(r.minimum):null,t.maxDate=r.maximum?new Date(r.maximum):null});iU=S("ZodArray",(t,e)=>{GA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>g2(t,r,n,o),t.element=e.element,t.min=(r,n)=>t.check(Ks(r,n)),t.nonempty=r=>t.check(Ks(1,r)),t.max=(r,n)=>t.check(Sl(r,n)),t.length=(r,n)=>t.check(kl(r,n)),t.unwrap=()=>t.element});bb=S("ZodObject",(t,e)=>{Jq.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>y2(t,r,n,o),q.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>Zr(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:bt()}),t.loose=()=>t.clone({...t._zod.def,catchall:bt()}),t.strict=()=>t.clone({...t._zod.def,catchall:tC()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>q.extend(t,r),t.safeExtend=r=>q.safeExtend(t,r),t.merge=r=>q.merge(t,r),t.pick=r=>q.pick(t,r),t.omit=r=>q.omit(t,r),t.partial=(...r)=>q.partial(nC,t,r[0]),t.required=(...r)=>q.required(oC,t,r[0])});wb=S("ZodUnion",(t,e)=>{Hf.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>y1(t,r,n,o),t.options=e.options});sU=S("ZodXor",(t,e)=>{wb.init(t,e),JA.init(t,e),t._zod.processJSONSchema=(r,n,o)=>y1(t,r,n,o),t.options=e.options});aU=S("ZodDiscriminatedUnion",(t,e)=>{wb.init(t,e),XA.init(t,e)});cU=S("ZodIntersection",(t,e)=>{YA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>v2(t,r,n,o)});uU=S("ZodTuple",(t,e)=>{M_.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>_2(t,r,n,o),t.rest=r=>t.clone({...t._zod.def,rest:r})});Sb=S("ZodRecord",(t,e)=>{QA.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>b2(t,r,n,o),t.keyType=e.keyType,t.valueType=e.valueType});dU=S("ZodMap",(t,e)=>{eP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>m2(t,r,n,o),t.keyType=e.keyType,t.valueType=e.valueType,t.min=(...r)=>t.check(Xi(...r)),t.nonempty=r=>t.check(Xi(1,r)),t.max=(...r)=>t.check(Ya(...r)),t.size=(...r)=>t.check(xl(...r))});pU=S("ZodSet",(t,e)=>{tP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>h2(t,r,n,o),t.min=(...r)=>t.check(Xi(...r)),t.nonempty=r=>t.check(Xi(1,r)),t.max=(...r)=>t.check(Ya(...r)),t.size=(...r)=>t.check(xl(...r))});fm=S("ZodEnum",(t,e)=>{rP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(n,o,i)=>i2(t,n,o,i),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let i={};for(let s of n)if(r.has(s))i[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new fm({...e,checks:[],...q.normalizeParams(o),entries:i})},t.exclude=(n,o)=>{let i={...e.entries};for(let s of n)if(r.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new fm({...e,checks:[],...q.normalizeParams(o),entries:i})}});fU=S("ZodLiteral",(t,e)=>{nP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>s2(t,r,n,o),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});mU=S("ZodFile",(t,e)=>{oP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>u2(t,r,n,o),t.min=(r,n)=>t.check(Xi(r,n)),t.max=(r,n)=>t.check(Ya(r,n)),t.mime=(r,n)=>t.check(nm(Array.isArray(r)?r:[r],n))});hU=S("ZodTransform",(t,e)=>{iP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>f2(t,r,n,o),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Ka(t.constructor.name);r.addIssue=i=>{if(typeof i=="string")r.issues.push(q.issue(i,r.value,e));else{let s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),r.issues.push(q.issue(s))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(i=>(r.value=i,r)):(r.value=o,r)}});nC=S("ZodOptional",(t,e)=>{D_.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>v1(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});gU=S("ZodExactOptional",(t,e)=>{sP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>v1(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});vU=S("ZodNullable",(t,e)=>{aP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>w2(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});_U=S("ZodDefault",(t,e)=>{cP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>S2(t,r,n,o),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});wU=S("ZodPrefault",(t,e)=>{uP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>k2(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});oC=S("ZodNonOptional",(t,e)=>{lP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>x2(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});kU=S("ZodSuccess",(t,e)=>{dP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>l2(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});$U=S("ZodCatch",(t,e)=>{pP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>$2(t,r,n,o),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});PU=S("ZodNaN",(t,e)=>{fP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>a2(t,r,n,o)});iC=S("ZodPipe",(t,e)=>{mP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>A2(t,r,n,o),t.in=e.in,t.out=e.out});sC=S("ZodCodec",(t,e)=>{iC.init(t,e),Kf.init(t,e)});CU=S("ZodReadonly",(t,e)=>{hP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>P2(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});IU=S("ZodTemplateLiteral",(t,e)=>{gP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>c2(t,r,n,o)});EU=S("ZodLazy",(t,e)=>{_P.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>T2(t,r,n,o),t.unwrap=()=>t._zod.def.getter()});jU=S("ZodPromise",(t,e)=>{vP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>C2(t,r,n,o),t.unwrap=()=>t._zod.def.innerType});NU=S("ZodFunction",(t,e)=>{yP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>p2(t,r,n,o)});kb=S("ZodCustom",(t,e)=>{bP.init(t,e),Ee.init(t,e),t._zod.processJSONSchema=(r,n,o)=>d2(t,r,n,o)});XX=m1,YX=h1;eY=(...t)=>g1({Codec:sC,Boolean:ym,String:mm},...t)});var DU,MU,qU=A(()=>{ir();ir();DU={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};MU||(MU={})});var Sxe,UU=A(()=>{Wf();mb();lm();pm();Sxe={...dm,...fb,iso:Qa}});var Ab={};To(Ab,{bigint:()=>iY,boolean:()=>oY,date:()=>sY,number:()=>nY,string:()=>rY});function rY(t){return IP(mm,t)}function nY(t){return MP(gm,t)}function oY(t){return VP(ym,t)}function iY(t){return HP(vm,t)}function sY(t){return n1(_b,t)}var BU=A(()=>{ir();pm()});var cC=A(()=>{ir();pm();mb();O1();j1();qU();ir();SP();ir();Al();UU();q_();lm();lm();BU();yr(xP())});var uC=A(()=>{cC();cC()});var lC=A(()=>{uC();uC()});var Il,ZU,Ws,Cb,Ir,VU,FU,Lxe,cY,uY,pC,Zn,wm,HU,Er,ro,no,Or,Tb,KU,fC,WU,GU,mC,xm,we,hC,JU,Ib,Zxe,ec,lY,Eb,dY,Sm,Tl,XU,pY,fY,mY,hY,gY,yY,vY,_Y,gC,bY,Ob,wY,xY,jb,SY,km,$m,kY,Am,tc,$Y,Pm,Nb,zb,Rb,Vxe,Mb,Db,qb,YU,QU,eB,yC,tB,Cm,El,rB,AY,PY,vC,CY,_C,bC,TY,IY,wC,xC,EY,OY,jY,NY,zY,RY,MY,DY,qY,SC,UY,BY,kC,$C,AC,LY,ZY,VY,PC,FY,CC,TC,HY,KY,nB,WY,Tm,Gs,Fxe,GY,JY,IC,oB,iB,XY,YY,QY,eQ,tQ,rQ,nQ,oQ,iQ,Pb,sQ,aQ,EC,OC,jC,cQ,uQ,lQ,dQ,pQ,fQ,mQ,hQ,gQ,yQ,vQ,_Q,bQ,wQ,xQ,NC,SQ,kQ,zC,$Q,AQ,PQ,CQ,RC,TQ,IQ,EQ,OQ,Hxe,Kxe,Wxe,Gxe,Jxe,Xxe,pe,dC,Js=A(()=>{lC();Il="2025-11-25",ZU=[Il,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],Ws="io.modelcontextprotocol/related-task",Cb="2.0",Ir=aC(t=>t!==null&&(typeof t=="object"||typeof t=="function")),VU=mt([_(),Xe().int()]),FU=_(),Lxe=dr({ttl:mt([Xe(),_m()]).optional(),pollInterval:Xe().optional()}),cY=H({ttl:Xe().optional()}),uY=H({taskId:_()}),pC=dr({progressToken:VU.optional(),[Ws]:uY.optional()}),Zn=H({_meta:pC.optional()}),wm=Zn.extend({task:cY.optional()}),HU=t=>wm.safeParse(t).success,Er=H({method:_(),params:Zn.loose().optional()}),ro=H({_meta:pC.optional()}),no=H({method:_(),params:ro.loose().optional()}),Or=dr({_meta:pC.optional()}),Tb=mt([_(),Xe().int()]),KU=H({jsonrpc:ie(Cb),id:Tb,...Er.shape}).strict(),fC=t=>KU.safeParse(t).success,WU=H({jsonrpc:ie(Cb),...no.shape}).strict(),GU=t=>WU.safeParse(t).success,mC=H({jsonrpc:ie(Cb),id:Tb,result:Or}).strict(),xm=t=>mC.safeParse(t).success;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(we||(we={}));hC=H({jsonrpc:ie(Cb),id:Tb.optional(),error:H({code:Xe().int(),message:_(),data:bt().optional()})}).strict(),JU=t=>hC.safeParse(t).success,Ib=mt([KU,WU,mC,hC]),Zxe=mt([mC,hC]),ec=Or.strict(),lY=ro.extend({requestId:Tb.optional(),reason:_().optional()}),Eb=no.extend({method:ie("notifications/cancelled"),params:lY}),dY=H({src:_(),mimeType:_().optional(),sizes:V(_()).optional(),theme:Zr(["light","dark"]).optional()}),Sm=H({icons:V(dY).optional()}),Tl=H({name:_(),title:_().optional()}),XU=Tl.extend({...Tl.shape,...Sm.shape,version:_(),websiteUrl:_().optional(),description:_().optional()}),pY=bm(H({applyDefaults:lt().optional()}),Ot(_(),bt())),fY=$b(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,bm(H({form:pY.optional(),url:Ir.optional()}),Ot(_(),bt()).optional())),mY=dr({list:Ir.optional(),cancel:Ir.optional(),requests:dr({sampling:dr({createMessage:Ir.optional()}).optional(),elicitation:dr({create:Ir.optional()}).optional()}).optional()}),hY=dr({list:Ir.optional(),cancel:Ir.optional(),requests:dr({tools:dr({call:Ir.optional()}).optional()}).optional()}),gY=H({experimental:Ot(_(),Ir).optional(),sampling:H({context:Ir.optional(),tools:Ir.optional()}).optional(),elicitation:fY.optional(),roots:H({listChanged:lt().optional()}).optional(),tasks:mY.optional()}),yY=Zn.extend({protocolVersion:_(),capabilities:gY,clientInfo:XU}),vY=Er.extend({method:ie("initialize"),params:yY}),_Y=H({experimental:Ot(_(),Ir).optional(),logging:Ir.optional(),completions:Ir.optional(),prompts:H({listChanged:lt().optional()}).optional(),resources:H({subscribe:lt().optional(),listChanged:lt().optional()}).optional(),tools:H({listChanged:lt().optional()}).optional(),tasks:hY.optional()}),gC=Or.extend({protocolVersion:_(),capabilities:_Y,serverInfo:XU,instructions:_().optional()}),bY=no.extend({method:ie("notifications/initialized"),params:ro.optional()}),Ob=Er.extend({method:ie("ping"),params:Zn.optional()}),wY=H({progress:Xe(),total:Rt(Xe()),message:Rt(_())}),xY=H({...ro.shape,...wY.shape,progressToken:VU}),jb=no.extend({method:ie("notifications/progress"),params:xY}),SY=Zn.extend({cursor:FU.optional()}),km=Er.extend({params:SY.optional()}),$m=Or.extend({nextCursor:FU.optional()}),kY=Zr(["working","input_required","completed","failed","cancelled"]),Am=H({taskId:_(),status:kY,ttl:mt([Xe(),_m()]),createdAt:_(),lastUpdatedAt:_(),pollInterval:Rt(Xe()),statusMessage:Rt(_())}),tc=Or.extend({task:Am}),$Y=ro.merge(Am),Pm=no.extend({method:ie("notifications/tasks/status"),params:$Y}),Nb=Er.extend({method:ie("tasks/get"),params:Zn.extend({taskId:_()})}),zb=Or.merge(Am),Rb=Er.extend({method:ie("tasks/result"),params:Zn.extend({taskId:_()})}),Vxe=Or.loose(),Mb=km.extend({method:ie("tasks/list")}),Db=$m.extend({tasks:V(Am)}),qb=Er.extend({method:ie("tasks/cancel"),params:Zn.extend({taskId:_()})}),YU=Or.merge(Am),QU=H({uri:_(),mimeType:Rt(_()),_meta:Ot(_(),bt()).optional()}),eB=QU.extend({text:_()}),yC=_().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),tB=QU.extend({blob:yC}),Cm=Zr(["user","assistant"]),El=H({audience:V(Cm).optional(),priority:Xe().min(0).max(1).optional(),lastModified:Qa.datetime({offset:!0}).optional()}),rB=H({...Tl.shape,...Sm.shape,uri:_(),description:Rt(_()),mimeType:Rt(_()),annotations:El.optional(),_meta:Rt(dr({}))}),AY=H({...Tl.shape,...Sm.shape,uriTemplate:_(),description:Rt(_()),mimeType:Rt(_()),annotations:El.optional(),_meta:Rt(dr({}))}),PY=km.extend({method:ie("resources/list")}),vC=$m.extend({resources:V(rB)}),CY=km.extend({method:ie("resources/templates/list")}),_C=$m.extend({resourceTemplates:V(AY)}),bC=Zn.extend({uri:_()}),TY=bC,IY=Er.extend({method:ie("resources/read"),params:TY}),wC=Or.extend({contents:V(mt([eB,tB]))}),xC=no.extend({method:ie("notifications/resources/list_changed"),params:ro.optional()}),EY=bC,OY=Er.extend({method:ie("resources/subscribe"),params:EY}),jY=bC,NY=Er.extend({method:ie("resources/unsubscribe"),params:jY}),zY=ro.extend({uri:_()}),RY=no.extend({method:ie("notifications/resources/updated"),params:zY}),MY=H({name:_(),description:Rt(_()),required:Rt(lt())}),DY=H({...Tl.shape,...Sm.shape,description:Rt(_()),arguments:Rt(V(MY)),_meta:Rt(dr({}))}),qY=km.extend({method:ie("prompts/list")}),SC=$m.extend({prompts:V(DY)}),UY=Zn.extend({name:_(),arguments:Ot(_(),_()).optional()}),BY=Er.extend({method:ie("prompts/get"),params:UY}),kC=H({type:ie("text"),text:_(),annotations:El.optional(),_meta:Ot(_(),bt()).optional()}),$C=H({type:ie("image"),data:yC,mimeType:_(),annotations:El.optional(),_meta:Ot(_(),bt()).optional()}),AC=H({type:ie("audio"),data:yC,mimeType:_(),annotations:El.optional(),_meta:Ot(_(),bt()).optional()}),LY=H({type:ie("tool_use"),name:_(),id:_(),input:Ot(_(),bt()),_meta:Ot(_(),bt()).optional()}),ZY=H({type:ie("resource"),resource:mt([eB,tB]),annotations:El.optional(),_meta:Ot(_(),bt()).optional()}),VY=rB.extend({type:ie("resource_link")}),PC=mt([kC,$C,AC,VY,ZY]),FY=H({role:Cm,content:PC}),CC=Or.extend({description:_().optional(),messages:V(FY)}),TC=no.extend({method:ie("notifications/prompts/list_changed"),params:ro.optional()}),HY=H({title:_().optional(),readOnlyHint:lt().optional(),destructiveHint:lt().optional(),idempotentHint:lt().optional(),openWorldHint:lt().optional()}),KY=H({taskSupport:Zr(["required","optional","forbidden"]).optional()}),nB=H({...Tl.shape,...Sm.shape,description:_().optional(),inputSchema:H({type:ie("object"),properties:Ot(_(),Ir).optional(),required:V(_()).optional()}).catchall(bt()),outputSchema:H({type:ie("object"),properties:Ot(_(),Ir).optional(),required:V(_()).optional()}).catchall(bt()).optional(),annotations:HY.optional(),execution:KY.optional(),_meta:Ot(_(),bt()).optional()}),WY=km.extend({method:ie("tools/list")}),Tm=$m.extend({tools:V(nB)}),Gs=Or.extend({content:V(PC).default([]),structuredContent:Ot(_(),bt()).optional(),isError:lt().optional()}),Fxe=Gs.or(Or.extend({toolResult:bt()})),GY=wm.extend({name:_(),arguments:Ot(_(),bt()).optional()}),JY=Er.extend({method:ie("tools/call"),params:GY}),IC=no.extend({method:ie("notifications/tools/list_changed"),params:ro.optional()}),oB=H({autoRefresh:lt().default(!0),debounceMs:Xe().int().nonnegative().default(300)}),iB=Zr(["debug","info","notice","warning","error","critical","alert","emergency"]),XY=Zn.extend({level:iB}),YY=Er.extend({method:ie("logging/setLevel"),params:XY}),QY=ro.extend({level:iB,logger:_().optional(),data:bt()}),eQ=no.extend({method:ie("notifications/message"),params:QY}),tQ=H({name:_().optional()}),rQ=H({hints:V(tQ).optional(),costPriority:Xe().min(0).max(1).optional(),speedPriority:Xe().min(0).max(1).optional(),intelligencePriority:Xe().min(0).max(1).optional()}),nQ=H({mode:Zr(["auto","required","none"]).optional()}),oQ=H({type:ie("tool_result"),toolUseId:_().describe("The unique identifier for the corresponding tool call."),content:V(PC).default([]),structuredContent:H({}).loose().optional(),isError:lt().optional(),_meta:Ot(_(),bt()).optional()}),iQ=xb("type",[kC,$C,AC]),Pb=xb("type",[kC,$C,AC,LY,oQ]),sQ=H({role:Cm,content:mt([Pb,V(Pb)]),_meta:Ot(_(),bt()).optional()}),aQ=wm.extend({messages:V(sQ),modelPreferences:rQ.optional(),systemPrompt:_().optional(),includeContext:Zr(["none","thisServer","allServers"]).optional(),temperature:Xe().optional(),maxTokens:Xe().int(),stopSequences:V(_()).optional(),metadata:Ir.optional(),tools:V(nB).optional(),toolChoice:nQ.optional()}),EC=Er.extend({method:ie("sampling/createMessage"),params:aQ}),OC=Or.extend({model:_(),stopReason:Rt(Zr(["endTurn","stopSequence","maxTokens"]).or(_())),role:Cm,content:iQ}),jC=Or.extend({model:_(),stopReason:Rt(Zr(["endTurn","stopSequence","maxTokens","toolUse"]).or(_())),role:Cm,content:mt([Pb,V(Pb)])}),cQ=H({type:ie("boolean"),title:_().optional(),description:_().optional(),default:lt().optional()}),uQ=H({type:ie("string"),title:_().optional(),description:_().optional(),minLength:Xe().optional(),maxLength:Xe().optional(),format:Zr(["email","uri","date","date-time"]).optional(),default:_().optional()}),lQ=H({type:Zr(["number","integer"]),title:_().optional(),description:_().optional(),minimum:Xe().optional(),maximum:Xe().optional(),default:Xe().optional()}),dQ=H({type:ie("string"),title:_().optional(),description:_().optional(),enum:V(_()),default:_().optional()}),pQ=H({type:ie("string"),title:_().optional(),description:_().optional(),oneOf:V(H({const:_(),title:_()})),default:_().optional()}),fQ=H({type:ie("string"),title:_().optional(),description:_().optional(),enum:V(_()),enumNames:V(_()).optional(),default:_().optional()}),mQ=mt([dQ,pQ]),hQ=H({type:ie("array"),title:_().optional(),description:_().optional(),minItems:Xe().optional(),maxItems:Xe().optional(),items:H({type:ie("string"),enum:V(_())}),default:V(_()).optional()}),gQ=H({type:ie("array"),title:_().optional(),description:_().optional(),minItems:Xe().optional(),maxItems:Xe().optional(),items:H({anyOf:V(H({const:_(),title:_()}))}),default:V(_()).optional()}),yQ=mt([hQ,gQ]),vQ=mt([fQ,mQ,yQ]),_Q=mt([vQ,cQ,uQ,lQ]),bQ=wm.extend({mode:ie("form").optional(),message:_(),requestedSchema:H({type:ie("object"),properties:Ot(_(),_Q),required:V(_()).optional()})}),wQ=wm.extend({mode:ie("url"),message:_(),elicitationId:_(),url:_().url()}),xQ=mt([bQ,wQ]),NC=Er.extend({method:ie("elicitation/create"),params:xQ}),SQ=ro.extend({elicitationId:_()}),kQ=no.extend({method:ie("notifications/elicitation/complete"),params:SQ}),zC=Or.extend({action:Zr(["accept","decline","cancel"]),content:$b(t=>t===null?void 0:t,Ot(_(),mt([_(),Xe(),lt(),V(_())])).optional())}),$Q=H({type:ie("ref/resource"),uri:_()}),AQ=H({type:ie("ref/prompt"),name:_()}),PQ=Zn.extend({ref:mt([AQ,$Q]),argument:H({name:_(),value:_()}),context:H({arguments:Ot(_(),_()).optional()}).optional()}),CQ=Er.extend({method:ie("completion/complete"),params:PQ}),RC=Or.extend({completion:dr({values:V(_()).max(100),total:Rt(Xe().int()),hasMore:Rt(lt())})}),TQ=H({uri:_().startsWith("file://"),name:_().optional(),_meta:Ot(_(),bt()).optional()}),IQ=Er.extend({method:ie("roots/list"),params:Zn.optional()}),EQ=Or.extend({roots:V(TQ)}),OQ=no.extend({method:ie("notifications/roots/list_changed"),params:ro.optional()}),Hxe=mt([Ob,vY,CQ,YY,BY,qY,PY,CY,IY,OY,NY,JY,WY,Nb,Rb,Mb,qb]),Kxe=mt([Eb,jb,bY,OQ,Pm]),Wxe=mt([ec,OC,jC,zC,EQ,zb,Db,tc]),Gxe=mt([Ob,EC,NC,IQ,Nb,Rb,Mb,qb]),Jxe=mt([Eb,jb,eQ,RY,xC,IC,TC,Pm,kQ]),Xxe=mt([ec,gC,RC,CC,SC,vC,_C,wC,Gs,Tm,zb,Db,tc]),pe=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===we.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new dC(o.elicitations,r)}return new t(e,r,n)}},dC=class extends pe{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(we.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}}});function Xs(t){return t==="completed"||t==="failed"||t==="cancelled"}var sB=A(()=>{});var Ub=A(()=>{});var MC=A(()=>{Ub()});var Ys=A(()=>{});var Bb=A(()=>{});var oo=A(()=>{Bb()});var DC=A(()=>{Pf();Ys();pr()});var qC=A(()=>{Ys()});var UC=A(()=>{});var Lb=A(()=>{pr()});var BC=A(()=>{pr()});var LC=A(()=>{Ys()});var ZC=A(()=>{pr()});var VC=A(()=>{pr();oo()});var FC=A(()=>{});var HC=A(()=>{pr()});var KC=A(()=>{});var ESe,Zb=A(()=>{Ys();ESe=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789")});var Vb=A(()=>{Pf();pr();Zb();Lb();oo()});var WC=A(()=>{pr();Vb();oo()});var GC=A(()=>{});var JC=A(()=>{oo()});var XC=A(()=>{});var Fb=A(()=>{pr()});var YC=A(()=>{pr();Fb()});var QC=A(()=>{Ys()});var eT=A(()=>{pr()});var tT=A(()=>{pr();oo()});var rT=A(()=>{pr()});var nT=A(()=>{pr()});var oT=A(()=>{Ys();pr()});var iT=A(()=>{pr()});var sT=A(()=>{oo()});var aT=A(()=>{oo()});var cT=A(()=>{pr()});var uT=A(()=>{Pf();oo();DC();qC();UC();Lb();BC();LC();ZC();VC();FC();HC();KC();WC();GC();JC();XC();YC();QC();eT();tT();rT();nT();Vb();oT();Zb();iT();sT();Fb();aT();cT()});var pr=A(()=>{Ub();uT();Bb();oo()});var aB=A(()=>{});var lT=A(()=>{pr();MC();oo()});var cB=A(()=>{Ub();MC();Ys();Bb();pr();aB();oo();DC();qC();UC();Lb();BC();LC();ZC();VC();FC();HC();KC();WC();GC();JC();XC();YC();QC();eT();tT();rT();nT();cT();Vb();oT();Zb();iT();sT();Fb();aT();uT();lT();lT()});function dT(t){let r=db(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=M2(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function pT(t,e){let r=No(t,e);if(!r.success)throw r.error;return r.data}var uB=A(()=>{S1();pb();cB()});function lB(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function dB(t,e){let r={...t};for(let n in e){let o=n,i=e[o];if(i===void 0)continue;let s=r[o];lB(s)&&lB(i)?r[o]={...s,...i}:r[o]=i}return r}var DQ,Hb,pB=A(()=>{pb();Js();sB();uB();DQ=6e4,Hb=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(Eb,r=>{this._oncancel(r)}),this.setNotificationHandler(jb,r=>{this._onprogress(r)}),this.setRequestHandler(Ob,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(Nb,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new pe(we.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(Rb,async(r,n)=>{let o=async()=>{let i=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(i,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{let d=c,p=new pe(d.error.code,d.error.message,d.error.data);l(p)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let s=await this._taskStore.getTask(i,n.sessionId);if(!s)throw new pe(we.InvalidParams,`Task not found: ${i}`);if(!Xs(s.status))return await this._waitForTaskUpdate(i,n.signal),await o();if(Xs(s.status)){let a=await this._taskStore.getTaskResult(i,n.sessionId);return this._clearTaskQueue(i),{...a,_meta:{...a._meta,[Ws]:{taskId:i}}}}return await o()};return await o()}),this.setRequestHandler(Mb,async(r,n)=>{try{let{tasks:o,nextCursor:i}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:i,_meta:{}}}catch(o){throw new pe(we.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(qb,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new pe(we.InvalidParams,`Task not found: ${r.params.taskId}`);if(Xs(o.status))throw new pe(we.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let i=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!i)throw new pe(we.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...i}}catch(o){throw o instanceof pe?o:new pe(we.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,i=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:i,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),pe.fromError(we.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=i=>{n?.(i),this._onerror(i)};let o=this._transport?.onmessage;this._transport.onmessage=(i,s)=>{o?.(i,s),xm(i)||JU(i)?this._onresponse(i):fC(i)?this._onrequest(i,s):GU(i)?this._onnotification(i):this._onerror(new Error(`Unknown message type: ${JSON.stringify(i)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(let n of this._requestHandlerAbortControllers.values())n.abort();this._requestHandlerAbortControllers.clear();let r=pe.fromError(we.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,i=e.params?._meta?.[Ws]?.taskId;if(n===void 0){let l={jsonrpc:"2.0",id:e.id,error:{code:we.MethodNotFound,message:"Method not found"}};i&&this._taskMessageQueue?this._enqueueTaskMessage(i,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(l).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let s=new AbortController;this._requestHandlerAbortControllers.set(e.id,s);let a=HU(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,u={signal:s.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async l=>{if(s.signal.aborted)return;let d={relatedRequestId:e.id};i&&(d.relatedTask={taskId:i}),await this.notification(l,d)},sendRequest:async(l,d,p)=>{if(s.signal.aborted)throw new pe(we.ConnectionClosed,"Request was cancelled");let f={...p,relatedRequestId:e.id};i&&!f.relatedTask&&(f.relatedTask={taskId:i});let h=f.relatedTask?.taskId??i;return h&&c&&await c.updateTaskStatus(h,"input_required"),await this.request(l,d,f)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:i,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,u)).then(async l=>{if(s.signal.aborted)return;let d={result:l,jsonrpc:"2.0",id:e.id};i&&this._taskMessageQueue?await this._enqueueTaskMessage(i,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async l=>{if(s.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:we.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};i&&this._taskMessageQueue?await this._enqueueTaskMessage(i,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),i=this._progressHandlers.get(o);if(!i){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let s=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&s&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),s(c);return}i(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),xm(e))n(e);else{let s=new pe(e.error.code,e.error.message,e.error.data);n(s)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let i=!1;if(xm(e)&&e.result&&typeof e.result=="object"){let s=e.result;if(s.task&&typeof s.task=="object"){let a=s.task;typeof a.taskId=="string"&&(i=!0,this._taskProgressTokens.set(a.taskId,r))}}if(i||this._progressHandlers.delete(r),xm(e))o(e);else{let s=pe.fromError(e.error.code,e.error.message,e.error.data);o(s)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(s){yield{type:"error",error:s instanceof pe?s:new pe(we.InternalError,String(s))}}return}let i;try{let s=await this.request(e,tc,n);if(s.task)i=s.task.taskId,yield{type:"taskCreated",task:s.task};else throw new pe(we.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:i},n);if(yield{type:"taskStatus",task:a},Xs(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:i},r,n)}:a.status==="failed"?yield{type:"error",error:new pe(we.InternalError,`Task ${i} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new pe(we.InternalError,`Task ${i} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:i},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(s){yield{type:"error",error:s instanceof pe?s:new pe(we.InternalError,String(s))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{let d=b=>{l(b)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(b){d(b);return}n?.signal?.throwIfAborted();let p=this._requestMessageId++,f={...e,jsonrpc:"2.0",id:p};n?.onprogress&&(this._progressHandlers.set(p,n.onprogress),f.params={...e.params,_meta:{...e.params?._meta||{},progressToken:p}}),a&&(f.params={...f.params,task:a}),c&&(f.params={...f.params,_meta:{...f.params?._meta||{},[Ws]:c}});let h=b=>{this._responseHandlers.delete(p),this._progressHandlers.delete(p),this._cleanupTimeout(p),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:p,reason:String(b)}},{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s}).catch(C=>this._onerror(new Error(`Failed to send cancellation: ${C}`)));let x=b instanceof pe?b:new pe(we.RequestTimeout,String(b));l(x)};this._responseHandlers.set(p,b=>{if(!n?.signal?.aborted){if(b instanceof Error)return l(b);try{let x=No(r,b.result);x.success?u(x.data):l(x.error)}catch(x){l(x)}}}),n?.signal?.addEventListener("abort",()=>{h(n?.signal?.reason)});let m=n?.timeout??DQ,y=()=>h(pe.fromError(we.RequestTimeout,"Request timed out",{timeout:m}));this._setupTimeout(p,m,n?.maxTotalTimeout,y,n?.resetTimeoutOnProgress??!1);let v=c?.taskId;if(v){let b=x=>{let C=this._responseHandlers.get(p);C?C(x):this._onerror(new Error(`Response handler missing for side-channeled request ${p}`))};this._requestResolvers.set(p,b),this._enqueueTaskMessage(v,{type:"request",message:f,timestamp:Date.now()}).catch(x=>{this._cleanupTimeout(p),l(x)})}else this._transport.send(f,{relatedRequestId:o,resumptionToken:i,onresumptiontoken:s}).catch(b=>{this._cleanupTimeout(p),l(b)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},zb,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},Db,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},YU,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[Ws]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[Ws]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let s={...e,jsonrpc:"2.0"};r?.relatedTask&&(s={...s,params:{...s.params,_meta:{...s.params?._meta||{},[Ws]:r.relatedTask}}}),await this._transport.send(s,r)}setRequestHandler(e,r){let n=dT(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,i)=>{let s=pT(e,o);return Promise.resolve(r(s,i))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=dT(e);this._notificationHandlers.set(n,o=>{let i=pT(e,o);return Promise.resolve(r(i))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&fC(o.message)){let i=o.message.id,s=this._requestResolvers.get(i);s?(s(new pe(we.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(i)):this._onerror(new Error(`Resolver missing for request ${i} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,i)=>{if(r.aborted){i(new pe(we.InvalidRequest,"Request cancelled"));return}let s=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(s),i(new pe(we.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let i=await n.getTask(o,r);if(!i)throw new pe(we.InvalidParams,"Failed to retrieve task: Task not found");return i},storeTaskResult:async(o,i,s)=>{await n.storeTaskResult(o,i,s,r);let a=await n.getTask(o,r);if(a){let c=Pm.parse({method:"notifications/tasks/status",params:a});await this.notification(c),Xs(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,i,s)=>{let a=await n.getTask(o,r);if(!a)throw new pe(we.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(Xs(a.status))throw new pe(we.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${i}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,i,s,r);let c=await n.getTask(o,r);if(c){let u=Pm.parse({method:"notifications/tasks/status",params:c});await this.notification(u),Xs(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}}});var jm=g(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.regexpCode=nt.getEsmExportName=nt.getProperty=nt.safeStringify=nt.stringify=nt.strConcat=nt.addCodeArg=nt.str=nt._=nt.nil=nt._Code=nt.Name=nt.IDENTIFIER=nt._CodeOrName=void 0;var Em=class{};nt._CodeOrName=Em;nt.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var rc=class extends Em{constructor(e){if(super(),!nt.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};nt.Name=rc;var io=class extends Em{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof rc&&(r[n.str]=(r[n.str]||0)+1),r),{})}};nt._Code=io;nt.nil=new io("");function fB(t,...e){let r=[t[0]],n=0;for(;n<e.length;)mT(r,e[n]),r.push(t[++n]);return new io(r)}nt._=fB;var fT=new io("+");function mB(t,...e){let r=[Om(t[0])],n=0;for(;n<e.length;)r.push(fT),mT(r,e[n]),r.push(fT,Om(t[++n]));return qQ(r),new io(r)}nt.str=mB;function mT(t,e){e instanceof io?t.push(...e._items):e instanceof rc?t.push(e):t.push(LQ(e))}nt.addCodeArg=mT;function qQ(t){let e=1;for(;e<t.length-1;){if(t[e]===fT){let r=UQ(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function UQ(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof rc||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof rc))return`"${t}${e.slice(1)}`}function BQ(t,e){return e.emptyStr()?t:t.emptyStr()?e:mB`${t}${e}`}nt.strConcat=BQ;function LQ(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:Om(Array.isArray(t)?t.join(","):t)}function ZQ(t){return new io(Om(t))}nt.stringify=ZQ;function Om(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}nt.safeStringify=Om;function VQ(t){return typeof t=="string"&&nt.IDENTIFIER.test(t)?new io(`.${t}`):fB`[${t}]`}nt.getProperty=VQ;function FQ(t){if(typeof t=="string"&&nt.IDENTIFIER.test(t))return new io(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}nt.getEsmExportName=FQ;function HQ(t){return new io(t.toString())}nt.regexpCode=HQ});var yT=g(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.ValueScope=yn.ValueScopeName=yn.Scope=yn.varKinds=yn.UsedValueState=void 0;var gn=jm(),hT=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},Kb;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(Kb||(yn.UsedValueState=Kb={}));yn.varKinds={const:new gn.Name("const"),let:new gn.Name("let"),var:new gn.Name("var")};var Wb=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof gn.Name?e:this.name(e)}name(e){return new gn.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};yn.Scope=Wb;var Gb=class extends gn.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,gn._)`.${new gn.Name(r)}[${n}]`}};yn.ValueScopeName=Gb;var KQ=(0,gn._)`\n`,gT=class extends Wb{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?KQ:gn.nil}}get(){return this._scope}name(e){return new Gb(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:i}=o,s=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let l=a.get(s);if(l)return l}else a=this._values[i]=new Map;a.set(s,o);let c=this._scope[i]||(this._scope[i]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:i,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,gn._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let i=gn.nil;for(let s in e){let a=e[s];if(!a)continue;let c=n[s]=n[s]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,Kb.Started);let l=r(u);if(l){let d=this.opts.es5?yn.varKinds.var:yn.varKinds.const;i=(0,gn._)`${i}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))i=(0,gn._)`${i}${l}${this.opts._n}`;else throw new hT(u);c.set(u,Kb.Completed)})}return i}};yn.ValueScope=gT});var De=g(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.or=Re.and=Re.not=Re.CodeGen=Re.operators=Re.varKinds=Re.ValueScopeName=Re.ValueScope=Re.Scope=Re.Name=Re.regexpCode=Re.stringify=Re.getProperty=Re.nil=Re.strConcat=Re.str=Re._=void 0;var Ge=jm(),zo=yT(),Qs=jm();Object.defineProperty(Re,"_",{enumerable:!0,get:function(){return Qs._}});Object.defineProperty(Re,"str",{enumerable:!0,get:function(){return Qs.str}});Object.defineProperty(Re,"strConcat",{enumerable:!0,get:function(){return Qs.strConcat}});Object.defineProperty(Re,"nil",{enumerable:!0,get:function(){return Qs.nil}});Object.defineProperty(Re,"getProperty",{enumerable:!0,get:function(){return Qs.getProperty}});Object.defineProperty(Re,"stringify",{enumerable:!0,get:function(){return Qs.stringify}});Object.defineProperty(Re,"regexpCode",{enumerable:!0,get:function(){return Qs.regexpCode}});Object.defineProperty(Re,"Name",{enumerable:!0,get:function(){return Qs.Name}});var Qb=yT();Object.defineProperty(Re,"Scope",{enumerable:!0,get:function(){return Qb.Scope}});Object.defineProperty(Re,"ValueScope",{enumerable:!0,get:function(){return Qb.ValueScope}});Object.defineProperty(Re,"ValueScopeName",{enumerable:!0,get:function(){return Qb.ValueScopeName}});Object.defineProperty(Re,"varKinds",{enumerable:!0,get:function(){return Qb.varKinds}});Re.operators={GT:new Ge._Code(">"),GTE:new Ge._Code(">="),LT:new Ge._Code("<"),LTE:new Ge._Code("<="),EQ:new Ge._Code("==="),NEQ:new Ge._Code("!=="),NOT:new Ge._Code("!"),OR:new Ge._Code("||"),AND:new Ge._Code("&&"),ADD:new Ge._Code("+")};var es=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},vT=class extends es{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?zo.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=jl(this.rhs,e,r)),this}get names(){return this.rhs instanceof Ge._CodeOrName?this.rhs.names:{}}},Jb=class extends es{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof Ge.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=jl(this.rhs,e,r),this}get names(){let e=this.lhs instanceof Ge.Name?{}:{...this.lhs.names};return Yb(e,this.rhs)}},_T=class extends Jb{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},bT=class extends es{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},wT=class extends es{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},xT=class extends es{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},ST=class extends es{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=jl(this.code,e,r),this}get names(){return this.code instanceof Ge._CodeOrName?this.code.names:{}}},Nm=class extends es{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let i=n[o];i.optimizeNames(e,r)||(WQ(e,i.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>ic(e,r.names),{})}},ts=class extends Nm{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},kT=class extends Nm{},Ol=class extends ts{};Ol.kind="else";var nc=class t extends ts{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new Ol(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(hB(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=jl(this.condition,e,r),this}get names(){let e=super.names;return Yb(e,this.condition),this.else&&ic(e,this.else.names),e}};nc.kind="if";var oc=class extends ts{};oc.kind="for";var $T=class extends oc{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=jl(this.iteration,e,r),this}get names(){return ic(super.names,this.iteration.names)}},AT=class extends oc{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?zo.varKinds.var:this.varKind,{name:n,from:o,to:i}=this;return`for(${r} ${n}=${o}; ${n}<${i}; ${n}++)`+super.render(e)}get names(){let e=Yb(super.names,this.from);return Yb(e,this.to)}},Xb=class extends oc{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=jl(this.iterable,e,r),this}get names(){return ic(super.names,this.iterable.names)}},zm=class extends ts{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};zm.kind="func";var Rm=class extends Nm{render(e){return"return "+super.render(e)}};Rm.kind="return";var PT=class extends ts{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&ic(e,this.catch.names),this.finally&&ic(e,this.finally.names),e}},Mm=class extends ts{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};Mm.kind="catch";var Dm=class extends ts{render(e){return"finally"+super.render(e)}};Dm.kind="finally";var CT=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new zo.Scope({parent:e}),this._nodes=[new kT]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let i=this._scope.toName(r);return n!==void 0&&o&&(this._constants[i.str]=n),this._leafNode(new vT(e,i,n)),i}const(e,r,n){return this._def(zo.varKinds.const,e,r,n)}let(e,r,n){return this._def(zo.varKinds.let,e,r,n)}var(e,r,n){return this._def(zo.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new Jb(e,r,n))}add(e,r){return this._leafNode(new _T(e,Re.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==Ge.nil&&this._leafNode(new ST(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,Ge.addCodeArg)(r,o));return r.push("}"),new Ge._Code(r)}if(e,r,n){if(this._blockNode(new nc(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new nc(e))}else(){return this._elseNode(new Ol)}endIf(){return this._endBlockNode(nc,Ol)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new $T(e),r)}forRange(e,r,n,o,i=this.opts.es5?zo.varKinds.var:zo.varKinds.let){let s=this._scope.toName(e);return this._for(new AT(i,s,r,n),()=>o(s))}forOf(e,r,n,o=zo.varKinds.const){let i=this._scope.toName(e);if(this.opts.es5){let s=r instanceof Ge.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,Ge._)`${s}.length`,a=>{this.var(i,(0,Ge._)`${s}[${a}]`),n(i)})}return this._for(new Xb("of",o,i,r),()=>n(i))}forIn(e,r,n,o=this.opts.es5?zo.varKinds.var:zo.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,Ge._)`Object.keys(${r})`,n);let i=this._scope.toName(e);return this._for(new Xb("in",o,i,r),()=>n(i))}endFor(){return this._endBlockNode(oc)}label(e){return this._leafNode(new bT(e))}break(e){return this._leafNode(new wT(e))}return(e){let r=new Rm;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(Rm)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new PT;if(this._blockNode(o),this.code(e),r){let i=this.name("e");this._currNode=o.catch=new Mm(i),r(i)}return n&&(this._currNode=o.finally=new Dm,this.code(n)),this._endBlockNode(Mm,Dm)}throw(e){return this._leafNode(new xT(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=Ge.nil,n,o){return this._blockNode(new zm(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(zm)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof nc))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};Re.CodeGen=CT;function ic(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function Yb(t,e){return e instanceof Ge._CodeOrName?ic(t,e.names):t}function jl(t,e,r){if(t instanceof Ge.Name)return n(t);if(!o(t))return t;return new Ge._Code(t._items.reduce((i,s)=>(s instanceof Ge.Name&&(s=n(s)),s instanceof Ge._Code?i.push(...s._items):i.push(s),i),[]));function n(i){let s=r[i.str];return s===void 0||e[i.str]!==1?i:(delete e[i.str],s)}function o(i){return i instanceof Ge._Code&&i._items.some(s=>s instanceof Ge.Name&&e[s.str]===1&&r[s.str]!==void 0)}}function WQ(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function hB(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,Ge._)`!${TT(t)}`}Re.not=hB;var GQ=gB(Re.operators.AND);function JQ(...t){return t.reduce(GQ)}Re.and=JQ;var XQ=gB(Re.operators.OR);function YQ(...t){return t.reduce(XQ)}Re.or=YQ;function gB(t){return(e,r)=>e===Ge.nil?r:r===Ge.nil?e:(0,Ge._)`${TT(e)} ${t} ${TT(r)}`}function TT(t){return t instanceof Ge.Name?t:(0,Ge._)`(${t})`}});var ot=g(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.checkStrictMode=qe.getErrorPath=qe.Type=qe.useFunc=qe.setEvaluated=qe.evaluatedPropsToName=qe.mergeEvaluated=qe.eachItem=qe.unescapeJsonPointer=qe.escapeJsonPointer=qe.escapeFragment=qe.unescapeFragment=qe.schemaRefOrVal=qe.schemaHasRulesButRef=qe.schemaHasRules=qe.checkUnknownRules=qe.alwaysValidSchema=qe.toHash=void 0;var wt=De(),QQ=jm();function eee(t){let e={};for(let r of t)e[r]=!0;return e}qe.toHash=eee;function tee(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(_B(t,e),!bB(e,t.self.RULES.all))}qe.alwaysValidSchema=tee;function _B(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let i in e)o[i]||SB(t,`unknown keyword: "${i}"`)}qe.checkUnknownRules=_B;function bB(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}qe.schemaHasRules=bB;function ree(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}qe.schemaHasRulesButRef=ree;function nee({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,wt._)`${r}`}return(0,wt._)`${t}${e}${(0,wt.getProperty)(n)}`}qe.schemaRefOrVal=nee;function oee(t){return wB(decodeURIComponent(t))}qe.unescapeFragment=oee;function iee(t){return encodeURIComponent(ET(t))}qe.escapeFragment=iee;function ET(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}qe.escapeJsonPointer=ET;function wB(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}qe.unescapeJsonPointer=wB;function see(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}qe.eachItem=see;function yB({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,i,s,a)=>{let c=s===void 0?i:s instanceof wt.Name?(i instanceof wt.Name?t(o,i,s):e(o,i,s),s):i instanceof wt.Name?(e(o,s,i),i):r(i,s);return a===wt.Name&&!(c instanceof wt.Name)?n(o,c):c}}qe.mergeEvaluated={props:yB({mergeNames:(t,e,r)=>t.if((0,wt._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,wt._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,wt._)`${r} || {}`).code((0,wt._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,wt._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,wt._)`${r} || {}`),OT(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:xB}),items:yB({mergeNames:(t,e,r)=>t.if((0,wt._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,wt._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,wt._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,wt._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function xB(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,wt._)`{}`);return e!==void 0&&OT(t,r,e),r}qe.evaluatedPropsToName=xB;function OT(t,e,r){Object.keys(r).forEach(n=>t.assign((0,wt._)`${e}${(0,wt.getProperty)(n)}`,!0))}qe.setEvaluated=OT;var vB={};function aee(t,e){return t.scopeValue("func",{ref:e,code:vB[e.code]||(vB[e.code]=new QQ._Code(e.code))})}qe.useFunc=aee;var IT;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(IT||(qe.Type=IT={}));function cee(t,e,r){if(t instanceof wt.Name){let n=e===IT.Num;return r?n?(0,wt._)`"[" + ${t} + "]"`:(0,wt._)`"['" + ${t} + "']"`:n?(0,wt._)`"/" + ${t}`:(0,wt._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,wt.getProperty)(t).toString():"/"+ET(t)}qe.getErrorPath=cee;function SB(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}qe.checkStrictMode=SB});var rs=g(jT=>{"use strict";Object.defineProperty(jT,"__esModule",{value:!0});var Vr=De(),uee={data:new Vr.Name("data"),valCxt:new Vr.Name("valCxt"),instancePath:new Vr.Name("instancePath"),parentData:new Vr.Name("parentData"),parentDataProperty:new Vr.Name("parentDataProperty"),rootData:new Vr.Name("rootData"),dynamicAnchors:new Vr.Name("dynamicAnchors"),vErrors:new Vr.Name("vErrors"),errors:new Vr.Name("errors"),this:new Vr.Name("this"),self:new Vr.Name("self"),scope:new Vr.Name("scope"),json:new Vr.Name("json"),jsonPos:new Vr.Name("jsonPos"),jsonLen:new Vr.Name("jsonLen"),jsonPart:new Vr.Name("jsonPart")};jT.default=uee});var qm=g(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.extendErrors=Fr.resetErrorsCount=Fr.reportExtraError=Fr.reportError=Fr.keyword$DataError=Fr.keywordError=void 0;var Ye=De(),e0=ot(),an=rs();Fr.keywordError={message:({keyword:t})=>(0,Ye.str)`must pass "${t}" keyword validation`};Fr.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Ye.str)`"${t}" keyword must be ${e} ($data)`:(0,Ye.str)`"${t}" keyword is invalid ($data)`};function lee(t,e=Fr.keywordError,r,n){let{it:o}=t,{gen:i,compositeRule:s,allErrors:a}=o,c=AB(t,e,r);n??(s||a)?kB(i,c):$B(o,(0,Ye._)`[${c}]`)}Fr.reportError=lee;function dee(t,e=Fr.keywordError,r){let{it:n}=t,{gen:o,compositeRule:i,allErrors:s}=n,a=AB(t,e,r);kB(o,a),i||s||$B(n,an.default.vErrors)}Fr.reportExtraError=dee;function pee(t,e){t.assign(an.default.errors,e),t.if((0,Ye._)`${an.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Ye._)`${an.default.vErrors}.length`,e),()=>t.assign(an.default.vErrors,null)))}Fr.resetErrorsCount=pee;function fee({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:i}){if(o===void 0)throw new Error("ajv implementation error");let s=t.name("err");t.forRange("i",o,an.default.errors,a=>{t.const(s,(0,Ye._)`${an.default.vErrors}[${a}]`),t.if((0,Ye._)`${s}.instancePath === undefined`,()=>t.assign((0,Ye._)`${s}.instancePath`,(0,Ye.strConcat)(an.default.instancePath,i.errorPath))),t.assign((0,Ye._)`${s}.schemaPath`,(0,Ye.str)`${i.errSchemaPath}/${e}`),i.opts.verbose&&(t.assign((0,Ye._)`${s}.schema`,r),t.assign((0,Ye._)`${s}.data`,n))})}Fr.extendErrors=fee;function kB(t,e){let r=t.const("err",e);t.if((0,Ye._)`${an.default.vErrors} === null`,()=>t.assign(an.default.vErrors,(0,Ye._)`[${r}]`),(0,Ye._)`${an.default.vErrors}.push(${r})`),t.code((0,Ye._)`${an.default.errors}++`)}function $B(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Ye._)`new ${t.ValidationError}(${e})`):(r.assign((0,Ye._)`${n}.errors`,e),r.return(!1))}var sc={keyword:new Ye.Name("keyword"),schemaPath:new Ye.Name("schemaPath"),params:new Ye.Name("params"),propertyName:new Ye.Name("propertyName"),message:new Ye.Name("message"),schema:new Ye.Name("schema"),parentSchema:new Ye.Name("parentSchema")};function AB(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Ye._)`{}`:mee(t,e,r)}function mee(t,e,r={}){let{gen:n,it:o}=t,i=[hee(o,r),gee(t,r)];return yee(t,e,i),n.object(...i)}function hee({errorPath:t},{instancePath:e}){let r=e?(0,Ye.str)`${t}${(0,e0.getErrorPath)(e,e0.Type.Str)}`:t;return[an.default.instancePath,(0,Ye.strConcat)(an.default.instancePath,r)]}function gee({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Ye.str)`${e}/${t}`;return r&&(o=(0,Ye.str)`${o}${(0,e0.getErrorPath)(r,e0.Type.Str)}`),[sc.schemaPath,o]}function yee(t,{params:e,message:r},n){let{keyword:o,data:i,schemaValue:s,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([sc.keyword,o],[sc.params,typeof e=="function"?e(t):e||(0,Ye._)`{}`]),c.messages&&n.push([sc.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([sc.schema,s],[sc.parentSchema,(0,Ye._)`${l}${d}`],[an.default.data,i]),u&&n.push([sc.propertyName,u])}});var CB=g(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});Nl.boolOrEmptySchema=Nl.topBoolOrEmptySchema=void 0;var vee=qm(),_ee=De(),bee=rs(),wee={message:"boolean schema is false"};function xee(t){let{gen:e,schema:r,validateName:n}=t;r===!1?PB(t,!1):typeof r=="object"&&r.$async===!0?e.return(bee.default.data):(e.assign((0,_ee._)`${n}.errors`,null),e.return(!0))}Nl.topBoolOrEmptySchema=xee;function See(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),PB(t)):r.var(e,!0)}Nl.boolOrEmptySchema=See;function PB(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,vee.reportError)(o,wee,void 0,e)}});var NT=g(zl=>{"use strict";Object.defineProperty(zl,"__esModule",{value:!0});zl.getRules=zl.isJSONType=void 0;var kee=["string","number","integer","boolean","null","object","array"],$ee=new Set(kee);function Aee(t){return typeof t=="string"&&$ee.has(t)}zl.isJSONType=Aee;function Pee(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}zl.getRules=Pee});var zT=g(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.shouldUseRule=ea.shouldUseGroup=ea.schemaHasRulesForType=void 0;function Cee({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&TB(t,n)}ea.schemaHasRulesForType=Cee;function TB(t,e){return e.rules.some(r=>IB(t,r))}ea.shouldUseGroup=TB;function IB(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}ea.shouldUseRule=IB});var Um=g(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.reportTypeError=Hr.checkDataTypes=Hr.checkDataType=Hr.coerceAndCheckDataType=Hr.getJSONTypes=Hr.getSchemaTypes=Hr.DataType=void 0;var Tee=NT(),Iee=zT(),Eee=qm(),Oe=De(),EB=ot(),Rl;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(Rl||(Hr.DataType=Rl={}));function Oee(t){let e=OB(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Hr.getSchemaTypes=Oee;function OB(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(Tee.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Hr.getJSONTypes=OB;function jee(t,e){let{gen:r,data:n,opts:o}=t,i=Nee(e,o.coerceTypes),s=e.length>0&&!(i.length===0&&e.length===1&&(0,Iee.schemaHasRulesForType)(t,e[0]));if(s){let a=MT(e,n,o.strictNumbers,Rl.Wrong);r.if(a,()=>{i.length?zee(t,e,i):DT(t)})}return s}Hr.coerceAndCheckDataType=jee;var jB=new Set(["string","number","integer","boolean","null"]);function Nee(t,e){return e?t.filter(r=>jB.has(r)||e==="array"&&r==="array"):[]}function zee(t,e,r){let{gen:n,data:o,opts:i}=t,s=n.let("dataType",(0,Oe._)`typeof ${o}`),a=n.let("coerced",(0,Oe._)`undefined`);i.coerceTypes==="array"&&n.if((0,Oe._)`${s} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,Oe._)`${o}[0]`).assign(s,(0,Oe._)`typeof ${o}`).if(MT(e,o,i.strictNumbers),()=>n.assign(a,o))),n.if((0,Oe._)`${a} !== undefined`);for(let u of r)(jB.has(u)||u==="array"&&i.coerceTypes==="array")&&c(u);n.else(),DT(t),n.endIf(),n.if((0,Oe._)`${a} !== undefined`,()=>{n.assign(o,a),Ree(t,a)});function c(u){switch(u){case"string":n.elseIf((0,Oe._)`${s} == "number" || ${s} == "boolean"`).assign(a,(0,Oe._)`"" + ${o}`).elseIf((0,Oe._)`${o} === null`).assign(a,(0,Oe._)`""`);return;case"number":n.elseIf((0,Oe._)`${s} == "boolean" || ${o} === null
              || (${s} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,Oe._)`+${o}`);return;case"integer":n.elseIf((0,Oe._)`${s} === "boolean" || ${o} === null
              || (${s} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,Oe._)`+${o}`);return;case"boolean":n.elseIf((0,Oe._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,Oe._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,Oe._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,Oe._)`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${o} === null`).assign(a,(0,Oe._)`[${o}]`)}}}function Ree({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,Oe._)`${e} !== undefined`,()=>t.assign((0,Oe._)`${e}[${r}]`,n))}function RT(t,e,r,n=Rl.Correct){let o=n===Rl.Correct?Oe.operators.EQ:Oe.operators.NEQ,i;switch(t){case"null":return(0,Oe._)`${e} ${o} null`;case"array":i=(0,Oe._)`Array.isArray(${e})`;break;case"object":i=(0,Oe._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":i=s((0,Oe._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":i=s();break;default:return(0,Oe._)`typeof ${e} ${o} ${t}`}return n===Rl.Correct?i:(0,Oe.not)(i);function s(a=Oe.nil){return(0,Oe.and)((0,Oe._)`typeof ${e} == "number"`,a,r?(0,Oe._)`isFinite(${e})`:Oe.nil)}}Hr.checkDataType=RT;function MT(t,e,r,n){if(t.length===1)return RT(t[0],e,r,n);let o,i=(0,EB.toHash)(t);if(i.array&&i.object){let s=(0,Oe._)`typeof ${e} != "object"`;o=i.null?s:(0,Oe._)`!${e} || ${s}`,delete i.null,delete i.array,delete i.object}else o=Oe.nil;i.number&&delete i.integer;for(let s in i)o=(0,Oe.and)(o,RT(s,e,r,n));return o}Hr.checkDataTypes=MT;var Mee={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,Oe._)`{type: ${t}}`:(0,Oe._)`{type: ${e}}`};function DT(t){let e=Dee(t);(0,Eee.reportError)(e,Mee)}Hr.reportTypeError=DT;function Dee(t){let{gen:e,data:r,schema:n}=t,o=(0,EB.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var zB=g(t0=>{"use strict";Object.defineProperty(t0,"__esModule",{value:!0});t0.assignDefaults=void 0;var Ml=De(),qee=ot();function Uee(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)NB(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,i)=>NB(t,i,o.default))}t0.assignDefaults=Uee;function NB(t,e,r){let{gen:n,compositeRule:o,data:i,opts:s}=t;if(r===void 0)return;let a=(0,Ml._)`${i}${(0,Ml.getProperty)(e)}`;if(o){(0,qee.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,Ml._)`${a} === undefined`;s.useDefaults==="empty"&&(c=(0,Ml._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,Ml._)`${a} = ${(0,Ml.stringify)(r)}`)}});var so=g(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.validateUnion=ht.validateArray=ht.usePattern=ht.callValidateCode=ht.schemaProperties=ht.allSchemaProperties=ht.noPropertyInData=ht.propertyInData=ht.isOwnProperty=ht.hasPropFunc=ht.reportMissingProp=ht.checkMissingProp=ht.checkReportMissingProp=void 0;var Mt=De(),qT=ot(),ta=rs(),Bee=ot();function Lee(t,e){let{gen:r,data:n,it:o}=t;r.if(BT(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,Mt._)`${e}`},!0),t.error()})}ht.checkReportMissingProp=Lee;function Zee({gen:t,data:e,it:{opts:r}},n,o){return(0,Mt.or)(...n.map(i=>(0,Mt.and)(BT(t,e,i,r.ownProperties),(0,Mt._)`${o} = ${i}`)))}ht.checkMissingProp=Zee;function Vee(t,e){t.setParams({missingProperty:e},!0),t.error()}ht.reportMissingProp=Vee;function RB(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,Mt._)`Object.prototype.hasOwnProperty`})}ht.hasPropFunc=RB;function UT(t,e,r){return(0,Mt._)`${RB(t)}.call(${e}, ${r})`}ht.isOwnProperty=UT;function Fee(t,e,r,n){let o=(0,Mt._)`${e}${(0,Mt.getProperty)(r)} !== undefined`;return n?(0,Mt._)`${o} && ${UT(t,e,r)}`:o}ht.propertyInData=Fee;function BT(t,e,r,n){let o=(0,Mt._)`${e}${(0,Mt.getProperty)(r)} === undefined`;return n?(0,Mt.or)(o,(0,Mt.not)(UT(t,e,r))):o}ht.noPropertyInData=BT;function MB(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}ht.allSchemaProperties=MB;function Hee(t,e){return MB(e).filter(r=>!(0,qT.alwaysValidSchema)(t,e[r]))}ht.schemaProperties=Hee;function Kee({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:i},it:s},a,c,u){let l=u?(0,Mt._)`${t}, ${e}, ${n}${o}`:e,d=[[ta.default.instancePath,(0,Mt.strConcat)(ta.default.instancePath,i)],[ta.default.parentData,s.parentData],[ta.default.parentDataProperty,s.parentDataProperty],[ta.default.rootData,ta.default.rootData]];s.opts.dynamicRef&&d.push([ta.default.dynamicAnchors,ta.default.dynamicAnchors]);let p=(0,Mt._)`${l}, ${r.object(...d)}`;return c!==Mt.nil?(0,Mt._)`${a}.call(${c}, ${p})`:(0,Mt._)`${a}(${p})`}ht.callValidateCode=Kee;var Wee=(0,Mt._)`new RegExp`;function Gee({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,i=o(r,n);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,Mt._)`${o.code==="new RegExp"?Wee:(0,Bee.useFunc)(t,o)}(${r}, ${n})`})}ht.usePattern=Gee;function Jee(t){let{gen:e,data:r,keyword:n,it:o}=t,i=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(i,!0),s(()=>e.break()),i;function s(a){let c=e.const("len",(0,Mt._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:qT.Type.Num},i),e.if((0,Mt.not)(i),a)})}}ht.validateArray=Jee;function Xee(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,qT.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let s=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(s,(0,Mt._)`${s} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,Mt.not)(s))})),t.result(s,()=>t.reset(),()=>t.error(!0))}ht.validateUnion=Xee});var UB=g(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.validateKeywordUsage=fi.validSchemaType=fi.funcKeywordCode=fi.macroKeywordCode=void 0;var cn=De(),ac=rs(),Yee=so(),Qee=qm();function ete(t,e){let{gen:r,keyword:n,schema:o,parentSchema:i,it:s}=t,a=e.macro.call(s.self,o,i,s),c=qB(r,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:cn.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}fi.macroKeywordCode=ete;function tte(t,e){var r;let{gen:n,keyword:o,schema:i,parentSchema:s,$data:a,it:c}=t;nte(c,e);let u=!a&&e.compile?e.compile.call(c.self,i,s,c):e.validate,l=qB(n,o,u),d=n.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)m(),e.modifying&&DB(t),y(()=>t.error());else{let v=e.async?f():h();e.modifying&&DB(t),y(()=>rte(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>m((0,cn._)`await `),b=>n.assign(d,!1).if((0,cn._)`${b} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,cn._)`${b}.errors`),()=>n.throw(b))),v}function h(){let v=(0,cn._)`${l}.errors`;return n.assign(v,null),m(cn.nil),v}function m(v=e.async?(0,cn._)`await `:cn.nil){let b=c.opts.passContext?ac.default.this:ac.default.self,x=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,cn._)`${v}${(0,Yee.callValidateCode)(t,l,b,x)}`,e.modifying)}function y(v){var b;n.if((0,cn.not)((b=e.valid)!==null&&b!==void 0?b:d),v)}}fi.funcKeywordCode=tte;function DB(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,cn._)`${n.parentData}[${n.parentDataProperty}]`))}function rte(t,e){let{gen:r}=t;r.if((0,cn._)`Array.isArray(${e})`,()=>{r.assign(ac.default.vErrors,(0,cn._)`${ac.default.vErrors} === null ? ${e} : ${ac.default.vErrors}.concat(${e})`).assign(ac.default.errors,(0,cn._)`${ac.default.vErrors}.length`),(0,Qee.extendErrors)(t)},()=>t.error())}function nte({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function qB(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,cn.stringify)(r)})}function ote(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}fi.validSchemaType=ote;function ite({schema:t,opts:e,self:r,errSchemaPath:n},o,i){if(Array.isArray(o.keyword)?!o.keyword.includes(i):o.keyword!==i)throw new Error("ajv implementation error");let s=o.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${i}: ${s.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[i])){let c=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}fi.validateKeywordUsage=ite});var LB=g(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});ra.extendSubschemaMode=ra.extendSubschemaData=ra.getSubschema=void 0;var mi=De(),BB=ot();function ste(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:i,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,mi._)`${t.schemaPath}${(0,mi.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,mi._)`${t.schemaPath}${(0,mi.getProperty)(e)}${(0,mi.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,BB.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||i===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:s,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}ra.getSubschema=ste;function ate(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:i,propertyName:s}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,p=a.let("data",(0,mi._)`${e.data}${(0,mi.getProperty)(r)}`,!0);c(p),t.errorPath=(0,mi.str)`${u}${(0,BB.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,mi._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof mi.Name?o:a.let("data",o,!0);c(u),s!==void 0&&(t.propertyName=s)}i&&(t.dataTypes=i);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}ra.extendSubschemaData=ate;function cte(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:i}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),i!==void 0&&(t.allErrors=i),t.jtdDiscriminator=e,t.jtdMetadata=r}ra.extendSubschemaMode=cte});var Bm=g((HAe,ZB)=>{"use strict";ZB.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,i;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,i[o]))return!1;for(o=n;o--!==0;){var s=i[o];if(!t(e[s],r[s]))return!1}return!0}return e!==e&&r!==r}});var FB=g((KAe,VB)=>{"use strict";var na=VB.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};r0(e,n,o,t,"",t)};na.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};na.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};na.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};na.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function r0(t,e,r,n,o,i,s,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,i,s,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in na.arrayKeywords)for(var p=0;p<d.length;p++)r0(t,e,r,d[p],o+"/"+l+"/"+p,i,o,l,n,p)}else if(l in na.propsKeywords){if(d&&typeof d=="object")for(var f in d)r0(t,e,r,d[f],o+"/"+l+"/"+ute(f),i,o,l,n,f)}else(l in na.keywords||t.allKeys&&!(l in na.skipKeywords))&&r0(t,e,r,d,o+"/"+l,i,o,l,n)}r(n,o,i,s,a,c,u)}}function ute(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var Lm=g(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.getSchemaRefs=vn.resolveUrl=vn.normalizeId=vn._getFullPath=vn.getFullPath=vn.inlineRef=void 0;var lte=ot(),dte=Bm(),pte=FB(),fte=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function mte(t,e=!0){return typeof t=="boolean"?!0:e===!0?!LT(t):e?HB(t)<=e:!1}vn.inlineRef=mte;var hte=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function LT(t){for(let e in t){if(hte.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(LT)||typeof r=="object"&&LT(r))return!0}return!1}function HB(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!fte.has(r)&&(typeof t[r]=="object"&&(0,lte.eachItem)(t[r],n=>e+=HB(n)),e===1/0))return 1/0}return e}function KB(t,e="",r){r!==!1&&(e=Dl(e));let n=t.parse(e);return WB(t,n)}vn.getFullPath=KB;function WB(t,e){return t.serialize(e).split("#")[0]+"#"}vn._getFullPath=WB;var gte=/#\/?$/;function Dl(t){return t?t.replace(gte,""):""}vn.normalizeId=Dl;function yte(t,e,r){return r=Dl(r),t.resolve(e,r)}vn.resolveUrl=yte;var vte=/^[a-z_][-a-z0-9._]*$/i;function _te(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=Dl(t[r]||e),i={"":o},s=KB(n,o,!1),a={},c=new Set;return pte(t,{allKeys:!0},(d,p,f,h)=>{if(h===void 0)return;let m=s+p,y=i[h];typeof d[r]=="string"&&(y=v.call(this,d[r])),b.call(this,d.$anchor),b.call(this,d.$dynamicAnchor),i[p]=y;function v(x){let C=this.opts.uriResolver.resolve;if(x=Dl(y?C(y,x):x),c.has(x))throw l(x);c.add(x);let $=this.refs[x];return typeof $=="string"&&($=this.refs[$]),typeof $=="object"?u(d,$.schema,x):x!==Dl(m)&&(x[0]==="#"?(u(d,a[x],x),a[x]=d):this.refs[x]=m),x}function b(x){if(typeof x=="string"){if(!vte.test(x))throw new Error(`invalid anchor "${x}"`);v.call(this,`#${x}`)}}}),a;function u(d,p,f){if(p!==void 0&&!dte(d,p))throw l(f)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}vn.getSchemaRefs=_te});var Fm=g(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.getData=oa.KeywordCxt=oa.validateFunctionCode=void 0;var QB=CB(),GB=Um(),VT=zT(),n0=Um(),bte=zB(),Vm=UB(),ZT=LB(),ce=De(),ke=rs(),wte=Lm(),ns=ot(),Zm=qm();function xte(t){if(rL(t)&&(nL(t),tL(t))){$te(t);return}eL(t,()=>(0,QB.topBoolOrEmptySchema)(t))}oa.validateFunctionCode=xte;function eL({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},i){o.code.es5?t.func(e,(0,ce._)`${ke.default.data}, ${ke.default.valCxt}`,n.$async,()=>{t.code((0,ce._)`"use strict"; ${JB(r,o)}`),kte(t,o),t.code(i)}):t.func(e,(0,ce._)`${ke.default.data}, ${Ste(o)}`,n.$async,()=>t.code(JB(r,o)).code(i))}function Ste(t){return(0,ce._)`{${ke.default.instancePath}="", ${ke.default.parentData}, ${ke.default.parentDataProperty}, ${ke.default.rootData}=${ke.default.data}${t.dynamicRef?(0,ce._)`, ${ke.default.dynamicAnchors}={}`:ce.nil}}={}`}function kte(t,e){t.if(ke.default.valCxt,()=>{t.var(ke.default.instancePath,(0,ce._)`${ke.default.valCxt}.${ke.default.instancePath}`),t.var(ke.default.parentData,(0,ce._)`${ke.default.valCxt}.${ke.default.parentData}`),t.var(ke.default.parentDataProperty,(0,ce._)`${ke.default.valCxt}.${ke.default.parentDataProperty}`),t.var(ke.default.rootData,(0,ce._)`${ke.default.valCxt}.${ke.default.rootData}`),e.dynamicRef&&t.var(ke.default.dynamicAnchors,(0,ce._)`${ke.default.valCxt}.${ke.default.dynamicAnchors}`)},()=>{t.var(ke.default.instancePath,(0,ce._)`""`),t.var(ke.default.parentData,(0,ce._)`undefined`),t.var(ke.default.parentDataProperty,(0,ce._)`undefined`),t.var(ke.default.rootData,ke.default.data),e.dynamicRef&&t.var(ke.default.dynamicAnchors,(0,ce._)`{}`)})}function $te(t){let{schema:e,opts:r,gen:n}=t;eL(t,()=>{r.$comment&&e.$comment&&iL(t),Ite(t),n.let(ke.default.vErrors,null),n.let(ke.default.errors,0),r.unevaluated&&Ate(t),oL(t),jte(t)})}function Ate(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,ce._)`${r}.evaluated`),e.if((0,ce._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,ce._)`${t.evaluated}.props`,(0,ce._)`undefined`)),e.if((0,ce._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,ce._)`${t.evaluated}.items`,(0,ce._)`undefined`))}function JB(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,ce._)`/*# sourceURL=${r} */`:ce.nil}function Pte(t,e){if(rL(t)&&(nL(t),tL(t))){Cte(t,e);return}(0,QB.boolOrEmptySchema)(t,e)}function tL({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function rL(t){return typeof t.schema!="boolean"}function Cte(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&iL(t),Ete(t),Ote(t);let i=n.const("_errs",ke.default.errors);oL(t,i),n.var(e,(0,ce._)`${i} === ${ke.default.errors}`)}function nL(t){(0,ns.checkUnknownRules)(t),Tte(t)}function oL(t,e){if(t.opts.jtd)return XB(t,[],!1,e);let r=(0,GB.getSchemaTypes)(t.schema),n=(0,GB.coerceAndCheckDataType)(t,r);XB(t,r,!n,e)}function Tte(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,ns.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function Ite(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,ns.checkStrictMode)(t,"default is ignored in the schema root")}function Ete(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,wte.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function Ote(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function iL({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let i=r.$comment;if(o.$comment===!0)t.code((0,ce._)`${ke.default.self}.logger.log(${i})`);else if(typeof o.$comment=="function"){let s=(0,ce.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,ce._)`${ke.default.self}.opts.$comment(${i}, ${s}, ${a}.schema)`)}}function jte(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:i}=t;r.$async?e.if((0,ce._)`${ke.default.errors} === 0`,()=>e.return(ke.default.data),()=>e.throw((0,ce._)`new ${o}(${ke.default.vErrors})`)):(e.assign((0,ce._)`${n}.errors`,ke.default.vErrors),i.unevaluated&&Nte(t),e.return((0,ce._)`${ke.default.errors} === 0`))}function Nte({gen:t,evaluated:e,props:r,items:n}){r instanceof ce.Name&&t.assign((0,ce._)`${e}.props`,r),n instanceof ce.Name&&t.assign((0,ce._)`${e}.items`,n)}function XB(t,e,r,n){let{gen:o,schema:i,data:s,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(i.$ref&&(c.ignoreKeywordsWithRef||!(0,ns.schemaHasRulesButRef)(i,l))){o.block(()=>aL(t,"$ref",l.all.$ref.definition));return}c.jtd||zte(t,e),o.block(()=>{for(let p of l.rules)d(p);d(l.post)});function d(p){(0,VT.shouldUseGroup)(i,p)&&(p.type?(o.if((0,n0.checkDataType)(p.type,s,c.strictNumbers)),YB(t,p),e.length===1&&e[0]===p.type&&r&&(o.else(),(0,n0.reportTypeError)(t)),o.endIf()):YB(t,p),a||o.if((0,ce._)`${ke.default.errors} === ${n||0}`))}}function YB(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,bte.assignDefaults)(t,e.type),r.block(()=>{for(let i of e.rules)(0,VT.shouldUseRule)(n,i)&&aL(t,i.keyword,i.definition,e.type)})}function zte(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(Rte(t,e),t.opts.allowUnionTypes||Mte(t,e),Dte(t,t.dataTypes))}function Rte(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{sL(t.dataTypes,r)||FT(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),Ute(t,e)}}function Mte(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&FT(t,"use allowUnionTypes to allow union type keyword")}function Dte(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,VT.shouldUseRule)(t.schema,o)){let{type:i}=o.definition;i.length&&!i.some(s=>qte(e,s))&&FT(t,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function qte(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function sL(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function Ute(t,e){let r=[];for(let n of t.dataTypes)sL(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function FT(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,ns.checkStrictMode)(t,e,t.opts.strictTypes)}var o0=class{constructor(e,r,n){if((0,Vm.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,ns.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",cL(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,Vm.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",ke.default.errors))}result(e,r,n){this.failResult((0,ce.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,ce.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,ce._)`${r} !== undefined && (${(0,ce.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?Zm.reportExtraError:Zm.reportError)(this,this.def.error,r)}$dataError(){(0,Zm.reportError)(this,this.def.$dataError||Zm.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Zm.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=ce.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=ce.nil,r=ce.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:i,def:s}=this;n.if((0,ce.or)((0,ce._)`${o} === undefined`,r)),e!==ce.nil&&n.assign(e,!0),(i.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==ce.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:i}=this;return(0,ce.or)(s(),a());function s(){if(n.length){if(!(r instanceof ce.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,ce._)`${(0,n0.checkDataTypes)(c,r,i.opts.strictNumbers,n0.DataType.Wrong)}`}return ce.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,ce._)`!${c}(${r})`}return ce.nil}}subschema(e,r){let n=(0,ZT.getSubschema)(this.it,e);(0,ZT.extendSubschemaData)(n,this.it,e),(0,ZT.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return Pte(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=ns.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=ns.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,ce.Name)),!0}};oa.KeywordCxt=o0;function aL(t,e,r,n){let o=new o0(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,Vm.funcKeywordCode)(o,r):"macro"in r?(0,Vm.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,Vm.funcKeywordCode)(o,r)}var Bte=/^\/(?:[^~]|~0|~1)*$/,Lte=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function cL(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,i;if(t==="")return ke.default.rootData;if(t[0]==="/"){if(!Bte.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,i=ke.default.rootData}else{let u=Lte.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(i=r[e-l],!o)return i}let s=i,a=o.split("/");for(let u of a)u&&(i=(0,ce._)`${i}${(0,ce.getProperty)((0,ns.unescapeJsonPointer)(u))}`,s=(0,ce._)`${s} && ${i}`);return s;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}oa.getData=cL});var i0=g(KT=>{"use strict";Object.defineProperty(KT,"__esModule",{value:!0});var HT=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};KT.default=HT});var Hm=g(JT=>{"use strict";Object.defineProperty(JT,"__esModule",{value:!0});var WT=Lm(),GT=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,WT.resolveUrl)(e,r,n),this.missingSchema=(0,WT.normalizeId)((0,WT.getFullPath)(e,this.missingRef))}};JT.default=GT});var a0=g(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.resolveSchema=ao.getCompilingSchema=ao.resolveRef=ao.compileSchema=ao.SchemaEnv=void 0;var Ro=De(),Zte=i0(),cc=rs(),Mo=Lm(),uL=ot(),Vte=Fm(),ql=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,Mo.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};ao.SchemaEnv=ql;function YT(t){let e=lL.call(this,t);if(e)return e;let r=(0,Mo.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:i}=this.opts,s=new Ro.CodeGen(this.scope,{es5:n,lines:o,ownProperties:i}),a;t.$async&&(a=s.scopeValue("Error",{ref:Zte.default,code:(0,Ro._)`require("ajv/dist/runtime/validation_error").default`}));let c=s.scopeName("validate");t.validateName=c;let u={gen:s,allErrors:this.opts.allErrors,data:cc.default.data,parentData:cc.default.parentData,parentDataProperty:cc.default.parentDataProperty,dataNames:[cc.default.data],dataPathArr:[Ro.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,Ro.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:Ro.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,Ro._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,Vte.validateFunctionCode)(u),s.optimize(this.opts.code.optimize);let d=s.toString();l=`${s.scopeRefs(cc.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let f=new Function(`${cc.default.self}`,`${cc.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:s._values}),this.opts.unevaluated){let{props:h,items:m}=u;f.evaluated={props:h instanceof Ro.Name?void 0:h,items:m instanceof Ro.Name?void 0:m,dynamicProps:h instanceof Ro.Name,dynamicItems:m instanceof Ro.Name},f.source&&(f.source.evaluated=(0,Ro.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}ao.compileSchema=YT;function Fte(t,e,r){var n;r=(0,Mo.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let i=Wte.call(this,t,r);if(i===void 0){let s=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;s&&(i=new ql({schema:s,schemaId:a,root:t,baseId:e}))}if(i!==void 0)return t.refs[r]=Hte.call(this,i)}ao.resolveRef=Fte;function Hte(t){return(0,Mo.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:YT.call(this,t)}function lL(t){for(let e of this._compilations)if(Kte(e,t))return e}ao.getCompilingSchema=lL;function Kte(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function Wte(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||s0.call(this,t,e)}function s0(t,e){let r=this.opts.uriResolver.parse(e),n=(0,Mo._getFullPath)(this.opts.uriResolver,r),o=(0,Mo.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return XT.call(this,r,t);let i=(0,Mo.normalizeId)(n),s=this.refs[i]||this.schemas[i];if(typeof s=="string"){let a=s0.call(this,t,s);return typeof a?.schema!="object"?void 0:XT.call(this,r,a)}if(typeof s?.schema=="object"){if(s.validate||YT.call(this,s),i===(0,Mo.normalizeId)(e)){let{schema:a}=s,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,Mo.resolveUrl)(this.opts.uriResolver,o,u)),new ql({schema:a,schemaId:c,root:t,baseId:o})}return XT.call(this,r,s)}}ao.resolveSchema=s0;var Gte=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function XT(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,uL.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!Gte.has(a)&&u&&(e=(0,Mo.resolveUrl)(this.opts.uriResolver,e,u))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,uL.schemaHasRulesButRef)(r,this.RULES)){let a=(0,Mo.resolveUrl)(this.opts.uriResolver,e,r.$ref);i=s0.call(this,n,a)}let{schemaId:s}=this.opts;if(i=i||new ql({schema:r,schemaId:s,root:n,baseId:e}),i.schema!==i.root.schema)return i}});var dL=g((QAe,Jte)=>{Jte.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var eI=g((ePe,hL)=>{"use strict";var Xte=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),fL=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function QT(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var Yte=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function pL(t){return t.length=0,!0}function Qte(t,e,r){if(t.length){let n=QT(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function ere(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],i=!1,s=!1,a=Qte;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(i===!0&&(s=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(i=!0),n.push(":");continue}else if(u==="%"){if(!a(o,n,r))break;a=pL}else{o.push(u);continue}}return o.length&&(a===pL?r.zone=o.join(""):s?n.push(o.join("")):n.push(QT(o))),r.address=n.join(""),r}function mL(t){if(tre(t,":")<2)return{host:t,isIPV6:!1};let e=ere(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function tre(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function rre(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function nre(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function ore(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!fL(r)){let n=mL(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}hL.exports={nonSimpleDomain:Yte,recomposeAuthority:ore,normalizeComponentEncoding:nre,removeDotSegments:rre,isIPv4:fL,isUUID:Xte,normalizeIPv6:mL,stringArrayToHexStripped:QT}});var bL=g((tPe,_L)=>{"use strict";var{isUUID:ire}=eI(),sre=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,are=["http","https","ws","wss","urn","urn:uuid"];function cre(t){return are.indexOf(t)!==-1}function tI(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function gL(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function yL(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function ure(t){return t.secure=tI(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function lre(t){if((t.port===(tI(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function dre(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(sre);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,i=rI(o);t.path=void 0,i&&(t=i.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function pre(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,i=rI(o);i&&(t=i.serialize(t,e));let s=t,a=t.nss;return s.path=`${n||e.nid}:${a}`,e.skipEscape=!0,s}function fre(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!ire(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function mre(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var vL={scheme:"http",domainHost:!0,parse:gL,serialize:yL},hre={scheme:"https",domainHost:vL.domainHost,parse:gL,serialize:yL},c0={scheme:"ws",domainHost:!0,parse:ure,serialize:lre},gre={scheme:"wss",domainHost:c0.domainHost,parse:c0.parse,serialize:c0.serialize},yre={scheme:"urn",parse:dre,serialize:pre,skipNormalize:!0},vre={scheme:"urn:uuid",parse:fre,serialize:mre,skipNormalize:!0},u0={http:vL,https:hre,ws:c0,wss:gre,urn:yre,"urn:uuid":vre};Object.setPrototypeOf(u0,null);function rI(t){return t&&(u0[t]||u0[t.toLowerCase()])||void 0}_L.exports={wsIsSecure:tI,SCHEMES:u0,isValidSchemeName:cre,getSchemeHandler:rI}});var oI=g((rPe,d0)=>{"use strict";var{normalizeIPv6:_re,removeDotSegments:Km,recomposeAuthority:bre,normalizeComponentEncoding:l0,isIPv4:wre,nonSimpleDomain:xre}=eI(),{SCHEMES:Sre,getSchemeHandler:wL}=bL();function kre(t,e){return typeof t=="string"?t=hi(os(t,e),e):typeof t=="object"&&(t=os(hi(t,e),e)),t}function $re(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=xL(os(t,n),os(e,n),n,!0);return n.skipEscape=!0,hi(o,n)}function xL(t,e,r,n){let o={};return n||(t=os(hi(t,r),r),e=os(hi(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=Km(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=Km(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=Km(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=Km(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function Are(t,e,r){return typeof t=="string"?(t=unescape(t),t=hi(l0(os(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=hi(l0(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=hi(l0(os(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=hi(l0(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function hi(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],i=wL(n.scheme||r.scheme);i&&i.serialize&&i.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let s=bre(r);if(s!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(s),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!i||!i.absolutePath)&&(a=Km(a)),s===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var Pre=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function os(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let i=t.match(Pre);if(i){if(n.scheme=i[1],n.userinfo=i[3],n.host=i[4],n.port=parseInt(i[5],10),n.path=i[6]||"",n.query=i[7],n.fragment=i[8],isNaN(n.port)&&(n.port=i[5]),n.host)if(wre(n.host)===!1){let c=_re(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let s=wL(r.scheme||n.scheme);if(!r.unicodeSupport&&(!s||!s.unicodeSupport)&&n.host&&(r.domainHost||s&&s.domainHost)&&o===!1&&xre(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!s||s&&!s.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),s&&s.parse&&s.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var nI={SCHEMES:Sre,normalize:kre,resolve:$re,resolveComponent:xL,equal:Are,serialize:hi,parse:os};d0.exports=nI;d0.exports.default=nI;d0.exports.fastUri=nI});var kL=g(iI=>{"use strict";Object.defineProperty(iI,"__esModule",{value:!0});var SL=oI();SL.code='require("ajv/dist/runtime/uri").default';iI.default=SL});var OL=g(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.CodeGen=Nr.Name=Nr.nil=Nr.stringify=Nr.str=Nr._=Nr.KeywordCxt=void 0;var Cre=Fm();Object.defineProperty(Nr,"KeywordCxt",{enumerable:!0,get:function(){return Cre.KeywordCxt}});var Ul=De();Object.defineProperty(Nr,"_",{enumerable:!0,get:function(){return Ul._}});Object.defineProperty(Nr,"str",{enumerable:!0,get:function(){return Ul.str}});Object.defineProperty(Nr,"stringify",{enumerable:!0,get:function(){return Ul.stringify}});Object.defineProperty(Nr,"nil",{enumerable:!0,get:function(){return Ul.nil}});Object.defineProperty(Nr,"Name",{enumerable:!0,get:function(){return Ul.Name}});Object.defineProperty(Nr,"CodeGen",{enumerable:!0,get:function(){return Ul.CodeGen}});var Tre=i0(),TL=Hm(),Ire=NT(),Wm=a0(),Ere=De(),Gm=Lm(),p0=Um(),aI=ot(),$L=dL(),Ore=kL(),IL=(t,e)=>new RegExp(t,e);IL.code="new RegExp";var jre=["removeAdditional","useDefaults","coerceTypes"],Nre=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),zre={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Rre={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},AL=200;function Mre(t){var e,r,n,o,i,s,a,c,u,l,d,p,f,h,m,y,v,b,x,C,$,L,xe,ve,Se;let Fe=t.strict,Yt=(e=t.code)===null||e===void 0?void 0:e.optimize,en=Yt===!0||Yt===void 0?1:Yt||0,Ms=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:IL,Gt=(o=t.uriResolver)!==null&&o!==void 0?o:Ore.default;return{strictSchema:(s=(i=t.strictSchema)!==null&&i!==void 0?i:Fe)!==null&&s!==void 0?s:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:Fe)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:Fe)!==null&&l!==void 0?l:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:Fe)!==null&&p!==void 0?p:"log",strictRequired:(h=(f=t.strictRequired)!==null&&f!==void 0?f:Fe)!==null&&h!==void 0?h:!1,code:t.code?{...t.code,optimize:en,regExp:Ms}:{optimize:en,regExp:Ms},loopRequired:(m=t.loopRequired)!==null&&m!==void 0?m:AL,loopEnum:(y=t.loopEnum)!==null&&y!==void 0?y:AL,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:(b=t.messages)!==null&&b!==void 0?b:!0,inlineRefs:(x=t.inlineRefs)!==null&&x!==void 0?x:!0,schemaId:(C=t.schemaId)!==null&&C!==void 0?C:"$id",addUsedSchema:($=t.addUsedSchema)!==null&&$!==void 0?$:!0,validateSchema:(L=t.validateSchema)!==null&&L!==void 0?L:!0,validateFormats:(xe=t.validateFormats)!==null&&xe!==void 0?xe:!0,unicodeRegExp:(ve=t.unicodeRegExp)!==null&&ve!==void 0?ve:!0,int32range:(Se=t.int32range)!==null&&Se!==void 0?Se:!0,uriResolver:Gt}}var Jm=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...Mre(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new Ere.ValueScope({scope:{},prefixes:Nre,es5:r,lines:n}),this.logger=Zre(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,Ire.getRules)(),PL.call(this,zre,e,"NOT SUPPORTED"),PL.call(this,Rre,e,"DEPRECATED","warn"),this._metaOpts=Bre.call(this),e.formats&&qre.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&Ure.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),Dre.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=$L;n==="id"&&(o={...$L},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await i.call(this,l.$schema);let p=this._addSchema(l,d);return p.validate||s.call(this,p)}async function i(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function s(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof TL.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),s.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await i.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let s of e)this.addSchema(s,void 0,n,o);return this}let i;if(typeof e=="object"){let{schemaId:s}=this.opts;if(i=e[s],i!==void 0&&typeof i!="string")throw new Error(`schema ${s} must be string`)}return r=(0,Gm.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return o}getSchema(e){let r;for(;typeof(r=CL.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new Wm.SchemaEnv({schema:{},schemaId:n});if(r=Wm.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=CL.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,Gm.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Fre.call(this,n,r),!r)return(0,aI.eachItem)(n,i=>sI.call(this,i)),this;Kre.call(this,r);let o={...r,type:(0,p0.getJSONTypes)(r.type),schemaType:(0,p0.getJSONTypes)(r.schemaType)};return(0,aI.eachItem)(n,o.type.length===0?i=>sI.call(this,i,o):i=>o.type.forEach(s=>sI.call(this,i,o,s))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(i=>i.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,i)=>o+r+i)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let i=o.split("/").slice(1),s=e;for(let a of i)s=s[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=s[a];u&&l&&(s[a]=EL(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,i=this.opts.addUsedSchema){let s,{schemaId:a}=this.opts;if(typeof e=="object")s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,Gm.normalizeId)(s||n);let u=Gm.getSchemaRefs.call(this,e,n);return c=new Wm.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):Wm.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{Wm.compileSchema.call(this,e)}finally{this.opts=r}}};Jm.ValidationError=Tre.default;Jm.MissingRefError=TL.default;Nr.default=Jm;function PL(t,e,r,n="error"){for(let o in t){let i=o;i in e&&this.logger[n](`${r}: option ${o}. ${t[i]}`)}}function CL(t){return t=(0,Gm.normalizeId)(t),this.schemas[t]||this.refs[t]}function Dre(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function qre(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function Ure(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function Bre(){let t={...this.opts};for(let e of jre)delete t[e];return t}var Lre={log(){},warn(){},error(){}};function Zre(t){if(t===!1)return Lre;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var Vre=/^[a-z_$][a-z0-9_$:-]*$/i;function Fre(t,e){let{RULES:r}=this;if((0,aI.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!Vre.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function sI(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,s=o?i.post:i.rules.find(({type:c})=>c===r);if(s||(s={type:r,rules:[]},i.rules.push(s)),i.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,p0.getJSONTypes)(e.type),schemaType:(0,p0.getJSONTypes)(e.schemaType)}};e.before?Hre.call(this,s,a,e.before):s.rules.push(a),i.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function Hre(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function Kre(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=EL(e)),t.validateSchema=this.compile(e,!0))}var Wre={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function EL(t){return{anyOf:[t,Wre]}}});var jL=g(cI=>{"use strict";Object.defineProperty(cI,"__esModule",{value:!0});var Gre={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};cI.default=Gre});var ML=g(uc=>{"use strict";Object.defineProperty(uc,"__esModule",{value:!0});uc.callRef=uc.getValidate=void 0;var Jre=Hm(),NL=so(),_n=De(),Bl=rs(),zL=a0(),f0=ot(),Xre={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:i,validateName:s,opts:a,self:c}=n,{root:u}=i;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=zL.resolveRef.call(c,u,o,r);if(l===void 0)throw new Jre.default(n.opts.uriResolver,o,r);if(l instanceof zL.SchemaEnv)return p(l);return f(l);function d(){if(i===u)return m0(t,s,i,i.$async);let h=e.scopeValue("root",{ref:u});return m0(t,(0,_n._)`${h}.validate`,u,u.$async)}function p(h){let m=RL(t,h);m0(t,m,h,h.$async)}function f(h){let m=e.scopeValue("schema",a.code.source===!0?{ref:h,code:(0,_n.stringify)(h)}:{ref:h}),y=e.name("valid"),v=t.subschema({schema:h,dataTypes:[],schemaPath:_n.nil,topSchemaRef:m,errSchemaPath:r},y);t.mergeEvaluated(v),t.ok(y)}}};function RL(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,_n._)`${r.scopeValue("wrapper",{ref:e})}.validate`}uc.getValidate=RL;function m0(t,e,r,n){let{gen:o,it:i}=t,{allErrors:s,schemaEnv:a,opts:c}=i,u=c.passContext?Bl.default.this:_n.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let h=o.let("valid");o.try(()=>{o.code((0,_n._)`await ${(0,NL.callValidateCode)(t,e,u)}`),f(e),s||o.assign(h,!0)},m=>{o.if((0,_n._)`!(${m} instanceof ${i.ValidationError})`,()=>o.throw(m)),p(m),s||o.assign(h,!1)}),t.ok(h)}function d(){t.result((0,NL.callValidateCode)(t,e,u),()=>f(e),()=>p(e))}function p(h){let m=(0,_n._)`${h}.errors`;o.assign(Bl.default.vErrors,(0,_n._)`${Bl.default.vErrors} === null ? ${m} : ${Bl.default.vErrors}.concat(${m})`),o.assign(Bl.default.errors,(0,_n._)`${Bl.default.vErrors}.length`)}function f(h){var m;if(!i.opts.unevaluated)return;let y=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(i.props!==!0)if(y&&!y.dynamicProps)y.props!==void 0&&(i.props=f0.mergeEvaluated.props(o,y.props,i.props));else{let v=o.var("props",(0,_n._)`${h}.evaluated.props`);i.props=f0.mergeEvaluated.props(o,v,i.props,_n.Name)}if(i.items!==!0)if(y&&!y.dynamicItems)y.items!==void 0&&(i.items=f0.mergeEvaluated.items(o,y.items,i.items));else{let v=o.var("items",(0,_n._)`${h}.evaluated.items`);i.items=f0.mergeEvaluated.items(o,v,i.items,_n.Name)}}}uc.callRef=m0;uc.default=Xre});var DL=g(uI=>{"use strict";Object.defineProperty(uI,"__esModule",{value:!0});var Yre=jL(),Qre=ML(),ene=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",Yre.default,Qre.default];uI.default=ene});var qL=g(lI=>{"use strict";Object.defineProperty(lI,"__esModule",{value:!0});var h0=De(),ia=h0.operators,g0={maximum:{okStr:"<=",ok:ia.LTE,fail:ia.GT},minimum:{okStr:">=",ok:ia.GTE,fail:ia.LT},exclusiveMaximum:{okStr:"<",ok:ia.LT,fail:ia.GTE},exclusiveMinimum:{okStr:">",ok:ia.GT,fail:ia.LTE}},tne={message:({keyword:t,schemaCode:e})=>(0,h0.str)`must be ${g0[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,h0._)`{comparison: ${g0[t].okStr}, limit: ${e}}`},rne={keyword:Object.keys(g0),type:"number",schemaType:"number",$data:!0,error:tne,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,h0._)`${r} ${g0[e].fail} ${n} || isNaN(${r})`)}};lI.default=rne});var UL=g(dI=>{"use strict";Object.defineProperty(dI,"__esModule",{value:!0});var Xm=De(),nne={message:({schemaCode:t})=>(0,Xm.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,Xm._)`{multipleOf: ${t}}`},one={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:nne,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,i=o.opts.multipleOfPrecision,s=e.let("res"),a=i?(0,Xm._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${i}`:(0,Xm._)`${s} !== parseInt(${s})`;t.fail$data((0,Xm._)`(${n} === 0 || (${s} = ${r}/${n}, ${a}))`)}};dI.default=one});var LL=g(pI=>{"use strict";Object.defineProperty(pI,"__esModule",{value:!0});function BL(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}pI.default=BL;BL.code='require("ajv/dist/runtime/ucs2length").default'});var ZL=g(fI=>{"use strict";Object.defineProperty(fI,"__esModule",{value:!0});var lc=De(),ine=ot(),sne=LL(),ane={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,lc.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,lc._)`{limit: ${t}}`},cne={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:ane,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,i=e==="maxLength"?lc.operators.GT:lc.operators.LT,s=o.opts.unicode===!1?(0,lc._)`${r}.length`:(0,lc._)`${(0,ine.useFunc)(t.gen,sne.default)}(${r})`;t.fail$data((0,lc._)`${s} ${i} ${n}`)}};fI.default=cne});var VL=g(mI=>{"use strict";Object.defineProperty(mI,"__esModule",{value:!0});var une=so(),y0=De(),lne={message:({schemaCode:t})=>(0,y0.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,y0._)`{pattern: ${t}}`},dne={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:lne,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:i}=t,s=i.opts.unicodeRegExp?"u":"",a=r?(0,y0._)`(new RegExp(${o}, ${s}))`:(0,une.usePattern)(t,n);t.fail$data((0,y0._)`!${a}.test(${e})`)}};mI.default=dne});var FL=g(hI=>{"use strict";Object.defineProperty(hI,"__esModule",{value:!0});var Ym=De(),pne={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,Ym.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Ym._)`{limit: ${t}}`},fne={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:pne,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?Ym.operators.GT:Ym.operators.LT;t.fail$data((0,Ym._)`Object.keys(${r}).length ${o} ${n}`)}};hI.default=fne});var HL=g(gI=>{"use strict";Object.defineProperty(gI,"__esModule",{value:!0});var Qm=so(),eh=De(),mne=ot(),hne={message:({params:{missingProperty:t}})=>(0,eh.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,eh._)`{missingProperty: ${t}}`},gne={keyword:"required",type:"object",schemaType:"array",$data:!0,error:hne,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:i,it:s}=t,{opts:a}=s;if(!i&&r.length===0)return;let c=r.length>=a.loopRequired;if(s.allErrors?u():l(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:h}=t.it;for(let m of r)if(f?.[m]===void 0&&!h.has(m)){let y=s.schemaEnv.baseId+s.errSchemaPath,v=`required property "${m}" is not defined at "${y}" (strictRequired)`;(0,mne.checkStrictMode)(s,v,s.opts.strictRequired)}}function u(){if(c||i)t.block$data(eh.nil,d);else for(let f of r)(0,Qm.checkReportMissingProp)(t,f)}function l(){let f=e.let("missing");if(c||i){let h=e.let("valid",!0);t.block$data(h,()=>p(f,h)),t.ok(h)}else e.if((0,Qm.checkMissingProp)(t,r,f)),(0,Qm.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,Qm.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function p(f,h){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(h,(0,Qm.propertyInData)(e,o,f,a.ownProperties)),e.if((0,eh.not)(h),()=>{t.error(),e.break()})},eh.nil)}}};gI.default=gne});var KL=g(yI=>{"use strict";Object.defineProperty(yI,"__esModule",{value:!0});var th=De(),yne={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,th.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,th._)`{limit: ${t}}`},vne={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:yne,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?th.operators.GT:th.operators.LT;t.fail$data((0,th._)`${r}.length ${o} ${n}`)}};yI.default=vne});var v0=g(vI=>{"use strict";Object.defineProperty(vI,"__esModule",{value:!0});var WL=Bm();WL.code='require("ajv/dist/runtime/equal").default';vI.default=WL});var GL=g(bI=>{"use strict";Object.defineProperty(bI,"__esModule",{value:!0});var _I=Um(),zr=De(),_ne=ot(),bne=v0(),wne={message:({params:{i:t,j:e}})=>(0,zr.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,zr._)`{i: ${t}, j: ${e}}`},xne={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:wne,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:i,schemaCode:s,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=i.items?(0,_I.getSchemaTypes)(i.items):[];t.block$data(c,l,(0,zr._)`${s} === false`),t.ok(c);function l(){let h=e.let("i",(0,zr._)`${r}.length`),m=e.let("j");t.setParams({i:h,j:m}),e.assign(c,!0),e.if((0,zr._)`${h} > 1`,()=>(d()?p:f)(h,m))}function d(){return u.length>0&&!u.some(h=>h==="object"||h==="array")}function p(h,m){let y=e.name("item"),v=(0,_I.checkDataTypes)(u,y,a.opts.strictNumbers,_I.DataType.Wrong),b=e.const("indices",(0,zr._)`{}`);e.for((0,zr._)`;${h}--;`,()=>{e.let(y,(0,zr._)`${r}[${h}]`),e.if(v,(0,zr._)`continue`),u.length>1&&e.if((0,zr._)`typeof ${y} == "string"`,(0,zr._)`${y} += "_"`),e.if((0,zr._)`typeof ${b}[${y}] == "number"`,()=>{e.assign(m,(0,zr._)`${b}[${y}]`),t.error(),e.assign(c,!1).break()}).code((0,zr._)`${b}[${y}] = ${h}`)})}function f(h,m){let y=(0,_ne.useFunc)(e,bne.default),v=e.name("outer");e.label(v).for((0,zr._)`;${h}--;`,()=>e.for((0,zr._)`${m} = ${h}; ${m}--;`,()=>e.if((0,zr._)`${y}(${r}[${h}], ${r}[${m}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};bI.default=xne});var JL=g(xI=>{"use strict";Object.defineProperty(xI,"__esModule",{value:!0});var wI=De(),Sne=ot(),kne=v0(),$ne={message:"must be equal to constant",params:({schemaCode:t})=>(0,wI._)`{allowedValue: ${t}}`},Ane={keyword:"const",$data:!0,error:$ne,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:i}=t;n||i&&typeof i=="object"?t.fail$data((0,wI._)`!${(0,Sne.useFunc)(e,kne.default)}(${r}, ${o})`):t.fail((0,wI._)`${i} !== ${r}`)}};xI.default=Ane});var XL=g(SI=>{"use strict";Object.defineProperty(SI,"__esModule",{value:!0});var rh=De(),Pne=ot(),Cne=v0(),Tne={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,rh._)`{allowedValues: ${t}}`},Ine={keyword:"enum",schemaType:"array",$data:!0,error:Tne,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:i,it:s}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=s.opts.loopEnum,c,u=()=>c??(c=(0,Pne.useFunc)(e,Cne.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",i);l=(0,rh.or)(...o.map((h,m)=>p(f,m)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",i,f=>e.if((0,rh._)`${u()}(${r}, ${f})`,()=>e.assign(l,!0).break()))}function p(f,h){let m=o[h];return typeof m=="object"&&m!==null?(0,rh._)`${u()}(${r}, ${f}[${h}])`:(0,rh._)`${r} === ${m}`}}};SI.default=Ine});var YL=g(kI=>{"use strict";Object.defineProperty(kI,"__esModule",{value:!0});var Ene=qL(),One=UL(),jne=ZL(),Nne=VL(),zne=FL(),Rne=HL(),Mne=KL(),Dne=GL(),qne=JL(),Une=XL(),Bne=[Ene.default,One.default,jne.default,Nne.default,zne.default,Rne.default,Mne.default,Dne.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},qne.default,Une.default];kI.default=Bne});var AI=g(nh=>{"use strict";Object.defineProperty(nh,"__esModule",{value:!0});nh.validateAdditionalItems=void 0;var dc=De(),$I=ot(),Lne={message:({params:{len:t}})=>(0,dc.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,dc._)`{limit: ${t}}`},Zne={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Lne,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,$I.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}QL(t,n)}};function QL(t,e){let{gen:r,schema:n,data:o,keyword:i,it:s}=t;s.items=!0;let a=r.const("len",(0,dc._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,dc._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,$I.alwaysValidSchema)(s,n)){let u=r.var("valid",(0,dc._)`${a} <= ${e.length}`);r.if((0,dc.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:i,dataProp:l,dataPropType:$I.Type.Num},u),s.allErrors||r.if((0,dc.not)(u),()=>r.break())})}}nh.validateAdditionalItems=QL;nh.default=Zne});var PI=g(oh=>{"use strict";Object.defineProperty(oh,"__esModule",{value:!0});oh.validateTuple=void 0;var e6=De(),_0=ot(),Vne=so(),Fne={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return t6(t,"additionalItems",e);r.items=!0,!(0,_0.alwaysValidSchema)(r,e)&&t.ok((0,Vne.validateArray)(t))}};function t6(t,e,r=t.schema){let{gen:n,parentSchema:o,data:i,keyword:s,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=_0.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,e6._)`${i}.length`);r.forEach((d,p)=>{(0,_0.alwaysValidSchema)(a,d)||(n.if((0,e6._)`${u} > ${p}`,()=>t.subschema({keyword:s,schemaProp:p,dataProp:p},c)),t.ok(c))});function l(d){let{opts:p,errSchemaPath:f}=a,h=r.length,m=h===d.minItems&&(h===d.maxItems||d[e]===!1);if(p.strictTuples&&!m){let y=`"${s}" is ${h}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,_0.checkStrictMode)(a,y,p.strictTuples)}}}oh.validateTuple=t6;oh.default=Fne});var r6=g(CI=>{"use strict";Object.defineProperty(CI,"__esModule",{value:!0});var Hne=PI(),Kne={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,Hne.validateTuple)(t,"items")};CI.default=Kne});var o6=g(TI=>{"use strict";Object.defineProperty(TI,"__esModule",{value:!0});var n6=De(),Wne=ot(),Gne=so(),Jne=AI(),Xne={message:({params:{len:t}})=>(0,n6.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,n6._)`{limit: ${t}}`},Yne={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:Xne,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,Wne.alwaysValidSchema)(n,e)&&(o?(0,Jne.validateAdditionalItems)(t,o):t.ok((0,Gne.validateArray)(t)))}};TI.default=Yne});var i6=g(II=>{"use strict";Object.defineProperty(II,"__esModule",{value:!0});var co=De(),b0=ot(),Qne={message:({params:{min:t,max:e}})=>e===void 0?(0,co.str)`must contain at least ${t} valid item(s)`:(0,co.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,co._)`{minContains: ${t}}`:(0,co._)`{minContains: ${t}, maxContains: ${e}}`},eoe={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:Qne,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t,s,a,{minContains:c,maxContains:u}=n;i.opts.next?(s=c===void 0?1:c,a=u):s=1;let l=e.const("len",(0,co._)`${o}.length`);if(t.setParams({min:s,max:a}),a===void 0&&s===0){(0,b0.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,b0.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,b0.alwaysValidSchema)(i,r)){let m=(0,co._)`${l} >= ${s}`;a!==void 0&&(m=(0,co._)`${m} && ${l} <= ${a}`),t.pass(m);return}i.items=!0;let d=e.name("valid");a===void 0&&s===1?f(d,()=>e.if(d,()=>e.break())):s===0?(e.let(d,!0),a!==void 0&&e.if((0,co._)`${o}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let m=e.name("_valid"),y=e.let("count",0);f(m,()=>e.if(m,()=>h(y)))}function f(m,y){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:b0.Type.Num,compositeRule:!0},m),y()})}function h(m){e.code((0,co._)`${m}++`),a===void 0?e.if((0,co._)`${m} >= ${s}`,()=>e.assign(d,!0).break()):(e.if((0,co._)`${m} > ${a}`,()=>e.assign(d,!1).break()),s===1?e.assign(d,!0):e.if((0,co._)`${m} >= ${s}`,()=>e.assign(d,!0)))}}};II.default=eoe});var c6=g(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.validateSchemaDeps=gi.validatePropertyDeps=gi.error=void 0;var EI=De(),toe=ot(),ih=so();gi.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,EI.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,EI._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var roe={keyword:"dependencies",type:"object",schemaType:"object",error:gi.error,code(t){let[e,r]=noe(t);s6(t,e),a6(t,r)}};function noe({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function s6(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let i=r.let("missing");for(let s in e){let a=e[s];if(a.length===0)continue;let c=(0,ih.propertyInData)(r,n,s,o.opts.ownProperties);t.setParams({property:s,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,ih.checkReportMissingProp)(t,u)}):(r.if((0,EI._)`${c} && (${(0,ih.checkMissingProp)(t,a,i)})`),(0,ih.reportMissingProp)(t,i),r.else())}}gi.validatePropertyDeps=s6;function a6(t,e=t.schema){let{gen:r,data:n,keyword:o,it:i}=t,s=r.name("valid");for(let a in e)(0,toe.alwaysValidSchema)(i,e[a])||(r.if((0,ih.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},s);t.mergeValidEvaluated(c,s)},()=>r.var(s,!0)),t.ok(s))}gi.validateSchemaDeps=a6;gi.default=roe});var l6=g(OI=>{"use strict";Object.defineProperty(OI,"__esModule",{value:!0});var u6=De(),ooe=ot(),ioe={message:"property name must be valid",params:({params:t})=>(0,u6._)`{propertyName: ${t.propertyName}}`},soe={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:ioe,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,ooe.alwaysValidSchema)(o,r))return;let i=e.name("valid");e.forIn("key",n,s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},i),e.if((0,u6.not)(i),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(i)}};OI.default=soe});var NI=g(jI=>{"use strict";Object.defineProperty(jI,"__esModule",{value:!0});var w0=so(),Do=De(),aoe=rs(),x0=ot(),coe={message:"must NOT have additional properties",params:({params:t})=>(0,Do._)`{additionalProperty: ${t.additionalProperty}}`},uoe={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:coe,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:i,it:s}=t;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=s;if(s.props=!0,c.removeAdditional!=="all"&&(0,x0.alwaysValidSchema)(s,r))return;let u=(0,w0.allSchemaProperties)(n.properties),l=(0,w0.allSchemaProperties)(n.patternProperties);d(),t.ok((0,Do._)`${i} === ${aoe.default.errors}`);function d(){e.forIn("key",o,y=>{!u.length&&!l.length?h(y):e.if(p(y),()=>h(y))})}function p(y){let v;if(u.length>8){let b=(0,x0.schemaRefOrVal)(s,n.properties,"properties");v=(0,w0.isOwnProperty)(e,b,y)}else u.length?v=(0,Do.or)(...u.map(b=>(0,Do._)`${y} === ${b}`)):v=Do.nil;return l.length&&(v=(0,Do.or)(v,...l.map(b=>(0,Do._)`${(0,w0.usePattern)(t,b)}.test(${y})`))),(0,Do.not)(v)}function f(y){e.code((0,Do._)`delete ${o}[${y}]`)}function h(y){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(y);return}if(r===!1){t.setParams({additionalProperty:y}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,x0.alwaysValidSchema)(s,r)){let v=e.name("valid");c.removeAdditional==="failing"?(m(y,v,!1),e.if((0,Do.not)(v),()=>{t.reset(),f(y)})):(m(y,v),a||e.if((0,Do.not)(v),()=>e.break()))}}function m(y,v,b){let x={keyword:"additionalProperties",dataProp:y,dataPropType:x0.Type.Str};b===!1&&Object.assign(x,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(x,v)}}};jI.default=uoe});var f6=g(RI=>{"use strict";Object.defineProperty(RI,"__esModule",{value:!0});var loe=Fm(),d6=so(),zI=ot(),p6=NI(),doe={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&p6.default.code(new loe.KeywordCxt(i,p6.default,"additionalProperties"));let s=(0,d6.allSchemaProperties)(r);for(let d of s)i.definedProperties.add(d);i.opts.unevaluated&&s.length&&i.props!==!0&&(i.props=zI.mergeEvaluated.props(e,(0,zI.toHash)(s),i.props));let a=s.filter(d=>!(0,zI.alwaysValidSchema)(i,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,d6.propertyInData)(e,o,d,i.opts.ownProperties)),l(d),i.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return i.opts.useDefaults&&!i.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};RI.default=doe});var y6=g(MI=>{"use strict";Object.defineProperty(MI,"__esModule",{value:!0});var m6=so(),S0=De(),h6=ot(),g6=ot(),poe={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:i}=t,{opts:s}=i,a=(0,m6.allSchemaProperties)(r),c=a.filter(m=>(0,h6.alwaysValidSchema)(i,r[m]));if(a.length===0||c.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let u=s.strictSchema&&!s.allowMatchingProperties&&o.properties,l=e.name("valid");i.props!==!0&&!(i.props instanceof S0.Name)&&(i.props=(0,g6.evaluatedPropsToName)(e,i.props));let{props:d}=i;p();function p(){for(let m of a)u&&f(m),i.allErrors?h(m):(e.var(l,!0),h(m),e.if(l))}function f(m){for(let y in u)new RegExp(m).test(y)&&(0,h6.checkStrictMode)(i,`property ${y} matches pattern ${m} (use allowMatchingProperties)`)}function h(m){e.forIn("key",n,y=>{e.if((0,S0._)`${(0,m6.usePattern)(t,m)}.test(${y})`,()=>{let v=c.includes(m);v||t.subschema({keyword:"patternProperties",schemaProp:m,dataProp:y,dataPropType:g6.Type.Str},l),i.opts.unevaluated&&d!==!0?e.assign((0,S0._)`${d}[${y}]`,!0):!v&&!i.allErrors&&e.if((0,S0.not)(l),()=>e.break())})})}}};MI.default=poe});var v6=g(DI=>{"use strict";Object.defineProperty(DI,"__esModule",{value:!0});var foe=ot(),moe={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,foe.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};DI.default=moe});var _6=g(qI=>{"use strict";Object.defineProperty(qI,"__esModule",{value:!0});var hoe=so(),goe={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:hoe.validateUnion,error:{message:"must match a schema in anyOf"}};qI.default=goe});var b6=g(UI=>{"use strict";Object.defineProperty(UI,"__esModule",{value:!0});var k0=De(),yoe=ot(),voe={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,k0._)`{passingSchemas: ${t.passing}}`},_oe={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:voe,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let i=r,s=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(s,()=>t.reset(),()=>t.error(!0));function u(){i.forEach((l,d)=>{let p;(0,yoe.alwaysValidSchema)(o,l)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,k0._)`${c} && ${s}`).assign(s,!1).assign(a,(0,k0._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(s,!0),e.assign(a,d),p&&t.mergeEvaluated(p,k0.Name)})})}}};UI.default=_oe});var w6=g(BI=>{"use strict";Object.defineProperty(BI,"__esModule",{value:!0});var boe=ot(),woe={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((i,s)=>{if((0,boe.alwaysValidSchema)(n,i))return;let a=t.subschema({keyword:"allOf",schemaProp:s},o);t.ok(o),t.mergeEvaluated(a)})}};BI.default=woe});var k6=g(LI=>{"use strict";Object.defineProperty(LI,"__esModule",{value:!0});var $0=De(),S6=ot(),xoe={message:({params:t})=>(0,$0.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,$0._)`{failingKeyword: ${t.ifClause}}`},Soe={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:xoe,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,S6.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=x6(n,"then"),i=x6(n,"else");if(!o&&!i)return;let s=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&i){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,$0.not)(a),u("else"));t.pass(s,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let p=t.subschema({keyword:l},a);e.assign(s,a),t.mergeValidEvaluated(p,s),d?e.assign(d,(0,$0._)`${l}`):t.setParams({ifClause:l})}}}};function x6(t,e){let r=t.schema[e];return r!==void 0&&!(0,S6.alwaysValidSchema)(t,r)}LI.default=Soe});var $6=g(ZI=>{"use strict";Object.defineProperty(ZI,"__esModule",{value:!0});var koe=ot(),$oe={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,koe.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};ZI.default=$oe});var A6=g(VI=>{"use strict";Object.defineProperty(VI,"__esModule",{value:!0});var Aoe=AI(),Poe=r6(),Coe=PI(),Toe=o6(),Ioe=i6(),Eoe=c6(),Ooe=l6(),joe=NI(),Noe=f6(),zoe=y6(),Roe=v6(),Moe=_6(),Doe=b6(),qoe=w6(),Uoe=k6(),Boe=$6();function Loe(t=!1){let e=[Roe.default,Moe.default,Doe.default,qoe.default,Uoe.default,Boe.default,Ooe.default,joe.default,Eoe.default,Noe.default,zoe.default];return t?e.push(Poe.default,Toe.default):e.push(Aoe.default,Coe.default),e.push(Ioe.default),e}VI.default=Loe});var P6=g(FI=>{"use strict";Object.defineProperty(FI,"__esModule",{value:!0});var sr=De(),Zoe={message:({schemaCode:t})=>(0,sr.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,sr._)`{format: ${t}}`},Voe={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:Zoe,code(t,e){let{gen:r,data:n,$data:o,schema:i,schemaCode:s,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?p():f();function p(){let h=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),m=r.const("fDef",(0,sr._)`${h}[${s}]`),y=r.let("fType"),v=r.let("format");r.if((0,sr._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(y,(0,sr._)`${m}.type || "string"`).assign(v,(0,sr._)`${m}.validate`),()=>r.assign(y,(0,sr._)`"string"`).assign(v,m)),t.fail$data((0,sr.or)(b(),x()));function b(){return c.strictSchema===!1?sr.nil:(0,sr._)`${s} && !${v}`}function x(){let C=l.$async?(0,sr._)`(${m}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,sr._)`${v}(${n})`,$=(0,sr._)`(typeof ${v} == "function" ? ${C} : ${v}.test(${n}))`;return(0,sr._)`${v} && ${v} !== true && ${y} === ${e} && !${$}`}}function f(){let h=d.formats[i];if(!h){b();return}if(h===!0)return;let[m,y,v]=x(h);m===e&&t.pass(C());function b(){if(c.strictSchema===!1){d.logger.warn($());return}throw new Error($());function $(){return`unknown format "${i}" ignored in schema at path "${u}"`}}function x($){let L=$ instanceof RegExp?(0,sr.regexpCode)($):c.code.formats?(0,sr._)`${c.code.formats}${(0,sr.getProperty)(i)}`:void 0,xe=r.scopeValue("formats",{key:i,ref:$,code:L});return typeof $=="object"&&!($ instanceof RegExp)?[$.type||"string",$.validate,(0,sr._)`${xe}.validate`]:["string",$,xe]}function C(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!l.$async)throw new Error("async format in sync schema");return(0,sr._)`await ${v}(${n})`}return typeof y=="function"?(0,sr._)`${v}(${n})`:(0,sr._)`${v}.test(${n})`}}}};FI.default=Voe});var C6=g(HI=>{"use strict";Object.defineProperty(HI,"__esModule",{value:!0});var Foe=P6(),Hoe=[Foe.default];HI.default=Hoe});var T6=g(Ll=>{"use strict";Object.defineProperty(Ll,"__esModule",{value:!0});Ll.contentVocabulary=Ll.metadataVocabulary=void 0;Ll.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];Ll.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var E6=g(KI=>{"use strict";Object.defineProperty(KI,"__esModule",{value:!0});var Koe=DL(),Woe=YL(),Goe=A6(),Joe=C6(),I6=T6(),Xoe=[Koe.default,Woe.default,(0,Goe.default)(),Joe.default,I6.metadataVocabulary,I6.contentVocabulary];KI.default=Xoe});var j6=g(A0=>{"use strict";Object.defineProperty(A0,"__esModule",{value:!0});A0.DiscrError=void 0;var O6;(function(t){t.Tag="tag",t.Mapping="mapping"})(O6||(A0.DiscrError=O6={}))});var z6=g(GI=>{"use strict";Object.defineProperty(GI,"__esModule",{value:!0});var Zl=De(),WI=j6(),N6=a0(),Yoe=Hm(),Qoe=ot(),eie={message:({params:{discrError:t,tagName:e}})=>t===WI.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,Zl._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},tie={keyword:"discriminator",type:"object",schemaType:"object",error:eie,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:i}=t,{oneOf:s}=o;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,Zl._)`${r}${(0,Zl.getProperty)(a)}`);e.if((0,Zl._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:WI.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let f=p();e.if(!1);for(let h in f)e.elseIf((0,Zl._)`${u} === ${h}`),e.assign(c,d(f[h]));e.else(),t.error(!1,{discrError:WI.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(f){let h=e.name("valid"),m=t.subschema({keyword:"oneOf",schemaProp:f},h);return t.mergeEvaluated(m,Zl.Name),h}function p(){var f;let h={},m=v(o),y=!0;for(let C=0;C<s.length;C++){let $=s[C];if($?.$ref&&!(0,Qoe.schemaHasRulesButRef)($,i.self.RULES)){let xe=$.$ref;if($=N6.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,xe),$ instanceof N6.SchemaEnv&&($=$.schema),$===void 0)throw new Yoe.default(i.opts.uriResolver,i.baseId,xe)}let L=(f=$?.properties)===null||f===void 0?void 0:f[a];if(typeof L!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);y=y&&(m||v($)),b(L,C)}if(!y)throw new Error(`discriminator: "${a}" must be required`);return h;function v({required:C}){return Array.isArray(C)&&C.includes(a)}function b(C,$){if(C.const)x(C.const,$);else if(C.enum)for(let L of C.enum)x(L,$);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function x(C,$){if(typeof C!="string"||C in h)throw new Error(`discriminator: "${a}" values must be unique strings`);h[C]=$}}}};GI.default=tie});var R6=g((VPe,rie)=>{rie.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var D6=g((Dt,JI)=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.MissingRefError=Dt.ValidationError=Dt.CodeGen=Dt.Name=Dt.nil=Dt.stringify=Dt.str=Dt._=Dt.KeywordCxt=Dt.Ajv=void 0;var nie=OL(),oie=E6(),iie=z6(),M6=R6(),sie=["/properties"],P0="http://json-schema.org/draft-07/schema",Vl=class extends nie.default{_addVocabularies(){super._addVocabularies(),oie.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(iie.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(M6,sie):M6;this.addMetaSchema(e,P0,!1),this.refs["http://json-schema.org/schema"]=P0}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(P0)?P0:void 0)}};Dt.Ajv=Vl;JI.exports=Dt=Vl;JI.exports.Ajv=Vl;Object.defineProperty(Dt,"__esModule",{value:!0});Dt.default=Vl;var aie=Fm();Object.defineProperty(Dt,"KeywordCxt",{enumerable:!0,get:function(){return aie.KeywordCxt}});var Fl=De();Object.defineProperty(Dt,"_",{enumerable:!0,get:function(){return Fl._}});Object.defineProperty(Dt,"str",{enumerable:!0,get:function(){return Fl.str}});Object.defineProperty(Dt,"stringify",{enumerable:!0,get:function(){return Fl.stringify}});Object.defineProperty(Dt,"nil",{enumerable:!0,get:function(){return Fl.nil}});Object.defineProperty(Dt,"Name",{enumerable:!0,get:function(){return Fl.Name}});Object.defineProperty(Dt,"CodeGen",{enumerable:!0,get:function(){return Fl.CodeGen}});var cie=i0();Object.defineProperty(Dt,"ValidationError",{enumerable:!0,get:function(){return cie.default}});var uie=Hm();Object.defineProperty(Dt,"MissingRefError",{enumerable:!0,get:function(){return uie.default}})});var H6=g(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.formatNames=vi.fastFormats=vi.fullFormats=void 0;function yi(t,e){return{validate:t,compare:e}}vi.fullFormats={date:yi(L6,eE),time:yi(YI(!0),tE),"date-time":yi(q6(!0),V6),"iso-time":yi(YI(),Z6),"iso-date-time":yi(q6(),F6),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:hie,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:xie,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:gie,int32:{type:"number",validate:_ie},int64:{type:"number",validate:bie},float:{type:"number",validate:B6},double:{type:"number",validate:B6},password:!0,binary:!0};vi.fastFormats={...vi.fullFormats,date:yi(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,eE),time:yi(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,tE),"date-time":yi(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,V6),"iso-time":yi(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Z6),"iso-date-time":yi(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,F6),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};vi.formatNames=Object.keys(vi.fullFormats);function lie(t){return t%4===0&&(t%100!==0||t%400===0)}var die=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,pie=[0,31,28,31,30,31,30,31,31,30,31,30,31];function L6(t){let e=die.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&lie(r)?29:pie[n])}function eE(t,e){if(t&&e)return t>e?1:t<e?-1:0}var XI=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function YI(t){return function(r){let n=XI.exec(r);if(!n)return!1;let o=+n[1],i=+n[2],s=+n[3],a=n[4],c=n[5]==="-"?-1:1,u=+(n[6]||0),l=+(n[7]||0);if(u>23||l>59||t&&!a)return!1;if(o<=23&&i<=59&&s<60)return!0;let d=i-l*c,p=o-u*c-(d<0?1:0);return(p===23||p===-1)&&(d===59||d===-1)&&s<61}}function tE(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function Z6(t,e){if(!(t&&e))return;let r=XI.exec(t),n=XI.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var QI=/t|\s/i;function q6(t){let e=YI(t);return function(n){let o=n.split(QI);return o.length===2&&L6(o[0])&&e(o[1])}}function V6(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function F6(t,e){if(!(t&&e))return;let[r,n]=t.split(QI),[o,i]=e.split(QI),s=eE(r,o);if(s!==void 0)return s||tE(n,i)}var fie=/\/|:/,mie=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function hie(t){return fie.test(t)&&mie.test(t)}var U6=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function gie(t){return U6.lastIndex=0,U6.test(t)}var yie=-(2**31),vie=2**31-1;function _ie(t){return Number.isInteger(t)&&t<=vie&&t>=yie}function bie(t){return Number.isInteger(t)}function B6(){return!0}var wie=/[^\\]\\Z/;function xie(t){if(wie.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var ch=g(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.regexpCode=it.getEsmExportName=it.getProperty=it.safeStringify=it.stringify=it.strConcat=it.addCodeArg=it.str=it._=it.nil=it._Code=it.Name=it.IDENTIFIER=it._CodeOrName=void 0;var sh=class{};it._CodeOrName=sh;it.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var pc=class extends sh{constructor(e){if(super(),!it.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};it.Name=pc;var uo=class extends sh{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof pc&&(r[n.str]=(r[n.str]||0)+1),r),{})}};it._Code=uo;it.nil=new uo("");function K6(t,...e){let r=[t[0]],n=0;for(;n<e.length;)nE(r,e[n]),r.push(t[++n]);return new uo(r)}it._=K6;var rE=new uo("+");function W6(t,...e){let r=[ah(t[0])],n=0;for(;n<e.length;)r.push(rE),nE(r,e[n]),r.push(rE,ah(t[++n]));return Sie(r),new uo(r)}it.str=W6;function nE(t,e){e instanceof uo?t.push(...e._items):e instanceof pc?t.push(e):t.push(Aie(e))}it.addCodeArg=nE;function Sie(t){let e=1;for(;e<t.length-1;){if(t[e]===rE){let r=kie(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function kie(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof pc||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof pc))return`"${t}${e.slice(1)}`}function $ie(t,e){return e.emptyStr()?t:t.emptyStr()?e:W6`${t}${e}`}it.strConcat=$ie;function Aie(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:ah(Array.isArray(t)?t.join(","):t)}function Pie(t){return new uo(ah(t))}it.stringify=Pie;function ah(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}it.safeStringify=ah;function Cie(t){return typeof t=="string"&&it.IDENTIFIER.test(t)?new uo(`.${t}`):K6`[${t}]`}it.getProperty=Cie;function Tie(t){if(typeof t=="string"&&it.IDENTIFIER.test(t))return new uo(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}it.getEsmExportName=Tie;function Iie(t){return new uo(t.toString())}it.regexpCode=Iie});var sE=g(wn=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.ValueScope=wn.ValueScopeName=wn.Scope=wn.varKinds=wn.UsedValueState=void 0;var bn=ch(),oE=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},C0;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(C0||(wn.UsedValueState=C0={}));wn.varKinds={const:new bn.Name("const"),let:new bn.Name("let"),var:new bn.Name("var")};var T0=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof bn.Name?e:this.name(e)}name(e){return new bn.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};wn.Scope=T0;var I0=class extends bn.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,bn._)`.${new bn.Name(r)}[${n}]`}};wn.ValueScopeName=I0;var Eie=(0,bn._)`\n`,iE=class extends T0{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?Eie:bn.nil}}get(){return this._scope}name(e){return new I0(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:i}=o,s=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let l=a.get(s);if(l)return l}else a=this._values[i]=new Map;a.set(s,o);let c=this._scope[i]||(this._scope[i]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:i,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,bn._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let i=bn.nil;for(let s in e){let a=e[s];if(!a)continue;let c=n[s]=n[s]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,C0.Started);let l=r(u);if(l){let d=this.opts.es5?wn.varKinds.var:wn.varKinds.const;i=(0,bn._)`${i}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))i=(0,bn._)`${i}${l}${this.opts._n}`;else throw new oE(u);c.set(u,C0.Completed)})}return i}};wn.ValueScope=iE});var Ne=g(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.or=Me.and=Me.not=Me.CodeGen=Me.operators=Me.varKinds=Me.ValueScopeName=Me.ValueScope=Me.Scope=Me.Name=Me.regexpCode=Me.stringify=Me.getProperty=Me.nil=Me.strConcat=Me.str=Me._=void 0;var Je=ch(),qo=sE(),sa=ch();Object.defineProperty(Me,"_",{enumerable:!0,get:function(){return sa._}});Object.defineProperty(Me,"str",{enumerable:!0,get:function(){return sa.str}});Object.defineProperty(Me,"strConcat",{enumerable:!0,get:function(){return sa.strConcat}});Object.defineProperty(Me,"nil",{enumerable:!0,get:function(){return sa.nil}});Object.defineProperty(Me,"getProperty",{enumerable:!0,get:function(){return sa.getProperty}});Object.defineProperty(Me,"stringify",{enumerable:!0,get:function(){return sa.stringify}});Object.defineProperty(Me,"regexpCode",{enumerable:!0,get:function(){return sa.regexpCode}});Object.defineProperty(Me,"Name",{enumerable:!0,get:function(){return sa.Name}});var N0=sE();Object.defineProperty(Me,"Scope",{enumerable:!0,get:function(){return N0.Scope}});Object.defineProperty(Me,"ValueScope",{enumerable:!0,get:function(){return N0.ValueScope}});Object.defineProperty(Me,"ValueScopeName",{enumerable:!0,get:function(){return N0.ValueScopeName}});Object.defineProperty(Me,"varKinds",{enumerable:!0,get:function(){return N0.varKinds}});Me.operators={GT:new Je._Code(">"),GTE:new Je._Code(">="),LT:new Je._Code("<"),LTE:new Je._Code("<="),EQ:new Je._Code("==="),NEQ:new Je._Code("!=="),NOT:new Je._Code("!"),OR:new Je._Code("||"),AND:new Je._Code("&&"),ADD:new Je._Code("+")};var is=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},aE=class extends is{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?qo.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=Kl(this.rhs,e,r)),this}get names(){return this.rhs instanceof Je._CodeOrName?this.rhs.names:{}}},E0=class extends is{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof Je.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=Kl(this.rhs,e,r),this}get names(){let e=this.lhs instanceof Je.Name?{}:{...this.lhs.names};return j0(e,this.rhs)}},cE=class extends E0{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},uE=class extends is{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},lE=class extends is{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},dE=class extends is{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},pE=class extends is{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=Kl(this.code,e,r),this}get names(){return this.code instanceof Je._CodeOrName?this.code.names:{}}},uh=class extends is{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let i=n[o];i.optimizeNames(e,r)||(Oie(e,i.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>hc(e,r.names),{})}},ss=class extends uh{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},fE=class extends uh{},Hl=class extends ss{};Hl.kind="else";var fc=class t extends ss{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new Hl(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(G6(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=Kl(this.condition,e,r),this}get names(){let e=super.names;return j0(e,this.condition),this.else&&hc(e,this.else.names),e}};fc.kind="if";var mc=class extends ss{};mc.kind="for";var mE=class extends mc{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=Kl(this.iteration,e,r),this}get names(){return hc(super.names,this.iteration.names)}},hE=class extends mc{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?qo.varKinds.var:this.varKind,{name:n,from:o,to:i}=this;return`for(${r} ${n}=${o}; ${n}<${i}; ${n}++)`+super.render(e)}get names(){let e=j0(super.names,this.from);return j0(e,this.to)}},O0=class extends mc{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=Kl(this.iterable,e,r),this}get names(){return hc(super.names,this.iterable.names)}},lh=class extends ss{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};lh.kind="func";var dh=class extends uh{render(e){return"return "+super.render(e)}};dh.kind="return";var gE=class extends ss{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&hc(e,this.catch.names),this.finally&&hc(e,this.finally.names),e}},ph=class extends ss{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};ph.kind="catch";var fh=class extends ss{render(e){return"finally"+super.render(e)}};fh.kind="finally";var yE=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new qo.Scope({parent:e}),this._nodes=[new fE]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let i=this._scope.toName(r);return n!==void 0&&o&&(this._constants[i.str]=n),this._leafNode(new aE(e,i,n)),i}const(e,r,n){return this._def(qo.varKinds.const,e,r,n)}let(e,r,n){return this._def(qo.varKinds.let,e,r,n)}var(e,r,n){return this._def(qo.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new E0(e,r,n))}add(e,r){return this._leafNode(new cE(e,Me.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==Je.nil&&this._leafNode(new pE(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,Je.addCodeArg)(r,o));return r.push("}"),new Je._Code(r)}if(e,r,n){if(this._blockNode(new fc(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new fc(e))}else(){return this._elseNode(new Hl)}endIf(){return this._endBlockNode(fc,Hl)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new mE(e),r)}forRange(e,r,n,o,i=this.opts.es5?qo.varKinds.var:qo.varKinds.let){let s=this._scope.toName(e);return this._for(new hE(i,s,r,n),()=>o(s))}forOf(e,r,n,o=qo.varKinds.const){let i=this._scope.toName(e);if(this.opts.es5){let s=r instanceof Je.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,Je._)`${s}.length`,a=>{this.var(i,(0,Je._)`${s}[${a}]`),n(i)})}return this._for(new O0("of",o,i,r),()=>n(i))}forIn(e,r,n,o=this.opts.es5?qo.varKinds.var:qo.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,Je._)`Object.keys(${r})`,n);let i=this._scope.toName(e);return this._for(new O0("in",o,i,r),()=>n(i))}endFor(){return this._endBlockNode(mc)}label(e){return this._leafNode(new uE(e))}break(e){return this._leafNode(new lE(e))}return(e){let r=new dh;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(dh)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new gE;if(this._blockNode(o),this.code(e),r){let i=this.name("e");this._currNode=o.catch=new ph(i),r(i)}return n&&(this._currNode=o.finally=new fh,this.code(n)),this._endBlockNode(ph,fh)}throw(e){return this._leafNode(new dE(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=Je.nil,n,o){return this._blockNode(new lh(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(lh)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof fc))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};Me.CodeGen=yE;function hc(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function j0(t,e){return e instanceof Je._CodeOrName?hc(t,e.names):t}function Kl(t,e,r){if(t instanceof Je.Name)return n(t);if(!o(t))return t;return new Je._Code(t._items.reduce((i,s)=>(s instanceof Je.Name&&(s=n(s)),s instanceof Je._Code?i.push(...s._items):i.push(s),i),[]));function n(i){let s=r[i.str];return s===void 0||e[i.str]!==1?i:(delete e[i.str],s)}function o(i){return i instanceof Je._Code&&i._items.some(s=>s instanceof Je.Name&&e[s.str]===1&&r[s.str]!==void 0)}}function Oie(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function G6(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,Je._)`!${vE(t)}`}Me.not=G6;var jie=J6(Me.operators.AND);function Nie(...t){return t.reduce(jie)}Me.and=Nie;var zie=J6(Me.operators.OR);function Rie(...t){return t.reduce(zie)}Me.or=Rie;function J6(t){return(e,r)=>e===Je.nil?r:r===Je.nil?e:(0,Je._)`${vE(e)} ${t} ${vE(r)}`}function vE(t){return t instanceof Je.Name?t:(0,Je._)`(${t})`}});var st=g(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.checkStrictMode=Ue.getErrorPath=Ue.Type=Ue.useFunc=Ue.setEvaluated=Ue.evaluatedPropsToName=Ue.mergeEvaluated=Ue.eachItem=Ue.unescapeJsonPointer=Ue.escapeJsonPointer=Ue.escapeFragment=Ue.unescapeFragment=Ue.schemaRefOrVal=Ue.schemaHasRulesButRef=Ue.schemaHasRules=Ue.checkUnknownRules=Ue.alwaysValidSchema=Ue.toHash=void 0;var xt=Ne(),Mie=ch();function Die(t){let e={};for(let r of t)e[r]=!0;return e}Ue.toHash=Die;function qie(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(Q6(t,e),!eZ(e,t.self.RULES.all))}Ue.alwaysValidSchema=qie;function Q6(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let i in e)o[i]||nZ(t,`unknown keyword: "${i}"`)}Ue.checkUnknownRules=Q6;function eZ(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}Ue.schemaHasRules=eZ;function Uie(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}Ue.schemaHasRulesButRef=Uie;function Bie({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,xt._)`${r}`}return(0,xt._)`${t}${e}${(0,xt.getProperty)(n)}`}Ue.schemaRefOrVal=Bie;function Lie(t){return tZ(decodeURIComponent(t))}Ue.unescapeFragment=Lie;function Zie(t){return encodeURIComponent(bE(t))}Ue.escapeFragment=Zie;function bE(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}Ue.escapeJsonPointer=bE;function tZ(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}Ue.unescapeJsonPointer=tZ;function Vie(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}Ue.eachItem=Vie;function X6({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,i,s,a)=>{let c=s===void 0?i:s instanceof xt.Name?(i instanceof xt.Name?t(o,i,s):e(o,i,s),s):i instanceof xt.Name?(e(o,s,i),i):r(i,s);return a===xt.Name&&!(c instanceof xt.Name)?n(o,c):c}}Ue.mergeEvaluated={props:X6({mergeNames:(t,e,r)=>t.if((0,xt._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,xt._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,xt._)`${r} || {}`).code((0,xt._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,xt._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,xt._)`${r} || {}`),wE(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:rZ}),items:X6({mergeNames:(t,e,r)=>t.if((0,xt._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,xt._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,xt._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,xt._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function rZ(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,xt._)`{}`);return e!==void 0&&wE(t,r,e),r}Ue.evaluatedPropsToName=rZ;function wE(t,e,r){Object.keys(r).forEach(n=>t.assign((0,xt._)`${e}${(0,xt.getProperty)(n)}`,!0))}Ue.setEvaluated=wE;var Y6={};function Fie(t,e){return t.scopeValue("func",{ref:e,code:Y6[e.code]||(Y6[e.code]=new Mie._Code(e.code))})}Ue.useFunc=Fie;var _E;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(_E||(Ue.Type=_E={}));function Hie(t,e,r){if(t instanceof xt.Name){let n=e===_E.Num;return r?n?(0,xt._)`"[" + ${t} + "]"`:(0,xt._)`"['" + ${t} + "']"`:n?(0,xt._)`"/" + ${t}`:(0,xt._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,xt.getProperty)(t).toString():"/"+bE(t)}Ue.getErrorPath=Hie;function nZ(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}Ue.checkStrictMode=nZ});var as=g(xE=>{"use strict";Object.defineProperty(xE,"__esModule",{value:!0});var Kr=Ne(),Kie={data:new Kr.Name("data"),valCxt:new Kr.Name("valCxt"),instancePath:new Kr.Name("instancePath"),parentData:new Kr.Name("parentData"),parentDataProperty:new Kr.Name("parentDataProperty"),rootData:new Kr.Name("rootData"),dynamicAnchors:new Kr.Name("dynamicAnchors"),vErrors:new Kr.Name("vErrors"),errors:new Kr.Name("errors"),this:new Kr.Name("this"),self:new Kr.Name("self"),scope:new Kr.Name("scope"),json:new Kr.Name("json"),jsonPos:new Kr.Name("jsonPos"),jsonLen:new Kr.Name("jsonLen"),jsonPart:new Kr.Name("jsonPart")};xE.default=Kie});var mh=g(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.extendErrors=Wr.resetErrorsCount=Wr.reportExtraError=Wr.reportError=Wr.keyword$DataError=Wr.keywordError=void 0;var Qe=Ne(),z0=st(),un=as();Wr.keywordError={message:({keyword:t})=>(0,Qe.str)`must pass "${t}" keyword validation`};Wr.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Qe.str)`"${t}" keyword must be ${e} ($data)`:(0,Qe.str)`"${t}" keyword is invalid ($data)`};function Wie(t,e=Wr.keywordError,r,n){let{it:o}=t,{gen:i,compositeRule:s,allErrors:a}=o,c=sZ(t,e,r);n??(s||a)?oZ(i,c):iZ(o,(0,Qe._)`[${c}]`)}Wr.reportError=Wie;function Gie(t,e=Wr.keywordError,r){let{it:n}=t,{gen:o,compositeRule:i,allErrors:s}=n,a=sZ(t,e,r);oZ(o,a),i||s||iZ(n,un.default.vErrors)}Wr.reportExtraError=Gie;function Jie(t,e){t.assign(un.default.errors,e),t.if((0,Qe._)`${un.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Qe._)`${un.default.vErrors}.length`,e),()=>t.assign(un.default.vErrors,null)))}Wr.resetErrorsCount=Jie;function Xie({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:i}){if(o===void 0)throw new Error("ajv implementation error");let s=t.name("err");t.forRange("i",o,un.default.errors,a=>{t.const(s,(0,Qe._)`${un.default.vErrors}[${a}]`),t.if((0,Qe._)`${s}.instancePath === undefined`,()=>t.assign((0,Qe._)`${s}.instancePath`,(0,Qe.strConcat)(un.default.instancePath,i.errorPath))),t.assign((0,Qe._)`${s}.schemaPath`,(0,Qe.str)`${i.errSchemaPath}/${e}`),i.opts.verbose&&(t.assign((0,Qe._)`${s}.schema`,r),t.assign((0,Qe._)`${s}.data`,n))})}Wr.extendErrors=Xie;function oZ(t,e){let r=t.const("err",e);t.if((0,Qe._)`${un.default.vErrors} === null`,()=>t.assign(un.default.vErrors,(0,Qe._)`[${r}]`),(0,Qe._)`${un.default.vErrors}.push(${r})`),t.code((0,Qe._)`${un.default.errors}++`)}function iZ(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Qe._)`new ${t.ValidationError}(${e})`):(r.assign((0,Qe._)`${n}.errors`,e),r.return(!1))}var gc={keyword:new Qe.Name("keyword"),schemaPath:new Qe.Name("schemaPath"),params:new Qe.Name("params"),propertyName:new Qe.Name("propertyName"),message:new Qe.Name("message"),schema:new Qe.Name("schema"),parentSchema:new Qe.Name("parentSchema")};function sZ(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Qe._)`{}`:Yie(t,e,r)}function Yie(t,e,r={}){let{gen:n,it:o}=t,i=[Qie(o,r),ese(t,r)];return tse(t,e,i),n.object(...i)}function Qie({errorPath:t},{instancePath:e}){let r=e?(0,Qe.str)`${t}${(0,z0.getErrorPath)(e,z0.Type.Str)}`:t;return[un.default.instancePath,(0,Qe.strConcat)(un.default.instancePath,r)]}function ese({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Qe.str)`${e}/${t}`;return r&&(o=(0,Qe.str)`${o}${(0,z0.getErrorPath)(r,z0.Type.Str)}`),[gc.schemaPath,o]}function tse(t,{params:e,message:r},n){let{keyword:o,data:i,schemaValue:s,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([gc.keyword,o],[gc.params,typeof e=="function"?e(t):e||(0,Qe._)`{}`]),c.messages&&n.push([gc.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([gc.schema,s],[gc.parentSchema,(0,Qe._)`${l}${d}`],[un.default.data,i]),u&&n.push([gc.propertyName,u])}});var cZ=g(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});Wl.boolOrEmptySchema=Wl.topBoolOrEmptySchema=void 0;var rse=mh(),nse=Ne(),ose=as(),ise={message:"boolean schema is false"};function sse(t){let{gen:e,schema:r,validateName:n}=t;r===!1?aZ(t,!1):typeof r=="object"&&r.$async===!0?e.return(ose.default.data):(e.assign((0,nse._)`${n}.errors`,null),e.return(!0))}Wl.topBoolOrEmptySchema=sse;function ase(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),aZ(t)):r.var(e,!0)}Wl.boolOrEmptySchema=ase;function aZ(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,rse.reportError)(o,ise,void 0,e)}});var SE=g(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});Gl.getRules=Gl.isJSONType=void 0;var cse=["string","number","integer","boolean","null","object","array"],use=new Set(cse);function lse(t){return typeof t=="string"&&use.has(t)}Gl.isJSONType=lse;function dse(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}Gl.getRules=dse});var kE=g(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.shouldUseRule=aa.shouldUseGroup=aa.schemaHasRulesForType=void 0;function pse({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&uZ(t,n)}aa.schemaHasRulesForType=pse;function uZ(t,e){return e.rules.some(r=>lZ(t,r))}aa.shouldUseGroup=uZ;function lZ(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}aa.shouldUseRule=lZ});var hh=g(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.reportTypeError=Gr.checkDataTypes=Gr.checkDataType=Gr.coerceAndCheckDataType=Gr.getJSONTypes=Gr.getSchemaTypes=Gr.DataType=void 0;var fse=SE(),mse=kE(),hse=mh(),je=Ne(),dZ=st(),Jl;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(Jl||(Gr.DataType=Jl={}));function gse(t){let e=pZ(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Gr.getSchemaTypes=gse;function pZ(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(fse.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Gr.getJSONTypes=pZ;function yse(t,e){let{gen:r,data:n,opts:o}=t,i=vse(e,o.coerceTypes),s=e.length>0&&!(i.length===0&&e.length===1&&(0,mse.schemaHasRulesForType)(t,e[0]));if(s){let a=AE(e,n,o.strictNumbers,Jl.Wrong);r.if(a,()=>{i.length?_se(t,e,i):PE(t)})}return s}Gr.coerceAndCheckDataType=yse;var fZ=new Set(["string","number","integer","boolean","null"]);function vse(t,e){return e?t.filter(r=>fZ.has(r)||e==="array"&&r==="array"):[]}function _se(t,e,r){let{gen:n,data:o,opts:i}=t,s=n.let("dataType",(0,je._)`typeof ${o}`),a=n.let("coerced",(0,je._)`undefined`);i.coerceTypes==="array"&&n.if((0,je._)`${s} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,je._)`${o}[0]`).assign(s,(0,je._)`typeof ${o}`).if(AE(e,o,i.strictNumbers),()=>n.assign(a,o))),n.if((0,je._)`${a} !== undefined`);for(let u of r)(fZ.has(u)||u==="array"&&i.coerceTypes==="array")&&c(u);n.else(),PE(t),n.endIf(),n.if((0,je._)`${a} !== undefined`,()=>{n.assign(o,a),bse(t,a)});function c(u){switch(u){case"string":n.elseIf((0,je._)`${s} == "number" || ${s} == "boolean"`).assign(a,(0,je._)`"" + ${o}`).elseIf((0,je._)`${o} === null`).assign(a,(0,je._)`""`);return;case"number":n.elseIf((0,je._)`${s} == "boolean" || ${o} === null
              || (${s} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,je._)`+${o}`);return;case"integer":n.elseIf((0,je._)`${s} === "boolean" || ${o} === null
              || (${s} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,je._)`+${o}`);return;case"boolean":n.elseIf((0,je._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,je._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,je._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,je._)`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${o} === null`).assign(a,(0,je._)`[${o}]`)}}}function bse({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,je._)`${e} !== undefined`,()=>t.assign((0,je._)`${e}[${r}]`,n))}function $E(t,e,r,n=Jl.Correct){let o=n===Jl.Correct?je.operators.EQ:je.operators.NEQ,i;switch(t){case"null":return(0,je._)`${e} ${o} null`;case"array":i=(0,je._)`Array.isArray(${e})`;break;case"object":i=(0,je._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":i=s((0,je._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":i=s();break;default:return(0,je._)`typeof ${e} ${o} ${t}`}return n===Jl.Correct?i:(0,je.not)(i);function s(a=je.nil){return(0,je.and)((0,je._)`typeof ${e} == "number"`,a,r?(0,je._)`isFinite(${e})`:je.nil)}}Gr.checkDataType=$E;function AE(t,e,r,n){if(t.length===1)return $E(t[0],e,r,n);let o,i=(0,dZ.toHash)(t);if(i.array&&i.object){let s=(0,je._)`typeof ${e} != "object"`;o=i.null?s:(0,je._)`!${e} || ${s}`,delete i.null,delete i.array,delete i.object}else o=je.nil;i.number&&delete i.integer;for(let s in i)o=(0,je.and)(o,$E(s,e,r,n));return o}Gr.checkDataTypes=AE;var wse={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,je._)`{type: ${t}}`:(0,je._)`{type: ${e}}`};function PE(t){let e=xse(t);(0,hse.reportError)(e,wse)}Gr.reportTypeError=PE;function xse(t){let{gen:e,data:r,schema:n}=t,o=(0,dZ.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var hZ=g(R0=>{"use strict";Object.defineProperty(R0,"__esModule",{value:!0});R0.assignDefaults=void 0;var Xl=Ne(),Sse=st();function kse(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)mZ(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,i)=>mZ(t,i,o.default))}R0.assignDefaults=kse;function mZ(t,e,r){let{gen:n,compositeRule:o,data:i,opts:s}=t;if(r===void 0)return;let a=(0,Xl._)`${i}${(0,Xl.getProperty)(e)}`;if(o){(0,Sse.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,Xl._)`${a} === undefined`;s.useDefaults==="empty"&&(c=(0,Xl._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,Xl._)`${a} = ${(0,Xl.stringify)(r)}`)}});var lo=g(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.validateUnion=gt.validateArray=gt.usePattern=gt.callValidateCode=gt.schemaProperties=gt.allSchemaProperties=gt.noPropertyInData=gt.propertyInData=gt.isOwnProperty=gt.hasPropFunc=gt.reportMissingProp=gt.checkMissingProp=gt.checkReportMissingProp=void 0;var qt=Ne(),CE=st(),ca=as(),$se=st();function Ase(t,e){let{gen:r,data:n,it:o}=t;r.if(IE(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,qt._)`${e}`},!0),t.error()})}gt.checkReportMissingProp=Ase;function Pse({gen:t,data:e,it:{opts:r}},n,o){return(0,qt.or)(...n.map(i=>(0,qt.and)(IE(t,e,i,r.ownProperties),(0,qt._)`${o} = ${i}`)))}gt.checkMissingProp=Pse;function Cse(t,e){t.setParams({missingProperty:e},!0),t.error()}gt.reportMissingProp=Cse;function gZ(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,qt._)`Object.prototype.hasOwnProperty`})}gt.hasPropFunc=gZ;function TE(t,e,r){return(0,qt._)`${gZ(t)}.call(${e}, ${r})`}gt.isOwnProperty=TE;function Tse(t,e,r,n){let o=(0,qt._)`${e}${(0,qt.getProperty)(r)} !== undefined`;return n?(0,qt._)`${o} && ${TE(t,e,r)}`:o}gt.propertyInData=Tse;function IE(t,e,r,n){let o=(0,qt._)`${e}${(0,qt.getProperty)(r)} === undefined`;return n?(0,qt.or)(o,(0,qt.not)(TE(t,e,r))):o}gt.noPropertyInData=IE;function yZ(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}gt.allSchemaProperties=yZ;function Ise(t,e){return yZ(e).filter(r=>!(0,CE.alwaysValidSchema)(t,e[r]))}gt.schemaProperties=Ise;function Ese({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:i},it:s},a,c,u){let l=u?(0,qt._)`${t}, ${e}, ${n}${o}`:e,d=[[ca.default.instancePath,(0,qt.strConcat)(ca.default.instancePath,i)],[ca.default.parentData,s.parentData],[ca.default.parentDataProperty,s.parentDataProperty],[ca.default.rootData,ca.default.rootData]];s.opts.dynamicRef&&d.push([ca.default.dynamicAnchors,ca.default.dynamicAnchors]);let p=(0,qt._)`${l}, ${r.object(...d)}`;return c!==qt.nil?(0,qt._)`${a}.call(${c}, ${p})`:(0,qt._)`${a}(${p})`}gt.callValidateCode=Ese;var Ose=(0,qt._)`new RegExp`;function jse({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,i=o(r,n);return t.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,qt._)`${o.code==="new RegExp"?Ose:(0,$se.useFunc)(t,o)}(${r}, ${n})`})}gt.usePattern=jse;function Nse(t){let{gen:e,data:r,keyword:n,it:o}=t,i=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(i,!0),s(()=>e.break()),i;function s(a){let c=e.const("len",(0,qt._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:CE.Type.Num},i),e.if((0,qt.not)(i),a)})}}gt.validateArray=Nse;function zse(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,CE.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let s=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(s,(0,qt._)`${s} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,qt.not)(s))})),t.result(s,()=>t.reset(),()=>t.error(!0))}gt.validateUnion=zse});var bZ=g(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.validateKeywordUsage=_i.validSchemaType=_i.funcKeywordCode=_i.macroKeywordCode=void 0;var ln=Ne(),yc=as(),Rse=lo(),Mse=mh();function Dse(t,e){let{gen:r,keyword:n,schema:o,parentSchema:i,it:s}=t,a=e.macro.call(s.self,o,i,s),c=_Z(r,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:ln.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}_i.macroKeywordCode=Dse;function qse(t,e){var r;let{gen:n,keyword:o,schema:i,parentSchema:s,$data:a,it:c}=t;Bse(c,e);let u=!a&&e.compile?e.compile.call(c.self,i,s,c):e.validate,l=_Z(n,o,u),d=n.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)m(),e.modifying&&vZ(t),y(()=>t.error());else{let v=e.async?f():h();e.modifying&&vZ(t),y(()=>Use(t,v))}}function f(){let v=n.let("ruleErrs",null);return n.try(()=>m((0,ln._)`await `),b=>n.assign(d,!1).if((0,ln._)`${b} instanceof ${c.ValidationError}`,()=>n.assign(v,(0,ln._)`${b}.errors`),()=>n.throw(b))),v}function h(){let v=(0,ln._)`${l}.errors`;return n.assign(v,null),m(ln.nil),v}function m(v=e.async?(0,ln._)`await `:ln.nil){let b=c.opts.passContext?yc.default.this:yc.default.self,x=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,ln._)`${v}${(0,Rse.callValidateCode)(t,l,b,x)}`,e.modifying)}function y(v){var b;n.if((0,ln.not)((b=e.valid)!==null&&b!==void 0?b:d),v)}}_i.funcKeywordCode=qse;function vZ(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,ln._)`${n.parentData}[${n.parentDataProperty}]`))}function Use(t,e){let{gen:r}=t;r.if((0,ln._)`Array.isArray(${e})`,()=>{r.assign(yc.default.vErrors,(0,ln._)`${yc.default.vErrors} === null ? ${e} : ${yc.default.vErrors}.concat(${e})`).assign(yc.default.errors,(0,ln._)`${yc.default.vErrors}.length`),(0,Mse.extendErrors)(t)},()=>t.error())}function Bse({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function _Z(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,ln.stringify)(r)})}function Lse(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}_i.validSchemaType=Lse;function Zse({schema:t,opts:e,self:r,errSchemaPath:n},o,i){if(Array.isArray(o.keyword)?!o.keyword.includes(i):o.keyword!==i)throw new Error("ajv implementation error");let s=o.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${i}: ${s.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[i])){let c=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}_i.validateKeywordUsage=Zse});var xZ=g(ua=>{"use strict";Object.defineProperty(ua,"__esModule",{value:!0});ua.extendSubschemaMode=ua.extendSubschemaData=ua.getSubschema=void 0;var bi=Ne(),wZ=st();function Vse(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:i,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,bi._)`${t.schemaPath}${(0,bi.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,bi._)`${t.schemaPath}${(0,bi.getProperty)(e)}${(0,bi.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,wZ.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||i===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:s,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}ua.getSubschema=Vse;function Fse(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:i,propertyName:s}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,p=a.let("data",(0,bi._)`${e.data}${(0,bi.getProperty)(r)}`,!0);c(p),t.errorPath=(0,bi.str)`${u}${(0,wZ.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,bi._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof bi.Name?o:a.let("data",o,!0);c(u),s!==void 0&&(t.propertyName=s)}i&&(t.dataTypes=i);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}ua.extendSubschemaData=Fse;function Hse(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:i}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),i!==void 0&&(t.allErrors=i),t.jtdDiscriminator=e,t.jtdMetadata=r}ua.extendSubschemaMode=Hse});var kZ=g((s1e,SZ)=>{"use strict";var la=SZ.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};M0(e,n,o,t,"",t)};la.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};la.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};la.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};la.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function M0(t,e,r,n,o,i,s,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,i,s,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in la.arrayKeywords)for(var p=0;p<d.length;p++)M0(t,e,r,d[p],o+"/"+l+"/"+p,i,o,l,n,p)}else if(l in la.propsKeywords){if(d&&typeof d=="object")for(var f in d)M0(t,e,r,d[f],o+"/"+l+"/"+Kse(f),i,o,l,n,f)}else(l in la.keywords||t.allKeys&&!(l in la.skipKeywords))&&M0(t,e,r,d,o+"/"+l,i,o,l,n)}r(n,o,i,s,a,c,u)}}function Kse(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var gh=g(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.getSchemaRefs=xn.resolveUrl=xn.normalizeId=xn._getFullPath=xn.getFullPath=xn.inlineRef=void 0;var Wse=st(),Gse=Bm(),Jse=kZ(),Xse=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Yse(t,e=!0){return typeof t=="boolean"?!0:e===!0?!EE(t):e?$Z(t)<=e:!1}xn.inlineRef=Yse;var Qse=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function EE(t){for(let e in t){if(Qse.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(EE)||typeof r=="object"&&EE(r))return!0}return!1}function $Z(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!Xse.has(r)&&(typeof t[r]=="object"&&(0,Wse.eachItem)(t[r],n=>e+=$Z(n)),e===1/0))return 1/0}return e}function AZ(t,e="",r){r!==!1&&(e=Yl(e));let n=t.parse(e);return PZ(t,n)}xn.getFullPath=AZ;function PZ(t,e){return t.serialize(e).split("#")[0]+"#"}xn._getFullPath=PZ;var eae=/#\/?$/;function Yl(t){return t?t.replace(eae,""):""}xn.normalizeId=Yl;function tae(t,e,r){return r=Yl(r),t.resolve(e,r)}xn.resolveUrl=tae;var rae=/^[a-z_][-a-z0-9._]*$/i;function nae(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=Yl(t[r]||e),i={"":o},s=AZ(n,o,!1),a={},c=new Set;return Jse(t,{allKeys:!0},(d,p,f,h)=>{if(h===void 0)return;let m=s+p,y=i[h];typeof d[r]=="string"&&(y=v.call(this,d[r])),b.call(this,d.$anchor),b.call(this,d.$dynamicAnchor),i[p]=y;function v(x){let C=this.opts.uriResolver.resolve;if(x=Yl(y?C(y,x):x),c.has(x))throw l(x);c.add(x);let $=this.refs[x];return typeof $=="string"&&($=this.refs[$]),typeof $=="object"?u(d,$.schema,x):x!==Yl(m)&&(x[0]==="#"?(u(d,a[x],x),a[x]=d):this.refs[x]=m),x}function b(x){if(typeof x=="string"){if(!rae.test(x))throw new Error(`invalid anchor "${x}"`);v.call(this,`#${x}`)}}}),a;function u(d,p,f){if(p!==void 0&&!Gse(d,p))throw l(f)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}xn.getSchemaRefs=nae});var _h=g(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});da.getData=da.KeywordCxt=da.validateFunctionCode=void 0;var OZ=cZ(),CZ=hh(),jE=kE(),D0=hh(),oae=hZ(),vh=bZ(),OE=xZ(),ue=Ne(),$e=as(),iae=gh(),cs=st(),yh=mh();function sae(t){if(zZ(t)&&(RZ(t),NZ(t))){uae(t);return}jZ(t,()=>(0,OZ.topBoolOrEmptySchema)(t))}da.validateFunctionCode=sae;function jZ({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},i){o.code.es5?t.func(e,(0,ue._)`${$e.default.data}, ${$e.default.valCxt}`,n.$async,()=>{t.code((0,ue._)`"use strict"; ${TZ(r,o)}`),cae(t,o),t.code(i)}):t.func(e,(0,ue._)`${$e.default.data}, ${aae(o)}`,n.$async,()=>t.code(TZ(r,o)).code(i))}function aae(t){return(0,ue._)`{${$e.default.instancePath}="", ${$e.default.parentData}, ${$e.default.parentDataProperty}, ${$e.default.rootData}=${$e.default.data}${t.dynamicRef?(0,ue._)`, ${$e.default.dynamicAnchors}={}`:ue.nil}}={}`}function cae(t,e){t.if($e.default.valCxt,()=>{t.var($e.default.instancePath,(0,ue._)`${$e.default.valCxt}.${$e.default.instancePath}`),t.var($e.default.parentData,(0,ue._)`${$e.default.valCxt}.${$e.default.parentData}`),t.var($e.default.parentDataProperty,(0,ue._)`${$e.default.valCxt}.${$e.default.parentDataProperty}`),t.var($e.default.rootData,(0,ue._)`${$e.default.valCxt}.${$e.default.rootData}`),e.dynamicRef&&t.var($e.default.dynamicAnchors,(0,ue._)`${$e.default.valCxt}.${$e.default.dynamicAnchors}`)},()=>{t.var($e.default.instancePath,(0,ue._)`""`),t.var($e.default.parentData,(0,ue._)`undefined`),t.var($e.default.parentDataProperty,(0,ue._)`undefined`),t.var($e.default.rootData,$e.default.data),e.dynamicRef&&t.var($e.default.dynamicAnchors,(0,ue._)`{}`)})}function uae(t){let{schema:e,opts:r,gen:n}=t;jZ(t,()=>{r.$comment&&e.$comment&&DZ(t),mae(t),n.let($e.default.vErrors,null),n.let($e.default.errors,0),r.unevaluated&&lae(t),MZ(t),yae(t)})}function lae(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,ue._)`${r}.evaluated`),e.if((0,ue._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,ue._)`${t.evaluated}.props`,(0,ue._)`undefined`)),e.if((0,ue._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,ue._)`${t.evaluated}.items`,(0,ue._)`undefined`))}function TZ(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,ue._)`/*# sourceURL=${r} */`:ue.nil}function dae(t,e){if(zZ(t)&&(RZ(t),NZ(t))){pae(t,e);return}(0,OZ.boolOrEmptySchema)(t,e)}function NZ({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function zZ(t){return typeof t.schema!="boolean"}function pae(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&DZ(t),hae(t),gae(t);let i=n.const("_errs",$e.default.errors);MZ(t,i),n.var(e,(0,ue._)`${i} === ${$e.default.errors}`)}function RZ(t){(0,cs.checkUnknownRules)(t),fae(t)}function MZ(t,e){if(t.opts.jtd)return IZ(t,[],!1,e);let r=(0,CZ.getSchemaTypes)(t.schema),n=(0,CZ.coerceAndCheckDataType)(t,r);IZ(t,r,!n,e)}function fae(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,cs.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function mae(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,cs.checkStrictMode)(t,"default is ignored in the schema root")}function hae(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,iae.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function gae(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function DZ({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let i=r.$comment;if(o.$comment===!0)t.code((0,ue._)`${$e.default.self}.logger.log(${i})`);else if(typeof o.$comment=="function"){let s=(0,ue.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,ue._)`${$e.default.self}.opts.$comment(${i}, ${s}, ${a}.schema)`)}}function yae(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:i}=t;r.$async?e.if((0,ue._)`${$e.default.errors} === 0`,()=>e.return($e.default.data),()=>e.throw((0,ue._)`new ${o}(${$e.default.vErrors})`)):(e.assign((0,ue._)`${n}.errors`,$e.default.vErrors),i.unevaluated&&vae(t),e.return((0,ue._)`${$e.default.errors} === 0`))}function vae({gen:t,evaluated:e,props:r,items:n}){r instanceof ue.Name&&t.assign((0,ue._)`${e}.props`,r),n instanceof ue.Name&&t.assign((0,ue._)`${e}.items`,n)}function IZ(t,e,r,n){let{gen:o,schema:i,data:s,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(i.$ref&&(c.ignoreKeywordsWithRef||!(0,cs.schemaHasRulesButRef)(i,l))){o.block(()=>UZ(t,"$ref",l.all.$ref.definition));return}c.jtd||_ae(t,e),o.block(()=>{for(let p of l.rules)d(p);d(l.post)});function d(p){(0,jE.shouldUseGroup)(i,p)&&(p.type?(o.if((0,D0.checkDataType)(p.type,s,c.strictNumbers)),EZ(t,p),e.length===1&&e[0]===p.type&&r&&(o.else(),(0,D0.reportTypeError)(t)),o.endIf()):EZ(t,p),a||o.if((0,ue._)`${$e.default.errors} === ${n||0}`))}}function EZ(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,oae.assignDefaults)(t,e.type),r.block(()=>{for(let i of e.rules)(0,jE.shouldUseRule)(n,i)&&UZ(t,i.keyword,i.definition,e.type)})}function _ae(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(bae(t,e),t.opts.allowUnionTypes||wae(t,e),xae(t,t.dataTypes))}function bae(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{qZ(t.dataTypes,r)||NE(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),kae(t,e)}}function wae(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&NE(t,"use allowUnionTypes to allow union type keyword")}function xae(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,jE.shouldUseRule)(t.schema,o)){let{type:i}=o.definition;i.length&&!i.some(s=>Sae(e,s))&&NE(t,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function Sae(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function qZ(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function kae(t,e){let r=[];for(let n of t.dataTypes)qZ(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function NE(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,cs.checkStrictMode)(t,e,t.opts.strictTypes)}var q0=class{constructor(e,r,n){if((0,vh.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,cs.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",BZ(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,vh.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",$e.default.errors))}result(e,r,n){this.failResult((0,ue.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,ue.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,ue._)`${r} !== undefined && (${(0,ue.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?yh.reportExtraError:yh.reportError)(this,this.def.error,r)}$dataError(){(0,yh.reportError)(this,this.def.$dataError||yh.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,yh.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=ue.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=ue.nil,r=ue.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:i,def:s}=this;n.if((0,ue.or)((0,ue._)`${o} === undefined`,r)),e!==ue.nil&&n.assign(e,!0),(i.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==ue.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:i}=this;return(0,ue.or)(s(),a());function s(){if(n.length){if(!(r instanceof ue.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,ue._)`${(0,D0.checkDataTypes)(c,r,i.opts.strictNumbers,D0.DataType.Wrong)}`}return ue.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,ue._)`!${c}(${r})`}return ue.nil}}subschema(e,r){let n=(0,OE.getSubschema)(this.it,e);(0,OE.extendSubschemaData)(n,this.it,e),(0,OE.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return dae(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=cs.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=cs.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,ue.Name)),!0}};da.KeywordCxt=q0;function UZ(t,e,r,n){let o=new q0(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,vh.funcKeywordCode)(o,r):"macro"in r?(0,vh.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,vh.funcKeywordCode)(o,r)}var $ae=/^\/(?:[^~]|~0|~1)*$/,Aae=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function BZ(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,i;if(t==="")return $e.default.rootData;if(t[0]==="/"){if(!$ae.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,i=$e.default.rootData}else{let u=Aae.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(i=r[e-l],!o)return i}let s=i,a=o.split("/");for(let u of a)u&&(i=(0,ue._)`${i}${(0,ue.getProperty)((0,cs.unescapeJsonPointer)(u))}`,s=(0,ue._)`${s} && ${i}`);return s;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}da.getData=BZ});var U0=g(RE=>{"use strict";Object.defineProperty(RE,"__esModule",{value:!0});var zE=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};RE.default=zE});var bh=g(qE=>{"use strict";Object.defineProperty(qE,"__esModule",{value:!0});var ME=gh(),DE=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,ME.resolveUrl)(e,r,n),this.missingSchema=(0,ME.normalizeId)((0,ME.getFullPath)(e,this.missingRef))}};qE.default=DE});var L0=g(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.resolveSchema=po.getCompilingSchema=po.resolveRef=po.compileSchema=po.SchemaEnv=void 0;var Uo=Ne(),Pae=U0(),vc=as(),Bo=gh(),LZ=st(),Cae=_h(),Ql=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,Bo.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};po.SchemaEnv=Ql;function BE(t){let e=ZZ.call(this,t);if(e)return e;let r=(0,Bo.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:i}=this.opts,s=new Uo.CodeGen(this.scope,{es5:n,lines:o,ownProperties:i}),a;t.$async&&(a=s.scopeValue("Error",{ref:Pae.default,code:(0,Uo._)`require("ajv/dist/runtime/validation_error").default`}));let c=s.scopeName("validate");t.validateName=c;let u={gen:s,allErrors:this.opts.allErrors,data:vc.default.data,parentData:vc.default.parentData,parentDataProperty:vc.default.parentDataProperty,dataNames:[vc.default.data],dataPathArr:[Uo.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,Uo.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:Uo.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,Uo._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,Cae.validateFunctionCode)(u),s.optimize(this.opts.code.optimize);let d=s.toString();l=`${s.scopeRefs(vc.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let f=new Function(`${vc.default.self}`,`${vc.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:f}),f.errors=null,f.schema=t.schema,f.schemaEnv=t,t.$async&&(f.$async=!0),this.opts.code.source===!0&&(f.source={validateName:c,validateCode:d,scopeValues:s._values}),this.opts.unevaluated){let{props:h,items:m}=u;f.evaluated={props:h instanceof Uo.Name?void 0:h,items:m instanceof Uo.Name?void 0:m,dynamicProps:h instanceof Uo.Name,dynamicItems:m instanceof Uo.Name},f.source&&(f.source.evaluated=(0,Uo.stringify)(f.evaluated))}return t.validate=f,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}po.compileSchema=BE;function Tae(t,e,r){var n;r=(0,Bo.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let i=Oae.call(this,t,r);if(i===void 0){let s=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;s&&(i=new Ql({schema:s,schemaId:a,root:t,baseId:e}))}if(i!==void 0)return t.refs[r]=Iae.call(this,i)}po.resolveRef=Tae;function Iae(t){return(0,Bo.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:BE.call(this,t)}function ZZ(t){for(let e of this._compilations)if(Eae(e,t))return e}po.getCompilingSchema=ZZ;function Eae(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function Oae(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||B0.call(this,t,e)}function B0(t,e){let r=this.opts.uriResolver.parse(e),n=(0,Bo._getFullPath)(this.opts.uriResolver,r),o=(0,Bo.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return UE.call(this,r,t);let i=(0,Bo.normalizeId)(n),s=this.refs[i]||this.schemas[i];if(typeof s=="string"){let a=B0.call(this,t,s);return typeof a?.schema!="object"?void 0:UE.call(this,r,a)}if(typeof s?.schema=="object"){if(s.validate||BE.call(this,s),i===(0,Bo.normalizeId)(e)){let{schema:a}=s,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,Bo.resolveUrl)(this.opts.uriResolver,o,u)),new Ql({schema:a,schemaId:c,root:t,baseId:o})}return UE.call(this,r,s)}}po.resolveSchema=B0;var jae=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function UE(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,LZ.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!jae.has(a)&&u&&(e=(0,Bo.resolveUrl)(this.opts.uriResolver,e,u))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,LZ.schemaHasRulesButRef)(r,this.RULES)){let a=(0,Bo.resolveUrl)(this.opts.uriResolver,e,r.$ref);i=B0.call(this,n,a)}let{schemaId:s}=this.opts;if(i=i||new Ql({schema:r,schemaId:s,root:n,baseId:e}),i.schema!==i.root.schema)return i}});var VZ=g((p1e,Nae)=>{Nae.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var HZ=g(LE=>{"use strict";Object.defineProperty(LE,"__esModule",{value:!0});var FZ=oI();FZ.code='require("ajv/dist/runtime/uri").default';LE.default=FZ});var eV=g(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.CodeGen=Rr.Name=Rr.nil=Rr.stringify=Rr.str=Rr._=Rr.KeywordCxt=void 0;var zae=_h();Object.defineProperty(Rr,"KeywordCxt",{enumerable:!0,get:function(){return zae.KeywordCxt}});var ed=Ne();Object.defineProperty(Rr,"_",{enumerable:!0,get:function(){return ed._}});Object.defineProperty(Rr,"str",{enumerable:!0,get:function(){return ed.str}});Object.defineProperty(Rr,"stringify",{enumerable:!0,get:function(){return ed.stringify}});Object.defineProperty(Rr,"nil",{enumerable:!0,get:function(){return ed.nil}});Object.defineProperty(Rr,"Name",{enumerable:!0,get:function(){return ed.Name}});Object.defineProperty(Rr,"CodeGen",{enumerable:!0,get:function(){return ed.CodeGen}});var Rae=U0(),XZ=bh(),Mae=SE(),wh=L0(),Dae=Ne(),xh=gh(),Z0=hh(),VE=st(),KZ=VZ(),qae=HZ(),YZ=(t,e)=>new RegExp(t,e);YZ.code="new RegExp";var Uae=["removeAdditional","useDefaults","coerceTypes"],Bae=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),Lae={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Zae={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},WZ=200;function Vae(t){var e,r,n,o,i,s,a,c,u,l,d,p,f,h,m,y,v,b,x,C,$,L,xe,ve,Se;let Fe=t.strict,Yt=(e=t.code)===null||e===void 0?void 0:e.optimize,en=Yt===!0||Yt===void 0?1:Yt||0,Ms=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:YZ,Gt=(o=t.uriResolver)!==null&&o!==void 0?o:qae.default;return{strictSchema:(s=(i=t.strictSchema)!==null&&i!==void 0?i:Fe)!==null&&s!==void 0?s:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:Fe)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:Fe)!==null&&l!==void 0?l:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:Fe)!==null&&p!==void 0?p:"log",strictRequired:(h=(f=t.strictRequired)!==null&&f!==void 0?f:Fe)!==null&&h!==void 0?h:!1,code:t.code?{...t.code,optimize:en,regExp:Ms}:{optimize:en,regExp:Ms},loopRequired:(m=t.loopRequired)!==null&&m!==void 0?m:WZ,loopEnum:(y=t.loopEnum)!==null&&y!==void 0?y:WZ,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:(b=t.messages)!==null&&b!==void 0?b:!0,inlineRefs:(x=t.inlineRefs)!==null&&x!==void 0?x:!0,schemaId:(C=t.schemaId)!==null&&C!==void 0?C:"$id",addUsedSchema:($=t.addUsedSchema)!==null&&$!==void 0?$:!0,validateSchema:(L=t.validateSchema)!==null&&L!==void 0?L:!0,validateFormats:(xe=t.validateFormats)!==null&&xe!==void 0?xe:!0,unicodeRegExp:(ve=t.unicodeRegExp)!==null&&ve!==void 0?ve:!0,int32range:(Se=t.int32range)!==null&&Se!==void 0?Se:!0,uriResolver:Gt}}var Sh=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...Vae(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new Dae.ValueScope({scope:{},prefixes:Bae,es5:r,lines:n}),this.logger=Jae(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,Mae.getRules)(),GZ.call(this,Lae,e,"NOT SUPPORTED"),GZ.call(this,Zae,e,"DEPRECATED","warn"),this._metaOpts=Wae.call(this),e.formats&&Hae.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&Kae.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),Fae.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=KZ;n==="id"&&(o={...KZ},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await i.call(this,l.$schema);let p=this._addSchema(l,d);return p.validate||s.call(this,p)}async function i(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function s(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof XZ.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),s.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await i.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let s of e)this.addSchema(s,void 0,n,o);return this}let i;if(typeof e=="object"){let{schemaId:s}=this.opts;if(i=e[s],i!==void 0&&typeof i!="string")throw new Error(`schema ${s} must be string`)}return r=(0,xh.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return o}getSchema(e){let r;for(;typeof(r=JZ.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new wh.SchemaEnv({schema:{},schemaId:n});if(r=wh.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=JZ.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,xh.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Yae.call(this,n,r),!r)return(0,VE.eachItem)(n,i=>ZE.call(this,i)),this;ece.call(this,r);let o={...r,type:(0,Z0.getJSONTypes)(r.type),schemaType:(0,Z0.getJSONTypes)(r.schemaType)};return(0,VE.eachItem)(n,o.type.length===0?i=>ZE.call(this,i,o):i=>o.type.forEach(s=>ZE.call(this,i,o,s))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(i=>i.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,i)=>o+r+i)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let i=o.split("/").slice(1),s=e;for(let a of i)s=s[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=s[a];u&&l&&(s[a]=QZ(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,i=this.opts.addUsedSchema){let s,{schemaId:a}=this.opts;if(typeof e=="object")s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,xh.normalizeId)(s||n);let u=xh.getSchemaRefs.call(this,e,n);return c=new wh.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):wh.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{wh.compileSchema.call(this,e)}finally{this.opts=r}}};Sh.ValidationError=Rae.default;Sh.MissingRefError=XZ.default;Rr.default=Sh;function GZ(t,e,r,n="error"){for(let o in t){let i=o;i in e&&this.logger[n](`${r}: option ${o}. ${t[i]}`)}}function JZ(t){return t=(0,xh.normalizeId)(t),this.schemas[t]||this.refs[t]}function Fae(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function Hae(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function Kae(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function Wae(){let t={...this.opts};for(let e of Uae)delete t[e];return t}var Gae={log(){},warn(){},error(){}};function Jae(t){if(t===!1)return Gae;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var Xae=/^[a-z_$][a-z0-9_$:-]*$/i;function Yae(t,e){let{RULES:r}=this;if((0,VE.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!Xae.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function ZE(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,s=o?i.post:i.rules.find(({type:c})=>c===r);if(s||(s={type:r,rules:[]},i.rules.push(s)),i.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,Z0.getJSONTypes)(e.type),schemaType:(0,Z0.getJSONTypes)(e.schemaType)}};e.before?Qae.call(this,s,a,e.before):s.rules.push(a),i.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function Qae(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function ece(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=QZ(e)),t.validateSchema=this.compile(e,!0))}var tce={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function QZ(t){return{anyOf:[t,tce]}}});var tV=g(FE=>{"use strict";Object.defineProperty(FE,"__esModule",{value:!0});var rce={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};FE.default=rce});var iV=g(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.callRef=_c.getValidate=void 0;var nce=bh(),rV=lo(),Sn=Ne(),td=as(),nV=L0(),V0=st(),oce={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:i,validateName:s,opts:a,self:c}=n,{root:u}=i;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=nV.resolveRef.call(c,u,o,r);if(l===void 0)throw new nce.default(n.opts.uriResolver,o,r);if(l instanceof nV.SchemaEnv)return p(l);return f(l);function d(){if(i===u)return F0(t,s,i,i.$async);let h=e.scopeValue("root",{ref:u});return F0(t,(0,Sn._)`${h}.validate`,u,u.$async)}function p(h){let m=oV(t,h);F0(t,m,h,h.$async)}function f(h){let m=e.scopeValue("schema",a.code.source===!0?{ref:h,code:(0,Sn.stringify)(h)}:{ref:h}),y=e.name("valid"),v=t.subschema({schema:h,dataTypes:[],schemaPath:Sn.nil,topSchemaRef:m,errSchemaPath:r},y);t.mergeEvaluated(v),t.ok(y)}}};function oV(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Sn._)`${r.scopeValue("wrapper",{ref:e})}.validate`}_c.getValidate=oV;function F0(t,e,r,n){let{gen:o,it:i}=t,{allErrors:s,schemaEnv:a,opts:c}=i,u=c.passContext?td.default.this:Sn.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let h=o.let("valid");o.try(()=>{o.code((0,Sn._)`await ${(0,rV.callValidateCode)(t,e,u)}`),f(e),s||o.assign(h,!0)},m=>{o.if((0,Sn._)`!(${m} instanceof ${i.ValidationError})`,()=>o.throw(m)),p(m),s||o.assign(h,!1)}),t.ok(h)}function d(){t.result((0,rV.callValidateCode)(t,e,u),()=>f(e),()=>p(e))}function p(h){let m=(0,Sn._)`${h}.errors`;o.assign(td.default.vErrors,(0,Sn._)`${td.default.vErrors} === null ? ${m} : ${td.default.vErrors}.concat(${m})`),o.assign(td.default.errors,(0,Sn._)`${td.default.vErrors}.length`)}function f(h){var m;if(!i.opts.unevaluated)return;let y=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(i.props!==!0)if(y&&!y.dynamicProps)y.props!==void 0&&(i.props=V0.mergeEvaluated.props(o,y.props,i.props));else{let v=o.var("props",(0,Sn._)`${h}.evaluated.props`);i.props=V0.mergeEvaluated.props(o,v,i.props,Sn.Name)}if(i.items!==!0)if(y&&!y.dynamicItems)y.items!==void 0&&(i.items=V0.mergeEvaluated.items(o,y.items,i.items));else{let v=o.var("items",(0,Sn._)`${h}.evaluated.items`);i.items=V0.mergeEvaluated.items(o,v,i.items,Sn.Name)}}}_c.callRef=F0;_c.default=oce});var sV=g(HE=>{"use strict";Object.defineProperty(HE,"__esModule",{value:!0});var ice=tV(),sce=iV(),ace=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",ice.default,sce.default];HE.default=ace});var aV=g(KE=>{"use strict";Object.defineProperty(KE,"__esModule",{value:!0});var H0=Ne(),pa=H0.operators,K0={maximum:{okStr:"<=",ok:pa.LTE,fail:pa.GT},minimum:{okStr:">=",ok:pa.GTE,fail:pa.LT},exclusiveMaximum:{okStr:"<",ok:pa.LT,fail:pa.GTE},exclusiveMinimum:{okStr:">",ok:pa.GT,fail:pa.LTE}},cce={message:({keyword:t,schemaCode:e})=>(0,H0.str)`must be ${K0[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,H0._)`{comparison: ${K0[t].okStr}, limit: ${e}}`},uce={keyword:Object.keys(K0),type:"number",schemaType:"number",$data:!0,error:cce,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,H0._)`${r} ${K0[e].fail} ${n} || isNaN(${r})`)}};KE.default=uce});var cV=g(WE=>{"use strict";Object.defineProperty(WE,"__esModule",{value:!0});var kh=Ne(),lce={message:({schemaCode:t})=>(0,kh.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,kh._)`{multipleOf: ${t}}`},dce={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:lce,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,i=o.opts.multipleOfPrecision,s=e.let("res"),a=i?(0,kh._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${i}`:(0,kh._)`${s} !== parseInt(${s})`;t.fail$data((0,kh._)`(${n} === 0 || (${s} = ${r}/${n}, ${a}))`)}};WE.default=dce});var lV=g(GE=>{"use strict";Object.defineProperty(GE,"__esModule",{value:!0});function uV(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}GE.default=uV;uV.code='require("ajv/dist/runtime/ucs2length").default'});var dV=g(JE=>{"use strict";Object.defineProperty(JE,"__esModule",{value:!0});var bc=Ne(),pce=st(),fce=lV(),mce={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,bc.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,bc._)`{limit: ${t}}`},hce={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:mce,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,i=e==="maxLength"?bc.operators.GT:bc.operators.LT,s=o.opts.unicode===!1?(0,bc._)`${r}.length`:(0,bc._)`${(0,pce.useFunc)(t.gen,fce.default)}(${r})`;t.fail$data((0,bc._)`${s} ${i} ${n}`)}};JE.default=hce});var pV=g(XE=>{"use strict";Object.defineProperty(XE,"__esModule",{value:!0});var gce=lo(),W0=Ne(),yce={message:({schemaCode:t})=>(0,W0.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,W0._)`{pattern: ${t}}`},vce={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:yce,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:i}=t,s=i.opts.unicodeRegExp?"u":"",a=r?(0,W0._)`(new RegExp(${o}, ${s}))`:(0,gce.usePattern)(t,n);t.fail$data((0,W0._)`!${a}.test(${e})`)}};XE.default=vce});var fV=g(YE=>{"use strict";Object.defineProperty(YE,"__esModule",{value:!0});var $h=Ne(),_ce={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,$h.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,$h._)`{limit: ${t}}`},bce={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:_ce,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?$h.operators.GT:$h.operators.LT;t.fail$data((0,$h._)`Object.keys(${r}).length ${o} ${n}`)}};YE.default=bce});var mV=g(QE=>{"use strict";Object.defineProperty(QE,"__esModule",{value:!0});var Ah=lo(),Ph=Ne(),wce=st(),xce={message:({params:{missingProperty:t}})=>(0,Ph.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,Ph._)`{missingProperty: ${t}}`},Sce={keyword:"required",type:"object",schemaType:"array",$data:!0,error:xce,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:i,it:s}=t,{opts:a}=s;if(!i&&r.length===0)return;let c=r.length>=a.loopRequired;if(s.allErrors?u():l(),a.strictRequired){let f=t.parentSchema.properties,{definedProperties:h}=t.it;for(let m of r)if(f?.[m]===void 0&&!h.has(m)){let y=s.schemaEnv.baseId+s.errSchemaPath,v=`required property "${m}" is not defined at "${y}" (strictRequired)`;(0,wce.checkStrictMode)(s,v,s.opts.strictRequired)}}function u(){if(c||i)t.block$data(Ph.nil,d);else for(let f of r)(0,Ah.checkReportMissingProp)(t,f)}function l(){let f=e.let("missing");if(c||i){let h=e.let("valid",!0);t.block$data(h,()=>p(f,h)),t.ok(h)}else e.if((0,Ah.checkMissingProp)(t,r,f)),(0,Ah.reportMissingProp)(t,f),e.else()}function d(){e.forOf("prop",n,f=>{t.setParams({missingProperty:f}),e.if((0,Ah.noPropertyInData)(e,o,f,a.ownProperties),()=>t.error())})}function p(f,h){t.setParams({missingProperty:f}),e.forOf(f,n,()=>{e.assign(h,(0,Ah.propertyInData)(e,o,f,a.ownProperties)),e.if((0,Ph.not)(h),()=>{t.error(),e.break()})},Ph.nil)}}};QE.default=Sce});var hV=g(eO=>{"use strict";Object.defineProperty(eO,"__esModule",{value:!0});var Ch=Ne(),kce={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,Ch.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,Ch._)`{limit: ${t}}`},$ce={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:kce,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?Ch.operators.GT:Ch.operators.LT;t.fail$data((0,Ch._)`${r}.length ${o} ${n}`)}};eO.default=$ce});var G0=g(tO=>{"use strict";Object.defineProperty(tO,"__esModule",{value:!0});var gV=Bm();gV.code='require("ajv/dist/runtime/equal").default';tO.default=gV});var yV=g(nO=>{"use strict";Object.defineProperty(nO,"__esModule",{value:!0});var rO=hh(),Mr=Ne(),Ace=st(),Pce=G0(),Cce={message:({params:{i:t,j:e}})=>(0,Mr.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,Mr._)`{i: ${t}, j: ${e}}`},Tce={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:Cce,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:i,schemaCode:s,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=i.items?(0,rO.getSchemaTypes)(i.items):[];t.block$data(c,l,(0,Mr._)`${s} === false`),t.ok(c);function l(){let h=e.let("i",(0,Mr._)`${r}.length`),m=e.let("j");t.setParams({i:h,j:m}),e.assign(c,!0),e.if((0,Mr._)`${h} > 1`,()=>(d()?p:f)(h,m))}function d(){return u.length>0&&!u.some(h=>h==="object"||h==="array")}function p(h,m){let y=e.name("item"),v=(0,rO.checkDataTypes)(u,y,a.opts.strictNumbers,rO.DataType.Wrong),b=e.const("indices",(0,Mr._)`{}`);e.for((0,Mr._)`;${h}--;`,()=>{e.let(y,(0,Mr._)`${r}[${h}]`),e.if(v,(0,Mr._)`continue`),u.length>1&&e.if((0,Mr._)`typeof ${y} == "string"`,(0,Mr._)`${y} += "_"`),e.if((0,Mr._)`typeof ${b}[${y}] == "number"`,()=>{e.assign(m,(0,Mr._)`${b}[${y}]`),t.error(),e.assign(c,!1).break()}).code((0,Mr._)`${b}[${y}] = ${h}`)})}function f(h,m){let y=(0,Ace.useFunc)(e,Pce.default),v=e.name("outer");e.label(v).for((0,Mr._)`;${h}--;`,()=>e.for((0,Mr._)`${m} = ${h}; ${m}--;`,()=>e.if((0,Mr._)`${y}(${r}[${h}], ${r}[${m}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};nO.default=Tce});var vV=g(iO=>{"use strict";Object.defineProperty(iO,"__esModule",{value:!0});var oO=Ne(),Ice=st(),Ece=G0(),Oce={message:"must be equal to constant",params:({schemaCode:t})=>(0,oO._)`{allowedValue: ${t}}`},jce={keyword:"const",$data:!0,error:Oce,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:i}=t;n||i&&typeof i=="object"?t.fail$data((0,oO._)`!${(0,Ice.useFunc)(e,Ece.default)}(${r}, ${o})`):t.fail((0,oO._)`${i} !== ${r}`)}};iO.default=jce});var _V=g(sO=>{"use strict";Object.defineProperty(sO,"__esModule",{value:!0});var Th=Ne(),Nce=st(),zce=G0(),Rce={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,Th._)`{allowedValues: ${t}}`},Mce={keyword:"enum",schemaType:"array",$data:!0,error:Rce,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:i,it:s}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=s.opts.loopEnum,c,u=()=>c??(c=(0,Nce.useFunc)(e,zce.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let f=e.const("vSchema",i);l=(0,Th.or)(...o.map((h,m)=>p(f,m)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",i,f=>e.if((0,Th._)`${u()}(${r}, ${f})`,()=>e.assign(l,!0).break()))}function p(f,h){let m=o[h];return typeof m=="object"&&m!==null?(0,Th._)`${u()}(${r}, ${f}[${h}])`:(0,Th._)`${r} === ${m}`}}};sO.default=Mce});var bV=g(aO=>{"use strict";Object.defineProperty(aO,"__esModule",{value:!0});var Dce=aV(),qce=cV(),Uce=dV(),Bce=pV(),Lce=fV(),Zce=mV(),Vce=hV(),Fce=yV(),Hce=vV(),Kce=_V(),Wce=[Dce.default,qce.default,Uce.default,Bce.default,Lce.default,Zce.default,Vce.default,Fce.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},Hce.default,Kce.default];aO.default=Wce});var uO=g(Ih=>{"use strict";Object.defineProperty(Ih,"__esModule",{value:!0});Ih.validateAdditionalItems=void 0;var wc=Ne(),cO=st(),Gce={message:({params:{len:t}})=>(0,wc.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,wc._)`{limit: ${t}}`},Jce={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Gce,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,cO.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}wV(t,n)}};function wV(t,e){let{gen:r,schema:n,data:o,keyword:i,it:s}=t;s.items=!0;let a=r.const("len",(0,wc._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,wc._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,cO.alwaysValidSchema)(s,n)){let u=r.var("valid",(0,wc._)`${a} <= ${e.length}`);r.if((0,wc.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:i,dataProp:l,dataPropType:cO.Type.Num},u),s.allErrors||r.if((0,wc.not)(u),()=>r.break())})}}Ih.validateAdditionalItems=wV;Ih.default=Jce});var lO=g(Eh=>{"use strict";Object.defineProperty(Eh,"__esModule",{value:!0});Eh.validateTuple=void 0;var xV=Ne(),J0=st(),Xce=lo(),Yce={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return SV(t,"additionalItems",e);r.items=!0,!(0,J0.alwaysValidSchema)(r,e)&&t.ok((0,Xce.validateArray)(t))}};function SV(t,e,r=t.schema){let{gen:n,parentSchema:o,data:i,keyword:s,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=J0.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,xV._)`${i}.length`);r.forEach((d,p)=>{(0,J0.alwaysValidSchema)(a,d)||(n.if((0,xV._)`${u} > ${p}`,()=>t.subschema({keyword:s,schemaProp:p,dataProp:p},c)),t.ok(c))});function l(d){let{opts:p,errSchemaPath:f}=a,h=r.length,m=h===d.minItems&&(h===d.maxItems||d[e]===!1);if(p.strictTuples&&!m){let y=`"${s}" is ${h}-tuple, but minItems or maxItems/${e} are not specified or different at path "${f}"`;(0,J0.checkStrictMode)(a,y,p.strictTuples)}}}Eh.validateTuple=SV;Eh.default=Yce});var kV=g(dO=>{"use strict";Object.defineProperty(dO,"__esModule",{value:!0});var Qce=lO(),eue={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,Qce.validateTuple)(t,"items")};dO.default=eue});var AV=g(pO=>{"use strict";Object.defineProperty(pO,"__esModule",{value:!0});var $V=Ne(),tue=st(),rue=lo(),nue=uO(),oue={message:({params:{len:t}})=>(0,$V.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,$V._)`{limit: ${t}}`},iue={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:oue,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,tue.alwaysValidSchema)(n,e)&&(o?(0,nue.validateAdditionalItems)(t,o):t.ok((0,rue.validateArray)(t)))}};pO.default=iue});var PV=g(fO=>{"use strict";Object.defineProperty(fO,"__esModule",{value:!0});var fo=Ne(),X0=st(),sue={message:({params:{min:t,max:e}})=>e===void 0?(0,fo.str)`must contain at least ${t} valid item(s)`:(0,fo.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,fo._)`{minContains: ${t}}`:(0,fo._)`{minContains: ${t}, maxContains: ${e}}`},aue={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:sue,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t,s,a,{minContains:c,maxContains:u}=n;i.opts.next?(s=c===void 0?1:c,a=u):s=1;let l=e.const("len",(0,fo._)`${o}.length`);if(t.setParams({min:s,max:a}),a===void 0&&s===0){(0,X0.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,X0.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,X0.alwaysValidSchema)(i,r)){let m=(0,fo._)`${l} >= ${s}`;a!==void 0&&(m=(0,fo._)`${m} && ${l} <= ${a}`),t.pass(m);return}i.items=!0;let d=e.name("valid");a===void 0&&s===1?f(d,()=>e.if(d,()=>e.break())):s===0?(e.let(d,!0),a!==void 0&&e.if((0,fo._)`${o}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let m=e.name("_valid"),y=e.let("count",0);f(m,()=>e.if(m,()=>h(y)))}function f(m,y){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:X0.Type.Num,compositeRule:!0},m),y()})}function h(m){e.code((0,fo._)`${m}++`),a===void 0?e.if((0,fo._)`${m} >= ${s}`,()=>e.assign(d,!0).break()):(e.if((0,fo._)`${m} > ${a}`,()=>e.assign(d,!1).break()),s===1?e.assign(d,!0):e.if((0,fo._)`${m} >= ${s}`,()=>e.assign(d,!0)))}}};fO.default=aue});var IV=g(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.validateSchemaDeps=wi.validatePropertyDeps=wi.error=void 0;var mO=Ne(),cue=st(),Oh=lo();wi.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,mO.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,mO._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var uue={keyword:"dependencies",type:"object",schemaType:"object",error:wi.error,code(t){let[e,r]=lue(t);CV(t,e),TV(t,r)}};function lue({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function CV(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let i=r.let("missing");for(let s in e){let a=e[s];if(a.length===0)continue;let c=(0,Oh.propertyInData)(r,n,s,o.opts.ownProperties);t.setParams({property:s,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,Oh.checkReportMissingProp)(t,u)}):(r.if((0,mO._)`${c} && (${(0,Oh.checkMissingProp)(t,a,i)})`),(0,Oh.reportMissingProp)(t,i),r.else())}}wi.validatePropertyDeps=CV;function TV(t,e=t.schema){let{gen:r,data:n,keyword:o,it:i}=t,s=r.name("valid");for(let a in e)(0,cue.alwaysValidSchema)(i,e[a])||(r.if((0,Oh.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},s);t.mergeValidEvaluated(c,s)},()=>r.var(s,!0)),t.ok(s))}wi.validateSchemaDeps=TV;wi.default=uue});var OV=g(hO=>{"use strict";Object.defineProperty(hO,"__esModule",{value:!0});var EV=Ne(),due=st(),pue={message:"property name must be valid",params:({params:t})=>(0,EV._)`{propertyName: ${t.propertyName}}`},fue={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:pue,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,due.alwaysValidSchema)(o,r))return;let i=e.name("valid");e.forIn("key",n,s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},i),e.if((0,EV.not)(i),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(i)}};hO.default=fue});var yO=g(gO=>{"use strict";Object.defineProperty(gO,"__esModule",{value:!0});var Y0=lo(),Lo=Ne(),mue=as(),Q0=st(),hue={message:"must NOT have additional properties",params:({params:t})=>(0,Lo._)`{additionalProperty: ${t.additionalProperty}}`},gue={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:hue,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:i,it:s}=t;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=s;if(s.props=!0,c.removeAdditional!=="all"&&(0,Q0.alwaysValidSchema)(s,r))return;let u=(0,Y0.allSchemaProperties)(n.properties),l=(0,Y0.allSchemaProperties)(n.patternProperties);d(),t.ok((0,Lo._)`${i} === ${mue.default.errors}`);function d(){e.forIn("key",o,y=>{!u.length&&!l.length?h(y):e.if(p(y),()=>h(y))})}function p(y){let v;if(u.length>8){let b=(0,Q0.schemaRefOrVal)(s,n.properties,"properties");v=(0,Y0.isOwnProperty)(e,b,y)}else u.length?v=(0,Lo.or)(...u.map(b=>(0,Lo._)`${y} === ${b}`)):v=Lo.nil;return l.length&&(v=(0,Lo.or)(v,...l.map(b=>(0,Lo._)`${(0,Y0.usePattern)(t,b)}.test(${y})`))),(0,Lo.not)(v)}function f(y){e.code((0,Lo._)`delete ${o}[${y}]`)}function h(y){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){f(y);return}if(r===!1){t.setParams({additionalProperty:y}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,Q0.alwaysValidSchema)(s,r)){let v=e.name("valid");c.removeAdditional==="failing"?(m(y,v,!1),e.if((0,Lo.not)(v),()=>{t.reset(),f(y)})):(m(y,v),a||e.if((0,Lo.not)(v),()=>e.break()))}}function m(y,v,b){let x={keyword:"additionalProperties",dataProp:y,dataPropType:Q0.Type.Str};b===!1&&Object.assign(x,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(x,v)}}};gO.default=gue});var zV=g(_O=>{"use strict";Object.defineProperty(_O,"__esModule",{value:!0});var yue=_h(),jV=lo(),vO=st(),NV=yO(),vue={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:i}=t;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&NV.default.code(new yue.KeywordCxt(i,NV.default,"additionalProperties"));let s=(0,jV.allSchemaProperties)(r);for(let d of s)i.definedProperties.add(d);i.opts.unevaluated&&s.length&&i.props!==!0&&(i.props=vO.mergeEvaluated.props(e,(0,vO.toHash)(s),i.props));let a=s.filter(d=>!(0,vO.alwaysValidSchema)(i,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,jV.propertyInData)(e,o,d,i.opts.ownProperties)),l(d),i.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return i.opts.useDefaults&&!i.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};_O.default=vue});var qV=g(bO=>{"use strict";Object.defineProperty(bO,"__esModule",{value:!0});var RV=lo(),ew=Ne(),MV=st(),DV=st(),_ue={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:i}=t,{opts:s}=i,a=(0,RV.allSchemaProperties)(r),c=a.filter(m=>(0,MV.alwaysValidSchema)(i,r[m]));if(a.length===0||c.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let u=s.strictSchema&&!s.allowMatchingProperties&&o.properties,l=e.name("valid");i.props!==!0&&!(i.props instanceof ew.Name)&&(i.props=(0,DV.evaluatedPropsToName)(e,i.props));let{props:d}=i;p();function p(){for(let m of a)u&&f(m),i.allErrors?h(m):(e.var(l,!0),h(m),e.if(l))}function f(m){for(let y in u)new RegExp(m).test(y)&&(0,MV.checkStrictMode)(i,`property ${y} matches pattern ${m} (use allowMatchingProperties)`)}function h(m){e.forIn("key",n,y=>{e.if((0,ew._)`${(0,RV.usePattern)(t,m)}.test(${y})`,()=>{let v=c.includes(m);v||t.subschema({keyword:"patternProperties",schemaProp:m,dataProp:y,dataPropType:DV.Type.Str},l),i.opts.unevaluated&&d!==!0?e.assign((0,ew._)`${d}[${y}]`,!0):!v&&!i.allErrors&&e.if((0,ew.not)(l),()=>e.break())})})}}};bO.default=_ue});var UV=g(wO=>{"use strict";Object.defineProperty(wO,"__esModule",{value:!0});var bue=st(),wue={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,bue.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};wO.default=wue});var BV=g(xO=>{"use strict";Object.defineProperty(xO,"__esModule",{value:!0});var xue=lo(),Sue={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:xue.validateUnion,error:{message:"must match a schema in anyOf"}};xO.default=Sue});var LV=g(SO=>{"use strict";Object.defineProperty(SO,"__esModule",{value:!0});var tw=Ne(),kue=st(),$ue={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,tw._)`{passingSchemas: ${t.passing}}`},Aue={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:$ue,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let i=r,s=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(s,()=>t.reset(),()=>t.error(!0));function u(){i.forEach((l,d)=>{let p;(0,kue.alwaysValidSchema)(o,l)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,tw._)`${c} && ${s}`).assign(s,!1).assign(a,(0,tw._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(s,!0),e.assign(a,d),p&&t.mergeEvaluated(p,tw.Name)})})}}};SO.default=Aue});var ZV=g(kO=>{"use strict";Object.defineProperty(kO,"__esModule",{value:!0});var Pue=st(),Cue={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((i,s)=>{if((0,Pue.alwaysValidSchema)(n,i))return;let a=t.subschema({keyword:"allOf",schemaProp:s},o);t.ok(o),t.mergeEvaluated(a)})}};kO.default=Cue});var HV=g($O=>{"use strict";Object.defineProperty($O,"__esModule",{value:!0});var rw=Ne(),FV=st(),Tue={message:({params:t})=>(0,rw.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,rw._)`{failingKeyword: ${t.ifClause}}`},Iue={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:Tue,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,FV.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=VV(n,"then"),i=VV(n,"else");if(!o&&!i)return;let s=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&i){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,rw.not)(a),u("else"));t.pass(s,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let p=t.subschema({keyword:l},a);e.assign(s,a),t.mergeValidEvaluated(p,s),d?e.assign(d,(0,rw._)`${l}`):t.setParams({ifClause:l})}}}};function VV(t,e){let r=t.schema[e];return r!==void 0&&!(0,FV.alwaysValidSchema)(t,r)}$O.default=Iue});var KV=g(AO=>{"use strict";Object.defineProperty(AO,"__esModule",{value:!0});var Eue=st(),Oue={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,Eue.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};AO.default=Oue});var WV=g(PO=>{"use strict";Object.defineProperty(PO,"__esModule",{value:!0});var jue=uO(),Nue=kV(),zue=lO(),Rue=AV(),Mue=PV(),Due=IV(),que=OV(),Uue=yO(),Bue=zV(),Lue=qV(),Zue=UV(),Vue=BV(),Fue=LV(),Hue=ZV(),Kue=HV(),Wue=KV();function Gue(t=!1){let e=[Zue.default,Vue.default,Fue.default,Hue.default,Kue.default,Wue.default,que.default,Uue.default,Due.default,Bue.default,Lue.default];return t?e.push(Nue.default,Rue.default):e.push(jue.default,zue.default),e.push(Mue.default),e}PO.default=Gue});var GV=g(CO=>{"use strict";Object.defineProperty(CO,"__esModule",{value:!0});var ar=Ne(),Jue={message:({schemaCode:t})=>(0,ar.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,ar._)`{format: ${t}}`},Xue={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:Jue,code(t,e){let{gen:r,data:n,$data:o,schema:i,schemaCode:s,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?p():f();function p(){let h=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),m=r.const("fDef",(0,ar._)`${h}[${s}]`),y=r.let("fType"),v=r.let("format");r.if((0,ar._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(y,(0,ar._)`${m}.type || "string"`).assign(v,(0,ar._)`${m}.validate`),()=>r.assign(y,(0,ar._)`"string"`).assign(v,m)),t.fail$data((0,ar.or)(b(),x()));function b(){return c.strictSchema===!1?ar.nil:(0,ar._)`${s} && !${v}`}function x(){let C=l.$async?(0,ar._)`(${m}.async ? await ${v}(${n}) : ${v}(${n}))`:(0,ar._)`${v}(${n})`,$=(0,ar._)`(typeof ${v} == "function" ? ${C} : ${v}.test(${n}))`;return(0,ar._)`${v} && ${v} !== true && ${y} === ${e} && !${$}`}}function f(){let h=d.formats[i];if(!h){b();return}if(h===!0)return;let[m,y,v]=x(h);m===e&&t.pass(C());function b(){if(c.strictSchema===!1){d.logger.warn($());return}throw new Error($());function $(){return`unknown format "${i}" ignored in schema at path "${u}"`}}function x($){let L=$ instanceof RegExp?(0,ar.regexpCode)($):c.code.formats?(0,ar._)`${c.code.formats}${(0,ar.getProperty)(i)}`:void 0,xe=r.scopeValue("formats",{key:i,ref:$,code:L});return typeof $=="object"&&!($ instanceof RegExp)?[$.type||"string",$.validate,(0,ar._)`${xe}.validate`]:["string",$,xe]}function C(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!l.$async)throw new Error("async format in sync schema");return(0,ar._)`await ${v}(${n})`}return typeof y=="function"?(0,ar._)`${v}(${n})`:(0,ar._)`${v}.test(${n})`}}}};CO.default=Xue});var JV=g(TO=>{"use strict";Object.defineProperty(TO,"__esModule",{value:!0});var Yue=GV(),Que=[Yue.default];TO.default=Que});var XV=g(rd=>{"use strict";Object.defineProperty(rd,"__esModule",{value:!0});rd.contentVocabulary=rd.metadataVocabulary=void 0;rd.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];rd.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var QV=g(IO=>{"use strict";Object.defineProperty(IO,"__esModule",{value:!0});var ele=sV(),tle=bV(),rle=WV(),nle=JV(),YV=XV(),ole=[ele.default,tle.default,(0,rle.default)(),nle.default,YV.metadataVocabulary,YV.contentVocabulary];IO.default=ole});var tF=g(nw=>{"use strict";Object.defineProperty(nw,"__esModule",{value:!0});nw.DiscrError=void 0;var eF;(function(t){t.Tag="tag",t.Mapping="mapping"})(eF||(nw.DiscrError=eF={}))});var nF=g(OO=>{"use strict";Object.defineProperty(OO,"__esModule",{value:!0});var nd=Ne(),EO=tF(),rF=L0(),ile=bh(),sle=st(),ale={message:({params:{discrError:t,tagName:e}})=>t===EO.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,nd._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},cle={keyword:"discriminator",type:"object",schemaType:"object",error:ale,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:i}=t,{oneOf:s}=o;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,nd._)`${r}${(0,nd.getProperty)(a)}`);e.if((0,nd._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:EO.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let f=p();e.if(!1);for(let h in f)e.elseIf((0,nd._)`${u} === ${h}`),e.assign(c,d(f[h]));e.else(),t.error(!1,{discrError:EO.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(f){let h=e.name("valid"),m=t.subschema({keyword:"oneOf",schemaProp:f},h);return t.mergeEvaluated(m,nd.Name),h}function p(){var f;let h={},m=v(o),y=!0;for(let C=0;C<s.length;C++){let $=s[C];if($?.$ref&&!(0,sle.schemaHasRulesButRef)($,i.self.RULES)){let xe=$.$ref;if($=rF.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,xe),$ instanceof rF.SchemaEnv&&($=$.schema),$===void 0)throw new ile.default(i.opts.uriResolver,i.baseId,xe)}let L=(f=$?.properties)===null||f===void 0?void 0:f[a];if(typeof L!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);y=y&&(m||v($)),b(L,C)}if(!y)throw new Error(`discriminator: "${a}" must be required`);return h;function v({required:C}){return Array.isArray(C)&&C.includes(a)}function b(C,$){if(C.const)x(C.const,$);else if(C.enum)for(let L of C.enum)x(L,$);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function x(C,$){if(typeof C!="string"||C in h)throw new Error(`discriminator: "${a}" values must be unique strings`);h[C]=$}}}};OO.default=cle});var oF=g((eCe,ule)=>{ule.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var sF=g((Ut,jO)=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.MissingRefError=Ut.ValidationError=Ut.CodeGen=Ut.Name=Ut.nil=Ut.stringify=Ut.str=Ut._=Ut.KeywordCxt=Ut.Ajv=void 0;var lle=eV(),dle=QV(),ple=nF(),iF=oF(),fle=["/properties"],ow="http://json-schema.org/draft-07/schema",od=class extends lle.default{_addVocabularies(){super._addVocabularies(),dle.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(ple.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(iF,fle):iF;this.addMetaSchema(e,ow,!1),this.refs["http://json-schema.org/schema"]=ow}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(ow)?ow:void 0)}};Ut.Ajv=od;jO.exports=Ut=od;jO.exports.Ajv=od;Object.defineProperty(Ut,"__esModule",{value:!0});Ut.default=od;var mle=_h();Object.defineProperty(Ut,"KeywordCxt",{enumerable:!0,get:function(){return mle.KeywordCxt}});var id=Ne();Object.defineProperty(Ut,"_",{enumerable:!0,get:function(){return id._}});Object.defineProperty(Ut,"str",{enumerable:!0,get:function(){return id.str}});Object.defineProperty(Ut,"stringify",{enumerable:!0,get:function(){return id.stringify}});Object.defineProperty(Ut,"nil",{enumerable:!0,get:function(){return id.nil}});Object.defineProperty(Ut,"Name",{enumerable:!0,get:function(){return id.Name}});Object.defineProperty(Ut,"CodeGen",{enumerable:!0,get:function(){return id.CodeGen}});var hle=U0();Object.defineProperty(Ut,"ValidationError",{enumerable:!0,get:function(){return hle.default}});var gle=bh();Object.defineProperty(Ut,"MissingRefError",{enumerable:!0,get:function(){return gle.default}})});var aF=g(sd=>{"use strict";Object.defineProperty(sd,"__esModule",{value:!0});sd.formatLimitDefinition=void 0;var yle=sF(),Zo=Ne(),fa=Zo.operators,iw={formatMaximum:{okStr:"<=",ok:fa.LTE,fail:fa.GT},formatMinimum:{okStr:">=",ok:fa.GTE,fail:fa.LT},formatExclusiveMaximum:{okStr:"<",ok:fa.LT,fail:fa.GTE},formatExclusiveMinimum:{okStr:">",ok:fa.GT,fail:fa.LTE}},vle={message:({keyword:t,schemaCode:e})=>(0,Zo.str)`should be ${iw[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Zo._)`{comparison: ${iw[t].okStr}, limit: ${e}}`};sd.formatLimitDefinition={keyword:Object.keys(iw),type:"string",schemaType:"string",$data:!0,error:vle,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:i}=t,{opts:s,self:a}=i;if(!s.validateFormats)return;let c=new yle.KeywordCxt(i,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let p=e.scopeValue("formats",{ref:a.formats,code:s.code.formats}),f=e.const("fmt",(0,Zo._)`${p}[${c.schemaCode}]`);t.fail$data((0,Zo.or)((0,Zo._)`typeof ${f} != "object"`,(0,Zo._)`${f} instanceof RegExp`,(0,Zo._)`typeof ${f}.compare != "function"`,d(f)))}function l(){let p=c.schema,f=a.formats[p];if(!f||f===!0)return;if(typeof f!="object"||f instanceof RegExp||typeof f.compare!="function")throw new Error(`"${o}": format "${p}" does not define "compare" function`);let h=e.scopeValue("formats",{key:p,ref:f,code:s.code.formats?(0,Zo._)`${s.code.formats}${(0,Zo.getProperty)(p)}`:void 0});t.fail$data(d(h))}function d(p){return(0,Zo._)`${p}.compare(${r}, ${n}) ${iw[o].fail} 0`}},dependencies:["format"]};var _le=t=>(t.addKeyword(sd.formatLimitDefinition),t);sd.default=_le});var dF=g((jh,lF)=>{"use strict";Object.defineProperty(jh,"__esModule",{value:!0});var ad=H6(),ble=aF(),NO=Ne(),cF=new NO.Name("fullFormats"),wle=new NO.Name("fastFormats"),zO=(t,e={keywords:!0})=>{if(Array.isArray(e))return uF(t,e,ad.fullFormats,cF),t;let[r,n]=e.mode==="fast"?[ad.fastFormats,wle]:[ad.fullFormats,cF],o=e.formats||ad.formatNames;return uF(t,o,r,n),e.keywords&&(0,ble.default)(t),t};zO.get=(t,e="full")=>{let n=(e==="fast"?ad.fastFormats:ad.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function uF(t,e,r,n){var o,i;(o=(i=t.opts.code).formats)!==null&&o!==void 0||(i.formats=(0,NO._)`require("ajv-formats/dist/formats").${n}`);for(let s of e)t.addFormat(s,r[s])}lF.exports=jh=zO;Object.defineProperty(jh,"__esModule",{value:!0});jh.default=zO});function xle(){let t=new pF.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,fF.default)(t),t}var pF,fF,sw,mF=A(()=>{pF=It(D6(),1),fF=It(dF(),1);sw=class{constructor(e){this._ajv=e??xle()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}}});var aw,hF=A(()=>{Js();aw=class{constructor(e){this._client=e}async*callToolStream(e,r=Gs,n){let o=this._client,i={...n,task:n?.task??(o.isToolTask(e.name)?{}:void 0)},s=o.requestStream({method:"tools/call",params:e},r,i),a=o.getToolOutputValidator(e.name);for await(let c of s){if(c.type==="result"&&a){let u=c.result;if(!u.structuredContent&&!u.isError){yield{type:"error",error:new pe(we.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`)};return}if(u.structuredContent)try{let l=a(u.structuredContent);if(!l.valid){yield{type:"error",error:new pe(we.InvalidParams,`Structured content does not match the tool's output schema: ${l.errorMessage}`)};return}}catch(l){if(l instanceof pe){yield{type:"error",error:l};return}yield{type:"error",error:new pe(we.InvalidParams,`Failed to validate structured content: ${l instanceof Error?l.message:String(l)}`)};return}}yield c}}async getTask(e,r){return this._client.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._client.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._client.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._client.cancelTask({taskId:e},r)}requestStream(e,r,n){return this._client.requestStream(e,r,n)}}});function gF(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function yF(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var vF=A(()=>{});function cw(t,e){if(!(!t||e===null||typeof e!="object")){if(t.type==="object"&&t.properties&&typeof t.properties=="object"){let r=e,n=t.properties;for(let o of Object.keys(n)){let i=n[o];r[o]===void 0&&Object.prototype.hasOwnProperty.call(i,"default")&&(r[o]=i.default),r[o]!==void 0&&cw(i,r[o])}}if(Array.isArray(t.anyOf))for(let r of t.anyOf)typeof r!="boolean"&&cw(r,e);if(Array.isArray(t.oneOf))for(let r of t.oneOf)typeof r!="boolean"&&cw(r,e)}}function Sle(t){if(!t)return{supportsFormMode:!1,supportsUrlMode:!1};let e=t.form!==void 0,r=t.url!==void 0;return{supportsFormMode:e||!e&&!r,supportsUrlMode:r}}var uw,_F=A(()=>{pB();Js();mF();pb();hF();vF();uw=class extends Hb{constructor(e,r){super(r),this._clientInfo=e,this._cachedToolOutputValidators=new Map,this._cachedKnownTaskTools=new Set,this._cachedRequiredTaskTools=new Set,this._listChangedDebounceTimers=new Map,this._capabilities=r?.capabilities??{},this._jsonSchemaValidator=r?.jsonSchemaValidator??new sw,r?.listChanged&&(this._pendingListChangedConfig=r.listChanged)}_setupListChangedHandlers(e){e.tools&&this._serverCapabilities?.tools?.listChanged&&this._setupListChangedHandler("tools",IC,e.tools,async()=>(await this.listTools()).tools),e.prompts&&this._serverCapabilities?.prompts?.listChanged&&this._setupListChangedHandler("prompts",TC,e.prompts,async()=>(await this.listPrompts()).prompts),e.resources&&this._serverCapabilities?.resources?.listChanged&&this._setupListChangedHandler("resources",xC,e.resources,async()=>(await this.listResources()).resources)}get experimental(){return this._experimental||(this._experimental={tasks:new aw(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=dB(this._capabilities,e)}setRequestHandler(e,r){let o=db(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let i;if(Pl(o)){let a=o;i=a._zod?.def?.value??a.value}else{let a=o;i=a._def?.value??a.value}if(typeof i!="string")throw new Error("Schema method literal must be a string");let s=i;if(s==="elicitation/create"){let a=async(c,u)=>{let l=No(NC,c);if(!l.success){let b=l.error instanceof Error?l.error.message:String(l.error);throw new pe(we.InvalidParams,`Invalid elicitation request: ${b}`)}let{params:d}=l.data;d.mode=d.mode??"form";let{supportsFormMode:p,supportsUrlMode:f}=Sle(this._capabilities.elicitation);if(d.mode==="form"&&!p)throw new pe(we.InvalidParams,"Client does not support form-mode elicitation requests");if(d.mode==="url"&&!f)throw new pe(we.InvalidParams,"Client does not support URL-mode elicitation requests");let h=await Promise.resolve(r(c,u));if(d.task){let b=No(tc,h);if(!b.success){let x=b.error instanceof Error?b.error.message:String(b.error);throw new pe(we.InvalidParams,`Invalid task creation result: ${x}`)}return b.data}let m=No(zC,h);if(!m.success){let b=m.error instanceof Error?m.error.message:String(m.error);throw new pe(we.InvalidParams,`Invalid elicitation result: ${b}`)}let y=m.data,v=d.mode==="form"?d.requestedSchema:void 0;if(d.mode==="form"&&y.action==="accept"&&y.content&&v&&this._capabilities.elicitation?.form?.applyDefaults)try{cw(v,y.content)}catch{}return y};return super.setRequestHandler(e,a)}if(s==="sampling/createMessage"){let a=async(c,u)=>{let l=No(EC,c);if(!l.success){let y=l.error instanceof Error?l.error.message:String(l.error);throw new pe(we.InvalidParams,`Invalid sampling request: ${y}`)}let{params:d}=l.data,p=await Promise.resolve(r(c,u));if(d.task){let y=No(tc,p);if(!y.success){let v=y.error instanceof Error?y.error.message:String(y.error);throw new pe(we.InvalidParams,`Invalid task creation result: ${v}`)}return y.data}let h=d.tools||d.toolChoice?jC:OC,m=No(h,p);if(!m.success){let y=m.error instanceof Error?m.error.message:String(m.error);throw new pe(we.InvalidParams,`Invalid sampling result: ${y}`)}return m.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapability(e,r){if(!this._serverCapabilities?.[e])throw new Error(`Server does not support ${e} (required for ${r})`)}async connect(e,r){if(await super.connect(e),e.sessionId===void 0)try{let n=await this.request({method:"initialize",params:{protocolVersion:Il,capabilities:this._capabilities,clientInfo:this._clientInfo}},gC,r);if(n===void 0)throw new Error(`Server sent invalid initialize result: ${n}`);if(!ZU.includes(n.protocolVersion))throw new Error(`Server's protocol version is not supported: ${n.protocolVersion}`);this._serverCapabilities=n.capabilities,this._serverVersion=n.serverInfo,e.setProtocolVersion&&e.setProtocolVersion(n.protocolVersion),this._instructions=n.instructions,await this.notification({method:"notifications/initialized"}),this._pendingListChangedConfig&&(this._setupListChangedHandlers(this._pendingListChangedConfig),this._pendingListChangedConfig=void 0)}catch(n){throw this.close(),n}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){switch(e){case"logging/setLevel":if(!this._serverCapabilities?.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._serverCapabilities?.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!this._serverCapabilities?.resources)throw new Error(`Server does not support resources (required for ${e})`);if(e==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._serverCapabilities?.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!this._serverCapabilities?.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"initialize":break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/roots/list_changed":if(!this._capabilities.roots?.listChanged)throw new Error(`Client does not support roots list changed notifications (required for ${e})`);break;case"notifications/initialized":break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Client does not support tasks capability (required for ${e})`);break;case"ping":break}}assertTaskCapability(e){gF(this._serverCapabilities?.tasks?.requests,e,"Server")}assertTaskHandlerCapability(e){this._capabilities&&yF(this._capabilities.tasks?.requests,e,"Client")}async ping(e){return this.request({method:"ping"},ec,e)}async complete(e,r){return this.request({method:"completion/complete",params:e},RC,r)}async setLoggingLevel(e,r){return this.request({method:"logging/setLevel",params:{level:e}},ec,r)}async getPrompt(e,r){return this.request({method:"prompts/get",params:e},CC,r)}async listPrompts(e,r){return this.request({method:"prompts/list",params:e},SC,r)}async listResources(e,r){return this.request({method:"resources/list",params:e},vC,r)}async listResourceTemplates(e,r){return this.request({method:"resources/templates/list",params:e},_C,r)}async readResource(e,r){return this.request({method:"resources/read",params:e},wC,r)}async subscribeResource(e,r){return this.request({method:"resources/subscribe",params:e},ec,r)}async unsubscribeResource(e,r){return this.request({method:"resources/unsubscribe",params:e},ec,r)}async callTool(e,r=Gs,n){if(this.isToolTaskRequired(e.name))throw new pe(we.InvalidRequest,`Tool "${e.name}" requires task-based execution. Use client.experimental.tasks.callToolStream() instead.`);let o=await this.request({method:"tools/call",params:e},r,n),i=this.getToolOutputValidator(e.name);if(i){if(!o.structuredContent&&!o.isError)throw new pe(we.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`);if(o.structuredContent)try{let s=i(o.structuredContent);if(!s.valid)throw new pe(we.InvalidParams,`Structured content does not match the tool's output schema: ${s.errorMessage}`)}catch(s){throw s instanceof pe?s:new pe(we.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return o}isToolTask(e){return this._serverCapabilities?.tasks?.requests?.tools?.call?this._cachedKnownTaskTools.has(e):!1}isToolTaskRequired(e){return this._cachedRequiredTaskTools.has(e)}cacheToolMetadata(e){this._cachedToolOutputValidators.clear(),this._cachedKnownTaskTools.clear(),this._cachedRequiredTaskTools.clear();for(let r of e){if(r.outputSchema){let o=this._jsonSchemaValidator.getValidator(r.outputSchema);this._cachedToolOutputValidators.set(r.name,o)}let n=r.execution?.taskSupport;(n==="required"||n==="optional")&&this._cachedKnownTaskTools.add(r.name),n==="required"&&this._cachedRequiredTaskTools.add(r.name)}}getToolOutputValidator(e){return this._cachedToolOutputValidators.get(e)}async listTools(e,r){let n=await this.request({method:"tools/list",params:e},Tm,r);return this.cacheToolMetadata(n.tools),n}_setupListChangedHandler(e,r,n,o){let i=oB.safeParse(n);if(!i.success)throw new Error(`Invalid ${e} listChanged options: ${i.error.message}`);if(typeof n.onChanged!="function")throw new Error(`Invalid ${e} listChanged options: onChanged must be a function`);let{autoRefresh:s,debounceMs:a}=i.data,{onChanged:c}=n,u=async()=>{if(!s){c(null,null);return}try{let d=await o();c(null,d)}catch(d){let p=d instanceof Error?d:new Error(String(d));c(p,null)}},l=()=>{if(a){let d=this._listChangedDebounceTimers.get(e);d&&clearTimeout(d);let p=setTimeout(u,a);this._listChangedDebounceTimers.set(e,p)}else u()};this.setNotificationHandler(r,l)}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}});var kF=g((fCe,SF)=>{SF.exports=xF;xF.sync=$le;var bF=require("fs");function kle(t,e){var r=e.pathExt!==void 0?e.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var n=0;n<r.length;n++){var o=r[n].toLowerCase();if(o&&t.substr(-o.length).toLowerCase()===o)return!0}return!1}function wF(t,e,r){return!t.isSymbolicLink()&&!t.isFile()?!1:kle(e,r)}function xF(t,e,r){bF.stat(t,function(n,o){r(n,n?!1:wF(o,t,e))})}function $le(t,e){return wF(bF.statSync(t),t,e)}});var TF=g((mCe,CF)=>{CF.exports=AF;AF.sync=Ale;var $F=require("fs");function AF(t,e,r){$F.stat(t,function(n,o){r(n,n?!1:PF(o,e))})}function Ale(t,e){return PF($F.statSync(t),e)}function PF(t,e){return t.isFile()&&Ple(t,e)}function Ple(t,e){var r=t.mode,n=t.uid,o=t.gid,i=e.uid!==void 0?e.uid:process.getuid&&process.getuid(),s=e.gid!==void 0?e.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),u=parseInt("001",8),l=a|c,d=r&u||r&c&&o===s||r&a&&n===i||r&l&&i===0;return d}});var EF=g((gCe,IF)=>{var hCe=require("fs"),lw;process.platform==="win32"||global.TESTING_WINDOWS?lw=kF():lw=TF();IF.exports=RO;RO.sync=Cle;function RO(t,e,r){if(typeof e=="function"&&(r=e,e={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(n,o){RO(t,e||{},function(i,s){i?o(i):n(s)})})}lw(t,e||{},function(n,o){n&&(n.code==="EACCES"||e&&e.ignoreErrors)&&(n=null,o=!1),r(n,o)})}function Cle(t,e){try{return lw.sync(t,e||{})}catch(r){if(e&&e.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var DF=g((yCe,MF)=>{var cd=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",OF=require("path"),Tle=cd?";":":",jF=EF(),NF=t=>Object.assign(new Error(`not found: ${t}`),{code:"ENOENT"}),zF=(t,e)=>{let r=e.colon||Tle,n=t.match(/\//)||cd&&t.match(/\\/)?[""]:[...cd?[process.cwd()]:[],...(e.path||process.env.PATH||"").split(r)],o=cd?e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",i=cd?o.split(r):[""];return cd&&t.indexOf(".")!==-1&&i[0]!==""&&i.unshift(""),{pathEnv:n,pathExt:i,pathExtExe:o}},RF=(t,e,r)=>{typeof e=="function"&&(r=e,e={}),e||(e={});let{pathEnv:n,pathExt:o,pathExtExe:i}=zF(t,e),s=[],a=u=>new Promise((l,d)=>{if(u===n.length)return e.all&&s.length?l(s):d(NF(t));let p=n[u],f=/^".*"$/.test(p)?p.slice(1,-1):p,h=OF.join(f,t),m=!f&&/^\.[\\\/]/.test(t)?t.slice(0,2)+h:h;l(c(m,u,0))}),c=(u,l,d)=>new Promise((p,f)=>{if(d===o.length)return p(a(l+1));let h=o[d];jF(u+h,{pathExt:i},(m,y)=>{if(!m&&y)if(e.all)s.push(u+h);else return p(u+h);return p(c(u,l,d+1))})});return r?a(0).then(u=>r(null,u),r):a(0)},Ile=(t,e)=>{e=e||{};let{pathEnv:r,pathExt:n,pathExtExe:o}=zF(t,e),i=[];for(let s=0;s<r.length;s++){let a=r[s],c=/^".*"$/.test(a)?a.slice(1,-1):a,u=OF.join(c,t),l=!c&&/^\.[\\\/]/.test(t)?t.slice(0,2)+u:u;for(let d=0;d<n.length;d++){let p=l+n[d];try{if(jF.sync(p,{pathExt:o}))if(e.all)i.push(p);else return p}catch{}}}if(e.all&&i.length)return i;if(e.nothrow)return null;throw NF(t)};MF.exports=RF;RF.sync=Ile});var UF=g((vCe,MO)=>{"use strict";var qF=(t={})=>{let e=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(e).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};MO.exports=qF;MO.exports.default=qF});var VF=g((_Ce,ZF)=>{"use strict";var BF=require("path"),Ele=DF(),Ole=UF();function LF(t,e){let r=t.options.env||process.env,n=process.cwd(),o=t.options.cwd!=null,i=o&&process.chdir!==void 0&&!process.chdir.disabled;if(i)try{process.chdir(t.options.cwd)}catch{}let s;try{s=Ele.sync(t.command,{path:r[Ole({env:r})],pathExt:e?BF.delimiter:void 0})}catch{}finally{i&&process.chdir(n)}return s&&(s=BF.resolve(o?t.options.cwd:"",s)),s}function jle(t){return LF(t)||LF(t,!0)}ZF.exports=jle});var FF=g((bCe,qO)=>{"use strict";var DO=/([()\][%!^"`<>&|;, *?])/g;function Nle(t){return t=t.replace(DO,"^$1"),t}function zle(t,e){return t=`${t}`,t=t.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),t=t.replace(/(?=(\\+?)?)\1$/,"$1$1"),t=`"${t}"`,t=t.replace(DO,"^$1"),e&&(t=t.replace(DO,"^$1")),t}qO.exports.command=Nle;qO.exports.argument=zle});var KF=g((wCe,HF)=>{"use strict";HF.exports=/^#!(.*)/});var GF=g((xCe,WF)=>{"use strict";var Rle=KF();WF.exports=(t="")=>{let e=t.match(Rle);if(!e)return null;let[r,n]=e[0].replace(/#! ?/,"").split(" "),o=r.split("/").pop();return o==="env"?n:n?`${o} ${n}`:o}});var XF=g((SCe,JF)=>{"use strict";var UO=require("fs"),Mle=GF();function Dle(t){let r=Buffer.alloc(150),n;try{n=UO.openSync(t,"r"),UO.readSync(n,r,0,150,0),UO.closeSync(n)}catch{}return Mle(r.toString())}JF.exports=Dle});var t9=g((kCe,e9)=>{"use strict";var qle=require("path"),YF=VF(),QF=FF(),Ule=XF(),Ble=process.platform==="win32",Lle=/\.(?:com|exe)$/i,Zle=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function Vle(t){t.file=YF(t);let e=t.file&&Ule(t.file);return e?(t.args.unshift(t.file),t.command=e,YF(t)):t.file}function Fle(t){if(!Ble)return t;let e=Vle(t),r=!Lle.test(e);if(t.options.forceShell||r){let n=Zle.test(e);t.command=qle.normalize(t.command),t.command=QF.command(t.command),t.args=t.args.map(i=>QF.argument(i,n));let o=[t.command].concat(t.args).join(" ");t.args=["/d","/s","/c",`"${o}"`],t.command=process.env.comspec||"cmd.exe",t.options.windowsVerbatimArguments=!0}return t}function Hle(t,e,r){e&&!Array.isArray(e)&&(r=e,e=null),e=e?e.slice(0):[],r=Object.assign({},r);let n={command:t,args:e,options:r,file:void 0,original:{command:t,args:e}};return r.shell?n:Fle(n)}e9.exports=Hle});var o9=g(($Ce,n9)=>{"use strict";var BO=process.platform==="win32";function LO(t,e){return Object.assign(new Error(`${e} ${t.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${e} ${t.command}`,path:t.command,spawnargs:t.args})}function Kle(t,e){if(!BO)return;let r=t.emit;t.emit=function(n,o){if(n==="exit"){let i=r9(o,e);if(i)return r.call(t,"error",i)}return r.apply(t,arguments)}}function r9(t,e){return BO&&t===1&&!e.file?LO(e.original,"spawn"):null}function Wle(t,e){return BO&&t===1&&!e.file?LO(e.original,"spawnSync"):null}n9.exports={hookChildProcess:Kle,verifyENOENT:r9,verifyENOENTSync:Wle,notFoundError:LO}});var a9=g((ACe,ud)=>{"use strict";var i9=require("child_process"),ZO=t9(),VO=o9();function s9(t,e,r){let n=ZO(t,e,r),o=i9.spawn(n.command,n.args,n.options);return VO.hookChildProcess(o,n),o}function Gle(t,e,r){let n=ZO(t,e,r),o=i9.spawnSync(n.command,n.args,n.options);return o.error=o.error||VO.verifyENOENTSync(o.status,n),o}ud.exports=s9;ud.exports.spawn=s9;ud.exports.sync=Gle;ud.exports._parse=ZO;ud.exports._enoent=VO});function Jle(t){return Ib.parse(JSON.parse(t))}function c9(t){return JSON.stringify(t)+`
`}var dw,u9=A(()=>{Js();dw=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),Jle(r)}clear(){this._buffer=void 0}}});function Yle(){let t={};for(let e of Xle){let r=Nh.default.env[e];r!==void 0&&(r.startsWith("()")||(t[e]=r))}return t}function Qle(){return"type"in Nh.default}var l9,Nh,d9,Xle,pw,p9=A(()=>{l9=It(a9(),1),Nh=It(require("node:process"),1),d9=require("node:stream");u9();Xle=Nh.default.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];pw=class{constructor(e){this._readBuffer=new dw,this._stderrStream=null,this._serverParams=e,(e.stderr==="pipe"||e.stderr==="overlapped")&&(this._stderrStream=new d9.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,r)=>{this._process=(0,l9.default)(this._serverParams.command,this._serverParams.args??[],{env:{...Yle(),...this._serverParams.env},stdio:["pipe","pipe",this._serverParams.stderr??"inherit"],shell:!1,windowsHide:Nh.default.platform==="win32"&&Qle(),cwd:this._serverParams.cwd}),this._process.on("error",n=>{r(n),this.onerror?.(n)}),this._process.on("spawn",()=>{e()}),this._process.on("close",n=>{this._process=void 0,this.onclose?.()}),this._process.stdin?.on("error",n=>{this.onerror?.(n)}),this._process.stdout?.on("data",n=>{this._readBuffer.append(n),this.processReadBuffer()}),this._process.stdout?.on("error",n=>{this.onerror?.(n)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){return this._stderrStream?this._stderrStream:this._process?.stderr??null}get pid(){return this._process?.pid??null}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){if(this._process){let e=this._process;this._process=void 0;let r=new Promise(n=>{e.once("close",()=>{n()})});try{e.stdin?.end()}catch{}if(await Promise.race([r,new Promise(n=>setTimeout(n,2e3).unref())]),e.exitCode===null){try{e.kill("SIGTERM")}catch{}await Promise.race([r,new Promise(n=>setTimeout(n,2e3).unref())])}if(e.exitCode===null)try{e.kill("SIGKILL")}catch{}}this._readBuffer.clear()}send(e){return new Promise(r=>{if(!this._process?.stdin)throw new Error("Not connected");let n=c9(e);this._process.stdin.write(n)?r():this._process.stdin.once("drain",r)})}}});function FO(t){}function f9(t){if(typeof t=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=FO,onError:r=FO,onRetry:n=FO,onComment:o}=t,i="",s=!0,a,c="",u="";function l(m){let y=s?m.replace(/^\xEF\xBB\xBF/,""):m,[v,b]=ede(`${i}${y}`);for(let x of v)d(x);i=b,s=!1}function d(m){if(m===""){f();return}if(m.startsWith(":")){o&&o(m.slice(m.startsWith(": ")?2:1));return}let y=m.indexOf(":");if(y!==-1){let v=m.slice(0,y),b=m[y+1]===" "?2:1,x=m.slice(y+b);p(v,x,m);return}p(m,"",m)}function p(m,y,v){switch(m){case"event":u=y;break;case"data":c=`${c}${y}
`;break;case"id":a=y.includes("\0")?void 0:y;break;case"retry":/^\d+$/.test(y)?n(parseInt(y,10)):r(new fw(`Invalid \`retry\` value: "${y}"`,{type:"invalid-retry",value:y,line:v}));break;default:r(new fw(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:y,line:v}));break}}function f(){c.length>0&&e({id:a,event:u||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),a=void 0,c="",u=""}function h(m={}){i&&m.consume&&d(i),s=!0,a=void 0,c="",u="",i=""}return{feed:l,reset:h}}function ede(t){let e=[],r="",n=0;for(;n<t.length;){let o=t.indexOf("\r",n),i=t.indexOf(`
`,n),s=-1;if(o!==-1&&i!==-1?s=Math.min(o,i):o!==-1?o===t.length-1?s=-1:s=o:i!==-1&&(s=i),s===-1){r=t.slice(n);break}else{let a=t.slice(n,s);e.push(a),n=s+1,t[n-1]==="\r"&&t[n]===`
`&&n++}}return[e,r]}var fw,m9=A(()=>{fw=class extends Error{constructor(e,r){super(e),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}});function tde(t){let e=globalThis.DOMException;return typeof e=="function"?new e(t,"SyntaxError"):new SyntaxError(t)}function HO(t){return t instanceof Error?"errors"in t&&Array.isArray(t.errors)?t.errors.map(HO).join(", "):"cause"in t&&t.cause instanceof Error?`${t}: ${HO(t.cause)}`:t.message:`${t}`}function h9(t){return{type:t.type,message:t.message,code:t.code,defaultPrevented:t.defaultPrevented,cancelable:t.cancelable,timeStamp:t.timeStamp}}function rde(){let t="document"in globalThis?globalThis.document:void 0;return t&&typeof t=="object"&&"baseURI"in t&&typeof t.baseURI=="string"?t.baseURI:void 0}var hw,y9,ej,Ze,vr,Ht,us,kn,xc,ld,mw,gw,Mh,fd,Dh,ma,dd,md,pd,zh,Vo,KO,WO,GO,g9,JO,XO,Rh,YO,QO,Sc,v9=A(()=>{m9();hw=class extends Event{constructor(e,r){var n,o;super(e),this.code=(n=r?.code)!=null?n:void 0,this.message=(o=r?.message)!=null?o:void 0}[Symbol.for("nodejs.util.inspect.custom")](e,r,n){return n(h9(this),r)}[Symbol.for("Deno.customInspect")](e,r){return e(h9(this),r)}};y9=t=>{throw TypeError(t)},ej=(t,e,r)=>e.has(t)||y9("Cannot "+r),Ze=(t,e,r)=>(ej(t,e,"read from private field"),r?r.call(t):e.get(t)),vr=(t,e,r)=>e.has(t)?y9("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Ht=(t,e,r,n)=>(ej(t,e,"write to private field"),e.set(t,r),r),us=(t,e,r)=>(ej(t,e,"access private method"),r),Sc=class extends EventTarget{constructor(e,r){var n,o;super(),vr(this,Vo),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,vr(this,kn),vr(this,xc),vr(this,ld),vr(this,mw),vr(this,gw),vr(this,Mh),vr(this,fd),vr(this,Dh,null),vr(this,ma),vr(this,dd),vr(this,md,null),vr(this,pd,null),vr(this,zh,null),vr(this,WO,async i=>{var s;Ze(this,dd).reset();let{body:a,redirected:c,status:u,headers:l}=i;if(u===204){us(this,Vo,Rh).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(c?Ht(this,ld,new URL(i.url)):Ht(this,ld,void 0),u!==200){us(this,Vo,Rh).call(this,`Non-200 status code (${u})`,u);return}if(!(l.get("content-type")||"").startsWith("text/event-stream")){us(this,Vo,Rh).call(this,'Invalid content type, expected "text/event-stream"',u);return}if(Ze(this,kn)===this.CLOSED)return;Ht(this,kn,this.OPEN);let d=new Event("open");if((s=Ze(this,zh))==null||s.call(this,d),this.dispatchEvent(d),typeof a!="object"||!a||!("getReader"in a)){us(this,Vo,Rh).call(this,"Invalid response body, expected a web ReadableStream",u),this.close();return}let p=new TextDecoder,f=a.getReader(),h=!0;do{let{done:m,value:y}=await f.read();y&&Ze(this,dd).feed(p.decode(y,{stream:!m})),m&&(h=!1,Ze(this,dd).reset(),us(this,Vo,YO).call(this))}while(h)}),vr(this,GO,i=>{Ht(this,ma,void 0),!(i.name==="AbortError"||i.type==="aborted")&&us(this,Vo,YO).call(this,HO(i))}),vr(this,JO,i=>{typeof i.id=="string"&&Ht(this,Dh,i.id);let s=new MessageEvent(i.event||"message",{data:i.data,origin:Ze(this,ld)?Ze(this,ld).origin:Ze(this,xc).origin,lastEventId:i.id||""});Ze(this,pd)&&(!i.event||i.event==="message")&&Ze(this,pd).call(this,s),this.dispatchEvent(s)}),vr(this,XO,i=>{Ht(this,Mh,i)}),vr(this,QO,()=>{Ht(this,fd,void 0),Ze(this,kn)===this.CONNECTING&&us(this,Vo,KO).call(this)});try{if(e instanceof URL)Ht(this,xc,e);else if(typeof e=="string")Ht(this,xc,new URL(e,rde()));else throw new Error("Invalid URL")}catch{throw tde("An invalid or illegal string was specified")}Ht(this,dd,f9({onEvent:Ze(this,JO),onRetry:Ze(this,XO)})),Ht(this,kn,this.CONNECTING),Ht(this,Mh,3e3),Ht(this,gw,(n=r?.fetch)!=null?n:globalThis.fetch),Ht(this,mw,(o=r?.withCredentials)!=null?o:!1),us(this,Vo,KO).call(this)}get readyState(){return Ze(this,kn)}get url(){return Ze(this,xc).href}get withCredentials(){return Ze(this,mw)}get onerror(){return Ze(this,md)}set onerror(e){Ht(this,md,e)}get onmessage(){return Ze(this,pd)}set onmessage(e){Ht(this,pd,e)}get onopen(){return Ze(this,zh)}set onopen(e){Ht(this,zh,e)}addEventListener(e,r,n){let o=r;super.addEventListener(e,o,n)}removeEventListener(e,r,n){let o=r;super.removeEventListener(e,o,n)}close(){Ze(this,fd)&&clearTimeout(Ze(this,fd)),Ze(this,kn)!==this.CLOSED&&(Ze(this,ma)&&Ze(this,ma).abort(),Ht(this,kn,this.CLOSED),Ht(this,ma,void 0))}};kn=new WeakMap,xc=new WeakMap,ld=new WeakMap,mw=new WeakMap,gw=new WeakMap,Mh=new WeakMap,fd=new WeakMap,Dh=new WeakMap,ma=new WeakMap,dd=new WeakMap,md=new WeakMap,pd=new WeakMap,zh=new WeakMap,Vo=new WeakSet,KO=function(){Ht(this,kn,this.CONNECTING),Ht(this,ma,new AbortController),Ze(this,gw)(Ze(this,xc),us(this,Vo,g9).call(this)).then(Ze(this,WO)).catch(Ze(this,GO))},WO=new WeakMap,GO=new WeakMap,g9=function(){var t;let e={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...Ze(this,Dh)?{"Last-Event-ID":Ze(this,Dh)}:void 0},cache:"no-store",signal:(t=Ze(this,ma))==null?void 0:t.signal};return"window"in globalThis&&(e.credentials=this.withCredentials?"include":"same-origin"),e},JO=new WeakMap,XO=new WeakMap,Rh=function(t,e){var r;Ze(this,kn)!==this.CLOSED&&Ht(this,kn,this.CLOSED);let n=new hw("error",{code:e,message:t});(r=Ze(this,md))==null||r.call(this,n),this.dispatchEvent(n)},YO=function(t,e){var r;if(Ze(this,kn)===this.CLOSED)return;Ht(this,kn,this.CONNECTING);let n=new hw("error",{code:e,message:t});(r=Ze(this,md))==null||r.call(this,n),this.dispatchEvent(n),Ht(this,fd,setTimeout(Ze(this,QO),Ze(this,Mh)))},QO=new WeakMap,Sc.CONNECTING=0,Sc.OPEN=1,Sc.CLOSED=2});function yw(t){return t?t instanceof Headers?Object.fromEntries(t.entries()):Array.isArray(t)?Object.fromEntries(t):{...t}:{}}function _9(t=fetch,e){return e?async(r,n)=>{let o={...e,...n,headers:n?.headers?{...yw(e.headers),...yw(n.headers)}:e.headers};return t(r,o)}:t}var b9=A(()=>{});async function nde(t){return(await tj).getRandomValues(new Uint8Array(t))}async function ode(t){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~",r=Math.pow(2,8)-Math.pow(2,8)%e.length,n="";for(;n.length<t;){let o=await nde(t-n.length);for(let i of o)i<r&&(n+=e[i%e.length])}return n}async function ide(t){return await ode(t)}async function sde(t){let e=await(await tj).subtle.digest("SHA-256",new TextEncoder().encode(t));return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function rj(t){if(t||(t=43),t<43||t>128)throw`Expected a length between 43 and 128. Received ${t}.`;let e=await ide(t),r=await sde(e);return{code_verifier:e,code_challenge:r}}var tj,w9=A(()=>{tj=globalThis.crypto?.webcrypto??globalThis.crypto??import("node:crypto").then(t=>t.webcrypto)});var Dr,S9,nj,ade,k9,$9,A9,x9,cde,ude,P9,RCe,MCe,oj=A(()=>{lC();Dr=M1().superRefine((t,e)=>{if(!URL.canParse(t))return e.addIssue({code:DU.custom,message:"URL must be parseable",fatal:!0}),__}).refine(t=>{let e=new URL(t);return e.protocol!=="javascript:"&&e.protocol!=="data:"&&e.protocol!=="vbscript:"},{message:"URL cannot use javascript:, data:, or vbscript: scheme"}),S9=dr({resource:_().url(),authorization_servers:V(Dr).optional(),jwks_uri:_().url().optional(),scopes_supported:V(_()).optional(),bearer_methods_supported:V(_()).optional(),resource_signing_alg_values_supported:V(_()).optional(),resource_name:_().optional(),resource_documentation:_().optional(),resource_policy_uri:_().url().optional(),resource_tos_uri:_().url().optional(),tls_client_certificate_bound_access_tokens:lt().optional(),authorization_details_types_supported:V(_()).optional(),dpop_signing_alg_values_supported:V(_()).optional(),dpop_bound_access_tokens_required:lt().optional()}),nj=dr({issuer:_(),authorization_endpoint:Dr,token_endpoint:Dr,registration_endpoint:Dr.optional(),scopes_supported:V(_()).optional(),response_types_supported:V(_()),response_modes_supported:V(_()).optional(),grant_types_supported:V(_()).optional(),token_endpoint_auth_methods_supported:V(_()).optional(),token_endpoint_auth_signing_alg_values_supported:V(_()).optional(),service_documentation:Dr.optional(),revocation_endpoint:Dr.optional(),revocation_endpoint_auth_methods_supported:V(_()).optional(),revocation_endpoint_auth_signing_alg_values_supported:V(_()).optional(),introspection_endpoint:_().optional(),introspection_endpoint_auth_methods_supported:V(_()).optional(),introspection_endpoint_auth_signing_alg_values_supported:V(_()).optional(),code_challenge_methods_supported:V(_()).optional(),client_id_metadata_document_supported:lt().optional()}),ade=dr({issuer:_(),authorization_endpoint:Dr,token_endpoint:Dr,userinfo_endpoint:Dr.optional(),jwks_uri:Dr,registration_endpoint:Dr.optional(),scopes_supported:V(_()).optional(),response_types_supported:V(_()),response_modes_supported:V(_()).optional(),grant_types_supported:V(_()).optional(),acr_values_supported:V(_()).optional(),subject_types_supported:V(_()),id_token_signing_alg_values_supported:V(_()),id_token_encryption_alg_values_supported:V(_()).optional(),id_token_encryption_enc_values_supported:V(_()).optional(),userinfo_signing_alg_values_supported:V(_()).optional(),userinfo_encryption_alg_values_supported:V(_()).optional(),userinfo_encryption_enc_values_supported:V(_()).optional(),request_object_signing_alg_values_supported:V(_()).optional(),request_object_encryption_alg_values_supported:V(_()).optional(),request_object_encryption_enc_values_supported:V(_()).optional(),token_endpoint_auth_methods_supported:V(_()).optional(),token_endpoint_auth_signing_alg_values_supported:V(_()).optional(),display_values_supported:V(_()).optional(),claim_types_supported:V(_()).optional(),claims_supported:V(_()).optional(),service_documentation:_().optional(),claims_locales_supported:V(_()).optional(),ui_locales_supported:V(_()).optional(),claims_parameter_supported:lt().optional(),request_parameter_supported:lt().optional(),request_uri_parameter_supported:lt().optional(),require_request_uri_registration:lt().optional(),op_policy_uri:Dr.optional(),op_tos_uri:Dr.optional(),client_id_metadata_document_supported:lt().optional()}),k9=H({...ade.shape,...nj.pick({code_challenge_methods_supported:!0}).shape}),$9=H({access_token:_(),id_token:_().optional(),token_type:_(),expires_in:Ab.number().optional(),scope:_().optional(),refresh_token:_().optional()}).strip(),A9=H({error:_(),error_description:_().optional(),error_uri:_().optional()}),x9=Dr.optional().or(ie("").transform(()=>{})),cde=H({redirect_uris:V(Dr),token_endpoint_auth_method:_().optional(),grant_types:V(_()).optional(),response_types:V(_()).optional(),client_name:_().optional(),client_uri:Dr.optional(),logo_uri:x9,scope:_().optional(),contacts:V(_()).optional(),tos_uri:x9,policy_uri:_().optional(),jwks_uri:Dr.optional(),jwks:eC().optional(),software_id:_().optional(),software_version:_().optional(),software_statement:_().optional()}).strip(),ude=H({client_id:_(),client_secret:_().optional(),client_id_issued_at:Xe().optional(),client_secret_expires_at:Xe().optional()}).strip(),P9=cde.merge(ude),RCe=H({error:_(),error_description:_().optional()}).strip(),MCe=H({token:_(),token_type_hint:_().optional()}).strip()});function C9(t){let e=typeof t=="string"?new URL(t):new URL(t.href);return e.hash="",e}function T9({requestedResource:t,configuredResource:e}){let r=typeof t=="string"?new URL(t):new URL(t.href),n=typeof e=="string"?new URL(e):new URL(e.href);if(r.origin!==n.origin||r.pathname.length<n.pathname.length)return!1;let o=r.pathname.endsWith("/")?r.pathname:r.pathname+"/",i=n.pathname.endsWith("/")?n.pathname:n.pathname+"/";return o.startsWith(i)}var I9=A(()=>{});var cr,qh,kc,$c,Ac,Uh,Bh,Lh,ls,Zh,Vh,Fh,Hh,Kh,Wh,Pc,Gh,Jh,E9,O9=A(()=>{cr=class extends Error{constructor(e,r){super(e),this.errorUri=r,this.name=this.constructor.name}toResponseObject(){let e={error:this.errorCode,error_description:this.message};return this.errorUri&&(e.error_uri=this.errorUri),e}get errorCode(){return this.constructor.errorCode}},qh=class extends cr{};qh.errorCode="invalid_request";kc=class extends cr{};kc.errorCode="invalid_client";$c=class extends cr{};$c.errorCode="invalid_grant";Ac=class extends cr{};Ac.errorCode="unauthorized_client";Uh=class extends cr{};Uh.errorCode="unsupported_grant_type";Bh=class extends cr{};Bh.errorCode="invalid_scope";Lh=class extends cr{};Lh.errorCode="access_denied";ls=class extends cr{};ls.errorCode="server_error";Zh=class extends cr{};Zh.errorCode="temporarily_unavailable";Vh=class extends cr{};Vh.errorCode="unsupported_response_type";Fh=class extends cr{};Fh.errorCode="unsupported_token_type";Hh=class extends cr{};Hh.errorCode="invalid_token";Kh=class extends cr{};Kh.errorCode="method_not_allowed";Wh=class extends cr{};Wh.errorCode="too_many_requests";Pc=class extends cr{};Pc.errorCode="invalid_client_metadata";Gh=class extends cr{};Gh.errorCode="insufficient_scope";Jh=class extends cr{};Jh.errorCode="invalid_target";E9={[qh.errorCode]:qh,[kc.errorCode]:kc,[$c.errorCode]:$c,[Ac.errorCode]:Ac,[Uh.errorCode]:Uh,[Bh.errorCode]:Bh,[Lh.errorCode]:Lh,[ls.errorCode]:ls,[Zh.errorCode]:Zh,[Vh.errorCode]:Vh,[Fh.errorCode]:Fh,[Hh.errorCode]:Hh,[Kh.errorCode]:Kh,[Wh.errorCode]:Wh,[Pc.errorCode]:Pc,[Gh.errorCode]:Gh,[Jh.errorCode]:Jh}});function lde(t){return["client_secret_basic","client_secret_post","none"].includes(t)}function dde(t,e){let r=t.client_secret!==void 0;return e.length===0?r?"client_secret_post":"none":"token_endpoint_auth_method"in t&&t.token_endpoint_auth_method&&lde(t.token_endpoint_auth_method)&&e.includes(t.token_endpoint_auth_method)?t.token_endpoint_auth_method:r&&e.includes("client_secret_basic")?"client_secret_basic":r&&e.includes("client_secret_post")?"client_secret_post":e.includes("none")?"none":r?"client_secret_post":"none"}function pde(t,e,r,n){let{client_id:o,client_secret:i}=e;switch(t){case"client_secret_basic":fde(o,i,r);return;case"client_secret_post":mde(o,i,n);return;case"none":hde(o,n);return;default:throw new Error(`Unsupported client authentication method: ${t}`)}}function fde(t,e,r){if(!e)throw new Error("client_secret_basic authentication requires a client_secret");let n=btoa(`${t}:${e}`);r.set("Authorization",`Basic ${n}`)}function mde(t,e,r){r.set("client_id",t),e&&r.set("client_secret",e)}function hde(t,e){e.set("client_id",t)}async function N9(t){let e=t instanceof Response?t.status:void 0,r=t instanceof Response?await t.text():t;try{let n=A9.parse(JSON.parse(r)),{error:o,error_description:i,error_uri:s}=n,a=E9[o]||ls;return new a(i||"",s)}catch(n){let o=`${e?`HTTP ${e}: `:""}Invalid OAuth error response: ${n}. Raw body: ${r}`;return new ls(o)}}async function vw(t,e){try{return await aj(t,e)}catch(r){if(r instanceof kc||r instanceof Ac)return await t.invalidateCredentials?.("all"),await aj(t,e);if(r instanceof $c)return await t.invalidateCredentials?.("tokens"),await aj(t,e);throw r}}async function aj(t,{serverUrl:e,authorizationCode:r,scope:n,resourceMetadataUrl:o,fetchFn:i}){let s,a;try{s=await vde(e,{resourceMetadataUrl:o},i),s.authorization_servers&&s.authorization_servers.length>0&&(a=s.authorization_servers[0])}catch{}a||(a=new URL("/",e));let c=await yde(e,t,s),u=await Sde(a,{fetchFn:i}),l=await Promise.resolve(t.clientInformation());if(!l){if(r!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");let y=u?.client_id_metadata_document_supported===!0,v=t.clientMetadataUrl;if(v&&!gde(v))throw new Pc(`clientMetadataUrl must be a valid HTTPS URL with a non-root pathname, got: ${v}`);if(y&&v)l={client_id:v},await t.saveClientInformation?.(l);else{if(!t.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");let x=await Cde(a,{metadata:u,clientMetadata:t.clientMetadata,fetchFn:i});await t.saveClientInformation(x),l=x}}let d=!t.redirectUrl;if(r!==void 0||d){let y=await Pde(t,a,{metadata:u,resource:c,authorizationCode:r,fetchFn:i});return await t.saveTokens(y),"AUTHORIZED"}let p=await t.tokens();if(p?.refresh_token)try{let y=await Ade(a,{metadata:u,clientInformation:l,refreshToken:p.refresh_token,resource:c,addClientAuthentication:t.addClientAuthentication,fetchFn:i});return await t.saveTokens(y),"AUTHORIZED"}catch(y){if(!(!(y instanceof cr)||y instanceof ls))throw y}let f=t.state?await t.state():void 0,{authorizationUrl:h,codeVerifier:m}=await kde(a,{metadata:u,clientInformation:l,state:f,redirectUrl:t.redirectUrl,scope:n||s?.scopes_supported?.join(" ")||t.clientMetadata.scope,resource:c});return await t.saveCodeVerifier(m),await t.redirectToAuthorization(h),"REDIRECT"}function gde(t){if(!t)return!1;try{let e=new URL(t);return e.protocol==="https:"&&e.pathname!=="/"}catch{return!1}}async function yde(t,e,r){let n=C9(t);if(e.validateResourceURL)return await e.validateResourceURL(n,r?.resource);if(r){if(!T9({requestedResource:n,configuredResource:r.resource}))throw new Error(`Protected resource ${r.resource} does not match expected ${n} (or origin)`);return new URL(r.resource)}}function uj(t){let e=t.headers.get("WWW-Authenticate");if(!e)return{};let[r,n]=e.split(" ");if(r.toLowerCase()!=="bearer"||!n)return{};let o=cj(t,"resource_metadata")||void 0,i;if(o)try{i=new URL(o)}catch{}let s=cj(t,"scope")||void 0,a=cj(t,"error")||void 0;return{resourceMetadataUrl:i,scope:s,error:a}}function cj(t,e){let r=t.headers.get("WWW-Authenticate");if(!r)return null;let n=new RegExp(`${e}=(?:"([^"]+)"|([^\\s,]+))`),o=r.match(n);return o?o[1]||o[2]:null}async function vde(t,e,r=fetch){let n=await wde(t,"oauth-protected-resource",r,{protocolVersion:e?.protocolVersion,metadataUrl:e?.resourceMetadataUrl});if(!n||n.status===404)throw await n?.body?.cancel(),new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!n.ok)throw await n.body?.cancel(),new Error(`HTTP ${n.status} trying to load well-known OAuth protected resource metadata.`);return S9.parse(await n.json())}async function lj(t,e,r=fetch){try{return await r(t,{headers:e})}catch(n){if(n instanceof TypeError)return e?lj(t,void 0,r):void 0;throw n}}function _de(t,e="",r={}){return e.endsWith("/")&&(e=e.slice(0,-1)),r.prependPathname?`${e}/.well-known/${t}`:`/.well-known/${t}${e}`}async function j9(t,e,r=fetch){return await lj(t,{"MCP-Protocol-Version":e},r)}function bde(t,e){return!t||t.status>=400&&t.status<500&&e!=="/"}async function wde(t,e,r,n){let o=new URL(t),i=n?.protocolVersion??Il,s;if(n?.metadataUrl)s=new URL(n.metadataUrl);else{let c=_de(e,o.pathname);s=new URL(c,n?.metadataServerUrl??o),s.search=o.search}let a=await j9(s,i,r);if(!n?.metadataUrl&&bde(a,o.pathname)){let c=new URL(`/.well-known/${e}`,o);a=await j9(c,i,r)}return a}function xde(t){let e=typeof t=="string"?new URL(t):t,r=e.pathname!=="/",n=[];if(!r)return n.push({url:new URL("/.well-known/oauth-authorization-server",e.origin),type:"oauth"}),n.push({url:new URL("/.well-known/openid-configuration",e.origin),type:"oidc"}),n;let o=e.pathname;return o.endsWith("/")&&(o=o.slice(0,-1)),n.push({url:new URL(`/.well-known/oauth-authorization-server${o}`,e.origin),type:"oauth"}),n.push({url:new URL(`/.well-known/openid-configuration${o}`,e.origin),type:"oidc"}),n.push({url:new URL(`${o}/.well-known/openid-configuration`,e.origin),type:"oidc"}),n}async function Sde(t,{fetchFn:e=fetch,protocolVersion:r=Il}={}){let n={"MCP-Protocol-Version":r,Accept:"application/json"},o=xde(t);for(let{url:i,type:s}of o){let a=await lj(i,n,e);if(a){if(!a.ok){if(await a.body?.cancel(),a.status>=400&&a.status<500)continue;throw new Error(`HTTP ${a.status} trying to load ${s==="oauth"?"OAuth":"OpenID provider"} metadata from ${i}`)}return s==="oauth"?nj.parse(await a.json()):k9.parse(await a.json())}}}async function kde(t,{metadata:e,clientInformation:r,redirectUrl:n,scope:o,state:i,resource:s}){let a;if(e){if(a=new URL(e.authorization_endpoint),!e.response_types_supported.includes(ij))throw new Error(`Incompatible auth server: does not support response type ${ij}`);if(e.code_challenge_methods_supported&&!e.code_challenge_methods_supported.includes(sj))throw new Error(`Incompatible auth server: does not support code challenge method ${sj}`)}else a=new URL("/authorize",t);let c=await rj(),u=c.code_verifier,l=c.code_challenge;return a.searchParams.set("response_type",ij),a.searchParams.set("client_id",r.client_id),a.searchParams.set("code_challenge",l),a.searchParams.set("code_challenge_method",sj),a.searchParams.set("redirect_uri",String(n)),i&&a.searchParams.set("state",i),o&&a.searchParams.set("scope",o),o?.includes("offline_access")&&a.searchParams.append("prompt","consent"),s&&a.searchParams.set("resource",s.href),{authorizationUrl:a,codeVerifier:u}}function $de(t,e,r){return new URLSearchParams({grant_type:"authorization_code",code:t,code_verifier:e,redirect_uri:String(r)})}async function z9(t,{metadata:e,tokenRequestParams:r,clientInformation:n,addClientAuthentication:o,resource:i,fetchFn:s}){let a=e?.token_endpoint?new URL(e.token_endpoint):new URL("/token",t),c=new Headers({"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"});if(i&&r.set("resource",i.href),o)await o(c,r,a,e);else if(n){let l=e?.token_endpoint_auth_methods_supported??[],d=dde(n,l);pde(d,n,c,r)}let u=await(s??fetch)(a,{method:"POST",headers:c,body:r});if(!u.ok)throw await N9(u);return $9.parse(await u.json())}async function Ade(t,{metadata:e,clientInformation:r,refreshToken:n,resource:o,addClientAuthentication:i,fetchFn:s}){let a=new URLSearchParams({grant_type:"refresh_token",refresh_token:n}),c=await z9(t,{metadata:e,tokenRequestParams:a,clientInformation:r,addClientAuthentication:i,resource:o,fetchFn:s});return{refresh_token:n,...c}}async function Pde(t,e,{metadata:r,resource:n,authorizationCode:o,fetchFn:i}={}){let s=t.clientMetadata.scope,a;if(t.prepareTokenRequest&&(a=await t.prepareTokenRequest(s)),!a){if(!o)throw new Error("Either provider.prepareTokenRequest() or authorizationCode is required");if(!t.redirectUrl)throw new Error("redirectUrl is required for authorization_code flow");let u=await t.codeVerifier();a=$de(o,u,t.redirectUrl)}let c=await t.clientInformation();return z9(e,{metadata:r,tokenRequestParams:a,clientInformation:c??void 0,addClientAuthentication:t.addClientAuthentication,resource:n,fetchFn:i})}async function Cde(t,{metadata:e,clientMetadata:r,fetchFn:n}){let o;if(e){if(!e.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");o=new URL(e.registration_endpoint)}else o=new URL("/register",t);let i=await(n??fetch)(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok)throw await N9(i);return P9.parse(await i.json())}var ha,ij,sj,R9=A(()=>{w9();Js();oj();oj();I9();O9();ha=class extends Error{constructor(e){super(e??"Unauthorized")}};ij="code",sj="S256"});var dj,_w,M9=A(()=>{v9();b9();Js();R9();dj=class extends Error{constructor(e,r,n){super(`SSE error: ${r}`),this.code=e,this.event=n}},_w=class{constructor(e,r){this._url=e,this._resourceMetadataUrl=void 0,this._scope=void 0,this._eventSourceInit=r?.eventSourceInit,this._requestInit=r?.requestInit,this._authProvider=r?.authProvider,this._fetch=r?.fetch,this._fetchWithInit=_9(r?.fetch,r?.requestInit)}async _authThenStart(){if(!this._authProvider)throw new ha("No auth provider");let e;try{e=await vw(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})}catch(r){throw this.onerror?.(r),r}if(e!=="AUTHORIZED")throw new ha;return await this._startOrAuth()}async _commonHeaders(){let e={};if(this._authProvider){let n=await this._authProvider.tokens();n&&(e.Authorization=`Bearer ${n.access_token}`)}this._protocolVersion&&(e["mcp-protocol-version"]=this._protocolVersion);let r=yw(this._requestInit?.headers);return new Headers({...e,...r})}_startOrAuth(){let e=this?._eventSourceInit?.fetch??this._fetch??fetch;return new Promise((r,n)=>{this._eventSource=new Sc(this._url.href,{...this._eventSourceInit,fetch:async(o,i)=>{let s=await this._commonHeaders();s.set("Accept","text/event-stream");let a=await e(o,{...i,headers:s});if(a.status===401&&a.headers.has("www-authenticate")){let{resourceMetadataUrl:c,scope:u}=uj(a);this._resourceMetadataUrl=c,this._scope=u}return a}}),this._abortController=new AbortController,this._eventSource.onerror=o=>{if(o.code===401&&this._authProvider){this._authThenStart().then(r,n);return}let i=new dj(o.code,o.message,o);n(i),this.onerror?.(i)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",o=>{let i=o;try{if(this._endpoint=new URL(i.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(s){n(s),this.onerror?.(s),this.close();return}r()}),this._eventSource.onmessage=o=>{let i=o,s;try{s=Ib.parse(JSON.parse(i.data))}catch(a){this.onerror?.(a);return}this.onmessage?.(s)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(e){if(!this._authProvider)throw new ha("No auth provider");if(await vw(this._authProvider,{serverUrl:this._url,authorizationCode:e,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new ha("Failed to authorize")}async close(){this._abortController?.abort(),this._eventSource?.close(),this.onclose?.()}async send(e){if(!this._endpoint)throw new Error("Not connected");try{let r=await this._commonHeaders();r.set("content-type","application/json");let n={...this._requestInit,method:"POST",headers:r,body:JSON.stringify(e),signal:this._abortController?.signal},o=await(this._fetch??fetch)(this._endpoint,n);if(!o.ok){let i=await o.text().catch(()=>null);if(o.status===401&&this._authProvider){let{resourceMetadataUrl:s,scope:a}=uj(o);if(this._resourceMetadataUrl=s,this._scope=a,await vw(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new ha;return this.send(e)}throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${i}`)}await o.body?.cancel()}catch(r){throw this.onerror?.(r),r}}setProtocolVersion(e){this._protocolVersion=e}}});var St,bw,D9=A(()=>{"use strict";St=It(require("vscode")),bw=class{constructor(){}getTools(){return[{serverName:"vscode",name:"vscode_read_file",description:"Read the contents of a file in the workspace",inputSchema:{type:"object",properties:{uri:{type:"string",description:"The absolute path or URI of the file to read"}},required:["uri"]}},{serverName:"vscode",name:"vscode_list_files",description:"List files in a directory or search for files matching a pattern",inputSchema:{type:"object",properties:{folder:{type:"string",description:"The absolute path of the folder to list (optional)"},pattern:{type:"string",description:'Glob pattern to search for specific files (e.g. "**/*.ts")'}}}},{serverName:"vscode",name:"vscode_open_file",description:"Open a file in the editor",inputSchema:{type:"object",properties:{uri:{type:"string",description:"The absolute path or URI of the file to open"},range:{type:"array",items:{type:"number"},minItems:2,maxItems:2,description:"Line range to select [startLine, endLine] (0-indexed)"}},required:["uri"]}},{serverName:"vscode",name:"vscode_get_diagnostics",description:"Get validation errors, warnings, and information for files",inputSchema:{type:"object",properties:{max:{type:"number",description:"Maximum number of diagnostics to return (default: 50)"}}}},{serverName:"vscode",name:"vscode_get_active_editor",description:"Get information about the currently active text editor",inputSchema:{type:"object",properties:{}}}]}async callTool(e,r){switch(e){case"vscode_read_file":return this.readFile(r.uri);case"vscode_list_files":return this.listFiles(r.folder,r.pattern);case"vscode_open_file":return this.openFile(r.uri,r.range);case"vscode_get_diagnostics":return this.getDiagnostics(r.max);case"vscode_get_active_editor":return this.getActiveEditor();default:throw new Error(`Unknown tool: ${e}`)}}async readFile(e){let r=St.Uri.file(e),n=await St.workspace.openTextDocument(r);return{content:n.getText(),languageId:n.languageId,lineCount:n.lineCount}}async listFiles(e,r){if(r)return{files:(await St.workspace.findFiles(r,null,50)).map(o=>o.fsPath)};if(e){let n=St.Uri.file(e),o=await St.workspace.fs.readDirectory(n);return{folder:e,entries:o.map(([i,s])=>({name:i,type:s===St.FileType.Directory?"directory":"file"}))}}else return St.workspace.workspaceFolders?{workspaceFolders:St.workspace.workspaceFolders.map(n=>n.uri.fsPath)}:{error:"No workspace folders open"}}async openFile(e,r){let n=St.Uri.file(e),o=await St.workspace.openTextDocument(n),i=await St.window.showTextDocument(o);if(r&&r.length===2){let s=new St.Range(r[0],0,r[1],1e3);i.selection=new St.Selection(s.start,s.end),i.revealRange(s,St.TextEditorRevealType.InCenter)}return{success:!0,opened:e}}async getDiagnostics(e=50){let r=St.languages.getDiagnostics(),n=[],o=0;for(let[i,s]of r){if(s.length===0)continue;let a=s.map(c=>({severity:St.DiagnosticSeverity[c.severity],message:c.message,range:{startLine:c.range.start.line,endLine:c.range.end.line},source:c.source,code:c.code}));if(n.push({file:i.fsPath,diagnostics:a}),o+=a.length,o>=e)break}return{diagnostics:n}}async getActiveEditor(){let e=St.window.activeTextEditor;return e?{active:!0,file:e.document.uri.fsPath,languageId:e.document.languageId,cursor:{line:e.selection.active.line,character:e.selection.active.character},selection:e.document.getText(e.selection)||null,preview:e.document.getText(new St.Range(0,0,Math.min(20,e.document.lineCount),0))+`
...`}:{active:!1,reason:"No editor active"}}}});var U9={};To(U9,{McpService:()=>pj});var q9,pj,B9=A(()=>{"use strict";q9=It(require("vscode"));_F();p9();M9();D9();Js();pj=class{constructor(e){this.output=e;this.vscodeTools=new bw}clients=new Map;cachedTools=[];disposables=[];vscodeTools;async initialize(){await this.refreshServers()}async refreshServers(){for(let o of this.clients.values())await o.close();this.clients.clear();let e=q9.workspace.getConfiguration("githubCopilotApi.mcp");if(!e.get("enabled",!0)){this.output.appendLine("[MCP] Disabled in configuration.");return}let n=e.get("servers",{});for(let[o,i]of Object.entries(n))try{await this.connectToServer(o,i)}catch(s){this.output.appendLine(`[MCP] Failed to connect to server "${o}": ${s}`)}this.cachedTools=await this.getAllTools()}getTools(){return this.cachedTools.length===0?this.vscodeTools.getTools():this.cachedTools}getConnectedServers(){return Array.from(this.clients.keys())}async connectToServer(e,r){let n;if(r.url)n=new _w(new URL(r.url));else if(r.command)n=new pw({command:r.command,args:r.args||[],env:this.getCleanEnv(r.env)});else throw new Error(`Invalid configuration for MCP server "${e}"`);let o=new uw({name:"github-copilot-api-gateway",version:"0.0.1"},{capabilities:{}});await o.connect(n),this.clients.set(e,o),this.output.appendLine(`[MCP] Connected to server "${e}"`)}async getAllTools(){let e=[];for(let[r,n]of this.clients.entries())try{let i=(await n.request({method:"tools/list"},Tm)).tools.map(s=>({serverName:r,name:s.name,description:s.description,inputSchema:s.inputSchema}));e.push(...i)}catch(o){this.output.appendLine(`[MCP] Failed to list tools for server "${r}": ${o}`)}return[...e,...this.vscodeTools.getTools()]}async callTool(e,r,n){if(e==="vscode")return this.vscodeTools.callTool(r,n);let o=this.clients.get(e);if(!o)throw new Error(`MCP server "${e}" not found or not connected`);return await o.request({method:"tools/call",params:{name:r,arguments:n}},Gs)}getCleanEnv(e){let r={};for(let[n,o]of Object.entries(process.env))o!==void 0&&(r[n]=o);if(e)for(let[n,o]of Object.entries(e))o!==void 0&&(r[n]=o);return r}dispose(){for(let e of this.clients.values())e.close().catch(r=>{});this.clients.clear();for(let e of this.disposables)e.dispose()}}});var Z9=g(()=>{var L9;(function(t){(function(e){var r=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:a(),n=o(t);typeof r.Reflect<"u"&&(n=o(r.Reflect,n)),e(n,r),typeof r.Reflect>"u"&&(r.Reflect=t);function o(c,u){return function(l,d){Object.defineProperty(c,l,{configurable:!0,writable:!0,value:d}),u&&u(l,d)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return i()||s()}})(function(e,r){var n=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",i=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,u=!a&&!c,l={create:a?function(){return p$(Object.create(null))}:c?function(){return p$({__proto__:null})}:function(){return p$({})},has:u?function(k,T){return n.call(k,T)}:function(k,T){return T in k},get:u?function(k,T){return n.call(k,T)?k[T]:void 0}:function(k,T){return k[T]}},d=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:eJ(),f=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:tJ(),h=typeof WeakMap=="function"?WeakMap:rJ(),m=o?Symbol.for("@reflect-metadata:registry"):void 0,y=XG(),v=YG(y);function b(k,T,j,Z){if(_e(j)){if(!l_(k))throw new TypeError;if(!Va(T))throw new TypeError;return en(k,T)}else{if(!l_(k))throw new TypeError;if(!Tt(T))throw new TypeError;if(!Tt(Z)&&!_e(Z)&&!Ds(Z))throw new TypeError;return Ds(Z)&&(Z=void 0),j=Yn(j),Ms(k,T,j,Z)}}e("decorate",b);function x(k,T){function j(Z,de){if(!Tt(Z))throw new TypeError;if(!_e(de)&&!GG(de))throw new TypeError;s_(k,T,Z,de)}return j}e("metadata",x);function C(k,T,j,Z){if(!Tt(j))throw new TypeError;return _e(Z)||(Z=Yn(Z)),s_(k,T,j,Z)}e("defineMetadata",C);function $(k,T,j){if(!Tt(T))throw new TypeError;return _e(j)||(j=Yn(j)),Gt(k,T,j)}e("hasMetadata",$);function L(k,T,j){if(!Tt(T))throw new TypeError;return _e(j)||(j=Yn(j)),Za(k,T,j)}e("hasOwnMetadata",L);function xe(k,T,j){if(!Tt(T))throw new TypeError;return _e(j)||(j=Yn(j)),df(k,T,j)}e("getMetadata",xe);function ve(k,T,j){if(!Tt(T))throw new TypeError;return _e(j)||(j=Yn(j)),i_(k,T,j)}e("getOwnMetadata",ve);function Se(k,T){if(!Tt(k))throw new TypeError;return _e(T)||(T=Yn(T)),a_(k,T)}e("getMetadataKeys",Se);function Fe(k,T){if(!Tt(k))throw new TypeError;return _e(T)||(T=Yn(T)),c_(k,T)}e("getOwnMetadataKeys",Fe);function Yt(k,T,j){if(!Tt(T))throw new TypeError;if(_e(j)||(j=Yn(j)),!Tt(T))throw new TypeError;_e(j)||(j=Yn(j));var Z=ff(T,j,!1);return _e(Z)?!1:Z.OrdinaryDeleteMetadata(k,T,j)}e("deleteMetadata",Yt);function en(k,T){for(var j=k.length-1;j>=0;--j){var Z=k[j],de=Z(T);if(!_e(de)&&!Ds(de)){if(!Va(de))throw new TypeError;T=de}}return T}function Ms(k,T,j,Z){for(var de=k.length-1;de>=0;--de){var nr=k[de],gr=nr(T,j,Z);if(!_e(gr)&&!Ds(gr)){if(!Tt(gr))throw new TypeError;Z=gr}}return Z}function Gt(k,T,j){var Z=Za(k,T,j);if(Z)return!0;var de=d$(T);return Ds(de)?!1:Gt(k,de,j)}function Za(k,T,j){var Z=ff(T,j,!1);return _e(Z)?!1:u_(Z.OrdinaryHasOwnMetadata(k,T,j))}function df(k,T,j){var Z=Za(k,T,j);if(Z)return i_(k,T,j);var de=d$(T);if(!Ds(de))return df(k,de,j)}function i_(k,T,j){var Z=ff(T,j,!1);if(!_e(Z))return Z.OrdinaryGetOwnMetadata(k,T,j)}function s_(k,T,j,Z){var de=ff(j,Z,!0);de.OrdinaryDefineOwnMetadata(k,T,j,Z)}function a_(k,T){var j=c_(k,T),Z=d$(k);if(Z===null)return j;var de=a_(Z,T);if(de.length<=0)return j;if(j.length<=0)return de;for(var nr=new f,gr=[],Le=0,J=j;Le<J.length;Le++){var te=J[Le],ne=nr.has(te);ne||(nr.add(te),gr.push(te))}for(var se=0,He=de;se<He.length;se++){var te=He[se],ne=nr.has(te);ne||(nr.add(te),gr.push(te))}return gr}function c_(k,T){var j=ff(k,T,!1);return j?j.OrdinaryOwnMetadataKeys(k,T):[]}function el(k){if(k===null)return 1;switch(typeof k){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return k===null?1:6;default:return 6}}function _e(k){return k===void 0}function Ds(k){return k===null}function pf(k){return typeof k=="symbol"}function Tt(k){return typeof k=="object"?k!==null:typeof k=="function"}function tl(k,T){switch(el(k)){case 0:return k;case 1:return k;case 2:return k;case 3:return k;case 4:return k;case 5:return k}var j=T===3?"string":T===5?"number":"default",Z=ID(k,i);if(Z!==void 0){var de=Z.call(k,j);if(Tt(de))throw new TypeError;return de}return c$(k,j==="default"?"number":j)}function c$(k,T){if(T==="string"){var j=k.toString;if(qs(j)){var Z=j.call(k);if(!Tt(Z))return Z}var de=k.valueOf;if(qs(de)){var Z=de.call(k);if(!Tt(Z))return Z}}else{var de=k.valueOf;if(qs(de)){var Z=de.call(k);if(!Tt(Z))return Z}var nr=k.toString;if(qs(nr)){var Z=nr.call(k);if(!Tt(Z))return Z}}throw new TypeError}function u_(k){return!!k}function u$(k){return""+k}function Yn(k){var T=tl(k,3);return pf(T)?T:u$(T)}function l_(k){return Array.isArray?Array.isArray(k):k instanceof Object?k instanceof Array:Object.prototype.toString.call(k)==="[object Array]"}function qs(k){return typeof k=="function"}function Va(k){return typeof k=="function"}function GG(k){switch(el(k)){case 3:return!0;case 4:return!0;default:return!1}}function l$(k,T){return k===T||k!==k&&T!==T}function ID(k,T){var j=k[T];if(j!=null){if(!qs(j))throw new TypeError;return j}}function ED(k){var T=ID(k,s);if(!qs(T))throw new TypeError;var j=T.call(k);if(!Tt(j))throw new TypeError;return j}function OD(k){return k.value}function jD(k){var T=k.next();return T.done?!1:T}function ND(k){var T=k.return;T&&T.call(k)}function d$(k){var T=Object.getPrototypeOf(k);if(typeof k!="function"||k===d||T!==d)return T;var j=k.prototype,Z=j&&Object.getPrototypeOf(j);if(Z==null||Z===Object.prototype)return T;var de=Z.constructor;return typeof de!="function"||de===k?T:de}function JG(){var k;!_e(m)&&typeof r.Reflect<"u"&&!(m in r.Reflect)&&typeof r.Reflect.defineMetadata=="function"&&(k=QG(r.Reflect));var T,j,Z,de=new h,nr={registerProvider:gr,getProvider:J,setProvider:ne};return nr;function gr(se){if(!Object.isExtensible(nr))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case k===se:break;case _e(T):T=se;break;case T===se:break;case _e(j):j=se;break;case j===se:break;default:Z===void 0&&(Z=new f),Z.add(se);break}}function Le(se,He){if(!_e(T)){if(T.isProviderFor(se,He))return T;if(!_e(j)){if(j.isProviderFor(se,He))return T;if(!_e(Z))for(var zt=ED(Z);;){var or=jD(zt);if(!or)return;var Co=OD(or);if(Co.isProviderFor(se,He))return ND(zt),Co}}}if(!_e(k)&&k.isProviderFor(se,He))return k}function J(se,He){var zt=de.get(se),or;return _e(zt)||(or=zt.get(He)),_e(or)&&(or=Le(se,He),_e(or)||(_e(zt)&&(zt=new p,de.set(se,zt)),zt.set(He,or))),or}function te(se){if(_e(se))throw new TypeError;return T===se||j===se||!_e(Z)&&Z.has(se)}function ne(se,He,zt){if(!te(zt))throw new Error("Metadata provider not registered.");var or=J(se,He);if(or!==zt){if(!_e(or))return!1;var Co=de.get(se);_e(Co)&&(Co=new p,de.set(se,Co)),Co.set(He,zt)}return!0}}function XG(){var k;return!_e(m)&&Tt(r.Reflect)&&Object.isExtensible(r.Reflect)&&(k=r.Reflect[m]),_e(k)&&(k=JG()),!_e(m)&&Tt(r.Reflect)&&Object.isExtensible(r.Reflect)&&Object.defineProperty(r.Reflect,m,{enumerable:!1,configurable:!1,writable:!1,value:k}),k}function YG(k){var T=new h,j={isProviderFor:function(te,ne){var se=T.get(te);return _e(se)?!1:se.has(ne)},OrdinaryDefineOwnMetadata:gr,OrdinaryHasOwnMetadata:de,OrdinaryGetOwnMetadata:nr,OrdinaryOwnMetadataKeys:Le,OrdinaryDeleteMetadata:J};return y.registerProvider(j),j;function Z(te,ne,se){var He=T.get(te),zt=!1;if(_e(He)){if(!se)return;He=new p,T.set(te,He),zt=!0}var or=He.get(ne);if(_e(or)){if(!se)return;if(or=new p,He.set(ne,or),!k.setProvider(te,ne,j))throw He.delete(ne),zt&&T.delete(te),new Error("Wrong provider for target.")}return or}function de(te,ne,se){var He=Z(ne,se,!1);return _e(He)?!1:u_(He.has(te))}function nr(te,ne,se){var He=Z(ne,se,!1);if(!_e(He))return He.get(te)}function gr(te,ne,se,He){var zt=Z(se,He,!0);zt.set(te,ne)}function Le(te,ne){var se=[],He=Z(te,ne,!1);if(_e(He))return se;for(var zt=He.keys(),or=ED(zt),Co=0;;){var zD=jD(or);if(!zD)return se.length=Co,se;var nJ=OD(zD);try{se[Co]=nJ}catch(oJ){try{ND(or)}finally{throw oJ}}Co++}}function J(te,ne,se){var He=Z(ne,se,!1);if(_e(He)||!He.delete(te))return!1;if(He.size===0){var zt=T.get(ne);_e(zt)||(zt.delete(se),zt.size===0&&T.delete(zt))}return!0}}function QG(k){var T=k.defineMetadata,j=k.hasOwnMetadata,Z=k.getOwnMetadata,de=k.getOwnMetadataKeys,nr=k.deleteMetadata,gr=new h,Le={isProviderFor:function(J,te){var ne=gr.get(J);return!_e(ne)&&ne.has(te)?!0:de(J,te).length?(_e(ne)&&(ne=new f,gr.set(J,ne)),ne.add(te),!0):!1},OrdinaryDefineOwnMetadata:T,OrdinaryHasOwnMetadata:j,OrdinaryGetOwnMetadata:Z,OrdinaryOwnMetadataKeys:de,OrdinaryDeleteMetadata:nr};return Le}function ff(k,T,j){var Z=y.getProvider(k,T);if(!_e(Z))return Z;if(j){if(y.setProvider(k,T,v))return v;throw new Error("Illegal state.")}}function eJ(){var k={},T=[],j=(function(){function Le(J,te,ne){this._index=0,this._keys=J,this._values=te,this._selector=ne}return Le.prototype["@@iterator"]=function(){return this},Le.prototype[s]=function(){return this},Le.prototype.next=function(){var J=this._index;if(J>=0&&J<this._keys.length){var te=this._selector(this._keys[J],this._values[J]);return J+1>=this._keys.length?(this._index=-1,this._keys=T,this._values=T):this._index++,{value:te,done:!1}}return{value:void 0,done:!0}},Le.prototype.throw=function(J){throw this._index>=0&&(this._index=-1,this._keys=T,this._values=T),J},Le.prototype.return=function(J){return this._index>=0&&(this._index=-1,this._keys=T,this._values=T),{value:J,done:!0}},Le})(),Z=(function(){function Le(){this._keys=[],this._values=[],this._cacheKey=k,this._cacheIndex=-2}return Object.defineProperty(Le.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Le.prototype.has=function(J){return this._find(J,!1)>=0},Le.prototype.get=function(J){var te=this._find(J,!1);return te>=0?this._values[te]:void 0},Le.prototype.set=function(J,te){var ne=this._find(J,!0);return this._values[ne]=te,this},Le.prototype.delete=function(J){var te=this._find(J,!1);if(te>=0){for(var ne=this._keys.length,se=te+1;se<ne;se++)this._keys[se-1]=this._keys[se],this._values[se-1]=this._values[se];return this._keys.length--,this._values.length--,l$(J,this._cacheKey)&&(this._cacheKey=k,this._cacheIndex=-2),!0}return!1},Le.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=k,this._cacheIndex=-2},Le.prototype.keys=function(){return new j(this._keys,this._values,de)},Le.prototype.values=function(){return new j(this._keys,this._values,nr)},Le.prototype.entries=function(){return new j(this._keys,this._values,gr)},Le.prototype["@@iterator"]=function(){return this.entries()},Le.prototype[s]=function(){return this.entries()},Le.prototype._find=function(J,te){if(!l$(this._cacheKey,J)){this._cacheIndex=-1;for(var ne=0;ne<this._keys.length;ne++)if(l$(this._keys[ne],J)){this._cacheIndex=ne;break}}return this._cacheIndex<0&&te&&(this._cacheIndex=this._keys.length,this._keys.push(J),this._values.push(void 0)),this._cacheIndex},Le})();return Z;function de(Le,J){return Le}function nr(Le,J){return J}function gr(Le,J){return[Le,J]}}function tJ(){var k=(function(){function T(){this._map=new p}return Object.defineProperty(T.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),T.prototype.has=function(j){return this._map.has(j)},T.prototype.add=function(j){return this._map.set(j,j),this},T.prototype.delete=function(j){return this._map.delete(j)},T.prototype.clear=function(){this._map.clear()},T.prototype.keys=function(){return this._map.keys()},T.prototype.values=function(){return this._map.keys()},T.prototype.entries=function(){return this._map.entries()},T.prototype["@@iterator"]=function(){return this.keys()},T.prototype[s]=function(){return this.keys()},T})();return k}function rJ(){var k=16,T=l.create(),j=Z();return(function(){function J(){this._key=Z()}return J.prototype.has=function(te){var ne=de(te,!1);return ne!==void 0?l.has(ne,this._key):!1},J.prototype.get=function(te){var ne=de(te,!1);return ne!==void 0?l.get(ne,this._key):void 0},J.prototype.set=function(te,ne){var se=de(te,!0);return se[this._key]=ne,this},J.prototype.delete=function(te){var ne=de(te,!1);return ne!==void 0?delete ne[this._key]:!1},J.prototype.clear=function(){this._key=Z()},J})();function Z(){var J;do J="@@WeakMap@@"+Le();while(l.has(T,J));return T[J]=!0,J}function de(J,te){if(!n.call(J,j)){if(!te)return;Object.defineProperty(J,j,{value:l.create()})}return J[j]}function nr(J,te){for(var ne=0;ne<te;++ne)J[ne]=Math.random()*255|0;return J}function gr(J){if(typeof Uint8Array=="function"){var te=new Uint8Array(J);return typeof crypto<"u"?crypto.getRandomValues(te):typeof msCrypto<"u"?msCrypto.getRandomValues(te):nr(te,J),te}return nr(new Array(J),J)}function Le(){var J=gr(k);J[6]=J[6]&79|64,J[8]=J[8]&191|128;for(var te="",ne=0;ne<k;++ne){var se=J[ne];(ne===4||ne===6||ne===8)&&(te+="-"),se<16&&(te+="0"),te+=se.toString(16).toLowerCase()}return te}}function p$(k){return k.__=void 0,delete k.__,k}})})(L9||(L9={}))});var E={};To(E,{__addDisposableResource:()=>mH,__assign:()=>ww,__asyncDelegator:()=>sH,__asyncGenerator:()=>iH,__asyncValues:()=>aH,__await:()=>hd,__awaiter:()=>Q9,__classPrivateFieldGet:()=>dH,__classPrivateFieldIn:()=>fH,__classPrivateFieldSet:()=>pH,__createBinding:()=>Sw,__decorate:()=>H9,__disposeResources:()=>hH,__esDecorate:()=>W9,__exportStar:()=>tH,__extends:()=>V9,__generator:()=>eH,__importDefault:()=>lH,__importStar:()=>uH,__makeTemplateObject:()=>cH,__metadata:()=>Y9,__param:()=>K9,__propKey:()=>J9,__read:()=>hj,__rest:()=>F9,__rewriteRelativeImportExtension:()=>gH,__runInitializers:()=>G9,__setFunctionName:()=>X9,__spread:()=>rH,__spreadArray:()=>oH,__spreadArrays:()=>nH,__values:()=>xw,default:()=>Ede});function V9(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");fj(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function F9(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r}function H9(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i}function K9(t,e){return function(r,n){e(r,n,t)}}function W9(t,e,r,n,o,i){function s(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var a=n.kind,c=a==="getter"?"get":a==="setter"?"set":"value",u=!e&&t?n.static?t:t.prototype:null,l=e||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),d,p=!1,f=r.length-1;f>=0;f--){var h={};for(var m in n)h[m]=m==="access"?{}:n[m];for(var m in n.access)h.access[m]=n.access[m];h.addInitializer=function(v){if(p)throw new TypeError("Cannot add initializers after decoration has completed");i.push(s(v||null))};var y=(0,r[f])(a==="accessor"?{get:l.get,set:l.set}:l[c],h);if(a==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(d=s(y.get))&&(l.get=d),(d=s(y.set))&&(l.set=d),(d=s(y.init))&&o.unshift(d)}else(d=s(y))&&(a==="field"?o.unshift(d):l[c]=d)}u&&Object.defineProperty(u,n.name,l),p=!0}function G9(t,e,r){for(var n=arguments.length>2,o=0;o<e.length;o++)r=n?e[o].call(t,r):e[o].call(t);return n?r:void 0}function J9(t){return typeof t=="symbol"?t:"".concat(t)}function X9(t,e,r){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:r?"".concat(r," ",e):e})}function Y9(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Q9(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(l){try{u(n.next(l))}catch(d){s(d)}}function c(l){try{u(n.throw(l))}catch(d){s(d)}}function u(l){l.done?i(l.value):o(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function eH(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(r=0)),r;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function tH(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Sw(e,t,r)}function xw(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function hj(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function rH(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(hj(arguments[e]));return t}function nH(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}function oH(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}function hd(t){return this instanceof hd?(this.v=t,this):new hd(t)}function iH(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(h){return Promise.resolve(h).then(f,d)}}function a(f,h){n[f]&&(o[f]=function(m){return new Promise(function(y,v){i.push([f,m,y,v])>1||c(f,m)})},h&&(o[f]=h(o[f])))}function c(f,h){try{u(n[f](h))}catch(m){p(i[0][3],m)}}function u(f){f.value instanceof hd?Promise.resolve(f.value.v).then(l,d):p(i[0][2],f)}function l(f){c("next",f)}function d(f){c("throw",f)}function p(f,h){f(h),i.shift(),i.length&&c(i[0][0],i[0][1])}}function sH(t){var e,r;return e={},n("next"),n("throw",function(o){throw o}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(o,i){e[o]=t[o]?function(s){return(r=!r)?{value:hd(t[o](s)),done:!1}:i?i(s):s}:i}}function aH(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof xw=="function"?xw(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(s){return new Promise(function(a,c){s=t[i](s),o(a,c,s.done,s.value)})}}function o(i,s,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},s)}}function cH(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function uH(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r=mj(t),n=0;n<r.length;n++)r[n]!=="default"&&Sw(e,t,r[n]);return Tde(e,t),e}function lH(t){return t&&t.__esModule?t:{default:t}}function dH(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function pH(t,e,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(t,r):o?o.value=r:e.set(t,r),r}function fH(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function mH(t,e,r){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var n,o;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],r&&(o=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");o&&(n=function(){try{o.call(this)}catch(i){return Promise.reject(i)}}),t.stack.push({value:e,dispose:n,async:r})}else r&&t.stack.push({async:!0});return e}function hH(t){function e(i){t.error=t.hasError?new Ide(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}var r,n=0;function o(){for(;r=t.stack.pop();)try{if(!r.async&&n===1)return n=0,t.stack.push(r),Promise.resolve().then(o);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(o,function(s){return e(s),o()})}else n|=1}catch(s){e(s)}if(n===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return o()}function gH(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,o,i,s){return n?e?".jsx":".js":o&&(!i||!s)?r:o+i+"."+s.toLowerCase()+"js"}):t}var fj,ww,Sw,Tde,mj,Ide,Ede,O=A(()=>{fj=function(t,e){return fj=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},fj(t,e)};ww=function(){return ww=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},ww.apply(this,arguments)};Sw=Object.create?(function(t,e,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]});Tde=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},mj=function(t){return mj=Object.getOwnPropertyNames||function(e){var r=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[r.length]=n);return r},mj(t)};Ide=typeof SuppressedError=="function"?SuppressedError:function(t,e,r){var n=new Error(r);return n.name="SuppressedError",n.error=t,n.suppressed=e,n};Ede={__extends:V9,__assign:ww,__rest:F9,__decorate:H9,__param:K9,__esDecorate:W9,__runInitializers:G9,__propKey:J9,__setFunctionName:X9,__metadata:Y9,__awaiter:Q9,__generator:eH,__createBinding:Sw,__exportStar:tH,__values:xw,__read:hj,__spread:rH,__spreadArrays:nH,__spreadArray:oH,__await:hd,__asyncGenerator:iH,__asyncDelegator:sH,__asyncValues:aH,__makeTemplateObject:cH,__importStar:uH,__importDefault:lH,__classPrivateFieldGet:dH,__classPrivateFieldSet:pH,__classPrivateFieldIn:fH,__addDisposableResource:mH,__disposeResources:hH,__rewriteRelativeImportExtension:gH}});var ps=g(gd=>{"use strict";var Ode="[object ArrayBuffer]",ds=class t{static isArrayBuffer(e){return Object.prototype.toString.call(e)===Ode}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,r){if(e.constructor===r)return e;if(this.isArrayBuffer(e))return new r(e);if(this.isArrayBufferView(e))return new r(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,r){let n=t.toUint8Array(e),o=t.toUint8Array(r);if(n.length!==o.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==o[i])return!1;return!0}static concat(...e){let r;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?r=e[0]:e[e.length-1]instanceof Function?r=e.slice(0,e.length-1):r=e;let n=0;for(let s of r)n+=s.byteLength;let o=new Uint8Array(n),i=0;for(let s of r){let a=this.toUint8Array(s);o.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(o,e[e.length-1]):o.buffer}},gj="string",jde=/^[0-9a-f\s]+$/i,Nde=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,zde=/^[a-zA-Z0-9-_]+$/,kw=class{static fromString(e){let r=unescape(encodeURIComponent(e)),n=new Uint8Array(r.length);for(let o=0;o<r.length;o++)n[o]=r.charCodeAt(o);return n.buffer}static toString(e){let r=ds.toUint8Array(e),n="";for(let i=0;i<r.length;i++)n+=String.fromCharCode(r[i]);return decodeURIComponent(escape(n))}},mo=class{static toString(e,r=!1){let n=ds.toArrayBuffer(e),o=new DataView(n),i="";for(let s=0;s<n.byteLength;s+=2){let a=o.getUint16(s,r);i+=String.fromCharCode(a)}return i}static fromString(e,r=!1){let n=new ArrayBuffer(e.length*2),o=new DataView(n);for(let i=0;i<e.length;i++)o.setUint16(i*2,e.charCodeAt(i),r);return n}},$w=class t{static isHex(e){return typeof e===gj&&jde.test(e)}static isBase64(e){return typeof e===gj&&Nde.test(e)}static isBase64Url(e){return typeof e===gj&&zde.test(e)}static ToString(e,r="utf8"){let n=ds.toUint8Array(e);switch(r.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return mo.toString(n,!0);case"utf16":case"utf16be":return mo.toString(n);default:throw new Error(`Unknown type of encoding '${r}'`)}}static FromString(e,r="utf8"){if(!e)return new ArrayBuffer(0);switch(r.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return mo.fromString(e,!0);case"utf16":case"utf16be":return mo.fromString(e);default:throw new Error(`Unknown type of encoding '${r}'`)}}static ToBase64(e){let r=ds.toUint8Array(e);if(typeof btoa<"u"){let n=this.ToString(r,"binary");return btoa(n)}else return Buffer.from(r).toString("base64")}static FromBase64(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}static FromBase64Url(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,r=t.DEFAULT_UTF8_ENCODING){switch(r){case"ascii":return this.FromBinary(e);case"utf8":return kw.fromString(e);case"utf16":case"utf16be":return mo.fromString(e);case"utf16le":case"usc2":return mo.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${r}'`)}}static ToUtf8String(e,r=t.DEFAULT_UTF8_ENCODING){switch(r){case"ascii":return this.ToBinary(e);case"utf8":return kw.toString(e);case"utf16":case"utf16be":return mo.toString(e);case"utf16le":case"usc2":return mo.toString(e,!0);default:throw new Error(`Unknown type of encoding '${r}'`)}}static FromBinary(e){let r=e.length,n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e.charCodeAt(o);return n.buffer}static ToBinary(e){let r=ds.toUint8Array(e),n="";for(let o=0;o<r.length;o++)n+=String.fromCharCode(r[o]);return n}static ToHex(e){let r=ds.toUint8Array(e),n="",o=r.length;for(let i=0;i<o;i++){let s=r[i];s<16&&(n+="0"),n+=s.toString(16)}return n}static FromHex(e){let r=this.formatString(e);if(!r)return new ArrayBuffer(0);if(!t.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r=`0${r}`);let n=new Uint8Array(r.length/2);for(let o=0;o<r.length;o=o+2){let i=r.slice(o,o+2);n[o/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(e,r=!1){return mo.toString(e,r)}static FromUtf16String(e,r=!1){return mo.fromString(e,r)}static Base64Padding(e){let r=4-e.length%4;if(r<4)for(let n=0;n<r;n++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}};$w.DEFAULT_UTF8_ENCODING="utf8";function Rde(t,...e){let r=arguments[0];for(let n=1;n<arguments.length;n++){let o=arguments[n];for(let i in o)r[i]=o[i]}return r}function Mde(...t){let e=t.map(o=>o.byteLength).reduce((o,i)=>o+i),r=new Uint8Array(e),n=0;return t.map(o=>new Uint8Array(o)).forEach(o=>{for(let i of o)r[n++]=i}),r.buffer}function Dde(t,e){if(!(t&&e)||t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<t.byteLength;o++)if(r[o]!==n[o])return!1;return!0}gd.BufferSourceConverter=ds;gd.Convert=$w;gd.assign=Rde;gd.combine=Mde;gd.isEqual=Dde});var _H=g(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});function qde(t){return new Date(t.getTime()+t.getTimezoneOffset()*6e4)}function Ude(t,e,r){var n;return t instanceof Object&&(n=t[e])!==null&&n!==void 0?n:r}function Bde(t,e=0,r=t.byteLength-e,n=!1){let o="";for(let i of new Uint8Array(t,e,r)){let s=i.toString(16).toUpperCase();s.length===1&&(o+="0"),o+=s,n&&(o+=" ")}return o.trim()}function Lde(t,e,r,n){return e instanceof ArrayBuffer?e.byteLength?r<0?(t.error="Wrong parameter: inputOffset less than zero",!1):n<0?(t.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-r-n<0?(t.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(t.error="Wrong parameter: inputBuffer has zero length",!1):(t.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1)}function yj(t,e){let r=0;if(t.length===1)return t[0];for(let n=t.length-1;n>=0;n--)r+=t[t.length-1-n]*Math.pow(2,e*n);return r}function vj(t,e,r=-1){let n=r,o=t,i=0,s=Math.pow(2,e);for(let a=1;a<8;a++){if(t<s){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let u=new Uint8Array(c);for(let l=a-1;l>=0;l--){let d=Math.pow(2,l*e);u[i-l-1]=Math.floor(o/d),o-=u[i-l-1]*d}return c}s*=Math.pow(2,e)}return new ArrayBuffer(0)}function Zde(...t){let e=0,r=0;for(let i of t)e+=i.byteLength;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of t)o.set(new Uint8Array(i),r),r+=i.byteLength;return n}function Vde(...t){let e=0,r=0;for(let i of t)e+=i.length;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of t)o.set(i,r),r+=i.length;return o}function Fde(){let t=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=t[0]===255&&t[1]&128,c=t[0]===0&&(t[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)r[a]=0;r[0]=t[0]&128;let n=yj(r,8),o=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(o);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=t[a];return i[0]&=127,yj(i,8)-n}function Hde(t){let e=t<0?t*-1:t,r=128;for(let n=1;n<8;n++){if(e<=r){if(t<0){let s=r-e,a=vj(s,8,n),c=new Uint8Array(a);return c[0]|=128,a}let o=vj(e,8,n),i=new Uint8Array(o);if(i[0]&128){let s=o.slice(0),a=new Uint8Array(s);o=new ArrayBuffer(o.byteLength+1),i=new Uint8Array(o);for(let c=0;c<s.byteLength;c++)i[c+1]=a[c];i[0]=0}return o}r*=Math.pow(2,8)}return new ArrayBuffer(0)}function Kde(t,e){if(t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<r.length;o++)if(r[o]!==n[o])return!1;return!0}function Wde(t,e){let r=t.toString(10);if(e<r.length)return"";let n=e-r.length,o=new Array(n);for(let s=0;s<n;s++)o[s]="0";return o.join("").concat(r)}var yH="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",vH="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Gde(t,e=!1,r=!1,n=!1){let o=0,i=0,s=0,a="",c=e?vH:yH;if(n){let u=0;for(let l=0;l<t.length;l++)if(t.charCodeAt(l)!==0){u=l;break}t=t.slice(u)}for(;o<t.length;){let u=t.charCodeAt(o++);o>=t.length&&(i=1);let l=t.charCodeAt(o++);o>=t.length&&(s=1);let d=t.charCodeAt(o++),p=u>>2,f=(u&3)<<4|l>>4,h=(l&15)<<2|d>>6,m=d&63;i===1?h=m=64:s===1&&(m=64),r?h===64?a+=`${c.charAt(p)}${c.charAt(f)}`:m===64?a+=`${c.charAt(p)}${c.charAt(f)}${c.charAt(h)}`:a+=`${c.charAt(p)}${c.charAt(f)}${c.charAt(h)}${c.charAt(m)}`:a+=`${c.charAt(p)}${c.charAt(f)}${c.charAt(h)}${c.charAt(m)}`}return a}function Jde(t,e=!1,r=!1){let n=e?vH:yH;function o(c){for(let u=0;u<64;u++)if(n.charAt(u)===c)return u;return 64}function i(c){return c===64?0:c}let s=0,a="";for(;s<t.length;){let c=o(t.charAt(s++)),u=s>=t.length?0:o(t.charAt(s++)),l=s>=t.length?0:o(t.charAt(s++)),d=s>=t.length?0:o(t.charAt(s++)),p=i(c)<<2|i(u)>>4,f=(i(u)&15)<<4|i(l)>>2,h=(i(l)&3)<<6|i(d);a+=String.fromCharCode(p),l!==64&&(a+=String.fromCharCode(f)),d!==64&&(a+=String.fromCharCode(h))}if(r){let c=a.length,u=-1;for(let l=c-1;l>=0;l--)if(a.charCodeAt(l)!==0){u=l;break}u!==-1?a=a.slice(0,u+1):a=""}return a}function Xde(t){let e="",r=new Uint8Array(t);for(let n of r)e+=String.fromCharCode(n);return e}function Yde(t){let e=t.length,r=new ArrayBuffer(e),n=new Uint8Array(r);for(let o=0;o<e;o++)n[o]=t.charCodeAt(o);return r}var Qde=Math.log(2);function epe(t){let e=Math.log(t)/Qde,r=Math.floor(e),n=Math.round(e);return r===n?r:n}function tpe(t,e){for(let r of e)delete t[r]}fr.arrayBufferToString=Xde;fr.bufferToHexCodes=Bde;fr.checkBufferParams=Lde;fr.clearProps=tpe;fr.fromBase64=Jde;fr.getParametersValue=Ude;fr.getUTCDate=qde;fr.isEqualBuffer=Kde;fr.nearestPowerOf2=epe;fr.padNumber=Wde;fr.stringToArrayBuffer=Yde;fr.toBase64=Gde;fr.utilConcatBuf=Zde;fr.utilConcatView=Vde;fr.utilDecodeTC=Fde;fr.utilEncodeTC=Hde;fr.utilFromBase=yj;fr.utilToBase=vj});var ga=g(Pe=>{"use strict";var rpe=ps(),npe=_H();function SH(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,Object.freeze(e)}var Ve=SH(rpe),dt=SH(npe);function Aw(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function wj(t){let e=0,r=0;for(let o=0;o<t.length;o++){let i=t[o];e+=i.byteLength}let n=new Uint8Array(e);for(let o=0;o<t.length;o++){let i=t[o];n.set(new Uint8Array(i),r),r+=i.byteLength}return n.buffer}function hs(t,e,r,n){return e instanceof Uint8Array?e.byteLength?r<0?(t.error="Wrong parameter: inputOffset less than zero",!1):n<0?(t.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-r-n<0?(t.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(t.error="Wrong parameter: inputBuffer has zero length",!1):(t.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var vd=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return wj(this.items)}},Xh=[new Uint8Array([1])],bH="0123456789",_j="name",wH="valueHexView",ope="isHexOnly",ipe="idBlock",spe="tagClass",ape="tagNumber",cpe="isConstructed",upe="fromBER",lpe="toBER",dpe="local",$n="",ki=new ArrayBuffer(0),Lw=new Uint8Array(0),Qh="EndOfContent",kH="OCTET STRING",$H="BIT STRING";function $i(t){var e;return e=class extends t{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var o;super(...n);let i=n[0]||{};this.isHexOnly=(o=i.isHexOnly)!==null&&o!==void 0?o:!1,this.valueHexView=i.valueHex?Ve.BufferSourceConverter.toUint8Array(i.valueHex):Lw}fromBER(n,o,i){let s=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!hs(this,s,o,i))return-1;let a=o+i;return this.valueHexView=s.subarray(o,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),o)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ki)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Ve.Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}var fs=class{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:r=$n,warnings:n=[],valueBeforeDecode:o=Lw}={}){this.blockLength=e,this.error=r,this.warnings=n,this.valueBeforeDecodeView=Ve.BufferSourceConverter.toUint8Array(o)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ve.Convert.ToHex(this.valueBeforeDecodeView)}}};fs.NAME="baseBlock";var qr=class extends fs{fromBER(e,r,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};qr.NAME="valueBlock";var Pw=class extends $i(fs){constructor({idBlock:e={}}={}){var r,n,o,i;super(),e?(this.isHexOnly=(r=e.isHexOnly)!==null&&r!==void 0?r:!1,this.valueHexView=e.valueHex?Ve.BufferSourceConverter.toUint8Array(e.valueHex):Lw,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(o=e.tagNumber)!==null&&o!==void 0?o:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let r=0;switch(this.tagClass){case 1:r|=0;break;case 2:r|=64;break;case 3:r|=128;break;case 4:r|=192;break;default:return this.error="Unknown tag class",ki}if(this.isConstructed&&(r|=32),this.tagNumber<31&&!this.isHexOnly){let o=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,r|=i,o[0]=r}return o.buffer}if(!this.isHexOnly){let o=dt.utilToBase(this.tagNumber,7),i=new Uint8Array(o),s=o.byteLength,a=new Uint8Array(s+1);if(a[0]=r|31,!e){for(let c=0;c<s-1;c++)a[c+1]=i[c]|128;a[s]=i[s-1]}return a.buffer}let n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=r|31,!e){let o=this.valueHexView;for(let i=0;i<o.length-1;i++)n[i+1]=o[i]|128;n[this.valueHexView.byteLength]=o[o.length-1]}return n.buffer}fromBER(e,r,n){let o=Ve.BufferSourceConverter.toUint8Array(e);if(!hs(this,o,r,n))return-1;let i=o.subarray(r,r+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;let a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,u=this.valueHexView=new Uint8Array(255),l=255;for(;i[c]&128;){if(u[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===l){l+=255;let p=new Uint8Array(l);for(let f=0;f<u.length;f++)p[f]=u[f];u=this.valueHexView=new Uint8Array(l)}}this.blockLength=c+1,u[c-1]=i[c]&127;let d=new Uint8Array(c);for(let p=0;p<c;p++)d[p]=u[p];u=this.valueHexView=new Uint8Array(c),u.set(d),this.blockLength<=9?this.tagNumber=dt.utilFromBase(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return r+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};Pw.NAME="identificationBlock";var Cw=class extends fs{constructor({lenBlock:e={}}={}){var r,n,o;super(),this.isIndefiniteForm=(r=e.isIndefiniteForm)!==null&&r!==void 0?r:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(o=e.length)!==null&&o!==void 0?o:0}fromBER(e,r,n){let o=Ve.BufferSourceConverter.toUint8Array(e);if(!hs(this,o,r,n))return-1;let i=o.subarray(r,r+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,r+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,r+this.blockLength;let s=i[0]&127;if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let a=r+1,c=o.subarray(a,a+s);return c[s-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=dt.utilFromBase(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,r+this.blockLength}toBER(e=!1){let r,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return r=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(r),n[0]=128),r;if(this.longFormUsed){let o=dt.utilToBase(this.length,8);if(o.byteLength>127)return this.error="Too big length",ki;if(r=new ArrayBuffer(o.byteLength+1),e)return r;let i=new Uint8Array(o);n=new Uint8Array(r),n[0]=o.byteLength|128;for(let s=0;s<o.byteLength;s++)n[s+1]=i[s];return r}return r=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(r),n[0]=this.length),r}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};Cw.NAME="lengthBlock";var Y={},kr=class extends fs{constructor({name:e=$n,optional:r=!1,primitiveSchema:n,...o}={},i){super(o),this.name=e,this.optional=r,n&&(this.primitiveSchema=n),this.idBlock=new Pw(o),this.lenBlock=new Cw(o),this.valueBlock=i?new i(o):new qr(o)}fromBER(e,r,n){let o=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}toBER(e,r){let n=r||new vd;r||AH(this);let o=this.idBlock.toBER(e);if(n.write(o),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{let i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;let s=this.lenBlock.toBER(e);n.write(s),n.write(i)}return r?ki:n.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Ve.Convert.ToHex(this.toBER())}onAsciiEncoding(){let e=this.constructor.NAME,r=Ve.Convert.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${r}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;let r=this.toBER(),n=e.toBER();return dt.isEqualBuffer(r,n)}};kr.NAME="BaseBlock";function AH(t){var e;if(t instanceof Y.Constructed)for(let r of t.valueBlock.value)AH(r)&&(t.lenBlock.isIndefiniteForm=!0);return!!(!((e=t.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}var eg=class extends kr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=$n,...r}={},n){super(r,n),e&&this.fromString(e)}fromBER(e,r,n){let o=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};eg.NAME="BaseStringBlock";var Tw=class extends $i(qr){constructor({isHexOnly:e=!0,...r}={}){super(r),this.isHexOnly=e}};Tw.NAME="PrimitiveValueBlock";var PH,tg=class extends kr{constructor(e={}){super(e,Tw),this.idBlock.isConstructed=!1}};PH=tg;Y.Primitive=PH;tg.NAME="PRIMITIVE";function ppe(t,e){if(t instanceof e)return t;let r=new e;return r.idBlock=t.idBlock,r.lenBlock=t.lenBlock,r.warnings=t.warnings,r.valueBeforeDecodeView=t.valueBeforeDecodeView,r}function xd(t,e=0,r=t.length){let n=e,o=new kr({},qr),i=new fs;if(!hs(i,t,e,r))return o.error=i.error,{offset:-1,result:o};if(!t.subarray(e,e+r).length)return o.error="Zero buffer length",{offset:-1,result:o};let a=o.idBlock.fromBER(t,e,r);if(o.idBlock.warnings.length&&o.warnings.concat(o.idBlock.warnings),a===-1)return o.error=o.idBlock.error,{offset:-1,result:o};if(e=a,r-=o.idBlock.blockLength,a=o.lenBlock.fromBER(t,e,r),o.lenBlock.warnings.length&&o.warnings.concat(o.lenBlock.warnings),a===-1)return o.error=o.lenBlock.error,{offset:-1,result:o};if(e=a,r-=o.lenBlock.blockLength,!o.idBlock.isConstructed&&o.lenBlock.isIndefiniteForm)return o.error="Indefinite length form used for primitive encoding form",{offset:-1,result:o};let c=kr;switch(o.idBlock.tagClass){case 1:if(o.idBlock.tagNumber>=37&&o.idBlock.isHexOnly===!1)return o.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:o};switch(o.idBlock.tagNumber){case 0:if(o.idBlock.isConstructed&&o.lenBlock.length>0)return o.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:o};c=Y.EndOfContent;break;case 1:c=Y.Boolean;break;case 2:c=Y.Integer;break;case 3:c=Y.BitString;break;case 4:c=Y.OctetString;break;case 5:c=Y.Null;break;case 6:c=Y.ObjectIdentifier;break;case 10:c=Y.Enumerated;break;case 12:c=Y.Utf8String;break;case 13:c=Y.RelativeObjectIdentifier;break;case 14:c=Y.TIME;break;case 15:return o.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:o};case 16:c=Y.Sequence;break;case 17:c=Y.Set;break;case 18:c=Y.NumericString;break;case 19:c=Y.PrintableString;break;case 20:c=Y.TeletexString;break;case 21:c=Y.VideotexString;break;case 22:c=Y.IA5String;break;case 23:c=Y.UTCTime;break;case 24:c=Y.GeneralizedTime;break;case 25:c=Y.GraphicString;break;case 26:c=Y.VisibleString;break;case 27:c=Y.GeneralString;break;case 28:c=Y.UniversalString;break;case 29:c=Y.CharacterString;break;case 30:c=Y.BmpString;break;case 31:c=Y.DATE;break;case 32:c=Y.TimeOfDay;break;case 33:c=Y.DateTime;break;case 34:c=Y.Duration;break;default:{let u=o.idBlock.isConstructed?new Y.Constructed:new Y.Primitive;u.idBlock=o.idBlock,u.lenBlock=o.lenBlock,u.warnings=o.warnings,o=u}}break;default:c=o.idBlock.isConstructed?Y.Constructed:Y.Primitive}return o=ppe(o,c),a=o.fromBER(t,e,o.lenBlock.isIndefiniteForm?r:o.lenBlock.length),o.valueBeforeDecodeView=t.subarray(n,n+o.blockLength),{offset:a,result:o}}function fpe(t){if(!t.byteLength){let e=new kr({},qr);return e.error="Input buffer has zero length",{offset:-1,result:e}}return xd(Ve.BufferSourceConverter.toUint8Array(t).slice(),0,t.byteLength)}function mpe(t,e){return t?1:e}var xi=class extends qr{constructor({value:e=[],isIndefiniteForm:r=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=r}fromBER(e,r,n){let o=Ve.BufferSourceConverter.toUint8Array(e);if(!hs(this,o,r,n))return-1;if(this.valueBeforeDecodeView=o.subarray(r,r+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),r;let i=r;for(;mpe(this.isIndefiniteForm,n)>0;){let s=xd(o,i,n);if(s.offset===-1)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(i=s.offset,this.blockLength+=s.result.blockLength,n-=s.result.blockLength,this.value.push(s.result),this.isIndefiniteForm&&s.result.constructor.NAME===Qh)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Qh?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,r){let n=r||new vd;for(let o=0;o<this.value.length;o++)this.value[o].toBER(e,n);return r?ki:n.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let r of this.value)e.value.push(r.toJSON());return e}};xi.NAME="ConstructedValueBlock";var CH,ms=class extends kr{constructor(e={}){super(e,xi),this.idBlock.isConstructed=!0}fromBER(e,r,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let o=this.valueBlock.fromBER(e,r,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(o=>`  ${o}`).join(`
`));let r=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${r} :
${e.join(`
`)}`:`${r} :`}};CH=ms;Y.Constructed=CH;ms.NAME="CONSTRUCTED";var Iw=class extends qr{fromBER(e,r,n){return r}toBER(e){return ki}};Iw.override="EndOfContentValueBlock";var TH,rg=class extends kr{constructor(e={}){super(e,Iw),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};TH=rg;Y.EndOfContent=TH;rg.NAME=Qh;var IH,ng=class extends kr{constructor(e={}){super(e,qr),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,r,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,r+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):r+n}toBER(e,r){let n=new ArrayBuffer(2);if(!e){let o=new Uint8Array(n);o[0]=5,o[1]=0}return r&&r.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};IH=ng;Y.Null=IH;ng.NAME="NULL";var Ew=class extends $i(qr){get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...r}={}){super(r),r.valueHex?this.valueHexView=Ve.BufferSourceConverter.toUint8Array(r.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,r,n){let o=Ve.BufferSourceConverter.toUint8Array(e);return hs(this,o,r,n)?(this.valueHexView=o.subarray(r,r+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,dt.utilDecodeTC.call(this),this.blockLength=n,r+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};Ew.NAME="BooleanValueBlock";var EH,og=class extends kr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,Ew),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};EH=og;Y.Boolean=EH;og.NAME="BOOLEAN";var Ow=class extends $i(xi){constructor({isConstructed:e=!1,...r}={}){super(r),this.isConstructed=e}fromBER(e,r,n){let o=0;if(this.isConstructed){if(this.isHexOnly=!1,o=xi.prototype.fromBER.call(this,e,r,n),o===-1)return o;for(let i=0;i<this.value.length;i++){let s=this.value[i].constructor.NAME;if(s===Qh){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==kH)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,o=super.fromBER(e,r,n),this.blockLength=n;return o}toBER(e,r){return this.isConstructed?xi.prototype.toBER.call(this,e,r):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};Ow.NAME="OctetStringValueBlock";var xj,ig=class extends kr{constructor({idBlock:e={},lenBlock:r={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...r,isIndefiniteForm:!!n.isIndefiniteForm},...n},Ow),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,r,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),r;if(!this.valueBlock.isConstructed){let i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(r,r+n);try{if(i.byteLength){let s=xd(i,0,i.byteLength);s.offset!==-1&&s.offset===n&&(this.valueBlock.value=[s.result])}}catch{}}return super.fromBER(e,r,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return ms.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,r=Ve.Convert.ToHex(this.valueBlock.valueHexView);return`${e} : ${r}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let r of this.valueBlock.value)r instanceof xj&&e.push(r.valueBlock.valueHexView);return Ve.BufferSourceConverter.concat(e)}};xj=ig;Y.OctetString=xj;ig.NAME=kH;var jw=class extends $i(xi){constructor({unusedBits:e=0,isConstructed:r=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=r,this.blockLength=this.valueHexView.byteLength}fromBER(e,r,n){if(!n)return r;let o=-1;if(this.isConstructed){if(o=xi.prototype.fromBER.call(this,e,r,n),o===-1)return o;for(let a of this.value){let c=a.constructor.NAME;if(c===Qh){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==$H)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let u=a.valueBlock;if(this.unusedBits>0&&u.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=u.unusedBits}return o}let i=Ve.BufferSourceConverter.toUint8Array(e);if(!hs(this,i,r,n))return-1;let s=i.subarray(r,r+n);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=s.subarray(1);try{if(a.byteLength){let c=xd(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,r+n}toBER(e,r){if(this.isConstructed)return xi.prototype.toBER.call(this,e,r);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength){let o=new Uint8Array(1);return o[0]=0,o.buffer}let n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};jw.NAME="BitStringValueBlock";var OH,sg=class extends kr{constructor({idBlock:e={},lenBlock:r={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...r,isIndefiniteForm:!!n.isIndefiniteForm},...n},jw),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,r,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,r,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return ms.prototype.onAsciiEncoding.call(this);{let e=[],r=this.valueBlock.valueHexView;for(let s of r)e.push(s.toString(2).padStart(8,"0"));let n=e.join(""),o=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${o} : ${i}`}}};OH=sg;Y.BitString=OH;sg.NAME=$H;var jH;function hpe(t,e){let r=new Uint8Array([0]),n=new Uint8Array(t),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,u=0,l=c<s?s:c,d=0;for(let p=l;p>=0;p--,d++)!0===d<a.length?u=i[s-d]+a[c-d]+r[0]:u=i[s-d]+r[0],r[0]=u/10,!0===d>=i.length?i=dt.utilConcatView(new Uint8Array([u%10]),i):i[s-d]=u%10;return r[0]>0&&(i=dt.utilConcatView(r,i)),i}function xH(t){if(t>=Xh.length)for(let e=Xh.length;e<=t;e++){let r=new Uint8Array([0]),n=Xh[e-1].slice(0);for(let o=n.length-1;o>=0;o--){let i=new Uint8Array([(n[o]<<1)+r[0]]);r[0]=i[0]/10,n[o]=i[0]%10}r[0]>0&&(n=dt.utilConcatView(r,n)),Xh.push(n)}return Xh[t]}function gpe(t,e){let r=0,n=new Uint8Array(t),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,u,l=0;for(let d=c;d>=0;d--,l++)u=i[s-l]-a[c-l]-r,!0===u<0?(r=1,i[s-l]=u+10):(r=0,i[s-l]=u);if(r>0)for(let d=s-c+1;d>=0;d--,l++)if(u=i[s-l]-r,u<0)r=1,i[s-l]=u+10;else{r=0,i[s-l]=u;break}return i.slice()}var ag=class extends $i(qr){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=dt.utilDecodeTC.call(this)))}constructor({value:e,...r}={}){super(r),this._valueDec=0,r.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(dt.utilEncodeTC(e))}get valueDec(){return this._valueDec}fromDER(e,r,n,o=0){let i=this.fromBER(e,r,n);if(i===-1)return i;let s=this.valueHexView;return s[0]===0&&(s[1]&128)!==0?this.valueHexView=s.subarray(1):o!==0&&s.length<o&&(o-s.length>1&&(o=s.length+1),this.valueHexView=s.subarray(o-s.length)),i}toDER(e=!1){let r=this.valueHexView;switch(!0){case(r[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(r,1),this.valueHexView=n}break;case(r[0]===0&&(r[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,r,n){let o=super.fromBER(e,r,n);return o===-1||this.setValueHex(),o}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e=this.valueHexView.length*8-1,r=new Uint8Array(this.valueHexView.length*8/3),n=0,o,i=this.valueHexView,s="",a=!1;for(let c=i.byteLength-1;c>=0;c--){o=i[c];for(let u=0;u<8;u++)(o&1)===1&&(n===e?(r=gpe(xH(n),r),s="-"):r=hpe(r,xH(n))),n++,o>>=1}for(let c=0;c<r.length;c++)r[c]&&(a=!0),a&&(s+=bH.charAt(r[c]));return a===!1&&(s+=bH.charAt(0)),s}};jH=ag;ag.NAME="IntegerValueBlock";Object.defineProperty(jH.prototype,"valueHex",{set:function(t){this.valueHexView=new Uint8Array(t),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Yh,_d=class extends kr{constructor(e={}){super(e,ag),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Aw(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Aw();let r=BigInt(e),n=new vd,o=r.toString(16).replace(/^-/,""),i=new Uint8Array(Ve.Convert.FromHex(o));if(r<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let u=BigInt(`0x${Ve.Convert.ToHex(a)}`)+r,l=Ve.BufferSourceConverter.toUint8Array(Ve.Convert.FromHex(u.toString(16)));l[0]|=128,n.write(l)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new Yh({valueHex:n.final()})}convertToDER(){let e=new Yh({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Yh({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};Yh=_d;Y.Integer=Yh;_d.NAME="INTEGER";var NH,cg=class extends _d{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};NH=cg;Y.Enumerated=NH;cg.NAME="ENUMERATED";var ug=class extends $i(qr){constructor({valueDec:e=-1,isFirstSid:r=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=r}fromBER(e,r,n){if(!n)return r;let o=Ve.BufferSourceConverter.toUint8Array(e);if(!hs(this,o,r,n))return-1;let i=o.subarray(r,r+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=dt.utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),r+this.blockLength)}set valueBigInt(e){Aw();let r=BigInt(e).toString(2);for(;r.length%7;)r="0"+r;let n=new Uint8Array(r.length/7);for(let o=0;o<n.length;o++)n[o]=parseInt(r.slice(o*7,o*7+7),2)+(o+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let r=dt.utilToBase(this.valueDec,7);if(r.byteLength===0)return this.error="Error during encoding SID value",ki;let n=new Uint8Array(r.byteLength);if(!e){let o=new Uint8Array(r),i=r.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n}toString(){let e="";if(this.isHexOnly)e=Ve.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let r=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",r-=40):(e="2.",r-=80),e+=r.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};ug.NAME="sidBlock";var Nw=class extends qr{constructor({value:e=$n,...r}={}){super(r),this.value=[],e&&this.fromString(e)}fromBER(e,r,n){let o=r;for(;n>0;){let i=new ug;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e){let r=[];for(let n=0;n<this.value.length;n++){let o=this.value[n].toBER(e);if(o.byteLength===0)return this.error=this.value[n].error,ki;r.push(o)}return wj(r)}fromString(e){this.value=[];let r=0,n=0,o="",i=!1;do if(n=e.indexOf(".",r),n===-1?o=e.substring(r):o=e.substring(r,n),r=n+1,i){let s=this.value[0],a=0;switch(s.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}let c=parseInt(o,10);if(isNaN(c))return;s.valueDec=c+a,i=!1}else{let s=new ug;if(o>Number.MAX_SAFE_INTEGER){Aw();let a=BigInt(o);s.valueBigInt=a}else if(s.valueDec=parseInt(o,10),isNaN(s.valueDec))return;this.value.length||(s.isFirstSid=!0,i=!0),this.value.push(s)}while(n!==-1)}toString(){let e="",r=!1;for(let n=0;n<this.value.length;n++){r=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),r?(o=`{${o}}`,this.value[n].isFirstSid?e=`2.{${o} - 80}`:e+=o):e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}};Nw.NAME="ObjectIdentifierValueBlock";var zH,lg=class extends kr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Nw),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};zH=lg;Y.ObjectIdentifier=zH;lg.NAME="OBJECT IDENTIFIER";var dg=class extends $i(fs){constructor({valueDec:e=0,...r}={}){super(r),this.valueDec=e}fromBER(e,r,n){if(n===0)return r;let o=Ve.BufferSourceConverter.toUint8Array(e);if(!hs(this,o,r,n))return-1;let i=o.subarray(r,r+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=dt.utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),r+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let r=dt.utilToBase(this.valueDec,7);if(r.byteLength===0)return this.error="Error during encoding SID value",ki;let n=new Uint8Array(r.byteLength);if(!e){let o=new Uint8Array(r),i=r.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Ve.Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};dg.NAME="relativeSidBlock";var zw=class extends qr{constructor({value:e=$n,...r}={}){super(r),this.value=[],e&&this.fromString(e)}fromBER(e,r,n){let o=r;for(;n>0;){let i=new dg;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e,r){let n=[];for(let o=0;o<this.value.length;o++){let i=this.value[o].toBER(e);if(i.byteLength===0)return this.error=this.value[o].error,ki;n.push(i)}return wj(n)}fromString(e){this.value=[];let r=0,n=0,o="";do{n=e.indexOf(".",r),n===-1?o=e.substring(r):o=e.substring(r,n),r=n+1;let i=new dg;if(i.valueDec=parseInt(o,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let e="",r=!1;for(let n=0;n<this.value.length;n++){r=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),r&&(o=`{${o}}`),e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}};zw.NAME="RelativeObjectIdentifierValueBlock";var RH,pg=class extends kr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,zw),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};RH=pg;Y.RelativeObjectIdentifier=RH;pg.NAME="RelativeObjectIdentifier";var MH,fg=class extends ms{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};MH=fg;Y.Sequence=MH;fg.NAME="SEQUENCE";var DH,mg=class extends ms{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};DH=mg;Y.Set=DH;mg.NAME="SET";var Rw=class extends $i(qr){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=$n}toJSON(){return{...super.toJSON(),value:this.value}}};Rw.NAME="StringValueBlock";var Mw=class extends Rw{};Mw.NAME="SimpleStringValueBlock";var dn=class extends eg{constructor({...e}={}){super(e,Mw)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,Ve.BufferSourceConverter.toUint8Array(e))}fromString(e){let r=e.length,n=this.valueBlock.valueHexView=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e.charCodeAt(o);this.valueBlock.value=e}};dn.NAME="SIMPLE STRING";var Dw=class extends dn{fromBuffer(e){this.valueBlock.valueHexView=Ve.BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=Ve.Convert.ToUtf8String(e)}catch(r){this.warnings.push(`Error during "decodeURIComponent": ${r}, using raw string`),this.valueBlock.value=Ve.Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Ve.Convert.FromUtf8String(e)),this.valueBlock.value=e}};Dw.NAME="Utf8StringValueBlock";var qH,Si=class extends Dw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};qH=Si;Y.Utf8String=qH;Si.NAME="UTF8String";var qw=class extends dn{fromBuffer(e){this.valueBlock.value=Ve.Convert.ToUtf16String(e),this.valueBlock.valueHexView=Ve.BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ve.Convert.FromUtf16String(e))}};qw.NAME="BmpStringValueBlock";var UH,hg=class extends qw{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};UH=hg;Y.BmpString=UH;hg.NAME="BMPString";var Uw=class extends dn{fromBuffer(e){let r=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(r);for(let o=0;o<n.length;o+=4)n[o]=n[o+3],n[o+1]=n[o+2],n[o+2]=0,n[o+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(r))}fromString(e){let r=e.length,n=this.valueBlock.valueHexView=new Uint8Array(r*4);for(let o=0;o<r;o++){let i=dt.utilToBase(e.charCodeAt(o),8),s=new Uint8Array(i);if(s.length>4)continue;let a=4-s.length;for(let c=s.length-1;c>=0;c--)n[o*4+c+a]=s[c]}this.valueBlock.value=e}};Uw.NAME="UniversalStringValueBlock";var BH,gg=class extends Uw{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};BH=gg;Y.UniversalString=BH;gg.NAME="UniversalString";var LH,yg=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};LH=yg;Y.NumericString=LH;yg.NAME="NumericString";var ZH,vg=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};ZH=vg;Y.PrintableString=ZH;vg.NAME="PrintableString";var VH,_g=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};VH=_g;Y.TeletexString=VH;_g.NAME="TeletexString";var FH,bg=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};FH=bg;Y.VideotexString=FH;bg.NAME="VideotexString";var HH,wg=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};HH=wg;Y.IA5String=HH;wg.NAME="IA5String";var KH,xg=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};KH=xg;Y.GraphicString=KH;xg.NAME="GraphicString";var WH,bd=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};WH=bd;Y.VisibleString=WH;bd.NAME="VisibleString";var GH,Sg=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};GH=Sg;Y.GeneralString=GH;Sg.NAME="GeneralString";var JH,kg=class extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};JH=kg;Y.CharacterString=JH;kg.NAME="CharacterString";var XH,wd=class extends bd{constructor({value:e,valueDate:r,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let o=0;o<e.length;o++)this.valueBlock.valueHexView[o]=e.charCodeAt(o)}r&&(this.fromDate(r),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,Ve.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),r=new ArrayBuffer(e.length),n=new Uint8Array(r);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return r}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let o=parseInt(n[1],10);o>=50?this.year=1900+o:this.year=2e3+o,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let r=new Array(7);return r[0]=dt.padNumber(this.year<2e3?this.year-1900:this.year-2e3,2),r[1]=dt.padNumber(this.month,2),r[2]=dt.padNumber(this.day,2),r[3]=dt.padNumber(this.hour,2),r[4]=dt.padNumber(this.minute,2),r[5]=dt.padNumber(this.second,2),r[6]="Z",r.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};XH=wd;Y.UTCTime=XH;wd.NAME="UTCTime";var YH,$g=class extends wd{constructor(e={}){var r;super(e),(r=this.millisecond)!==null&&r!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){let e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let r=!1,n="",o="",i=0,s,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),r=!0;else{let d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,p=n.indexOf("+"),f="";if(p===-1&&(p=n.indexOf("-"),d=-1),p!==-1){if(f=n.substring(p+1),n=n.substring(0,p),f.length!==2&&f.length!==4)throw new Error("Wrong input string for conversion");let h=parseInt(f.substring(0,2),10);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");if(a=d*h,f.length===4){if(h=parseInt(f.substring(2,4),10),isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");c=d*h}}}let u=n.indexOf(".");if(u===-1&&(u=n.indexOf(",")),u!==-1){let d=new Number(`0${n.substring(u)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");i=d.valueOf(),o=n.substring(0,u)}else o=n;switch(!0){case o.length===8:if(s=/(\d{4})(\d{2})(\d{2})/ig,u!==-1)throw new Error("Wrong input string for conversion");break;case o.length===10:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case o.length===12:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case o.length===14:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let d=1e3*i;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}let l=s.exec(o);if(l===null)throw new Error("Wrong input string for conversion");for(let d=1;d<l.length;d++)switch(d){case 1:this.year=parseInt(l[d],10);break;case 2:this.month=parseInt(l[d],10);break;case 3:this.day=parseInt(l[d],10);break;case 4:this.hour=parseInt(l[d],10)+a;break;case 5:this.minute=parseInt(l[d],10)+c;break;case 6:this.second=parseInt(l[d],10);break;default:throw new Error("Wrong input string for conversion")}if(r===!1){let d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let r=[];return r.push(dt.padNumber(this.year,4)),r.push(dt.padNumber(this.month,2)),r.push(dt.padNumber(this.day,2)),r.push(dt.padNumber(this.hour,2)),r.push(dt.padNumber(this.minute,2)),r.push(dt.padNumber(this.second,2)),this.millisecond!==0&&(r.push("."),r.push(dt.padNumber(this.millisecond,3))),r.push("Z"),r.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};YH=$g;Y.GeneralizedTime=YH;$g.NAME="GeneralizedTime";var QH,Ag=class extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};QH=Ag;Y.DATE=QH;Ag.NAME="DATE";var e5,Pg=class extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};e5=Pg;Y.TimeOfDay=e5;Pg.NAME="TimeOfDay";var t5,Cg=class extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};t5=Cg;Y.DateTime=t5;Cg.NAME="DateTime";var r5,Tg=class extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};r5=Tg;Y.Duration=r5;Tg.NAME="Duration";var n5,Ig=class extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};n5=Ig;Y.TIME=n5;Ig.NAME="TIME";var Cc=class{constructor({name:e=$n,optional:r=!1}={}){this.name=e,this.optional=r}},Bw=class extends Cc{constructor({value:e=[],...r}={}){super(r),this.value=e}},Eg=class extends Cc{constructor({value:e=new Cc,local:r=!1,...n}={}){super(n),this.value=e,this.local=r}},bj=class{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=Ve.BufferSourceConverter.toUint8Array(e)}constructor({data:e=Lw}={}){this.dataView=Ve.BufferSourceConverter.toUint8Array(e)}fromBER(e,r,n){let o=r+n;return this.dataView=Ve.BufferSourceConverter.toUint8Array(e).subarray(r,o),o}toBER(e){return this.dataView.slice().buffer}};function yd(t,e,r){if(r instanceof Bw){for(let i of r.value)if(yd(t,e,i).verified)return{verified:!0,result:t};{let i={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(_j)&&(i.name=r.name),i}}if(r instanceof Cc)return r.hasOwnProperty(_j)&&(t[r.name]=e),{verified:!0,result:t};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(ipe in r))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(upe in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(lpe in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=r.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(r.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(r.idBlock.hasOwnProperty(spe)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:t};if(r.idBlock.hasOwnProperty(ape)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:t};if(r.idBlock.hasOwnProperty(cpe)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:t};if(!(ope in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:t};if(r.idBlock.isHexOnly){if(!(wH in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=r.idBlock.valueHexView,s=e.idBlock.valueHexView;if(i.length!==s.length)return{verified:!1,result:t};for(let a=0;a<i.length;a++)if(i[a]!==s[1])return{verified:!1,result:t}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,$n),r.name&&(t[r.name]=e)),r instanceof Y.Constructed){let i=0,s={verified:!1,result:{error:"Unknown error"}},a=r.valueBlock.value.length;if(a>0&&r.valueBlock.value[0]instanceof Eg&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:t};if(e.valueBlock.value.length===0&&r.valueBlock.value.length!==0){let c=!0;for(let u=0;u<r.valueBlock.value.length;u++)c=c&&(r.valueBlock.value[u].optional||!1);return c?{verified:!0,result:t}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,$n),r.name&&delete t[r.name]),t.error="Inconsistent object length",{verified:!1,result:t})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(r.valueBlock.value[c].optional===!1){let u={verified:!1,result:t};return t.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,$n),r.name&&(delete t[r.name],u.name=r.name)),u}}else if(r.valueBlock.value[0]instanceof Eg){if(s=yd(t,e.valueBlock.value[c],r.valueBlock.value[0].value),s.verified===!1)if(r.valueBlock.value[0].optional)i++;else return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,$n),r.name&&delete t[r.name]),s;if(_j in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let u={};dpe in r.valueBlock.value[0]&&r.valueBlock.value[0].local?u=e:u=t,typeof u[r.valueBlock.value[0].name]>"u"&&(u[r.valueBlock.value[0].name]=[]),u[r.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(s=yd(t,e.valueBlock.value[c-i],r.valueBlock.value[c]),s.verified===!1)if(r.valueBlock.value[c].optional)i++;else return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,$n),r.name&&delete t[r.name]),s;if(s.verified===!1){let c={verified:!1,result:t};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,$n),r.name&&(delete t[r.name],c.name=r.name)),c}return{verified:!0,result:t}}if(r.primitiveSchema&&wH in e.valueBlock){let i=xd(e.valueBlock.valueHexView);if(i.offset===-1){let s={verified:!1,result:i.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,$n),r.name&&(delete t[r.name],s.name=r.name)),s}return yd(t,i.result,r.primitiveSchema)}return{verified:!0,result:t}}function ype(t,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let r=xd(Ve.BufferSourceConverter.toUint8Array(t));return r.offset===-1?{verified:!1,result:r.result}:yd(r.result,r.result,e)}Pe.Any=Cc;Pe.BaseBlock=kr;Pe.BaseStringBlock=eg;Pe.BitString=sg;Pe.BmpString=hg;Pe.Boolean=og;Pe.CharacterString=kg;Pe.Choice=Bw;Pe.Constructed=ms;Pe.DATE=Ag;Pe.DateTime=Cg;Pe.Duration=Tg;Pe.EndOfContent=rg;Pe.Enumerated=cg;Pe.GeneralString=Sg;Pe.GeneralizedTime=$g;Pe.GraphicString=xg;Pe.HexBlock=$i;Pe.IA5String=wg;Pe.Integer=_d;Pe.Null=ng;Pe.NumericString=yg;Pe.ObjectIdentifier=lg;Pe.OctetString=ig;Pe.Primitive=tg;Pe.PrintableString=vg;Pe.RawData=bj;Pe.RelativeObjectIdentifier=pg;Pe.Repeated=Eg;Pe.Sequence=fg;Pe.Set=mg;Pe.TIME=Ig;Pe.TeletexString=_g;Pe.TimeOfDay=Pg;Pe.UTCTime=wd;Pe.UniversalString=gg;Pe.Utf8String=Si;Pe.ValueBlock=qr;Pe.VideotexString=bg;Pe.ViewWriter=vd;Pe.VisibleString=bd;Pe.compareSchema=yd;Pe.fromBER=fpe;Pe.verifySchema=ype});var Tc=g(Sd=>{"use strict";Object.defineProperty(Sd,"__esModule",{value:!0});Sd.AsnPropTypes=Sd.AsnTypeTypes=void 0;var o5;(function(t){t[t.Sequence=0]="Sequence",t[t.Set=1]="Set",t[t.Choice=2]="Choice"})(o5||(Sd.AsnTypeTypes=o5={}));var i5;(function(t){t[t.Any=1]="Any",t[t.Boolean=2]="Boolean",t[t.OctetString=3]="OctetString",t[t.BitString=4]="BitString",t[t.Integer=5]="Integer",t[t.Enumerated=6]="Enumerated",t[t.ObjectIdentifier=7]="ObjectIdentifier",t[t.Utf8String=8]="Utf8String",t[t.BmpString=9]="BmpString",t[t.UniversalString=10]="UniversalString",t[t.NumericString=11]="NumericString",t[t.PrintableString=12]="PrintableString",t[t.TeletexString=13]="TeletexString",t[t.VideotexString=14]="VideotexString",t[t.IA5String=15]="IA5String",t[t.GraphicString=16]="GraphicString",t[t.VisibleString=17]="VisibleString",t[t.GeneralString=18]="GeneralString",t[t.CharacterString=19]="CharacterString",t[t.UTCTime=20]="UTCTime",t[t.GeneralizedTime=21]="GeneralizedTime",t[t.DATE=22]="DATE",t[t.TimeOfDay=23]="TimeOfDay",t[t.DateTime=24]="DateTime",t[t.Duration=25]="Duration",t[t.TIME=26]="TIME",t[t.Null=27]="Null"})(i5||(Sd.AsnPropTypes=i5={}))});var a5=g(Zw=>{"use strict";Object.defineProperty(Zw,"__esModule",{value:!0});Zw.BitString=void 0;var Sj=ga(),s5=ps(),kj=class{constructor(e,r=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(s5.BufferSourceConverter.isBufferSource(e))this.unusedBits=r,this.value=s5.BufferSourceConverter.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Sj.BitString))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Sj.BitString({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Sj.BitString({name:e})}toNumber(){let e="",r=new Uint8Array(this.value);for(let n of r)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let r=e.toString(2),n=r.length+7>>3;this.unusedBits=(n<<3)-r.length;let o=new Uint8Array(n);r=r.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)o[i]=parseInt(r.slice(i<<3,(i<<3)+8),2),i++;this.value=o.buffer}};Zw.BitString=kj});var u5=g(Vw=>{"use strict";Object.defineProperty(Vw,"__esModule",{value:!0});Vw.OctetString=void 0;var $j=ga(),c5=ps(),Aj=class{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):c5.BufferSourceConverter.isBufferSource(e)?this.buffer=c5.BufferSourceConverter.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof $j.OctetString))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new $j.OctetString({valueHex:this.buffer})}toSchema(e){return new $j.OctetString({name:e})}};Vw.OctetString=Aj});var Pj=g(Fw=>{"use strict";Object.defineProperty(Fw,"__esModule",{value:!0});var l5=(O(),I(E));l5.__exportStar(a5(),Fw);l5.__exportStar(u5(),Fw)});var Og=g(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.AsnNullConverter=G.AsnGeneralizedTimeConverter=G.AsnUTCTimeConverter=G.AsnCharacterStringConverter=G.AsnGeneralStringConverter=G.AsnVisibleStringConverter=G.AsnGraphicStringConverter=G.AsnIA5StringConverter=G.AsnVideotexStringConverter=G.AsnTeletexStringConverter=G.AsnPrintableStringConverter=G.AsnNumericStringConverter=G.AsnUniversalStringConverter=G.AsnBmpStringConverter=G.AsnUtf8StringConverter=G.AsnConstructedOctetStringConverter=G.AsnOctetStringConverter=G.AsnBooleanConverter=G.AsnObjectIdentifierConverter=G.AsnBitStringConverter=G.AsnIntegerBigIntConverter=G.AsnIntegerArrayBufferConverter=G.AsnEnumeratedConverter=G.AsnIntegerConverter=G.AsnAnyConverter=void 0;G.defaultConverter=_pe;var jt=ga(),Qt=Tc(),vpe=Pj();G.AsnAnyConverter={fromASN:t=>t instanceof jt.Null?null:t.valueBeforeDecodeView,toASN:t=>{if(t===null)return new jt.Null;let e=jt.fromBER(t);if(e.result.error)throw new Error(e.result.error);return e.result}};G.AsnIntegerConverter={fromASN:t=>t.valueBlock.valueHexView.byteLength>=4?t.valueBlock.toString():t.valueBlock.valueDec,toASN:t=>new jt.Integer({value:+t})};G.AsnEnumeratedConverter={fromASN:t=>t.valueBlock.valueDec,toASN:t=>new jt.Enumerated({value:t})};G.AsnIntegerArrayBufferConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new jt.Integer({valueHex:t})};G.AsnIntegerBigIntConverter={fromASN:t=>t.toBigInt(),toASN:t=>jt.Integer.fromBigInt(t)};G.AsnBitStringConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new jt.BitString({valueHex:t})};G.AsnObjectIdentifierConverter={fromASN:t=>t.valueBlock.toString(),toASN:t=>new jt.ObjectIdentifier({value:t})};G.AsnBooleanConverter={fromASN:t=>t.valueBlock.value,toASN:t=>new jt.Boolean({value:t})};G.AsnOctetStringConverter={fromASN:t=>t.valueBlock.valueHexView,toASN:t=>new jt.OctetString({valueHex:t})};G.AsnConstructedOctetStringConverter={fromASN:t=>new vpe.OctetString(t.getValue()),toASN:t=>t.toASN()};function ho(t){return{fromASN:e=>e.valueBlock.value,toASN:e=>new t({value:e})}}G.AsnUtf8StringConverter=ho(jt.Utf8String);G.AsnBmpStringConverter=ho(jt.BmpString);G.AsnUniversalStringConverter=ho(jt.UniversalString);G.AsnNumericStringConverter=ho(jt.NumericString);G.AsnPrintableStringConverter=ho(jt.PrintableString);G.AsnTeletexStringConverter=ho(jt.TeletexString);G.AsnVideotexStringConverter=ho(jt.VideotexString);G.AsnIA5StringConverter=ho(jt.IA5String);G.AsnGraphicStringConverter=ho(jt.GraphicString);G.AsnVisibleStringConverter=ho(jt.VisibleString);G.AsnGeneralStringConverter=ho(jt.GeneralString);G.AsnCharacterStringConverter=ho(jt.CharacterString);G.AsnUTCTimeConverter={fromASN:t=>t.toDate(),toASN:t=>new jt.UTCTime({valueDate:t})};G.AsnGeneralizedTimeConverter={fromASN:t=>t.toDate(),toASN:t=>new jt.GeneralizedTime({valueDate:t})};G.AsnNullConverter={fromASN:()=>null,toASN:()=>new jt.Null};function _pe(t){switch(t){case Qt.AsnPropTypes.Any:return G.AsnAnyConverter;case Qt.AsnPropTypes.BitString:return G.AsnBitStringConverter;case Qt.AsnPropTypes.BmpString:return G.AsnBmpStringConverter;case Qt.AsnPropTypes.Boolean:return G.AsnBooleanConverter;case Qt.AsnPropTypes.CharacterString:return G.AsnCharacterStringConverter;case Qt.AsnPropTypes.Enumerated:return G.AsnEnumeratedConverter;case Qt.AsnPropTypes.GeneralString:return G.AsnGeneralStringConverter;case Qt.AsnPropTypes.GeneralizedTime:return G.AsnGeneralizedTimeConverter;case Qt.AsnPropTypes.GraphicString:return G.AsnGraphicStringConverter;case Qt.AsnPropTypes.IA5String:return G.AsnIA5StringConverter;case Qt.AsnPropTypes.Integer:return G.AsnIntegerConverter;case Qt.AsnPropTypes.Null:return G.AsnNullConverter;case Qt.AsnPropTypes.NumericString:return G.AsnNumericStringConverter;case Qt.AsnPropTypes.ObjectIdentifier:return G.AsnObjectIdentifierConverter;case Qt.AsnPropTypes.OctetString:return G.AsnOctetStringConverter;case Qt.AsnPropTypes.PrintableString:return G.AsnPrintableStringConverter;case Qt.AsnPropTypes.TeletexString:return G.AsnTeletexStringConverter;case Qt.AsnPropTypes.UTCTime:return G.AsnUTCTimeConverter;case Qt.AsnPropTypes.UniversalString:return G.AsnUniversalStringConverter;case Qt.AsnPropTypes.Utf8String:return G.AsnUtf8StringConverter;case Qt.AsnPropTypes.VideotexString:return G.AsnVideotexStringConverter;case Qt.AsnPropTypes.VisibleString:return G.AsnVisibleStringConverter;default:return null}}});var Hw=g(jg=>{"use strict";Object.defineProperty(jg,"__esModule",{value:!0});jg.isConvertible=d5;jg.isTypeOfArray=p5;jg.isArrayEqual=bpe;function d5(t){return typeof t=="function"&&t.prototype?t.prototype.toASN&&t.prototype.fromASN?!0:d5(t.prototype):!!(t&&typeof t=="object"&&"toASN"in t&&"fromASN"in t)}function p5(t){var e;if(t){let r=Object.getPrototypeOf(t);return((e=r?.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:p5(r)}return!1}function bpe(t,e){if(!(t&&e)||t.byteLength!==e.byteLength)return!1;let r=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<t.byteLength;o++)if(r[o]!==n[o])return!1;return!0}});var m5=g(Kw=>{"use strict";Object.defineProperty(Kw,"__esModule",{value:!0});Kw.AsnSchemaStorage=void 0;var Vn=ga(),kd=Tc(),f5=Hw(),Cj=class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,r=!1){let n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(r&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){let r=this.get(e);r.schema||(r.schema=this.create(e,!0))}createDefault(e){let r={type:kd.AsnTypeTypes.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(r,n),r.items=Object.assign({},r.items,n.items)),r}create(e,r){let n=this.items.get(e)||this.createDefault(e),o=[];for(let i in n.items){let s=n.items[i],a=r?i:"",c;if(typeof s.type=="number"){let l=kd.AsnPropTypes[s.type],d=Vn[l];if(!d)throw new Error(`Cannot get ASN1 class by name '${l}'`);c=new d({name:a})}else(0,f5.isConvertible)(s.type)?c=new s.type().toSchema(a):s.optional?this.get(s.type).type===kd.AsnTypeTypes.Choice?c=new Vn.Any({name:a}):(c=this.create(s.type,!1),c.name=a):c=new Vn.Any({name:a});let u=!!s.optional||s.defaultValue!==void 0;if(s.repeated){c.name="";let l=s.repeated==="set"?Vn.Set:Vn.Sequence;c=new l({name:"",value:[new Vn.Repeated({name:a,value:c})]})}if(s.context!==null&&s.context!==void 0)if(s.implicit)if(typeof s.type=="number"||(0,f5.isConvertible)(s.type)){let l=s.repeated?Vn.Constructed:Vn.Primitive;o.push(new l({name:a,optional:u,idBlock:{tagClass:3,tagNumber:s.context}}))}else{this.cache(s.type);let l=!!s.repeated,d=l?c:this.get(s.type,!0).schema;d="valueBlock"in d?d.valueBlock.value:d.value,o.push(new Vn.Constructed({name:l?"":a,optional:u,idBlock:{tagClass:3,tagNumber:s.context},value:d}))}else o.push(new Vn.Constructed({optional:u,idBlock:{tagClass:3,tagNumber:s.context},value:[c]}));else c.optional=u,o.push(c)}switch(n.type){case kd.AsnTypeTypes.Sequence:return new Vn.Sequence({value:o,name:""});case kd.AsnTypeTypes.Set:return new Vn.Set({value:o,name:""});case kd.AsnTypeTypes.Choice:return new Vn.Choice({value:o,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,r){return this.items.set(e,r),this}findParentSchema(e){let r=Object.getPrototypeOf(e);return r?this.items.get(r)||this.findParentSchema(r):null}};Kw.AsnSchemaStorage=Cj});var Gw=g(Ww=>{"use strict";Object.defineProperty(Ww,"__esModule",{value:!0});Ww.schemaStorage=void 0;var wpe=m5();Ww.schemaStorage=new wpe.AsnSchemaStorage});var h5=g(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.AsnProp=pn.AsnSequenceType=pn.AsnSetType=pn.AsnChoiceType=pn.AsnType=void 0;var xpe=Og(),Tj=Tc(),ya=Gw(),Spe=t=>e=>{let r;ya.schemaStorage.has(e)?r=ya.schemaStorage.get(e):(r=ya.schemaStorage.createDefault(e),ya.schemaStorage.set(e,r)),Object.assign(r,t)};pn.AsnType=Spe;var kpe=()=>(0,pn.AsnType)({type:Tj.AsnTypeTypes.Choice});pn.AsnChoiceType=kpe;var $pe=t=>(0,pn.AsnType)({type:Tj.AsnTypeTypes.Set,...t});pn.AsnSetType=$pe;var Ape=t=>(0,pn.AsnType)({type:Tj.AsnTypeTypes.Sequence,...t});pn.AsnSequenceType=Ape;var Ppe=t=>(e,r)=>{let n;ya.schemaStorage.has(e.constructor)?n=ya.schemaStorage.get(e.constructor):(n=ya.schemaStorage.createDefault(e.constructor),ya.schemaStorage.set(e.constructor,n));let o=Object.assign({},t);if(typeof o.type=="number"&&!o.converter){let i=xpe.defaultConverter(t.type);if(!i)throw new Error(`Cannot get default converter for property '${r}' of ${e.constructor.name}`);o.converter=i}o.raw=t.raw,n.items[r]=o};pn.AsnProp=Ppe});var g5=g(Jw=>{"use strict";Object.defineProperty(Jw,"__esModule",{value:!0});Jw.AsnSchemaValidationError=void 0;var Ij=class extends Error{constructor(){super(...arguments),this.schemas=[]}};Jw.AsnSchemaValidationError=Ij});var Oj=g(Ej=>{"use strict";Object.defineProperty(Ej,"__esModule",{value:!0});var Cpe=(O(),I(E));Cpe.__exportStar(g5(),Ej)});var zj=g(Xw=>{"use strict";Object.defineProperty(Xw,"__esModule",{value:!0});Xw.AsnParser=void 0;var An=ga(),va=Tc(),jj=Og(),Ng=Oj(),zg=Hw(),Ic=Gw(),Nj=class{static parse(e,r){let n=An.fromBER(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,r)}static fromASN(e,r){try{if((0,zg.isConvertible)(r))return new r().fromASN(e);let n=Ic.schemaStorage.get(r);Ic.schemaStorage.cache(r);let o=n.schema,i=this.handleChoiceTypes(e,n,r,o);if(i?.result)return i.result;i?.targetSchema&&(o=i.targetSchema);let s=this.handleSequenceTypes(e,n,r,o),a=new r;return(0,zg.isTypeOfArray)(r)?this.handleArrayTypes(e,n,r):(this.processSchemaItems(n,s,a),a)}catch(n){throw n instanceof Ng.AsnSchemaValidationError&&n.schemas.push(r.name),n}}static handleChoiceTypes(e,r,n,o){if(e.constructor===An.Constructed&&r.type===va.AsnTypeTypes.Choice&&e.idBlock.tagClass===3)for(let i in r.items){let s=r.items[i];if(s.context===e.idBlock.tagNumber&&s.implicit&&typeof s.type=="function"&&Ic.schemaStorage.has(s.type)){let a=Ic.schemaStorage.get(s.type);if(a&&a.type===va.AsnTypeTypes.Sequence){let c=new An.Sequence;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in c.valueBlock){c.valueBlock.value=e.valueBlock.value;let u=this.fromASN(c,s.type),l=new n;return l[i]=u,{result:l}}}}}else if(e.constructor===An.Constructed&&r.type!==va.AsnTypeTypes.Choice){let i=new An.Constructed({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:r.schema.valueBlock.value});for(let s in r.items)delete e[s];return{targetSchema:i}}return null}static handleSequenceTypes(e,r,n,o){if(r.type===va.AsnTypeTypes.Sequence){let i=An.compareSchema({},e,o);if(!i.verified)throw new Ng.AsnSchemaValidationError(`Data does not match to ${n.name} ASN1 schema.${i.result.error?` ${i.result.error}`:""}`);return i}else{let i=An.compareSchema({},e,o);if(!i.verified)throw new Ng.AsnSchemaValidationError(`Data does not match to ${n.name} ASN1 schema.${i.result.error?` ${i.result.error}`:""}`);return i}}static processRepeatedField(e,r,n){let o=e.slice(r);if(o.length===1&&o[0].constructor.name==="Sequence"){let i=o[0];i.valueBlock&&i.valueBlock.value&&Array.isArray(i.valueBlock.value)&&(o=i.valueBlock.value)}if(typeof n.type=="number"){let i=jj.defaultConverter(n.type);if(!i)throw new Error(`No converter for ASN.1 type ${n.type}`);return o.filter(s=>s&&s.valueBlock).map(s=>{try{return i.fromASN(s)}catch{return}}).filter(s=>s!==void 0)}else return o.filter(i=>i&&i.valueBlock).map(i=>{try{return this.fromASN(i,n.type)}catch{return}}).filter(i=>i!==void 0)}static processPrimitiveField(e,r){let n=jj.defaultConverter(r.type);if(!n)throw new Error(`No converter for ASN.1 type ${r.type}`);return n.fromASN(e)}static isOptionalChoiceField(e){return e.optional&&typeof e.type=="function"&&Ic.schemaStorage.has(e.type)&&Ic.schemaStorage.get(e.type).type===va.AsnTypeTypes.Choice}static processOptionalChoiceField(e,r){try{return{processed:!0,value:this.fromASN(e,r.type)}}catch(n){if(n instanceof Ng.AsnSchemaValidationError&&/Wrong values for Choice type/.test(n.message))return{processed:!1};throw n}}static handleArrayTypes(e,r,n){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let o=r.itemType;if(typeof o=="number"){let i=jj.defaultConverter(o);if(!i)throw new Error(`Cannot get default converter for array item of ${n.name} ASN1 schema`);return n.from(e.valueBlock.value,s=>i.fromASN(s))}else return n.from(e.valueBlock.value,i=>this.fromASN(i,o))}static processSchemaItems(e,r,n){for(let o in e.items){let i=r.result[o];if(!i)continue;let s=e.items[o],a=s.type,c;typeof a=="number"||(0,zg.isConvertible)(a)?c=this.processPrimitiveSchemaItem(i,s,a):c=this.processComplexSchemaItem(i,s,a),c&&typeof c=="object"&&"value"in c&&"raw"in c?(n[o]=c.value,n[`${o}Raw`]=c.raw):n[o]=c}}static processPrimitiveSchemaItem(e,r,n){var o;let i=(o=r.converter)!==null&&o!==void 0?o:(0,zg.isConvertible)(n)?new n:null;if(!i)throw new Error("Converter is empty");return r.repeated?this.processRepeatedPrimitiveItem(e,r,i):this.processSinglePrimitiveItem(e,r,n,i)}static processRepeatedPrimitiveItem(e,r,n){if(r.implicit){let o=r.repeated==="sequence"?An.Sequence:An.Set,i=new o;i.valueBlock=e.valueBlock;let s=An.fromBER(i.toBER(!1));if(s.offset===-1)throw new Error(`Cannot parse the child item. ${s.result.error}`);if(!("value"in s.result.valueBlock&&Array.isArray(s.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let a=s.result.valueBlock.value;return Array.from(a,c=>n.fromASN(c))}else return Array.from(e,o=>n.fromASN(o))}static processSinglePrimitiveItem(e,r,n,o){let i=e;if(r.implicit){let s;if((0,zg.isConvertible)(n))s=new n().toSchema("");else{let a=va.AsnPropTypes[n],c=An[a];if(!c)throw new Error(`Cannot get '${a}' class from asn1js module`);s=new c}s.valueBlock=i.valueBlock,i=An.fromBER(s.toBER(!1)).result}return o.fromASN(i)}static processComplexSchemaItem(e,r,n){if(r.repeated){if(!Array.isArray(e))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");return Array.from(e,o=>this.fromASN(o,n))}else{let o=this.handleImplicitTagging(e,r,n);if(this.isOptionalChoiceField(r))try{return this.fromASN(o,n)}catch(i){if(i instanceof Ng.AsnSchemaValidationError&&/Wrong values for Choice type/.test(i.message))return;throw i}else{let i=this.fromASN(o,n);return r.raw?{value:i,raw:e.valueBeforeDecodeView}:i}}}static handleImplicitTagging(e,r,n){if(r.implicit&&typeof r.context=="number"){let o=Ic.schemaStorage.get(n);if(o.type===va.AsnTypeTypes.Sequence){let i=new An.Sequence;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in i.valueBlock)return i.valueBlock.value=e.valueBlock.value,i}else if(o.type===va.AsnTypeTypes.Set){let i=new An.Set;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in i.valueBlock)return i.valueBlock.value=e.valueBlock.value,i}}return e}};Xw.AsnParser=Nj});var Dj=g(Qw=>{"use strict";Object.defineProperty(Qw,"__esModule",{value:!0});Qw.AsnSerializer=void 0;var Fo=ga(),Tpe=Og(),Yw=Tc(),Rj=Hw(),y5=Gw(),Mj=class t{static serialize(e){return e instanceof Fo.BaseBlock?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&(0,Rj.isConvertible)(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");let r=e.constructor,n=y5.schemaStorage.get(r);y5.schemaStorage.cache(r);let o=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){let s=Tpe.defaultConverter(n.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${r.name} ASN1 schema`);o=e.map(a=>s.toASN(a))}else o=e.map(s=>this.toAsnItem({type:n.itemType},"[]",r,s))}else for(let s in n.items){let a=n.items[s],c=e[s];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&(0,Rj.isArrayEqual)(this.serialize(a.defaultValue),this.serialize(c)))continue;let u=t.toAsnItem(a,s,r,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||(0,Rj.isConvertible)(a.type))){let l={};l.valueHex=u instanceof Fo.Null?u.valueBeforeDecodeView:u.valueBlock.toBER(),o.push(new Fo.Primitive({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...l}))}else o.push(new Fo.Constructed({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:u.valueBlock.value}));else o.push(new Fo.Constructed({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[u]}));else a.repeated?o=o.concat(u):o.push(u)}let i;switch(n.type){case Yw.AsnTypeTypes.Sequence:i=new Fo.Sequence({value:o});break;case Yw.AsnTypeTypes.Set:i=new Fo.Set({value:o});break;case Yw.AsnTypeTypes.Choice:if(!o[0])throw new Error(`Schema '${r.name}' has wrong data. Choice cannot be empty.`);i=o[0];break}return i}static toAsnItem(e,r,n,o){let i;if(typeof e.type=="number"){let s=e.converter;if(!s)throw new Error(`Property '${r}' doesn't have converter for type ${Yw.AsnPropTypes[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let a=Array.from(o,u=>s.toASN(u)),c=e.repeated==="sequence"?Fo.Sequence:Fo.Set;i=new c({value:a})}else i=s.toASN(o)}else if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let s=Array.from(o,c=>this.toASN(c)),a=e.repeated==="sequence"?Fo.Sequence:Fo.Set;i=new a({value:s})}else i=this.toASN(o);return i}};Qw.AsnSerializer=Mj});var v5=g(ex=>{"use strict";Object.defineProperty(ex,"__esModule",{value:!0});ex.AsnArray=void 0;var qj=class extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(let r of e)this.push(r)}}};ex.AsnArray=qj});var b5=g(tx=>{"use strict";Object.defineProperty(tx,"__esModule",{value:!0});tx.AsnConvert=void 0;var Ipe=ga(),_5=ps(),Epe=zj(),Ope=Dj(),Uj=class t{static serialize(e){return Ope.AsnSerializer.serialize(e)}static parse(e,r){return Epe.AsnParser.parse(e,r)}static toString(e){let r=_5.BufferSourceConverter.isBufferSource(e)?_5.BufferSourceConverter.toArrayBuffer(e):t.serialize(e),n=Ipe.fromBER(r);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}};tx.AsnConvert=Uj});var R=g(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.AsnSerializer=Bt.AsnParser=Bt.AsnPropTypes=Bt.AsnTypeTypes=Bt.AsnSetType=Bt.AsnSequenceType=Bt.AsnChoiceType=Bt.AsnType=Bt.AsnProp=void 0;var Rg=(O(),I(E));Rg.__exportStar(Og(),Bt);Rg.__exportStar(Pj(),Bt);var Mg=h5();Object.defineProperty(Bt,"AsnProp",{enumerable:!0,get:function(){return Mg.AsnProp}});Object.defineProperty(Bt,"AsnType",{enumerable:!0,get:function(){return Mg.AsnType}});Object.defineProperty(Bt,"AsnChoiceType",{enumerable:!0,get:function(){return Mg.AsnChoiceType}});Object.defineProperty(Bt,"AsnSequenceType",{enumerable:!0,get:function(){return Mg.AsnSequenceType}});Object.defineProperty(Bt,"AsnSetType",{enumerable:!0,get:function(){return Mg.AsnSetType}});var w5=Tc();Object.defineProperty(Bt,"AsnTypeTypes",{enumerable:!0,get:function(){return w5.AsnTypeTypes}});Object.defineProperty(Bt,"AsnPropTypes",{enumerable:!0,get:function(){return w5.AsnPropTypes}});var jpe=zj();Object.defineProperty(Bt,"AsnParser",{enumerable:!0,get:function(){return jpe.AsnParser}});var Npe=Dj();Object.defineProperty(Bt,"AsnSerializer",{enumerable:!0,get:function(){return Npe.AsnSerializer}});Rg.__exportStar(Oj(),Bt);Rg.__exportStar(v5(),Bt);Rg.__exportStar(b5(),Bt)});var x5=g(rx=>{"use strict";Object.defineProperty(rx,"__esModule",{value:!0});rx.IpConverter=void 0;var zpe=ps(),Bj=class{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){let r=e.split(".");if(r.length!==4)throw new Error("Invalid IPv4 address");return r.map(n=>{let o=parseInt(n,10);if(isNaN(o)||o<0||o>255)throw new Error("Invalid IPv4 address part");return o})}static parseIPv6(e){let n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((o,i)=>{let s=parseInt(i,16);if(isNaN(s)||s<0||s>65535)throw new Error("Invalid IPv6 address part");return o.push(s>>8&255),o.push(s&255),o},[])}static expandIPv6(e){if(!e.includes("::"))return e;let r=e.split("::");if(r.length>2)throw new Error("Invalid IPv6 address");let n=r[0]?r[0].split(":"):[],o=r[1]?r[1].split(":"):[],i=8-(n.length+o.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...o].join(":")}static formatIPv6(e){let r=[];for(let n=0;n<16;n+=2)r.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(r.join(":"))}static compressIPv6(e){let r=e.split(":"),n=-1,o=0,i=-1,s=0;for(let a=0;a<r.length;a++)r[a]==="0"?(i===-1&&(i=a),s++):(s>o&&(n=i,o=s),i=-1,s=0);if(s>o&&(n=i,o=s),o>1){let a=r.slice(0,n).join(":"),c=r.slice(n+o).join(":");return`${a}::${c}`}return e}static parseCIDR(e){let[r,n]=e.split("/"),o=parseInt(n,10);if(this.isIPv4(r)){if(o<0||o>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(r),o]}else{if(o<0||o>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(r),o]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;let r=parseInt(e.slice(8),16).toString(2).split("").reduce((o,i)=>o+ +i,0),n=e.slice(0,8).replace(/(.{2})/g,o=>`${parseInt(o,16)}.`);return n=n.slice(0,-1),`${n}/${r}`}static toString(e){let r=new Uint8Array(e);if(r.length===4)return Array.from(r).join(".");if(r.length===16)return this.formatIPv6(r);if(r.length===8||r.length===32){let n=r.length/2,o=r.slice(0,n),i=r.slice(n);if(r.every(c=>c===0))return r.length===8?"0.0.0.0/0":"::/0";let a=i.reduce((c,u)=>c+(u.toString(2).match(/1/g)||[]).length,0);return r.length===8?`${Array.from(o).join(".")}/${a}`:`${this.formatIPv6(o)}/${a}`}return this.decodeIP(zpe.Convert.ToHex(e))}static fromString(e){if(e.includes("/")){let[n,o]=this.parseCIDR(e),i=new Uint8Array(n.length),s=o;for(let c=0;c<i.length;c++)s>=8?(i[c]=255,s-=8):s>0&&(i[c]=255<<8-s,s=0);let a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}let r=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(r).buffer}};rx.IpConverter=Bj});var Ad=g(_r=>{"use strict";var Lj,Zj,Vj;Object.defineProperty(_r,"__esModule",{value:!0});_r.Name=_r.RDNSequence=_r.RelativeDistinguishedName=_r.AttributeTypeAndValue=_r.AttributeValue=_r.DirectoryString=void 0;var Pn=(O(),I(E)),pt=R(),Rpe=ps(),gs=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};_r.DirectoryString=gs;Pn.__decorate([(0,pt.AsnProp)({type:pt.AsnPropTypes.TeletexString})],gs.prototype,"teletexString",void 0);Pn.__decorate([(0,pt.AsnProp)({type:pt.AsnPropTypes.PrintableString})],gs.prototype,"printableString",void 0);Pn.__decorate([(0,pt.AsnProp)({type:pt.AsnPropTypes.UniversalString})],gs.prototype,"universalString",void 0);Pn.__decorate([(0,pt.AsnProp)({type:pt.AsnPropTypes.Utf8String})],gs.prototype,"utf8String",void 0);Pn.__decorate([(0,pt.AsnProp)({type:pt.AsnPropTypes.BmpString})],gs.prototype,"bmpString",void 0);_r.DirectoryString=gs=Pn.__decorate([(0,pt.AsnType)({type:pt.AsnTypeTypes.Choice})],gs);var Ec=class extends gs{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Rpe.Convert.ToHex(this.anyValue):super.toString())}};_r.AttributeValue=Ec;Pn.__decorate([(0,pt.AsnProp)({type:pt.AsnPropTypes.IA5String})],Ec.prototype,"ia5String",void 0);Pn.__decorate([(0,pt.AsnProp)({type:pt.AsnPropTypes.Any})],Ec.prototype,"anyValue",void 0);_r.AttributeValue=Ec=Pn.__decorate([(0,pt.AsnType)({type:pt.AsnTypeTypes.Choice})],Ec);var $d=class{constructor(e={}){this.type="",this.value=new Ec,Object.assign(this,e)}};_r.AttributeTypeAndValue=$d;Pn.__decorate([(0,pt.AsnProp)({type:pt.AsnPropTypes.ObjectIdentifier})],$d.prototype,"type",void 0);Pn.__decorate([(0,pt.AsnProp)({type:Ec})],$d.prototype,"value",void 0);var nx=Lj=class extends pt.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Lj.prototype)}};_r.RelativeDistinguishedName=nx;_r.RelativeDistinguishedName=nx=Lj=Pn.__decorate([(0,pt.AsnType)({type:pt.AsnTypeTypes.Set,itemType:$d})],nx);var ox=Zj=class extends pt.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Zj.prototype)}};_r.RDNSequence=ox;_r.RDNSequence=ox=Zj=Pn.__decorate([(0,pt.AsnType)({type:pt.AsnTypeTypes.Sequence,itemType:nx})],ox);var Fj=Vj=class extends ox{constructor(e){super(e),Object.setPrototypeOf(this,Vj.prototype)}};_r.Name=Fj;_r.Name=Fj=Vj=Pn.__decorate([(0,pt.AsnType)({type:pt.AsnTypeTypes.Sequence})],Fj)});var Oc=g(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});go.GeneralName=go.EDIPartyName=go.OtherName=go.AsnIpConverter=void 0;var Cn=(O(),I(E)),Lt=R(),S5=x5(),ix=Ad();go.AsnIpConverter={fromASN:t=>S5.IpConverter.toString(Lt.AsnOctetStringConverter.fromASN(t)),toASN:t=>Lt.AsnOctetStringConverter.toASN(S5.IpConverter.fromString(t))};var Pd=class{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};go.OtherName=Pd;Cn.__decorate([(0,Lt.AsnProp)({type:Lt.AsnPropTypes.ObjectIdentifier})],Pd.prototype,"typeId",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:Lt.AsnPropTypes.Any,context:0})],Pd.prototype,"value",void 0);var Cd=class{constructor(e={}){this.partyName=new ix.DirectoryString,Object.assign(this,e)}};go.EDIPartyName=Cd;Cn.__decorate([(0,Lt.AsnProp)({type:ix.DirectoryString,optional:!0,context:0,implicit:!0})],Cd.prototype,"nameAssigner",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:ix.DirectoryString,context:1,implicit:!0})],Cd.prototype,"partyName",void 0);var yo=class{constructor(e={}){Object.assign(this,e)}};go.GeneralName=yo;Cn.__decorate([(0,Lt.AsnProp)({type:Pd,context:0,implicit:!0})],yo.prototype,"otherName",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:Lt.AsnPropTypes.IA5String,context:1,implicit:!0})],yo.prototype,"rfc822Name",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:Lt.AsnPropTypes.IA5String,context:2,implicit:!0})],yo.prototype,"dNSName",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:Lt.AsnPropTypes.Any,context:3,implicit:!0})],yo.prototype,"x400Address",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:ix.Name,context:4,implicit:!1})],yo.prototype,"directoryName",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:Cd,context:5})],yo.prototype,"ediPartyName",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:Lt.AsnPropTypes.IA5String,context:6,implicit:!0})],yo.prototype,"uniformResourceIdentifier",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:Lt.AsnPropTypes.OctetString,context:7,implicit:!0,converter:go.AsnIpConverter})],yo.prototype,"iPAddress",void 0);Cn.__decorate([(0,Lt.AsnProp)({type:Lt.AsnPropTypes.ObjectIdentifier,context:8,implicit:!0})],yo.prototype,"registeredID",void 0);go.GeneralName=yo=Cn.__decorate([(0,Lt.AsnType)({type:Lt.AsnTypeTypes.Choice})],yo)});var Nt=g(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.id_ce=We.id_ad_caRepository=We.id_ad_timeStamping=We.id_ad_caIssuers=We.id_ad_ocsp=We.id_qt_unotice=We.id_qt_csp=We.id_ad=We.id_kp=We.id_qt=We.id_pe=We.id_pkix=void 0;We.id_pkix="1.3.6.1.5.5.7";We.id_pe=`${We.id_pkix}.1`;We.id_qt=`${We.id_pkix}.2`;We.id_kp=`${We.id_pkix}.3`;We.id_ad=`${We.id_pkix}.48`;We.id_qt_csp=`${We.id_qt}.1`;We.id_qt_unotice=`${We.id_qt}.2`;We.id_ad_ocsp=`${We.id_ad}.1`;We.id_ad_caIssuers=`${We.id_ad}.2`;We.id_ad_timeStamping=`${We.id_ad}.3`;We.id_ad_caRepository=`${We.id_ad}.5`;We.id_ce="2.5.29"});var Gj=g(ys=>{"use strict";var Hj;Object.defineProperty(ys,"__esModule",{value:!0});ys.AuthorityInfoAccessSyntax=ys.AccessDescription=ys.id_pe_authorityInfoAccess=void 0;var Wj=(O(),I(E)),Td=R(),k5=Oc(),Mpe=Nt();ys.id_pe_authorityInfoAccess=`${Mpe.id_pe}.1`;var Id=class{constructor(e={}){this.accessMethod="",this.accessLocation=new k5.GeneralName,Object.assign(this,e)}};ys.AccessDescription=Id;Wj.__decorate([(0,Td.AsnProp)({type:Td.AsnPropTypes.ObjectIdentifier})],Id.prototype,"accessMethod",void 0);Wj.__decorate([(0,Td.AsnProp)({type:k5.GeneralName})],Id.prototype,"accessLocation",void 0);var Kj=Hj=class extends Td.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Hj.prototype)}};ys.AuthorityInfoAccessSyntax=Kj;ys.AuthorityInfoAccessSyntax=Kj=Hj=Wj.__decorate([(0,Td.AsnType)({type:Td.AsnTypeTypes.Sequence,itemType:Id})],Kj)});var Xj=g(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.AuthorityKeyIdentifier=_a.KeyIdentifier=_a.id_ce_authorityKeyIdentifier=void 0;var Jj=(O(),I(E)),Ed=R(),Dpe=Oc(),qpe=Nt();_a.id_ce_authorityKeyIdentifier=`${qpe.id_ce}.35`;var sx=class extends Ed.OctetString{};_a.KeyIdentifier=sx;var Od=class{constructor(e={}){e&&Object.assign(this,e)}};_a.AuthorityKeyIdentifier=Od;Jj.__decorate([(0,Ed.AsnProp)({type:sx,context:0,optional:!0,implicit:!0})],Od.prototype,"keyIdentifier",void 0);Jj.__decorate([(0,Ed.AsnProp)({type:Dpe.GeneralName,context:1,optional:!0,implicit:!0,repeated:"sequence"})],Od.prototype,"authorityCertIssuer",void 0);Jj.__decorate([(0,Ed.AsnProp)({type:Ed.AsnPropTypes.Integer,context:2,optional:!0,implicit:!0,converter:Ed.AsnIntegerArrayBufferConverter})],Od.prototype,"authorityCertSerialNumber",void 0)});var A5=g(jd=>{"use strict";Object.defineProperty(jd,"__esModule",{value:!0});jd.BasicConstraints=jd.id_ce_basicConstraints=void 0;var $5=(O(),I(E)),ax=R(),Upe=Nt();jd.id_ce_basicConstraints=`${Upe.id_ce}.19`;var Dg=class{constructor(e={}){this.cA=!1,Object.assign(this,e)}};jd.BasicConstraints=Dg;$5.__decorate([(0,ax.AsnProp)({type:ax.AsnPropTypes.Boolean,defaultValue:!1})],Dg.prototype,"cA",void 0);$5.__decorate([(0,ax.AsnProp)({type:ax.AsnPropTypes.Integer,optional:!0})],Dg.prototype,"pathLenConstraint",void 0)});var Ug=g(qg=>{"use strict";var Yj;Object.defineProperty(qg,"__esModule",{value:!0});qg.GeneralNames=void 0;var Bpe=(O(),I(E)),P5=R(),Lpe=Oc(),Zpe=R(),Qj=Yj=class extends Zpe.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Yj.prototype)}};qg.GeneralNames=Qj;qg.GeneralNames=Qj=Yj=Bpe.__decorate([(0,P5.AsnType)({type:P5.AsnTypeTypes.Sequence,itemType:Lpe.GeneralName})],Qj)});var T5=g(jc=>{"use strict";var eN;Object.defineProperty(jc,"__esModule",{value:!0});jc.CertificateIssuer=jc.id_ce_certificateIssuer=void 0;var Vpe=(O(),I(E)),C5=R(),Fpe=Ug(),Hpe=Nt();jc.id_ce_certificateIssuer=`${Hpe.id_ce}.29`;var tN=eN=class extends Fpe.GeneralNames{constructor(e){super(e),Object.setPrototypeOf(this,eN.prototype)}};jc.CertificateIssuer=tN;jc.CertificateIssuer=tN=eN=Vpe.__decorate([(0,C5.AsnType)({type:C5.AsnTypeTypes.Sequence})],tN)});var I5=g(Kt=>{"use strict";var rN;Object.defineProperty(Kt,"__esModule",{value:!0});Kt.CertificatePolicies=Kt.PolicyInformation=Kt.PolicyQualifierInfo=Kt.Qualifier=Kt.UserNotice=Kt.NoticeReference=Kt.DisplayText=Kt.id_ce_certificatePolicies_anyPolicy=Kt.id_ce_certificatePolicies=void 0;var Ur=(O(),I(E)),ct=R(),Kpe=Nt();Kt.id_ce_certificatePolicies=`${Kpe.id_ce}.32`;Kt.id_ce_certificatePolicies_anyPolicy=`${Kt.id_ce_certificatePolicies}.0`;var Ai=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};Kt.DisplayText=Ai;Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.IA5String})],Ai.prototype,"ia5String",void 0);Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.VisibleString})],Ai.prototype,"visibleString",void 0);Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.BmpString})],Ai.prototype,"bmpString",void 0);Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.Utf8String})],Ai.prototype,"utf8String",void 0);Kt.DisplayText=Ai=Ur.__decorate([(0,ct.AsnType)({type:ct.AsnTypeTypes.Choice})],Ai);var Nd=class{constructor(e={}){this.organization=new Ai,this.noticeNumbers=[],Object.assign(this,e)}};Kt.NoticeReference=Nd;Ur.__decorate([(0,ct.AsnProp)({type:Ai})],Nd.prototype,"organization",void 0);Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.Integer,repeated:"sequence"})],Nd.prototype,"noticeNumbers",void 0);var zd=class{constructor(e={}){Object.assign(this,e)}};Kt.UserNotice=zd;Ur.__decorate([(0,ct.AsnProp)({type:Nd,optional:!0})],zd.prototype,"noticeRef",void 0);Ur.__decorate([(0,ct.AsnProp)({type:Ai,optional:!0})],zd.prototype,"explicitText",void 0);var Bg=class{constructor(e={}){Object.assign(this,e)}};Kt.Qualifier=Bg;Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.IA5String})],Bg.prototype,"cPSuri",void 0);Ur.__decorate([(0,ct.AsnProp)({type:zd})],Bg.prototype,"userNotice",void 0);Kt.Qualifier=Bg=Ur.__decorate([(0,ct.AsnType)({type:ct.AsnTypeTypes.Choice})],Bg);var Rd=class{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}};Kt.PolicyQualifierInfo=Rd;Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.ObjectIdentifier})],Rd.prototype,"policyQualifierId",void 0);Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.Any})],Rd.prototype,"qualifier",void 0);var Md=class{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}};Kt.PolicyInformation=Md;Ur.__decorate([(0,ct.AsnProp)({type:ct.AsnPropTypes.ObjectIdentifier})],Md.prototype,"policyIdentifier",void 0);Ur.__decorate([(0,ct.AsnProp)({type:Rd,repeated:"sequence",optional:!0})],Md.prototype,"policyQualifiers",void 0);var nN=rN=class extends ct.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,rN.prototype)}};Kt.CertificatePolicies=nN;Kt.CertificatePolicies=nN=rN=Ur.__decorate([(0,ct.AsnType)({type:ct.AsnTypeTypes.Sequence,itemType:Md})],nN)});var oN=g(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.CRLNumber=Nc.id_ce_cRLNumber=void 0;var E5=(O(),I(E)),cx=R(),Wpe=Nt();Nc.id_ce_cRLNumber=`${Wpe.id_ce}.20`;var ux=class{constructor(e=0){this.value=e}};Nc.CRLNumber=ux;E5.__decorate([(0,cx.AsnProp)({type:cx.AsnPropTypes.Integer})],ux.prototype,"value",void 0);Nc.CRLNumber=ux=E5.__decorate([(0,cx.AsnType)({type:cx.AsnTypeTypes.Choice})],ux)});var j5=g(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.BaseCRLNumber=zc.id_ce_deltaCRLIndicator=void 0;var Gpe=(O(),I(E)),O5=R(),Jpe=Nt(),Xpe=oN();zc.id_ce_deltaCRLIndicator=`${Jpe.id_ce}.27`;var iN=class extends Xpe.CRLNumber{};zc.BaseCRLNumber=iN;zc.BaseCRLNumber=iN=Gpe.__decorate([(0,O5.AsnType)({type:O5.AsnTypeTypes.Choice})],iN)});var dx=g(Jr=>{"use strict";var sN;Object.defineProperty(Jr,"__esModule",{value:!0});Jr.CRLDistributionPoints=Jr.DistributionPoint=Jr.DistributionPointName=Jr.Reason=Jr.ReasonFlags=Jr.id_ce_cRLDistributionPoints=void 0;var Mc=(O(),I(E)),Ko=R(),Ype=Ad(),N5=Oc(),Qpe=Nt();Jr.id_ce_cRLDistributionPoints=`${Qpe.id_ce}.31`;var Ho;(function(t){t[t.unused=1]="unused",t[t.keyCompromise=2]="keyCompromise",t[t.cACompromise=4]="cACompromise",t[t.affiliationChanged=8]="affiliationChanged",t[t.superseded=16]="superseded",t[t.cessationOfOperation=32]="cessationOfOperation",t[t.certificateHold=64]="certificateHold",t[t.privilegeWithdrawn=128]="privilegeWithdrawn",t[t.aACompromise=256]="aACompromise"})(Ho||(Jr.ReasonFlags=Ho={}));var lx=class extends Ko.BitString{toJSON(){let e=[],r=this.toNumber();return r&Ho.aACompromise&&e.push("aACompromise"),r&Ho.affiliationChanged&&e.push("affiliationChanged"),r&Ho.cACompromise&&e.push("cACompromise"),r&Ho.certificateHold&&e.push("certificateHold"),r&Ho.cessationOfOperation&&e.push("cessationOfOperation"),r&Ho.keyCompromise&&e.push("keyCompromise"),r&Ho.privilegeWithdrawn&&e.push("privilegeWithdrawn"),r&Ho.superseded&&e.push("superseded"),r&Ho.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}};Jr.Reason=lx;var Dd=class{constructor(e={}){Object.assign(this,e)}};Jr.DistributionPointName=Dd;Mc.__decorate([(0,Ko.AsnProp)({type:N5.GeneralName,context:0,repeated:"sequence",implicit:!0})],Dd.prototype,"fullName",void 0);Mc.__decorate([(0,Ko.AsnProp)({type:Ype.RelativeDistinguishedName,context:1,implicit:!0})],Dd.prototype,"nameRelativeToCRLIssuer",void 0);Jr.DistributionPointName=Dd=Mc.__decorate([(0,Ko.AsnType)({type:Ko.AsnTypeTypes.Choice})],Dd);var Rc=class{constructor(e={}){Object.assign(this,e)}};Jr.DistributionPoint=Rc;Mc.__decorate([(0,Ko.AsnProp)({type:Dd,context:0,optional:!0})],Rc.prototype,"distributionPoint",void 0);Mc.__decorate([(0,Ko.AsnProp)({type:lx,context:1,optional:!0,implicit:!0})],Rc.prototype,"reasons",void 0);Mc.__decorate([(0,Ko.AsnProp)({type:N5.GeneralName,context:2,optional:!0,repeated:"sequence",implicit:!0})],Rc.prototype,"cRLIssuer",void 0);var aN=sN=class extends Ko.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,sN.prototype)}};Jr.CRLDistributionPoints=aN;Jr.CRLDistributionPoints=aN=sN=Mc.__decorate([(0,Ko.AsnType)({type:Ko.AsnTypeTypes.Sequence,itemType:Rc})],aN)});var M5=g(Dc=>{"use strict";var cN;Object.defineProperty(Dc,"__esModule",{value:!0});Dc.FreshestCRL=Dc.id_ce_freshestCRL=void 0;var efe=(O(),I(E)),z5=R(),tfe=Nt(),R5=dx();Dc.id_ce_freshestCRL=`${tfe.id_ce}.46`;var uN=cN=class extends R5.CRLDistributionPoints{constructor(e){super(e),Object.setPrototypeOf(this,cN.prototype)}};Dc.FreshestCRL=uN;Dc.FreshestCRL=uN=cN=efe.__decorate([(0,z5.AsnType)({type:z5.AsnTypeTypes.Sequence,itemType:R5.DistributionPoint})],uN)});var q5=g(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.IssuingDistributionPoint=qd.id_ce_issuingDistributionPoint=void 0;var Ud=(O(),I(E)),Bd=R(),D5=dx(),rfe=Nt(),px=R();qd.id_ce_issuingDistributionPoint=`${rfe.id_ce}.28`;var Tn=class t{constructor(e={}){this.onlyContainsUserCerts=t.ONLY,this.onlyContainsCACerts=t.ONLY,this.indirectCRL=t.ONLY,this.onlyContainsAttributeCerts=t.ONLY,Object.assign(this,e)}};qd.IssuingDistributionPoint=Tn;Tn.ONLY=!1;Ud.__decorate([(0,Bd.AsnProp)({type:D5.DistributionPointName,context:0,optional:!0})],Tn.prototype,"distributionPoint",void 0);Ud.__decorate([(0,Bd.AsnProp)({type:px.AsnPropTypes.Boolean,context:1,defaultValue:Tn.ONLY,implicit:!0})],Tn.prototype,"onlyContainsUserCerts",void 0);Ud.__decorate([(0,Bd.AsnProp)({type:px.AsnPropTypes.Boolean,context:2,defaultValue:Tn.ONLY,implicit:!0})],Tn.prototype,"onlyContainsCACerts",void 0);Ud.__decorate([(0,Bd.AsnProp)({type:D5.Reason,context:3,optional:!0,implicit:!0})],Tn.prototype,"onlySomeReasons",void 0);Ud.__decorate([(0,Bd.AsnProp)({type:px.AsnPropTypes.Boolean,context:4,defaultValue:Tn.ONLY,implicit:!0})],Tn.prototype,"indirectCRL",void 0);Ud.__decorate([(0,Bd.AsnProp)({type:px.AsnPropTypes.Boolean,context:5,defaultValue:Tn.ONLY,implicit:!0})],Tn.prototype,"onlyContainsAttributeCerts",void 0)});var B5=g(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});vs.CRLReason=vs.CRLReasons=vs.id_ce_cRLReasons=void 0;var U5=(O(),I(E)),fx=R(),nfe=Nt();vs.id_ce_cRLReasons=`${nfe.id_ce}.21`;var Lg;(function(t){t[t.unspecified=0]="unspecified",t[t.keyCompromise=1]="keyCompromise",t[t.cACompromise=2]="cACompromise",t[t.affiliationChanged=3]="affiliationChanged",t[t.superseded=4]="superseded",t[t.cessationOfOperation=5]="cessationOfOperation",t[t.certificateHold=6]="certificateHold",t[t.removeFromCRL=8]="removeFromCRL",t[t.privilegeWithdrawn=9]="privilegeWithdrawn",t[t.aACompromise=10]="aACompromise"})(Lg||(vs.CRLReasons=Lg={}));var mx=class{constructor(e=Lg.unspecified){this.reason=Lg.unspecified,this.reason=e}toJSON(){return Lg[this.reason]}toString(){return this.toJSON()}};vs.CRLReason=mx;U5.__decorate([(0,fx.AsnProp)({type:fx.AsnPropTypes.Enumerated})],mx.prototype,"reason",void 0);vs.CRLReason=mx=U5.__decorate([(0,fx.AsnType)({type:fx.AsnTypeTypes.Choice})],mx)});var L5=g(er=>{"use strict";var lN;Object.defineProperty(er,"__esModule",{value:!0});er.id_kp_OCSPSigning=er.id_kp_timeStamping=er.id_kp_emailProtection=er.id_kp_codeSigning=er.id_kp_clientAuth=er.id_kp_serverAuth=er.anyExtendedKeyUsage=er.ExtendedKeyUsage=er.id_ce_extKeyUsage=void 0;var ofe=(O(),I(E)),hx=R(),qc=Nt();er.id_ce_extKeyUsage=`${qc.id_ce}.37`;var dN=lN=class extends hx.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,lN.prototype)}};er.ExtendedKeyUsage=dN;er.ExtendedKeyUsage=dN=lN=ofe.__decorate([(0,hx.AsnType)({type:hx.AsnTypeTypes.Sequence,itemType:hx.AsnPropTypes.ObjectIdentifier})],dN);er.anyExtendedKeyUsage=`${er.id_ce_extKeyUsage}.0`;er.id_kp_serverAuth=`${qc.id_kp}.1`;er.id_kp_clientAuth=`${qc.id_kp}.2`;er.id_kp_codeSigning=`${qc.id_kp}.3`;er.id_kp_emailProtection=`${qc.id_kp}.4`;er.id_kp_timeStamping=`${qc.id_kp}.8`;er.id_kp_OCSPSigning=`${qc.id_kp}.9`});var V5=g(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.InhibitAnyPolicy=Uc.id_ce_inhibitAnyPolicy=void 0;var Z5=(O(),I(E)),Zg=R(),ife=Nt();Uc.id_ce_inhibitAnyPolicy=`${ife.id_ce}.54`;var gx=class{constructor(e=new ArrayBuffer(0)){this.value=e}};Uc.InhibitAnyPolicy=gx;Z5.__decorate([(0,Zg.AsnProp)({type:Zg.AsnPropTypes.Integer,converter:Zg.AsnIntegerArrayBufferConverter})],gx.prototype,"value",void 0);Uc.InhibitAnyPolicy=gx=Z5.__decorate([(0,Zg.AsnType)({type:Zg.AsnTypeTypes.Choice})],gx)});var H5=g(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});Bc.InvalidityDate=Bc.id_ce_invalidityDate=void 0;var F5=(O(),I(E)),yx=R(),sfe=Nt();Bc.id_ce_invalidityDate=`${sfe.id_ce}.24`;var vx=class{constructor(e){this.value=new Date,e&&(this.value=e)}};Bc.InvalidityDate=vx;F5.__decorate([(0,yx.AsnProp)({type:yx.AsnPropTypes.GeneralizedTime})],vx.prototype,"value",void 0);Bc.InvalidityDate=vx=F5.__decorate([(0,yx.AsnType)({type:yx.AsnTypeTypes.Choice})],vx)});var W5=g(Lc=>{"use strict";var pN;Object.defineProperty(Lc,"__esModule",{value:!0});Lc.IssueAlternativeName=Lc.id_ce_issuerAltName=void 0;var afe=(O(),I(E)),K5=R(),cfe=Ug(),ufe=Nt();Lc.id_ce_issuerAltName=`${ufe.id_ce}.18`;var fN=pN=class extends cfe.GeneralNames{constructor(e){super(e),Object.setPrototypeOf(this,pN.prototype)}};Lc.IssueAlternativeName=fN;Lc.IssueAlternativeName=fN=pN=afe.__decorate([(0,K5.AsnType)({type:K5.AsnTypeTypes.Sequence})],fN)});var G5=g(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});ba.KeyUsage=ba.KeyUsageFlags=ba.id_ce_keyUsage=void 0;var lfe=R(),dfe=Nt();ba.id_ce_keyUsage=`${dfe.id_ce}.15`;var Wo;(function(t){t[t.digitalSignature=1]="digitalSignature",t[t.nonRepudiation=2]="nonRepudiation",t[t.keyEncipherment=4]="keyEncipherment",t[t.dataEncipherment=8]="dataEncipherment",t[t.keyAgreement=16]="keyAgreement",t[t.keyCertSign=32]="keyCertSign",t[t.cRLSign=64]="cRLSign",t[t.encipherOnly=128]="encipherOnly",t[t.decipherOnly=256]="decipherOnly"})(Wo||(ba.KeyUsageFlags=Wo={}));var mN=class extends lfe.BitString{toJSON(){let e=this.toNumber(),r=[];return e&Wo.cRLSign&&r.push("crlSign"),e&Wo.dataEncipherment&&r.push("dataEncipherment"),e&Wo.decipherOnly&&r.push("decipherOnly"),e&Wo.digitalSignature&&r.push("digitalSignature"),e&Wo.encipherOnly&&r.push("encipherOnly"),e&Wo.keyAgreement&&r.push("keyAgreement"),e&Wo.keyCertSign&&r.push("keyCertSign"),e&Wo.keyEncipherment&&r.push("keyEncipherment"),e&Wo.nonRepudiation&&r.push("nonRepudiation"),r}toString(){return`[${this.toJSON().join(", ")}]`}};ba.KeyUsage=mN});var X5=g(Go=>{"use strict";var hN;Object.defineProperty(Go,"__esModule",{value:!0});Go.NameConstraints=Go.GeneralSubtrees=Go.GeneralSubtree=Go.id_ce_nameConstraints=void 0;var Ld=(O(),I(E)),Pi=R(),J5=Oc(),pfe=Nt();Go.id_ce_nameConstraints=`${pfe.id_ce}.30`;var Zc=class{constructor(e={}){this.base=new J5.GeneralName,this.minimum=0,Object.assign(this,e)}};Go.GeneralSubtree=Zc;Ld.__decorate([(0,Pi.AsnProp)({type:J5.GeneralName})],Zc.prototype,"base",void 0);Ld.__decorate([(0,Pi.AsnProp)({type:Pi.AsnPropTypes.Integer,context:0,defaultValue:0,implicit:!0})],Zc.prototype,"minimum",void 0);Ld.__decorate([(0,Pi.AsnProp)({type:Pi.AsnPropTypes.Integer,context:1,optional:!0,implicit:!0})],Zc.prototype,"maximum",void 0);var Vg=hN=class extends Pi.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,hN.prototype)}};Go.GeneralSubtrees=Vg;Go.GeneralSubtrees=Vg=hN=Ld.__decorate([(0,Pi.AsnType)({type:Pi.AsnTypeTypes.Sequence,itemType:Zc})],Vg);var Fg=class{constructor(e={}){Object.assign(this,e)}};Go.NameConstraints=Fg;Ld.__decorate([(0,Pi.AsnProp)({type:Vg,context:0,optional:!0,implicit:!0})],Fg.prototype,"permittedSubtrees",void 0);Ld.__decorate([(0,Pi.AsnProp)({type:Vg,context:1,optional:!0,implicit:!0})],Fg.prototype,"excludedSubtrees",void 0)});var Q5=g(Vd=>{"use strict";Object.defineProperty(Vd,"__esModule",{value:!0});Vd.PolicyConstraints=Vd.id_ce_policyConstraints=void 0;var Y5=(O(),I(E)),Zd=R(),ffe=Nt();Vd.id_ce_policyConstraints=`${ffe.id_ce}.36`;var Hg=class{constructor(e={}){Object.assign(this,e)}};Vd.PolicyConstraints=Hg;Y5.__decorate([(0,Zd.AsnProp)({type:Zd.AsnPropTypes.Integer,context:0,implicit:!0,optional:!0,converter:Zd.AsnIntegerArrayBufferConverter})],Hg.prototype,"requireExplicitPolicy",void 0);Y5.__decorate([(0,Zd.AsnProp)({type:Zd.AsnPropTypes.Integer,context:1,implicit:!0,optional:!0,converter:Zd.AsnIntegerArrayBufferConverter})],Hg.prototype,"inhibitPolicyMapping",void 0)});var e3=g(_s=>{"use strict";var gN;Object.defineProperty(_s,"__esModule",{value:!0});_s.PolicyMappings=_s.PolicyMapping=_s.id_ce_policyMappings=void 0;var vN=(O(),I(E)),Vc=R(),mfe=Nt();_s.id_ce_policyMappings=`${mfe.id_ce}.33`;var Fd=class{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}};_s.PolicyMapping=Fd;vN.__decorate([(0,Vc.AsnProp)({type:Vc.AsnPropTypes.ObjectIdentifier})],Fd.prototype,"issuerDomainPolicy",void 0);vN.__decorate([(0,Vc.AsnProp)({type:Vc.AsnPropTypes.ObjectIdentifier})],Fd.prototype,"subjectDomainPolicy",void 0);var yN=gN=class extends Vc.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,gN.prototype)}};_s.PolicyMappings=yN;_s.PolicyMappings=yN=gN=vN.__decorate([(0,Vc.AsnType)({type:Vc.AsnTypeTypes.Sequence,itemType:Fd})],yN)});var r3=g(Fc=>{"use strict";var _N;Object.defineProperty(Fc,"__esModule",{value:!0});Fc.SubjectAlternativeName=Fc.id_ce_subjectAltName=void 0;var hfe=(O(),I(E)),t3=R(),gfe=Ug(),yfe=Nt();Fc.id_ce_subjectAltName=`${yfe.id_ce}.17`;var bN=_N=class extends gfe.GeneralNames{constructor(e){super(e),Object.setPrototypeOf(this,_N.prototype)}};Fc.SubjectAlternativeName=bN;Fc.SubjectAlternativeName=bN=_N=hfe.__decorate([(0,t3.AsnType)({type:t3.AsnTypeTypes.Sequence})],bN)});var wN=g(bx=>{"use strict";Object.defineProperty(bx,"__esModule",{value:!0});bx.Attribute=void 0;var n3=(O(),I(E)),_x=R(),Kg=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};bx.Attribute=Kg;n3.__decorate([(0,_x.AsnProp)({type:_x.AsnPropTypes.ObjectIdentifier})],Kg.prototype,"type",void 0);n3.__decorate([(0,_x.AsnProp)({type:_x.AsnPropTypes.Any,repeated:"set"})],Kg.prototype,"values",void 0)});var o3=g(Hc=>{"use strict";var xN;Object.defineProperty(Hc,"__esModule",{value:!0});Hc.SubjectDirectoryAttributes=Hc.id_ce_subjectDirectoryAttributes=void 0;var vfe=(O(),I(E)),SN=R(),_fe=wN(),bfe=Nt();Hc.id_ce_subjectDirectoryAttributes=`${bfe.id_ce}.9`;var kN=xN=class extends SN.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,xN.prototype)}};Hc.SubjectDirectoryAttributes=kN;Hc.SubjectDirectoryAttributes=kN=xN=vfe.__decorate([(0,SN.AsnType)({type:SN.AsnTypeTypes.Sequence,itemType:_fe.Attribute})],kN)});var i3=g(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});Hd.SubjectKeyIdentifier=Hd.id_ce_subjectKeyIdentifier=void 0;var wfe=Nt(),xfe=Xj();Hd.id_ce_subjectKeyIdentifier=`${wfe.id_ce}.14`;var $N=class extends xfe.KeyIdentifier{};Hd.SubjectKeyIdentifier=$N});var a3=g(Kd=>{"use strict";Object.defineProperty(Kd,"__esModule",{value:!0});Kd.PrivateKeyUsagePeriod=Kd.id_ce_privateKeyUsagePeriod=void 0;var s3=(O(),I(E)),wx=R(),Sfe=Nt();Kd.id_ce_privateKeyUsagePeriod=`${Sfe.id_ce}.16`;var Wg=class{constructor(e={}){Object.assign(this,e)}};Kd.PrivateKeyUsagePeriod=Wg;s3.__decorate([(0,wx.AsnProp)({type:wx.AsnPropTypes.GeneralizedTime,context:0,implicit:!0,optional:!0})],Wg.prototype,"notBefore",void 0);s3.__decorate([(0,wx.AsnProp)({type:wx.AsnPropTypes.GeneralizedTime,context:1,implicit:!0,optional:!0})],Wg.prototype,"notAfter",void 0)});var u3=g(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.EntrustVersionInfo=Ci.EntrustInfo=Ci.EntrustInfoFlags=Ci.id_entrust_entrustVersInfo=void 0;var c3=(O(),I(E)),xx=R();Ci.id_entrust_entrustVersInfo="1.2.840.113533.7.65.0";var Gg;(function(t){t[t.keyUpdateAllowed=1]="keyUpdateAllowed",t[t.newExtensions=2]="newExtensions",t[t.pKIXCertificate=4]="pKIXCertificate"})(Gg||(Ci.EntrustInfoFlags=Gg={}));var Jg=class extends xx.BitString{toJSON(){let e=[],r=this.toNumber();return r&Gg.pKIXCertificate&&e.push("pKIXCertificate"),r&Gg.newExtensions&&e.push("newExtensions"),r&Gg.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}};Ci.EntrustInfo=Jg;var Xg=class{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new Jg,Object.assign(this,e)}};Ci.EntrustVersionInfo=Xg;c3.__decorate([(0,xx.AsnProp)({type:xx.AsnPropTypes.GeneralString})],Xg.prototype,"entrustVers",void 0);c3.__decorate([(0,xx.AsnProp)({type:Jg})],Xg.prototype,"entrustInfoFlags",void 0)});var l3=g(Kc=>{"use strict";var AN;Object.defineProperty(Kc,"__esModule",{value:!0});Kc.SubjectInfoAccessSyntax=Kc.id_pe_subjectInfoAccess=void 0;var kfe=(O(),I(E)),PN=R(),$fe=Nt(),Afe=Gj();Kc.id_pe_subjectInfoAccess=`${$fe.id_pe}.11`;var CN=AN=class extends PN.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,AN.prototype)}};Kc.SubjectInfoAccessSyntax=CN;Kc.SubjectInfoAccessSyntax=CN=AN=kfe.__decorate([(0,PN.AsnType)({type:PN.AsnTypeTypes.Sequence,itemType:Afe.AccessDescription})],CN)});var d3=g(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});var Zt=(O(),I(E));Zt.__exportStar(Gj(),kt);Zt.__exportStar(Xj(),kt);Zt.__exportStar(A5(),kt);Zt.__exportStar(T5(),kt);Zt.__exportStar(I5(),kt);Zt.__exportStar(j5(),kt);Zt.__exportStar(dx(),kt);Zt.__exportStar(M5(),kt);Zt.__exportStar(q5(),kt);Zt.__exportStar(oN(),kt);Zt.__exportStar(B5(),kt);Zt.__exportStar(L5(),kt);Zt.__exportStar(V5(),kt);Zt.__exportStar(H5(),kt);Zt.__exportStar(W5(),kt);Zt.__exportStar(G5(),kt);Zt.__exportStar(X5(),kt);Zt.__exportStar(Q5(),kt);Zt.__exportStar(e3(),kt);Zt.__exportStar(r3(),kt);Zt.__exportStar(o3(),kt);Zt.__exportStar(i3(),kt);Zt.__exportStar(a3(),kt);Zt.__exportStar(u3(),kt);Zt.__exportStar(l3(),kt)});var Wc=g(kx=>{"use strict";Object.defineProperty(kx,"__esModule",{value:!0});kx.AlgorithmIdentifier=void 0;var p3=(O(),I(E)),Sx=R(),Pfe=ps(),Yg=class t{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof t&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&Pfe.isEqual(e.parameters,this.parameters)||e.parameters===this.parameters)}};kx.AlgorithmIdentifier=Yg;p3.__decorate([(0,Sx.AsnProp)({type:Sx.AsnPropTypes.ObjectIdentifier})],Yg.prototype,"algorithm",void 0);p3.__decorate([(0,Sx.AsnProp)({type:Sx.AsnPropTypes.Any,optional:!0})],Yg.prototype,"parameters",void 0)});var IN=g($x=>{"use strict";Object.defineProperty($x,"__esModule",{value:!0});$x.SubjectPublicKeyInfo=void 0;var f3=(O(),I(E)),TN=R(),m3=Wc(),Qg=class{constructor(e={}){this.algorithm=new m3.AlgorithmIdentifier,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}};$x.SubjectPublicKeyInfo=Qg;f3.__decorate([(0,TN.AsnProp)({type:m3.AlgorithmIdentifier})],Qg.prototype,"algorithm",void 0);f3.__decorate([(0,TN.AsnProp)({type:TN.AsnPropTypes.BitString})],Qg.prototype,"subjectPublicKey",void 0)});var Ax=g(ty=>{"use strict";Object.defineProperty(ty,"__esModule",{value:!0});ty.Time=void 0;var EN=(O(),I(E)),Wd=R(),ey=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){let r=new Date(e);r.getUTCFullYear()>2049?this.generalTime=r:this.utcTime=r}else Object.assign(this,e)}getTime(){let e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};ty.Time=ey;EN.__decorate([(0,Wd.AsnProp)({type:Wd.AsnPropTypes.UTCTime})],ey.prototype,"utcTime",void 0);EN.__decorate([(0,Wd.AsnProp)({type:Wd.AsnPropTypes.GeneralizedTime})],ey.prototype,"generalTime",void 0);ty.Time=ey=EN.__decorate([(0,Wd.AsnType)({type:Wd.AsnTypeTypes.Choice})],ey)});var ON=g(Px=>{"use strict";Object.defineProperty(Px,"__esModule",{value:!0});Px.Validity=void 0;var h3=(O(),I(E)),g3=R(),Gd=Ax(),ry=class{constructor(e){this.notBefore=new Gd.Time(new Date),this.notAfter=new Gd.Time(new Date),e&&(this.notBefore=new Gd.Time(e.notBefore),this.notAfter=new Gd.Time(e.notAfter))}};Px.Validity=ry;h3.__decorate([(0,g3.AsnProp)({type:Gd.Time})],ry.prototype,"notBefore",void 0);h3.__decorate([(0,g3.AsnProp)({type:Gd.Time})],ry.prototype,"notAfter",void 0)});var Tx=g(Gc=>{"use strict";var jN;Object.defineProperty(Gc,"__esModule",{value:!0});Gc.Extensions=Gc.Extension=void 0;var Cx=(O(),I(E)),Ti=R(),bs=class t{constructor(e={}){this.extnID="",this.critical=t.CRITICAL,this.extnValue=new Ti.OctetString,Object.assign(this,e)}};Gc.Extension=bs;bs.CRITICAL=!1;Cx.__decorate([(0,Ti.AsnProp)({type:Ti.AsnPropTypes.ObjectIdentifier})],bs.prototype,"extnID",void 0);Cx.__decorate([(0,Ti.AsnProp)({type:Ti.AsnPropTypes.Boolean,defaultValue:bs.CRITICAL})],bs.prototype,"critical",void 0);Cx.__decorate([(0,Ti.AsnProp)({type:Ti.OctetString})],bs.prototype,"extnValue",void 0);var NN=jN=class extends Ti.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,jN.prototype)}};Gc.Extensions=NN;Gc.Extensions=NN=jN=Cx.__decorate([(0,Ti.AsnType)({type:Ti.AsnTypeTypes.Sequence,itemType:bs})],NN)});var zN=g(Ix=>{"use strict";Object.defineProperty(Ix,"__esModule",{value:!0});Ix.Version=void 0;var y3;(function(t){t[t.v1=0]="v1",t[t.v2=1]="v2",t[t.v3=2]="v3"})(y3||(Ix.Version=y3={}))});var RN=g(Ox=>{"use strict";Object.defineProperty(Ox,"__esModule",{value:!0});Ox.TBSCertificate=void 0;var Ii=(O(),I(E)),fn=R(),v3=Wc(),Ex=Ad(),_3=IN(),b3=ON(),Cfe=Tx(),w3=zN(),Fn=class{constructor(e={}){this.version=w3.Version.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new v3.AlgorithmIdentifier,this.issuer=new Ex.Name,this.validity=new b3.Validity,this.subject=new Ex.Name,this.subjectPublicKeyInfo=new _3.SubjectPublicKeyInfo,Object.assign(this,e)}};Ox.TBSCertificate=Fn;Ii.__decorate([(0,fn.AsnProp)({type:fn.AsnPropTypes.Integer,context:0,defaultValue:w3.Version.v1})],Fn.prototype,"version",void 0);Ii.__decorate([(0,fn.AsnProp)({type:fn.AsnPropTypes.Integer,converter:fn.AsnIntegerArrayBufferConverter})],Fn.prototype,"serialNumber",void 0);Ii.__decorate([(0,fn.AsnProp)({type:v3.AlgorithmIdentifier})],Fn.prototype,"signature",void 0);Ii.__decorate([(0,fn.AsnProp)({type:Ex.Name})],Fn.prototype,"issuer",void 0);Ii.__decorate([(0,fn.AsnProp)({type:b3.Validity})],Fn.prototype,"validity",void 0);Ii.__decorate([(0,fn.AsnProp)({type:Ex.Name})],Fn.prototype,"subject",void 0);Ii.__decorate([(0,fn.AsnProp)({type:_3.SubjectPublicKeyInfo})],Fn.prototype,"subjectPublicKeyInfo",void 0);Ii.__decorate([(0,fn.AsnProp)({type:fn.AsnPropTypes.BitString,context:1,implicit:!0,optional:!0})],Fn.prototype,"issuerUniqueID",void 0);Ii.__decorate([(0,fn.AsnProp)({type:fn.AsnPropTypes.BitString,context:2,implicit:!0,optional:!0})],Fn.prototype,"subjectUniqueID",void 0);Ii.__decorate([(0,fn.AsnProp)({type:Cfe.Extensions,context:3,optional:!0})],Fn.prototype,"extensions",void 0)});var k3=g(Nx=>{"use strict";Object.defineProperty(Nx,"__esModule",{value:!0});Nx.Certificate=void 0;var MN=(O(),I(E)),jx=R(),x3=Wc(),S3=RN(),Jd=class{constructor(e={}){this.tbsCertificate=new S3.TBSCertificate,this.signatureAlgorithm=new x3.AlgorithmIdentifier,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};Nx.Certificate=Jd;MN.__decorate([(0,jx.AsnProp)({type:S3.TBSCertificate,raw:!0})],Jd.prototype,"tbsCertificate",void 0);MN.__decorate([(0,jx.AsnProp)({type:x3.AlgorithmIdentifier})],Jd.prototype,"signatureAlgorithm",void 0);MN.__decorate([(0,jx.AsnProp)({type:jx.AsnPropTypes.BitString})],Jd.prototype,"signatureValue",void 0)});var DN=g(Xd=>{"use strict";Object.defineProperty(Xd,"__esModule",{value:!0});Xd.TBSCertList=Xd.RevokedCertificate=void 0;var Oi=(O(),I(E)),Hn=R(),$3=Wc(),A3=Ad(),ny=Ax(),P3=Tx(),Jc=class{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new ny.Time,Object.assign(this,e)}};Xd.RevokedCertificate=Jc;Oi.__decorate([(0,Hn.AsnProp)({type:Hn.AsnPropTypes.Integer,converter:Hn.AsnIntegerArrayBufferConverter})],Jc.prototype,"userCertificate",void 0);Oi.__decorate([(0,Hn.AsnProp)({type:ny.Time})],Jc.prototype,"revocationDate",void 0);Oi.__decorate([(0,Hn.AsnProp)({type:P3.Extension,optional:!0,repeated:"sequence"})],Jc.prototype,"crlEntryExtensions",void 0);var Ei=class{constructor(e={}){this.signature=new $3.AlgorithmIdentifier,this.issuer=new A3.Name,this.thisUpdate=new ny.Time,Object.assign(this,e)}};Xd.TBSCertList=Ei;Oi.__decorate([(0,Hn.AsnProp)({type:Hn.AsnPropTypes.Integer,optional:!0})],Ei.prototype,"version",void 0);Oi.__decorate([(0,Hn.AsnProp)({type:$3.AlgorithmIdentifier})],Ei.prototype,"signature",void 0);Oi.__decorate([(0,Hn.AsnProp)({type:A3.Name})],Ei.prototype,"issuer",void 0);Oi.__decorate([(0,Hn.AsnProp)({type:ny.Time})],Ei.prototype,"thisUpdate",void 0);Oi.__decorate([(0,Hn.AsnProp)({type:ny.Time,optional:!0})],Ei.prototype,"nextUpdate",void 0);Oi.__decorate([(0,Hn.AsnProp)({type:Jc,repeated:"sequence",optional:!0})],Ei.prototype,"revokedCertificates",void 0);Oi.__decorate([(0,Hn.AsnProp)({type:P3.Extension,optional:!0,context:0,repeated:"sequence"})],Ei.prototype,"crlExtensions",void 0)});var I3=g(Rx=>{"use strict";Object.defineProperty(Rx,"__esModule",{value:!0});Rx.CertificateList=void 0;var qN=(O(),I(E)),zx=R(),C3=Wc(),T3=DN(),Yd=class{constructor(e={}){this.tbsCertList=new T3.TBSCertList,this.signatureAlgorithm=new C3.AlgorithmIdentifier,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};Rx.CertificateList=Yd;qN.__decorate([(0,zx.AsnProp)({type:T3.TBSCertList,raw:!0})],Yd.prototype,"tbsCertList",void 0);qN.__decorate([(0,zx.AsnProp)({type:C3.AlgorithmIdentifier})],Yd.prototype,"signatureAlgorithm",void 0);qN.__decorate([(0,zx.AsnProp)({type:zx.AsnPropTypes.BitString})],Yd.prototype,"signature",void 0)});var et=g($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});var Xr=(O(),I(E));Xr.__exportStar(d3(),$r);Xr.__exportStar(Wc(),$r);Xr.__exportStar(wN(),$r);Xr.__exportStar(k3(),$r);Xr.__exportStar(I3(),$r);Xr.__exportStar(Tx(),$r);Xr.__exportStar(Oc(),$r);Xr.__exportStar(Ug(),$r);Xr.__exportStar(Ad(),$r);Xr.__exportStar(Nt(),$r);Xr.__exportStar(IN(),$r);Xr.__exportStar(DN(),$r);Xr.__exportStar(RN(),$r);Xr.__exportStar(Ax(),$r);Xr.__exportStar(zN(),$r);Xr.__exportStar(ON(),$r)});var iy=g(Dx=>{"use strict";Object.defineProperty(Dx,"__esModule",{value:!0});Dx.IssuerAndSerialNumber=void 0;var E3=(O(),I(E)),Mx=R(),O3=et(),oy=class{constructor(e={}){this.issuer=new O3.Name,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}};Dx.IssuerAndSerialNumber=oy;E3.__decorate([(0,Mx.AsnProp)({type:O3.Name})],oy.prototype,"issuer",void 0);E3.__decorate([(0,Mx.AsnProp)({type:Mx.AsnPropTypes.Integer,converter:Mx.AsnIntegerArrayBufferConverter})],oy.prototype,"serialNumber",void 0)});var BN=g(ay=>{"use strict";Object.defineProperty(ay,"__esModule",{value:!0});ay.SignerIdentifier=void 0;var UN=(O(),I(E)),qx=R(),Tfe=iy(),Ife=et(),sy=class{constructor(e={}){Object.assign(this,e)}};ay.SignerIdentifier=sy;UN.__decorate([(0,qx.AsnProp)({type:Ife.SubjectKeyIdentifier,context:0,implicit:!0})],sy.prototype,"subjectKeyIdentifier",void 0);UN.__decorate([(0,qx.AsnProp)({type:Tfe.IssuerAndSerialNumber})],sy.prototype,"issuerAndSerialNumber",void 0);ay.SignerIdentifier=sy=UN.__decorate([(0,qx.AsnType)({type:qx.AsnTypeTypes.Choice})],sy)});var ji=g(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.KeyDerivationAlgorithmIdentifier=tr.MessageAuthenticationCodeAlgorithm=tr.ContentEncryptionAlgorithmIdentifier=tr.KeyEncryptionAlgorithmIdentifier=tr.SignatureAlgorithmIdentifier=tr.DigestAlgorithmIdentifier=tr.CMSVersion=void 0;var Qd=(O(),I(E)),ep=et(),vo=R(),j3;(function(t){t[t.v0=0]="v0",t[t.v1=1]="v1",t[t.v2=2]="v2",t[t.v3=3]="v3",t[t.v4=4]="v4",t[t.v5=5]="v5"})(j3||(tr.CMSVersion=j3={}));var LN=class extends ep.AlgorithmIdentifier{};tr.DigestAlgorithmIdentifier=LN;tr.DigestAlgorithmIdentifier=LN=Qd.__decorate([(0,vo.AsnType)({type:vo.AsnTypeTypes.Sequence})],LN);var ZN=class extends ep.AlgorithmIdentifier{};tr.SignatureAlgorithmIdentifier=ZN;tr.SignatureAlgorithmIdentifier=ZN=Qd.__decorate([(0,vo.AsnType)({type:vo.AsnTypeTypes.Sequence})],ZN);var VN=class extends ep.AlgorithmIdentifier{};tr.KeyEncryptionAlgorithmIdentifier=VN;tr.KeyEncryptionAlgorithmIdentifier=VN=Qd.__decorate([(0,vo.AsnType)({type:vo.AsnTypeTypes.Sequence})],VN);var FN=class extends ep.AlgorithmIdentifier{};tr.ContentEncryptionAlgorithmIdentifier=FN;tr.ContentEncryptionAlgorithmIdentifier=FN=Qd.__decorate([(0,vo.AsnType)({type:vo.AsnTypeTypes.Sequence})],FN);var HN=class extends ep.AlgorithmIdentifier{};tr.MessageAuthenticationCodeAlgorithm=HN;tr.MessageAuthenticationCodeAlgorithm=HN=Qd.__decorate([(0,vo.AsnType)({type:vo.AsnTypeTypes.Sequence})],HN);var KN=class extends ep.AlgorithmIdentifier{};tr.KeyDerivationAlgorithmIdentifier=KN;tr.KeyDerivationAlgorithmIdentifier=KN=Qd.__decorate([(0,vo.AsnType)({type:vo.AsnTypeTypes.Sequence})],KN)});var Lx=g(Bx=>{"use strict";Object.defineProperty(Bx,"__esModule",{value:!0});Bx.Attribute=void 0;var N3=(O(),I(E)),Ux=R(),cy=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};Bx.Attribute=cy;N3.__decorate([(0,Ux.AsnProp)({type:Ux.AsnPropTypes.ObjectIdentifier})],cy.prototype,"attrType",void 0);N3.__decorate([(0,Ux.AsnProp)({type:Ux.AsnPropTypes.Any,repeated:"set"})],cy.prototype,"attrValues",void 0)});var Zx=g(Xc=>{"use strict";var WN;Object.defineProperty(Xc,"__esModule",{value:!0});Xc.SignerInfos=Xc.SignerInfo=void 0;var wa=(O(),I(E)),Kn=R(),z3=BN(),uy=ji(),R3=Lx(),Jo=class{constructor(e={}){this.version=uy.CMSVersion.v0,this.sid=new z3.SignerIdentifier,this.digestAlgorithm=new uy.DigestAlgorithmIdentifier,this.signatureAlgorithm=new uy.SignatureAlgorithmIdentifier,this.signature=new Kn.OctetString,Object.assign(this,e)}};Xc.SignerInfo=Jo;wa.__decorate([(0,Kn.AsnProp)({type:Kn.AsnPropTypes.Integer})],Jo.prototype,"version",void 0);wa.__decorate([(0,Kn.AsnProp)({type:z3.SignerIdentifier})],Jo.prototype,"sid",void 0);wa.__decorate([(0,Kn.AsnProp)({type:uy.DigestAlgorithmIdentifier})],Jo.prototype,"digestAlgorithm",void 0);wa.__decorate([(0,Kn.AsnProp)({type:R3.Attribute,repeated:"set",context:0,implicit:!0,optional:!0,raw:!0})],Jo.prototype,"signedAttrs",void 0);wa.__decorate([(0,Kn.AsnProp)({type:uy.SignatureAlgorithmIdentifier})],Jo.prototype,"signatureAlgorithm",void 0);wa.__decorate([(0,Kn.AsnProp)({type:Kn.OctetString})],Jo.prototype,"signature",void 0);wa.__decorate([(0,Kn.AsnProp)({type:R3.Attribute,repeated:"set",context:1,implicit:!0,optional:!0})],Jo.prototype,"unsignedAttrs",void 0);var GN=WN=class extends Kn.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,WN.prototype)}};Xc.SignerInfos=GN;Xc.SignerInfos=GN=WN=wa.__decorate([(0,Kn.AsnType)({type:Kn.AsnTypeTypes.Set,itemType:Jo})],GN)});var D3=g(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.CounterSignature=Yc.id_counterSignature=void 0;var Efe=(O(),I(E)),M3=R(),Ofe=Zx();Yc.id_counterSignature="1.2.840.113549.1.9.6";var JN=class extends Ofe.SignerInfo{};Yc.CounterSignature=JN;Yc.CounterSignature=JN=Efe.__decorate([(0,M3.AsnType)({type:M3.AsnTypeTypes.Sequence})],JN)});var q3=g(tp=>{"use strict";Object.defineProperty(tp,"__esModule",{value:!0});tp.MessageDigest=tp.id_messageDigest=void 0;var jfe=R();tp.id_messageDigest="1.2.840.113549.1.9.4";var XN=class extends jfe.OctetString{};tp.MessageDigest=XN});var B3=g(Qc=>{"use strict";Object.defineProperty(Qc,"__esModule",{value:!0});Qc.SigningTime=Qc.id_signingTime=void 0;var Nfe=(O(),I(E)),zfe=et(),U3=R();Qc.id_signingTime="1.2.840.113549.1.9.5";var YN=class extends zfe.Time{};Qc.SigningTime=YN;Qc.SigningTime=YN=Nfe.__decorate([(0,U3.AsnType)({type:U3.AsnTypeTypes.Choice})],YN)});var L3=g(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});eu.id_contentType=void 0;var QN=(O(),I(E));QN.__exportStar(D3(),eu);QN.__exportStar(q3(),eu);QN.__exportStar(B3(),eu);eu.id_contentType="1.2.840.113549.1.9.3"});var Z3=g(Fx=>{"use strict";Object.defineProperty(Fx,"__esModule",{value:!0});Fx.ACClearAttrs=void 0;var ez=(O(),I(E)),Vx=R(),tz=et(),rp=class{constructor(e={}){this.acIssuer=new tz.GeneralName,this.acSerial=0,this.attrs=[],Object.assign(this,e)}};Fx.ACClearAttrs=rp;ez.__decorate([(0,Vx.AsnProp)({type:tz.GeneralName})],rp.prototype,"acIssuer",void 0);ez.__decorate([(0,Vx.AsnProp)({type:Vx.AsnPropTypes.Integer})],rp.prototype,"acSerial",void 0);ez.__decorate([(0,Vx.AsnProp)({type:tz.Attribute,repeated:"sequence"})],rp.prototype,"attrs",void 0)});var oz=g(ly=>{"use strict";var rz;Object.defineProperty(ly,"__esModule",{value:!0});ly.AttrSpec=void 0;var Rfe=(O(),I(E)),Hx=R(),nz=rz=class extends Hx.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,rz.prototype)}};ly.AttrSpec=nz;ly.AttrSpec=nz=rz=Rfe.__decorate([(0,Hx.AsnType)({type:Hx.AsnTypeTypes.Sequence,itemType:Hx.AsnPropTypes.ObjectIdentifier})],nz)});var F3=g(Wx=>{"use strict";Object.defineProperty(Wx,"__esModule",{value:!0});Wx.AAControls=void 0;var Kx=(O(),I(E)),np=R(),V3=oz(),tu=class{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}};Wx.AAControls=tu;Kx.__decorate([(0,np.AsnProp)({type:np.AsnPropTypes.Integer,optional:!0})],tu.prototype,"pathLenConstraint",void 0);Kx.__decorate([(0,np.AsnProp)({type:V3.AttrSpec,implicit:!0,context:0,optional:!0})],tu.prototype,"permittedAttrs",void 0);Kx.__decorate([(0,np.AsnProp)({type:V3.AttrSpec,implicit:!0,context:1,optional:!0})],tu.prototype,"excludedAttrs",void 0);Kx.__decorate([(0,np.AsnProp)({type:np.AsnPropTypes.Boolean,defaultValue:!0})],tu.prototype,"permitUnSpecified",void 0)});var dy=g(Gx=>{"use strict";Object.defineProperty(Gx,"__esModule",{value:!0});Gx.IssuerSerial=void 0;var iz=(O(),I(E)),op=R(),H3=et(),ip=class{constructor(e={}){this.issuer=new H3.GeneralNames,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}};Gx.IssuerSerial=ip;iz.__decorate([(0,op.AsnProp)({type:H3.GeneralNames})],ip.prototype,"issuer",void 0);iz.__decorate([(0,op.AsnProp)({type:op.AsnPropTypes.Integer,converter:op.AsnIntegerArrayBufferConverter})],ip.prototype,"serial",void 0);iz.__decorate([(0,op.AsnProp)({type:op.AsnPropTypes.BitString,optional:!0})],ip.prototype,"issuerUID",void 0)});var py=g(sp=>{"use strict";Object.defineProperty(sp,"__esModule",{value:!0});sp.ObjectDigestInfo=sp.DigestedObjectType=void 0;var Jx=(O(),I(E)),ru=R(),K3=et(),sz;(function(t){t[t.publicKey=0]="publicKey",t[t.publicKeyCert=1]="publicKeyCert",t[t.otherObjectTypes=2]="otherObjectTypes"})(sz||(sp.DigestedObjectType=sz={}));var nu=class{constructor(e={}){this.digestedObjectType=sz.publicKey,this.digestAlgorithm=new K3.AlgorithmIdentifier,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}};sp.ObjectDigestInfo=nu;Jx.__decorate([(0,ru.AsnProp)({type:ru.AsnPropTypes.Enumerated})],nu.prototype,"digestedObjectType",void 0);Jx.__decorate([(0,ru.AsnProp)({type:ru.AsnPropTypes.ObjectIdentifier,optional:!0})],nu.prototype,"otherObjectTypeID",void 0);Jx.__decorate([(0,ru.AsnProp)({type:K3.AlgorithmIdentifier})],nu.prototype,"digestAlgorithm",void 0);Jx.__decorate([(0,ru.AsnProp)({type:ru.AsnPropTypes.BitString})],nu.prototype,"objectDigest",void 0)});var uz=g(Xx=>{"use strict";Object.defineProperty(Xx,"__esModule",{value:!0});Xx.V2Form=void 0;var az=(O(),I(E)),cz=R(),Mfe=et(),Dfe=dy(),qfe=py(),ap=class{constructor(e={}){Object.assign(this,e)}};Xx.V2Form=ap;az.__decorate([(0,cz.AsnProp)({type:Mfe.GeneralNames,optional:!0})],ap.prototype,"issuerName",void 0);az.__decorate([(0,cz.AsnProp)({type:Dfe.IssuerSerial,context:0,implicit:!0,optional:!0})],ap.prototype,"baseCertificateID",void 0);az.__decorate([(0,cz.AsnProp)({type:qfe.ObjectDigestInfo,context:1,implicit:!0,optional:!0})],ap.prototype,"objectDigestInfo",void 0)});var dz=g(my=>{"use strict";Object.defineProperty(my,"__esModule",{value:!0});my.AttCertIssuer=void 0;var lz=(O(),I(E)),Yx=R(),Ufe=et(),Bfe=uz(),fy=class{constructor(e={}){Object.assign(this,e)}};my.AttCertIssuer=fy;lz.__decorate([(0,Yx.AsnProp)({type:Ufe.GeneralName,repeated:"sequence"})],fy.prototype,"v1Form",void 0);lz.__decorate([(0,Yx.AsnProp)({type:Bfe.V2Form,context:0,implicit:!0})],fy.prototype,"v2Form",void 0);my.AttCertIssuer=fy=lz.__decorate([(0,Yx.AsnType)({type:Yx.AsnTypeTypes.Choice})],fy)});var pz=g(eS=>{"use strict";Object.defineProperty(eS,"__esModule",{value:!0});eS.AttCertValidityPeriod=void 0;var W3=(O(),I(E)),Qx=R(),hy=class{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}};eS.AttCertValidityPeriod=hy;W3.__decorate([(0,Qx.AsnProp)({type:Qx.AsnPropTypes.GeneralizedTime})],hy.prototype,"notBeforeTime",void 0);W3.__decorate([(0,Qx.AsnProp)({type:Qx.AsnPropTypes.GeneralizedTime})],hy.prototype,"notAfterTime",void 0)});var hz=g(tS=>{"use strict";Object.defineProperty(tS,"__esModule",{value:!0});tS.Holder=void 0;var fz=(O(),I(E)),mz=R(),Lfe=dy(),Zfe=et(),Vfe=py(),cp=class{constructor(e={}){Object.assign(this,e)}};tS.Holder=cp;fz.__decorate([(0,mz.AsnProp)({type:Lfe.IssuerSerial,implicit:!0,context:0,optional:!0})],cp.prototype,"baseCertificateID",void 0);fz.__decorate([(0,mz.AsnProp)({type:Zfe.GeneralNames,implicit:!0,context:1,optional:!0})],cp.prototype,"entityName",void 0);fz.__decorate([(0,mz.AsnProp)({type:Vfe.ObjectDigestInfo,implicit:!0,context:2,optional:!0})],cp.prototype,"objectDigestInfo",void 0)});var yz=g(up=>{"use strict";Object.defineProperty(up,"__esModule",{value:!0});up.AttributeCertificateInfo=up.AttCertVersion=void 0;var ws=(O(),I(E)),Wn=R(),rS=et(),G3=hz(),J3=dz(),X3=pz(),gz;(function(t){t[t.v2=1]="v2"})(gz||(up.AttCertVersion=gz={}));var _o=class{constructor(e={}){this.version=gz.v2,this.holder=new G3.Holder,this.issuer=new J3.AttCertIssuer,this.signature=new rS.AlgorithmIdentifier,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new X3.AttCertValidityPeriod,this.attributes=[],Object.assign(this,e)}};up.AttributeCertificateInfo=_o;ws.__decorate([(0,Wn.AsnProp)({type:Wn.AsnPropTypes.Integer})],_o.prototype,"version",void 0);ws.__decorate([(0,Wn.AsnProp)({type:G3.Holder})],_o.prototype,"holder",void 0);ws.__decorate([(0,Wn.AsnProp)({type:J3.AttCertIssuer})],_o.prototype,"issuer",void 0);ws.__decorate([(0,Wn.AsnProp)({type:rS.AlgorithmIdentifier})],_o.prototype,"signature",void 0);ws.__decorate([(0,Wn.AsnProp)({type:Wn.AsnPropTypes.Integer,converter:Wn.AsnIntegerArrayBufferConverter})],_o.prototype,"serialNumber",void 0);ws.__decorate([(0,Wn.AsnProp)({type:X3.AttCertValidityPeriod})],_o.prototype,"attrCertValidityPeriod",void 0);ws.__decorate([(0,Wn.AsnProp)({type:rS.Attribute,repeated:"sequence"})],_o.prototype,"attributes",void 0);ws.__decorate([(0,Wn.AsnProp)({type:Wn.AsnPropTypes.BitString,optional:!0})],_o.prototype,"issuerUniqueID",void 0);ws.__decorate([(0,Wn.AsnProp)({type:rS.Extensions,optional:!0})],_o.prototype,"extensions",void 0)});var e8=g(oS=>{"use strict";Object.defineProperty(oS,"__esModule",{value:!0});oS.AttributeCertificate=void 0;var vz=(O(),I(E)),nS=R(),Y3=et(),Q3=yz(),lp=class{constructor(e={}){this.acinfo=new Q3.AttributeCertificateInfo,this.signatureAlgorithm=new Y3.AlgorithmIdentifier,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};oS.AttributeCertificate=lp;vz.__decorate([(0,nS.AsnProp)({type:Q3.AttributeCertificateInfo})],lp.prototype,"acinfo",void 0);vz.__decorate([(0,nS.AsnProp)({type:Y3.AlgorithmIdentifier})],lp.prototype,"signatureAlgorithm",void 0);vz.__decorate([(0,nS.AsnProp)({type:nS.AsnPropTypes.BitString})],lp.prototype,"signatureValue",void 0)});var bz=g(dp=>{"use strict";Object.defineProperty(dp,"__esModule",{value:!0});dp.ClassList=dp.ClassListFlags=void 0;var Ffe=R(),t8;(function(t){t[t.unmarked=1]="unmarked",t[t.unclassified=2]="unclassified",t[t.restricted=4]="restricted",t[t.confidential=8]="confidential",t[t.secret=16]="secret",t[t.topSecret=32]="topSecret"})(t8||(dp.ClassListFlags=t8={}));var _z=class extends Ffe.BitString{};dp.ClassList=_z});var wz=g(sS=>{"use strict";Object.defineProperty(sS,"__esModule",{value:!0});sS.SecurityCategory=void 0;var r8=(O(),I(E)),iS=R(),gy=class{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};sS.SecurityCategory=gy;r8.__decorate([(0,iS.AsnProp)({type:iS.AsnPropTypes.ObjectIdentifier,implicit:!0,context:0})],gy.prototype,"type",void 0);r8.__decorate([(0,iS.AsnProp)({type:iS.AsnPropTypes.Any,implicit:!0,context:1})],gy.prototype,"value",void 0)});var n8=g(cS=>{"use strict";Object.defineProperty(cS,"__esModule",{value:!0});cS.Clearance=void 0;var xz=(O(),I(E)),aS=R(),yy=bz(),Hfe=wz(),pp=class{constructor(e={}){this.policyId="",this.classList=new yy.ClassList(yy.ClassListFlags.unclassified),Object.assign(this,e)}};cS.Clearance=pp;xz.__decorate([(0,aS.AsnProp)({type:aS.AsnPropTypes.ObjectIdentifier})],pp.prototype,"policyId",void 0);xz.__decorate([(0,aS.AsnProp)({type:yy.ClassList,defaultValue:new yy.ClassList(yy.ClassListFlags.unclassified)})],pp.prototype,"classList",void 0);xz.__decorate([(0,aS.AsnProp)({type:Hfe.SecurityCategory,repeated:"set"})],pp.prototype,"securityCategories",void 0)});var o8=g(fp=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});fp.IetfAttrSyntax=fp.IetfAttrSyntaxValueChoices=void 0;var _y=(O(),I(E)),xa=R(),Kfe=et(),ou=class{constructor(e={}){Object.assign(this,e)}};fp.IetfAttrSyntaxValueChoices=ou;_y.__decorate([(0,xa.AsnProp)({type:xa.OctetString})],ou.prototype,"cotets",void 0);_y.__decorate([(0,xa.AsnProp)({type:xa.AsnPropTypes.ObjectIdentifier})],ou.prototype,"oid",void 0);_y.__decorate([(0,xa.AsnProp)({type:xa.AsnPropTypes.Utf8String})],ou.prototype,"string",void 0);var vy=class{constructor(e={}){this.values=[],Object.assign(this,e)}};fp.IetfAttrSyntax=vy;_y.__decorate([(0,xa.AsnProp)({type:Kfe.GeneralNames,implicit:!0,context:0,optional:!0})],vy.prototype,"policyAuthority",void 0);_y.__decorate([(0,xa.AsnProp)({type:ou,repeated:"sequence"})],vy.prototype,"values",void 0)});var i8=g(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.id_at_clearance=tt.id_at_role=tt.id_at=tt.id_aca_encAttrs=tt.id_aca_group=tt.id_aca_chargingIdentity=tt.id_aca_accessIdentity=tt.id_aca_authenticationInfo=tt.id_aca=tt.id_ce_targetInformation=tt.id_pe_ac_proxying=tt.id_pe_aaControls=tt.id_pe_ac_auditIdentity=void 0;var by=et();tt.id_pe_ac_auditIdentity=`${by.id_pe}.4`;tt.id_pe_aaControls=`${by.id_pe}.6`;tt.id_pe_ac_proxying=`${by.id_pe}.10`;tt.id_ce_targetInformation=`${by.id_ce}.55`;tt.id_aca=`${by.id_pkix}.10`;tt.id_aca_authenticationInfo=`${tt.id_aca}.1`;tt.id_aca_accessIdentity=`${tt.id_aca}.2`;tt.id_aca_chargingIdentity=`${tt.id_aca}.3`;tt.id_aca_group=`${tt.id_aca}.4`;tt.id_aca_encAttrs=`${tt.id_aca}.6`;tt.id_at="2.5.4";tt.id_at_role=`${tt.id_at}.72`;tt.id_at_clearance="2.5.1.5.55"});var Az=g(Ni=>{"use strict";var Sz;Object.defineProperty(Ni,"__esModule",{value:!0});Ni.Targets=Ni.Target=Ni.TargetCert=void 0;var Sa=(O(),I(E)),Xo=R(),$z=et(),s8=dy(),Wfe=py(),iu=class{constructor(e={}){this.targetCertificate=new s8.IssuerSerial,Object.assign(this,e)}};Ni.TargetCert=iu;Sa.__decorate([(0,Xo.AsnProp)({type:s8.IssuerSerial})],iu.prototype,"targetCertificate",void 0);Sa.__decorate([(0,Xo.AsnProp)({type:$z.GeneralName,optional:!0})],iu.prototype,"targetName",void 0);Sa.__decorate([(0,Xo.AsnProp)({type:Wfe.ObjectDigestInfo,optional:!0})],iu.prototype,"certDigestInfo",void 0);var su=class{constructor(e={}){Object.assign(this,e)}};Ni.Target=su;Sa.__decorate([(0,Xo.AsnProp)({type:$z.GeneralName,context:0,implicit:!0})],su.prototype,"targetName",void 0);Sa.__decorate([(0,Xo.AsnProp)({type:$z.GeneralName,context:1,implicit:!0})],su.prototype,"targetGroup",void 0);Sa.__decorate([(0,Xo.AsnProp)({type:iu,context:2,implicit:!0})],su.prototype,"targetCert",void 0);Ni.Target=su=Sa.__decorate([(0,Xo.AsnType)({type:Xo.AsnTypeTypes.Choice})],su);var kz=Sz=class extends Xo.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Sz.prototype)}};Ni.Targets=kz;Ni.Targets=kz=Sz=Sa.__decorate([(0,Xo.AsnType)({type:Xo.AsnTypeTypes.Sequence,itemType:su})],kz)});var a8=g(wy=>{"use strict";var Pz;Object.defineProperty(wy,"__esModule",{value:!0});wy.ProxyInfo=void 0;var Gfe=(O(),I(E)),Cz=R(),Jfe=Az(),Tz=Pz=class extends Cz.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Pz.prototype)}};wy.ProxyInfo=Tz;wy.ProxyInfo=Tz=Pz=Gfe.__decorate([(0,Cz.AsnType)({type:Cz.AsnTypeTypes.Sequence,itemType:Jfe.Targets})],Tz)});var d8=g(uS=>{"use strict";Object.defineProperty(uS,"__esModule",{value:!0});uS.RoleSyntax=void 0;var c8=(O(),I(E)),u8=R(),l8=et(),xy=class{constructor(e={}){Object.assign(this,e)}};uS.RoleSyntax=xy;c8.__decorate([(0,u8.AsnProp)({type:l8.GeneralNames,implicit:!0,context:0,optional:!0})],xy.prototype,"roleAuthority",void 0);c8.__decorate([(0,u8.AsnProp)({type:l8.GeneralName,implicit:!0,context:1})],xy.prototype,"roleName",void 0)});var p8=g(pS=>{"use strict";Object.defineProperty(pS,"__esModule",{value:!0});pS.SvceAuthInfo=void 0;var Iz=(O(),I(E)),lS=R(),dS=et(),mp=class{constructor(e={}){this.service=new dS.GeneralName,this.ident=new dS.GeneralName,Object.assign(this,e)}};pS.SvceAuthInfo=mp;Iz.__decorate([(0,lS.AsnProp)({type:dS.GeneralName})],mp.prototype,"service",void 0);Iz.__decorate([(0,lS.AsnProp)({type:dS.GeneralName})],mp.prototype,"ident",void 0);Iz.__decorate([(0,lS.AsnProp)({type:lS.OctetString,optional:!0})],mp.prototype,"authInfo",void 0)});var Ez=g(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});var mr=(O(),I(E));mr.__exportStar(Z3(),rr);mr.__exportStar(F3(),rr);mr.__exportStar(dz(),rr);mr.__exportStar(pz(),rr);mr.__exportStar(oz(),rr);mr.__exportStar(e8(),rr);mr.__exportStar(yz(),rr);mr.__exportStar(bz(),rr);mr.__exportStar(n8(),rr);mr.__exportStar(hz(),rr);mr.__exportStar(o8(),rr);mr.__exportStar(dy(),rr);mr.__exportStar(py(),rr);mr.__exportStar(i8(),rr);mr.__exportStar(a8(),rr);mr.__exportStar(d8(),rr);mr.__exportStar(wz(),rr);mr.__exportStar(p8(),rr);mr.__exportStar(Az(),rr);mr.__exportStar(uz(),rr)});var fS=g(zi=>{"use strict";var Oz;Object.defineProperty(zi,"__esModule",{value:!0});zi.CertificateSet=zi.CertificateChoices=zi.OtherCertificateFormat=void 0;var cu=(O(),I(E)),bo=R(),Xfe=et(),Yfe=Ez(),hp=class{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}};zi.OtherCertificateFormat=hp;cu.__decorate([(0,bo.AsnProp)({type:bo.AsnPropTypes.ObjectIdentifier})],hp.prototype,"otherCertFormat",void 0);cu.__decorate([(0,bo.AsnProp)({type:bo.AsnPropTypes.Any})],hp.prototype,"otherCert",void 0);var au=class{constructor(e={}){Object.assign(this,e)}};zi.CertificateChoices=au;cu.__decorate([(0,bo.AsnProp)({type:Xfe.Certificate})],au.prototype,"certificate",void 0);cu.__decorate([(0,bo.AsnProp)({type:Yfe.AttributeCertificate,context:2,implicit:!0})],au.prototype,"v2AttrCert",void 0);cu.__decorate([(0,bo.AsnProp)({type:hp,context:3,implicit:!0})],au.prototype,"other",void 0);zi.CertificateChoices=au=cu.__decorate([(0,bo.AsnType)({type:bo.AsnTypeTypes.Choice})],au);var jz=Oz=class extends bo.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Oz.prototype)}};zi.CertificateSet=jz;zi.CertificateSet=jz=Oz=cu.__decorate([(0,bo.AsnType)({type:bo.AsnTypeTypes.Set,itemType:au})],jz)});var m8=g(hS=>{"use strict";Object.defineProperty(hS,"__esModule",{value:!0});hS.ContentInfo=void 0;var f8=(O(),I(E)),mS=R(),Sy=class{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}};hS.ContentInfo=Sy;f8.__decorate([(0,mS.AsnProp)({type:mS.AsnPropTypes.ObjectIdentifier})],Sy.prototype,"contentType",void 0);f8.__decorate([(0,mS.AsnProp)({type:mS.AsnPropTypes.Any,context:0})],Sy.prototype,"content",void 0)});var Nz=g(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});uu.EncapsulatedContentInfo=uu.EncapsulatedContent=void 0;var $y=(O(),I(E)),xs=R(),gp=class{constructor(e={}){Object.assign(this,e)}};uu.EncapsulatedContent=gp;$y.__decorate([(0,xs.AsnProp)({type:xs.OctetString})],gp.prototype,"single",void 0);$y.__decorate([(0,xs.AsnProp)({type:xs.AsnPropTypes.Any})],gp.prototype,"any",void 0);uu.EncapsulatedContent=gp=$y.__decorate([(0,xs.AsnType)({type:xs.AsnTypeTypes.Choice})],gp);var ky=class{constructor(e={}){this.eContentType="",Object.assign(this,e)}};uu.EncapsulatedContentInfo=ky;$y.__decorate([(0,xs.AsnProp)({type:xs.AsnPropTypes.ObjectIdentifier})],ky.prototype,"eContentType",void 0);$y.__decorate([(0,xs.AsnProp)({type:gp,context:0,optional:!0})],ky.prototype,"eContent",void 0)});var zz=g(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.EncryptedContentInfo=lu.EncryptedContent=void 0;var _p=(O(),I(E)),Yo=R(),h8=ji(),yp=class{constructor(e={}){Object.assign(this,e)}};lu.EncryptedContent=yp;_p.__decorate([(0,Yo.AsnProp)({type:Yo.OctetString,context:0,implicit:!0,optional:!0})],yp.prototype,"value",void 0);_p.__decorate([(0,Yo.AsnProp)({type:Yo.OctetString,converter:Yo.AsnConstructedOctetStringConverter,context:0,implicit:!0,optional:!0,repeated:"sequence"})],yp.prototype,"constructedValue",void 0);lu.EncryptedContent=yp=_p.__decorate([(0,Yo.AsnType)({type:Yo.AsnTypeTypes.Choice})],yp);var vp=class{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new h8.ContentEncryptionAlgorithmIdentifier,Object.assign(this,e)}};lu.EncryptedContentInfo=vp;_p.__decorate([(0,Yo.AsnProp)({type:Yo.AsnPropTypes.ObjectIdentifier})],vp.prototype,"contentType",void 0);_p.__decorate([(0,Yo.AsnProp)({type:h8.ContentEncryptionAlgorithmIdentifier})],vp.prototype,"contentEncryptionAlgorithm",void 0);_p.__decorate([(0,Yo.AsnProp)({type:yp,optional:!0})],vp.prototype,"encryptedContent",void 0)});var Rz=g(yS=>{"use strict";Object.defineProperty(yS,"__esModule",{value:!0});yS.OtherKeyAttribute=void 0;var g8=(O(),I(E)),gS=R(),Ay=class{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}};yS.OtherKeyAttribute=Ay;g8.__decorate([(0,gS.AsnProp)({type:gS.AsnPropTypes.ObjectIdentifier})],Ay.prototype,"keyAttrId",void 0);g8.__decorate([(0,gS.AsnProp)({type:gS.AsnPropTypes.Any,optional:!0})],Ay.prototype,"keyAttr",void 0)});var qz=g(br=>{"use strict";var Mz;Object.defineProperty(br,"__esModule",{value:!0});br.KeyAgreeRecipientInfo=br.OriginatorIdentifierOrKey=br.OriginatorPublicKey=br.RecipientEncryptedKeys=br.RecipientEncryptedKey=br.KeyAgreeRecipientIdentifier=br.RecipientKeyIdentifier=void 0;var hr=(O(),I(E)),ut=R(),Dz=ji(),y8=iy(),Cy=et(),Qfe=Rz(),du=class{constructor(e={}){this.subjectKeyIdentifier=new Cy.SubjectKeyIdentifier,Object.assign(this,e)}};br.RecipientKeyIdentifier=du;hr.__decorate([(0,ut.AsnProp)({type:Cy.SubjectKeyIdentifier})],du.prototype,"subjectKeyIdentifier",void 0);hr.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.GeneralizedTime,optional:!0})],du.prototype,"date",void 0);hr.__decorate([(0,ut.AsnProp)({type:Qfe.OtherKeyAttribute,optional:!0})],du.prototype,"other",void 0);var pu=class{constructor(e={}){Object.assign(this,e)}};br.KeyAgreeRecipientIdentifier=pu;hr.__decorate([(0,ut.AsnProp)({type:du,context:0,implicit:!0,optional:!0})],pu.prototype,"rKeyId",void 0);hr.__decorate([(0,ut.AsnProp)({type:y8.IssuerAndSerialNumber,optional:!0})],pu.prototype,"issuerAndSerialNumber",void 0);br.KeyAgreeRecipientIdentifier=pu=hr.__decorate([(0,ut.AsnType)({type:ut.AsnTypeTypes.Choice})],pu);var bp=class{constructor(e={}){this.rid=new pu,this.encryptedKey=new ut.OctetString,Object.assign(this,e)}};br.RecipientEncryptedKey=bp;hr.__decorate([(0,ut.AsnProp)({type:pu})],bp.prototype,"rid",void 0);hr.__decorate([(0,ut.AsnProp)({type:ut.OctetString})],bp.prototype,"encryptedKey",void 0);var Py=Mz=class extends ut.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Mz.prototype)}};br.RecipientEncryptedKeys=Py;br.RecipientEncryptedKeys=Py=Mz=hr.__decorate([(0,ut.AsnType)({type:ut.AsnTypeTypes.Sequence,itemType:bp})],Py);var wp=class{constructor(e={}){this.algorithm=new Cy.AlgorithmIdentifier,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}};br.OriginatorPublicKey=wp;hr.__decorate([(0,ut.AsnProp)({type:Cy.AlgorithmIdentifier})],wp.prototype,"algorithm",void 0);hr.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.BitString})],wp.prototype,"publicKey",void 0);var ka=class{constructor(e={}){Object.assign(this,e)}};br.OriginatorIdentifierOrKey=ka;hr.__decorate([(0,ut.AsnProp)({type:Cy.SubjectKeyIdentifier,context:0,implicit:!0,optional:!0})],ka.prototype,"subjectKeyIdentifier",void 0);hr.__decorate([(0,ut.AsnProp)({type:wp,context:1,implicit:!0,optional:!0})],ka.prototype,"originatorKey",void 0);hr.__decorate([(0,ut.AsnProp)({type:y8.IssuerAndSerialNumber,optional:!0})],ka.prototype,"issuerAndSerialNumber",void 0);br.OriginatorIdentifierOrKey=ka=hr.__decorate([(0,ut.AsnType)({type:ut.AsnTypeTypes.Choice})],ka);var $a=class{constructor(e={}){this.version=Dz.CMSVersion.v3,this.originator=new ka,this.keyEncryptionAlgorithm=new Dz.KeyEncryptionAlgorithmIdentifier,this.recipientEncryptedKeys=new Py,Object.assign(this,e)}};br.KeyAgreeRecipientInfo=$a;hr.__decorate([(0,ut.AsnProp)({type:ut.AsnPropTypes.Integer})],$a.prototype,"version",void 0);hr.__decorate([(0,ut.AsnProp)({type:ka,context:0})],$a.prototype,"originator",void 0);hr.__decorate([(0,ut.AsnProp)({type:ut.OctetString,context:1,optional:!0})],$a.prototype,"ukm",void 0);hr.__decorate([(0,ut.AsnProp)({type:Dz.KeyEncryptionAlgorithmIdentifier})],$a.prototype,"keyEncryptionAlgorithm",void 0);hr.__decorate([(0,ut.AsnProp)({type:Py})],$a.prototype,"recipientEncryptedKeys",void 0)});var Bz=g(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.KeyTransRecipientInfo=hu.RecipientIdentifier=void 0;var gu=(O(),I(E)),Qo=R(),Uz=ji(),eme=iy(),tme=et(),fu=class{constructor(e={}){Object.assign(this,e)}};hu.RecipientIdentifier=fu;gu.__decorate([(0,Qo.AsnProp)({type:tme.SubjectKeyIdentifier,context:0,implicit:!0})],fu.prototype,"subjectKeyIdentifier",void 0);gu.__decorate([(0,Qo.AsnProp)({type:eme.IssuerAndSerialNumber})],fu.prototype,"issuerAndSerialNumber",void 0);hu.RecipientIdentifier=fu=gu.__decorate([(0,Qo.AsnType)({type:Qo.AsnTypeTypes.Choice})],fu);var mu=class{constructor(e={}){this.version=Uz.CMSVersion.v0,this.rid=new fu,this.keyEncryptionAlgorithm=new Uz.KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new Qo.OctetString,Object.assign(this,e)}};hu.KeyTransRecipientInfo=mu;gu.__decorate([(0,Qo.AsnProp)({type:Qo.AsnPropTypes.Integer})],mu.prototype,"version",void 0);gu.__decorate([(0,Qo.AsnProp)({type:fu})],mu.prototype,"rid",void 0);gu.__decorate([(0,Qo.AsnProp)({type:Uz.KeyEncryptionAlgorithmIdentifier})],mu.prototype,"keyEncryptionAlgorithm",void 0);gu.__decorate([(0,Qo.AsnProp)({type:Qo.OctetString})],mu.prototype,"encryptedKey",void 0)});var Zz=g(xp=>{"use strict";Object.defineProperty(xp,"__esModule",{value:!0});xp.KEKRecipientInfo=xp.KEKIdentifier=void 0;var vu=(O(),I(E)),Gn=R(),rme=Rz(),Lz=ji(),Aa=class{constructor(e={}){this.keyIdentifier=new Gn.OctetString,Object.assign(this,e)}};xp.KEKIdentifier=Aa;vu.__decorate([(0,Gn.AsnProp)({type:Gn.OctetString})],Aa.prototype,"keyIdentifier",void 0);vu.__decorate([(0,Gn.AsnProp)({type:Gn.AsnPropTypes.GeneralizedTime,optional:!0})],Aa.prototype,"date",void 0);vu.__decorate([(0,Gn.AsnProp)({type:rme.OtherKeyAttribute,optional:!0})],Aa.prototype,"other",void 0);var yu=class{constructor(e={}){this.version=Lz.CMSVersion.v4,this.kekid=new Aa,this.keyEncryptionAlgorithm=new Lz.KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new Gn.OctetString,Object.assign(this,e)}};xp.KEKRecipientInfo=yu;vu.__decorate([(0,Gn.AsnProp)({type:Gn.AsnPropTypes.Integer})],yu.prototype,"version",void 0);vu.__decorate([(0,Gn.AsnProp)({type:Aa})],yu.prototype,"kekid",void 0);vu.__decorate([(0,Gn.AsnProp)({type:Lz.KeyEncryptionAlgorithmIdentifier})],yu.prototype,"keyEncryptionAlgorithm",void 0);vu.__decorate([(0,Gn.AsnProp)({type:Gn.OctetString})],yu.prototype,"encryptedKey",void 0)});var Vz=g(bS=>{"use strict";Object.defineProperty(bS,"__esModule",{value:!0});bS.PasswordRecipientInfo=void 0;var _S=(O(),I(E)),_u=R(),vS=ji(),bu=class{constructor(e={}){this.version=vS.CMSVersion.v0,this.keyEncryptionAlgorithm=new vS.KeyEncryptionAlgorithmIdentifier,this.encryptedKey=new _u.OctetString,Object.assign(this,e)}};bS.PasswordRecipientInfo=bu;_S.__decorate([(0,_u.AsnProp)({type:_u.AsnPropTypes.Integer})],bu.prototype,"version",void 0);_S.__decorate([(0,_u.AsnProp)({type:vS.KeyDerivationAlgorithmIdentifier,context:0,optional:!0})],bu.prototype,"keyDerivationAlgorithm",void 0);_S.__decorate([(0,_u.AsnProp)({type:vS.KeyEncryptionAlgorithmIdentifier})],bu.prototype,"keyEncryptionAlgorithm",void 0);_S.__decorate([(0,_u.AsnProp)({type:_u.OctetString})],bu.prototype,"encryptedKey",void 0)});var Fz=g(wu=>{"use strict";Object.defineProperty(wu,"__esModule",{value:!0});wu.RecipientInfo=wu.OtherRecipientInfo=void 0;var Ca=(O(),I(E)),ei=R(),nme=qz(),ome=Bz(),ime=Zz(),sme=Vz(),Sp=class{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}};wu.OtherRecipientInfo=Sp;Ca.__decorate([(0,ei.AsnProp)({type:ei.AsnPropTypes.ObjectIdentifier})],Sp.prototype,"oriType",void 0);Ca.__decorate([(0,ei.AsnProp)({type:ei.AsnPropTypes.Any})],Sp.prototype,"oriValue",void 0);var Pa=class{constructor(e={}){Object.assign(this,e)}};wu.RecipientInfo=Pa;Ca.__decorate([(0,ei.AsnProp)({type:ome.KeyTransRecipientInfo,optional:!0})],Pa.prototype,"ktri",void 0);Ca.__decorate([(0,ei.AsnProp)({type:nme.KeyAgreeRecipientInfo,context:1,implicit:!0,optional:!0})],Pa.prototype,"kari",void 0);Ca.__decorate([(0,ei.AsnProp)({type:ime.KEKRecipientInfo,context:2,implicit:!0,optional:!0})],Pa.prototype,"kekri",void 0);Ca.__decorate([(0,ei.AsnProp)({type:sme.PasswordRecipientInfo,context:3,implicit:!0,optional:!0})],Pa.prototype,"pwri",void 0);Ca.__decorate([(0,ei.AsnProp)({type:Sp,context:4,implicit:!0,optional:!0})],Pa.prototype,"ori",void 0);wu.RecipientInfo=Pa=Ca.__decorate([(0,ei.AsnType)({type:ei.AsnTypeTypes.Choice})],Pa)});var Gz=g(Ty=>{"use strict";var Hz;Object.defineProperty(Ty,"__esModule",{value:!0});Ty.RecipientInfos=void 0;var ame=(O(),I(E)),Kz=R(),cme=Fz(),Wz=Hz=class extends Kz.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Hz.prototype)}};Ty.RecipientInfos=Wz;Ty.RecipientInfos=Wz=Hz=ame.__decorate([(0,Kz.AsnType)({type:Kz.AsnTypeTypes.Set,itemType:cme.RecipientInfo})],Wz)});var wS=g(Ar=>{"use strict";var Jz;Object.defineProperty(Ar,"__esModule",{value:!0});Ar.RevocationInfoChoices=Ar.RevocationInfoChoice=Ar.OtherRevocationInfoFormat=Ar.id_ri_scvp=Ar.id_ri_ocsp_response=Ar.id_ri=void 0;var Ey=(O(),I(E)),Ri=R(),ume=et();Ar.id_ri=`${ume.id_pkix}.16`;Ar.id_ri_ocsp_response=`${Ar.id_ri}.2`;Ar.id_ri_scvp=`${Ar.id_ri}.4`;var xu=class{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}};Ar.OtherRevocationInfoFormat=xu;Ey.__decorate([(0,Ri.AsnProp)({type:Ri.AsnPropTypes.ObjectIdentifier})],xu.prototype,"otherRevInfoFormat",void 0);Ey.__decorate([(0,Ri.AsnProp)({type:Ri.AsnPropTypes.Any})],xu.prototype,"otherRevInfo",void 0);var Iy=class{constructor(e={}){this.other=new xu,Object.assign(this,e)}};Ar.RevocationInfoChoice=Iy;Ey.__decorate([(0,Ri.AsnProp)({type:xu,context:1,implicit:!0})],Iy.prototype,"other",void 0);Ar.RevocationInfoChoice=Iy=Ey.__decorate([(0,Ri.AsnType)({type:Ri.AsnTypeTypes.Choice})],Iy);var Xz=Jz=class extends Ri.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Jz.prototype)}};Ar.RevocationInfoChoices=Xz;Ar.RevocationInfoChoices=Xz=Jz=Ey.__decorate([(0,Ri.AsnType)({type:Ri.AsnTypeTypes.Set,itemType:Iy})],Xz)});var Yz=g(xS=>{"use strict";Object.defineProperty(xS,"__esModule",{value:!0});xS.OriginatorInfo=void 0;var v8=(O(),I(E)),_8=R(),lme=fS(),dme=wS(),Oy=class{constructor(e={}){Object.assign(this,e)}};xS.OriginatorInfo=Oy;v8.__decorate([(0,_8.AsnProp)({type:lme.CertificateSet,context:0,implicit:!0,optional:!0})],Oy.prototype,"certs",void 0);v8.__decorate([(0,_8.AsnProp)({type:dme.RevocationInfoChoices,context:1,implicit:!0,optional:!0})],Oy.prototype,"crls",void 0)});var x8=g(Su=>{"use strict";var Qz;Object.defineProperty(Su,"__esModule",{value:!0});Su.EnvelopedData=Su.UnprotectedAttributes=void 0;var kp=(O(),I(E)),Ss=R(),pme=ji(),fme=Lx(),b8=Gz(),mme=Yz(),w8=zz(),SS=Qz=class extends Ss.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,Qz.prototype)}};Su.UnprotectedAttributes=SS;Su.UnprotectedAttributes=SS=Qz=kp.__decorate([(0,Ss.AsnType)({type:Ss.AsnTypeTypes.Set,itemType:fme.Attribute})],SS);var Ta=class{constructor(e={}){this.version=pme.CMSVersion.v0,this.recipientInfos=new b8.RecipientInfos,this.encryptedContentInfo=new w8.EncryptedContentInfo,Object.assign(this,e)}};Su.EnvelopedData=Ta;kp.__decorate([(0,Ss.AsnProp)({type:Ss.AsnPropTypes.Integer})],Ta.prototype,"version",void 0);kp.__decorate([(0,Ss.AsnProp)({type:mme.OriginatorInfo,context:0,implicit:!0,optional:!0})],Ta.prototype,"originatorInfo",void 0);kp.__decorate([(0,Ss.AsnProp)({type:b8.RecipientInfos})],Ta.prototype,"recipientInfos",void 0);kp.__decorate([(0,Ss.AsnProp)({type:w8.EncryptedContentInfo})],Ta.prototype,"encryptedContentInfo",void 0);kp.__decorate([(0,Ss.AsnProp)({type:SS,context:1,implicit:!0,optional:!0})],Ta.prototype,"unprotectedAttrs",void 0)});var S8=g(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.id_authData=Yr.id_encryptedData=Yr.id_digestedData=Yr.id_envelopedData=Yr.id_signedData=Yr.id_data=Yr.id_ct_contentInfo=void 0;Yr.id_ct_contentInfo="1.2.840.113549.1.9.16.1.6";Yr.id_data="1.2.840.113549.1.7.1";Yr.id_signedData="1.2.840.113549.1.7.2";Yr.id_envelopedData="1.2.840.113549.1.7.3";Yr.id_digestedData="1.2.840.113549.1.7.5";Yr.id_encryptedData="1.2.840.113549.1.7.6";Yr.id_authData="1.2.840.113549.1.9.16.1.2"});var P8=g(ku=>{"use strict";var eR;Object.defineProperty(ku,"__esModule",{value:!0});ku.SignedData=ku.DigestAlgorithmIdentifiers=void 0;var $u=(O(),I(E)),Mi=R(),hme=fS(),k8=ji(),$8=Nz(),gme=wS(),A8=Zx(),jy=eR=class extends Mi.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,eR.prototype)}};ku.DigestAlgorithmIdentifiers=jy;ku.DigestAlgorithmIdentifiers=jy=eR=$u.__decorate([(0,Mi.AsnType)({type:Mi.AsnTypeTypes.Set,itemType:k8.DigestAlgorithmIdentifier})],jy);var ks=class{constructor(e={}){this.version=k8.CMSVersion.v0,this.digestAlgorithms=new jy,this.encapContentInfo=new $8.EncapsulatedContentInfo,this.signerInfos=new A8.SignerInfos,Object.assign(this,e)}};ku.SignedData=ks;$u.__decorate([(0,Mi.AsnProp)({type:Mi.AsnPropTypes.Integer})],ks.prototype,"version",void 0);$u.__decorate([(0,Mi.AsnProp)({type:jy})],ks.prototype,"digestAlgorithms",void 0);$u.__decorate([(0,Mi.AsnProp)({type:$8.EncapsulatedContentInfo})],ks.prototype,"encapContentInfo",void 0);$u.__decorate([(0,Mi.AsnProp)({type:hme.CertificateSet,context:0,implicit:!0,optional:!0})],ks.prototype,"certificates",void 0);$u.__decorate([(0,Mi.AsnProp)({type:gme.RevocationInfoChoices,context:1,implicit:!0,optional:!0})],ks.prototype,"crls",void 0);$u.__decorate([(0,Mi.AsnProp)({type:A8.SignerInfos})],ks.prototype,"signerInfos",void 0)});var Ny=g(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});var ur=(O(),I(E));ur.__exportStar(L3(),Jt);ur.__exportStar(Lx(),Jt);ur.__exportStar(fS(),Jt);ur.__exportStar(m8(),Jt);ur.__exportStar(Nz(),Jt);ur.__exportStar(zz(),Jt);ur.__exportStar(x8(),Jt);ur.__exportStar(iy(),Jt);ur.__exportStar(Zz(),Jt);ur.__exportStar(qz(),Jt);ur.__exportStar(Bz(),Jt);ur.__exportStar(S8(),Jt);ur.__exportStar(Yz(),Jt);ur.__exportStar(Vz(),Jt);ur.__exportStar(Fz(),Jt);ur.__exportStar(Gz(),Jt);ur.__exportStar(wS(),Jt);ur.__exportStar(P8(),Jt);ur.__exportStar(BN(),Jt);ur.__exportStar(Zx(),Jt);ur.__exportStar(ji(),Jt)});var tR=g(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.id_sect571r1=be.id_sect571k1=be.id_secp521r1=be.id_sect409r1=be.id_sect409k1=be.id_secp384r1=be.id_sect283r1=be.id_sect283k1=be.id_secp256r1=be.id_sect233r1=be.id_sect233k1=be.id_secp224r1=be.id_sect163r2=be.id_sect163k1=be.id_secp192r1=be.id_ecdsaWithSHA512=be.id_ecdsaWithSHA384=be.id_ecdsaWithSHA256=be.id_ecdsaWithSHA224=be.id_ecdsaWithSHA1=be.id_ecMQV=be.id_ecDH=be.id_ecPublicKey=void 0;be.id_ecPublicKey="1.2.840.10045.2.1";be.id_ecDH="1.3.132.1.12";be.id_ecMQV="1.3.132.1.13";be.id_ecdsaWithSHA1="1.2.840.10045.4.1";be.id_ecdsaWithSHA224="1.2.840.10045.4.3.1";be.id_ecdsaWithSHA256="1.2.840.10045.4.3.2";be.id_ecdsaWithSHA384="1.2.840.10045.4.3.3";be.id_ecdsaWithSHA512="1.2.840.10045.4.3.4";be.id_secp192r1="1.2.840.10045.3.1.1";be.id_sect163k1="1.3.132.0.1";be.id_sect163r2="1.3.132.0.15";be.id_secp224r1="1.3.132.0.33";be.id_sect233k1="1.3.132.0.26";be.id_sect233r1="1.3.132.0.27";be.id_secp256r1="1.2.840.10045.3.1.7";be.id_sect283k1="1.3.132.0.16";be.id_sect283r1="1.3.132.0.17";be.id_secp384r1="1.3.132.0.34";be.id_sect409k1="1.3.132.0.36";be.id_sect409r1="1.3.132.0.37";be.id_secp521r1="1.3.132.0.35";be.id_sect571k1="1.3.132.0.38";be.id_sect571r1="1.3.132.0.39"});var C8=g(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.ecdsaWithSHA512=wo.ecdsaWithSHA384=wo.ecdsaWithSHA256=wo.ecdsaWithSHA224=wo.ecdsaWithSHA1=void 0;var yme=et(),zy=tR();function Ry(t){return new yme.AlgorithmIdentifier({algorithm:t})}wo.ecdsaWithSHA1=Ry(zy.id_ecdsaWithSHA1);wo.ecdsaWithSHA224=Ry(zy.id_ecdsaWithSHA224);wo.ecdsaWithSHA256=Ry(zy.id_ecdsaWithSHA256);wo.ecdsaWithSHA384=Ry(zy.id_ecdsaWithSHA384);wo.ecdsaWithSHA512=Ry(zy.id_ecdsaWithSHA512)});var oR=g(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.SpecifiedECDomain=Br.ECPVer=Br.Curve=Br.FieldElement=Br.ECPoint=Br.FieldID=void 0;var In=(O(),I(E)),yt=R(),$p=class{constructor(e={}){Object.assign(this,e)}};Br.FieldID=$p;In.__decorate([(0,yt.AsnProp)({type:yt.AsnPropTypes.ObjectIdentifier})],$p.prototype,"fieldType",void 0);In.__decorate([(0,yt.AsnProp)({type:yt.AsnPropTypes.Any})],$p.prototype,"parameters",void 0);Br.FieldID=$p=In.__decorate([(0,yt.AsnType)({type:yt.AsnTypeTypes.Sequence})],$p);var kS=class extends yt.OctetString{};Br.ECPoint=kS;var rR=class extends yt.OctetString{};Br.FieldElement=rR;var Au=class{constructor(e={}){Object.assign(this,e)}};Br.Curve=Au;In.__decorate([(0,yt.AsnProp)({type:yt.AsnPropTypes.OctetString})],Au.prototype,"a",void 0);In.__decorate([(0,yt.AsnProp)({type:yt.AsnPropTypes.OctetString})],Au.prototype,"b",void 0);In.__decorate([(0,yt.AsnProp)({type:yt.AsnPropTypes.BitString,optional:!0})],Au.prototype,"seed",void 0);Br.Curve=Au=In.__decorate([(0,yt.AsnType)({type:yt.AsnTypeTypes.Sequence})],Au);var nR;(function(t){t[t.ecpVer1=1]="ecpVer1"})(nR||(Br.ECPVer=nR={}));var $s=class{constructor(e={}){this.version=nR.ecpVer1,Object.assign(this,e)}};Br.SpecifiedECDomain=$s;In.__decorate([(0,yt.AsnProp)({type:yt.AsnPropTypes.Integer})],$s.prototype,"version",void 0);In.__decorate([(0,yt.AsnProp)({type:$p})],$s.prototype,"fieldID",void 0);In.__decorate([(0,yt.AsnProp)({type:Au})],$s.prototype,"curve",void 0);In.__decorate([(0,yt.AsnProp)({type:kS})],$s.prototype,"base",void 0);In.__decorate([(0,yt.AsnProp)({type:yt.AsnPropTypes.Integer,converter:yt.AsnIntegerArrayBufferConverter})],$s.prototype,"order",void 0);In.__decorate([(0,yt.AsnProp)({type:yt.AsnPropTypes.Integer,optional:!0})],$s.prototype,"cofactor",void 0);Br.SpecifiedECDomain=$s=In.__decorate([(0,yt.AsnType)({type:yt.AsnTypeTypes.Sequence})],$s)});var iR=g(My=>{"use strict";Object.defineProperty(My,"__esModule",{value:!0});My.ECParameters=void 0;var $S=(O(),I(E)),Pu=R(),vme=oR(),Ap=class{constructor(e={}){Object.assign(this,e)}};My.ECParameters=Ap;$S.__decorate([(0,Pu.AsnProp)({type:Pu.AsnPropTypes.ObjectIdentifier})],Ap.prototype,"namedCurve",void 0);$S.__decorate([(0,Pu.AsnProp)({type:Pu.AsnPropTypes.Null})],Ap.prototype,"implicitCurve",void 0);$S.__decorate([(0,Pu.AsnProp)({type:vme.SpecifiedECDomain})],Ap.prototype,"specifiedCurve",void 0);My.ECParameters=Ap=$S.__decorate([(0,Pu.AsnType)({type:Pu.AsnTypeTypes.Choice})],Ap)});var T8=g(PS=>{"use strict";Object.defineProperty(PS,"__esModule",{value:!0});PS.ECPrivateKey=void 0;var AS=(O(),I(E)),Ia=R(),_me=iR(),Cu=class{constructor(e={}){this.version=1,this.privateKey=new Ia.OctetString,Object.assign(this,e)}};PS.ECPrivateKey=Cu;AS.__decorate([(0,Ia.AsnProp)({type:Ia.AsnPropTypes.Integer})],Cu.prototype,"version",void 0);AS.__decorate([(0,Ia.AsnProp)({type:Ia.OctetString})],Cu.prototype,"privateKey",void 0);AS.__decorate([(0,Ia.AsnProp)({type:_me.ECParameters,context:0,optional:!0})],Cu.prototype,"parameters",void 0);AS.__decorate([(0,Ia.AsnProp)({type:Ia.AsnPropTypes.BitString,context:1,optional:!0})],Cu.prototype,"publicKey",void 0)});var E8=g(CS=>{"use strict";Object.defineProperty(CS,"__esModule",{value:!0});CS.ECDSASigValue=void 0;var I8=(O(),I(E)),Pp=R(),Dy=class{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}};CS.ECDSASigValue=Dy;I8.__decorate([(0,Pp.AsnProp)({type:Pp.AsnPropTypes.Integer,converter:Pp.AsnIntegerArrayBufferConverter})],Dy.prototype,"r",void 0);I8.__decorate([(0,Pp.AsnProp)({type:Pp.AsnPropTypes.Integer,converter:Pp.AsnIntegerArrayBufferConverter})],Dy.prototype,"s",void 0)});var O8=g(Ea=>{"use strict";Object.defineProperty(Ea,"__esModule",{value:!0});var Cp=(O(),I(E));Cp.__exportStar(C8(),Ea);Cp.__exportStar(iR(),Ea);Cp.__exportStar(T8(),Ea);Cp.__exportStar(E8(),Ea);Cp.__exportStar(tR(),Ea);Cp.__exportStar(oR(),Ea)});var qy=g(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.id_mgf1=Q.id_md5=Q.id_md2=Q.id_sha512_256=Q.id_sha512_224=Q.id_sha512=Q.id_sha384=Q.id_sha256=Q.id_sha224=Q.id_sha1=Q.id_sha512_256WithRSAEncryption=Q.id_sha512_224WithRSAEncryption=Q.id_sha512WithRSAEncryption=Q.id_sha384WithRSAEncryption=Q.id_sha256WithRSAEncryption=Q.id_ssha224WithRSAEncryption=Q.id_sha224WithRSAEncryption=Q.id_sha1WithRSAEncryption=Q.id_md5WithRSAEncryption=Q.id_md2WithRSAEncryption=Q.id_RSASSA_PSS=Q.id_pSpecified=Q.id_RSAES_OAEP=Q.id_rsaEncryption=Q.id_pkcs_1=void 0;Q.id_pkcs_1="1.2.840.113549.1.1";Q.id_rsaEncryption=`${Q.id_pkcs_1}.1`;Q.id_RSAES_OAEP=`${Q.id_pkcs_1}.7`;Q.id_pSpecified=`${Q.id_pkcs_1}.9`;Q.id_RSASSA_PSS=`${Q.id_pkcs_1}.10`;Q.id_md2WithRSAEncryption=`${Q.id_pkcs_1}.2`;Q.id_md5WithRSAEncryption=`${Q.id_pkcs_1}.4`;Q.id_sha1WithRSAEncryption=`${Q.id_pkcs_1}.5`;Q.id_sha224WithRSAEncryption=`${Q.id_pkcs_1}.14`;Q.id_ssha224WithRSAEncryption=Q.id_sha224WithRSAEncryption;Q.id_sha256WithRSAEncryption=`${Q.id_pkcs_1}.11`;Q.id_sha384WithRSAEncryption=`${Q.id_pkcs_1}.12`;Q.id_sha512WithRSAEncryption=`${Q.id_pkcs_1}.13`;Q.id_sha512_224WithRSAEncryption=`${Q.id_pkcs_1}.15`;Q.id_sha512_256WithRSAEncryption=`${Q.id_pkcs_1}.16`;Q.id_sha1="1.3.14.3.2.26";Q.id_sha224="2.16.840.1.101.3.4.2.4";Q.id_sha256="2.16.840.1.101.3.4.2.1";Q.id_sha384="2.16.840.1.101.3.4.2.2";Q.id_sha512="2.16.840.1.101.3.4.2.3";Q.id_sha512_224="2.16.840.1.101.3.4.2.5";Q.id_sha512_256="2.16.840.1.101.3.4.2.6";Q.id_md2="1.2.840.113549.2.2";Q.id_md5="1.2.840.113549.2.5";Q.id_mgf1=`${Q.id_pkcs_1}.8`});var TS=g(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.sha512_256WithRSAEncryption=Ce.sha512_224WithRSAEncryption=Ce.sha512WithRSAEncryption=Ce.sha384WithRSAEncryption=Ce.sha256WithRSAEncryption=Ce.sha224WithRSAEncryption=Ce.sha1WithRSAEncryption=Ce.md5WithRSAEncryption=Ce.md2WithRSAEncryption=Ce.rsaEncryption=Ce.pSpecifiedEmpty=Ce.mgf1SHA1=Ce.sha512_256=Ce.sha512_224=Ce.sha512=Ce.sha384=Ce.sha256=Ce.sha224=Ce.sha1=Ce.md4=Ce.md2=void 0;var sR=R(),aR=et(),lr=qy();function wr(t){return new aR.AlgorithmIdentifier({algorithm:t,parameters:null})}Ce.md2=wr(lr.id_md2);Ce.md4=wr(lr.id_md5);Ce.sha1=wr(lr.id_sha1);Ce.sha224=wr(lr.id_sha224);Ce.sha256=wr(lr.id_sha256);Ce.sha384=wr(lr.id_sha384);Ce.sha512=wr(lr.id_sha512);Ce.sha512_224=wr(lr.id_sha512_224);Ce.sha512_256=wr(lr.id_sha512_256);Ce.mgf1SHA1=new aR.AlgorithmIdentifier({algorithm:lr.id_mgf1,parameters:sR.AsnConvert.serialize(Ce.sha1)});Ce.pSpecifiedEmpty=new aR.AlgorithmIdentifier({algorithm:lr.id_pSpecified,parameters:sR.AsnConvert.serialize(sR.AsnOctetStringConverter.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});Ce.rsaEncryption=wr(lr.id_rsaEncryption);Ce.md2WithRSAEncryption=wr(lr.id_md2WithRSAEncryption);Ce.md5WithRSAEncryption=wr(lr.id_md5WithRSAEncryption);Ce.sha1WithRSAEncryption=wr(lr.id_sha1WithRSAEncryption);Ce.sha224WithRSAEncryption=wr(lr.id_sha512_224WithRSAEncryption);Ce.sha256WithRSAEncryption=wr(lr.id_sha512_256WithRSAEncryption);Ce.sha384WithRSAEncryption=wr(lr.id_sha384WithRSAEncryption);Ce.sha512WithRSAEncryption=wr(lr.id_sha512WithRSAEncryption);Ce.sha512_224WithRSAEncryption=wr(lr.id_sha512_224WithRSAEncryption);Ce.sha512_256WithRSAEncryption=wr(lr.id_sha512_256WithRSAEncryption)});var N8=g(Ip=>{"use strict";Object.defineProperty(Ip,"__esModule",{value:!0});Ip.RSAES_OAEP=Ip.RsaEsOaepParams=void 0;var cR=(O(),I(E)),Uy=R(),Tu=et(),j8=qy(),Tp=TS(),Iu=class{constructor(e={}){this.hashAlgorithm=new Tu.AlgorithmIdentifier(Tp.sha1),this.maskGenAlgorithm=new Tu.AlgorithmIdentifier({algorithm:j8.id_mgf1,parameters:Uy.AsnConvert.serialize(Tp.sha1)}),this.pSourceAlgorithm=new Tu.AlgorithmIdentifier(Tp.pSpecifiedEmpty),Object.assign(this,e)}};Ip.RsaEsOaepParams=Iu;cR.__decorate([(0,Uy.AsnProp)({type:Tu.AlgorithmIdentifier,context:0,defaultValue:Tp.sha1})],Iu.prototype,"hashAlgorithm",void 0);cR.__decorate([(0,Uy.AsnProp)({type:Tu.AlgorithmIdentifier,context:1,defaultValue:Tp.mgf1SHA1})],Iu.prototype,"maskGenAlgorithm",void 0);cR.__decorate([(0,Uy.AsnProp)({type:Tu.AlgorithmIdentifier,context:2,defaultValue:Tp.pSpecifiedEmpty})],Iu.prototype,"pSourceAlgorithm",void 0);Ip.RSAES_OAEP=new Tu.AlgorithmIdentifier({algorithm:j8.id_RSAES_OAEP,parameters:Uy.AsnConvert.serialize(new Iu)})});var R8=g(Ep=>{"use strict";Object.defineProperty(Ep,"__esModule",{value:!0});Ep.RSASSA_PSS=Ep.RsaSaPssParams=void 0;var ES=(O(),I(E)),Oa=R(),By=et(),z8=qy(),IS=TS(),ja=class{constructor(e={}){this.hashAlgorithm=new By.AlgorithmIdentifier(IS.sha1),this.maskGenAlgorithm=new By.AlgorithmIdentifier({algorithm:z8.id_mgf1,parameters:Oa.AsnConvert.serialize(IS.sha1)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}};Ep.RsaSaPssParams=ja;ES.__decorate([(0,Oa.AsnProp)({type:By.AlgorithmIdentifier,context:0,defaultValue:IS.sha1})],ja.prototype,"hashAlgorithm",void 0);ES.__decorate([(0,Oa.AsnProp)({type:By.AlgorithmIdentifier,context:1,defaultValue:IS.mgf1SHA1})],ja.prototype,"maskGenAlgorithm",void 0);ES.__decorate([(0,Oa.AsnProp)({type:Oa.AsnPropTypes.Integer,context:2,defaultValue:20})],ja.prototype,"saltLength",void 0);ES.__decorate([(0,Oa.AsnProp)({type:Oa.AsnPropTypes.Integer,context:3,defaultValue:1})],ja.prototype,"trailerField",void 0);Ep.RSASSA_PSS=new By.AlgorithmIdentifier({algorithm:z8.id_RSASSA_PSS,parameters:Oa.AsnConvert.serialize(new ja)})});var q8=g(jS=>{"use strict";Object.defineProperty(jS,"__esModule",{value:!0});jS.DigestInfo=void 0;var M8=(O(),I(E)),D8=et(),OS=R(),Ly=class{constructor(e={}){this.digestAlgorithm=new D8.AlgorithmIdentifier,this.digest=new OS.OctetString,Object.assign(this,e)}};jS.DigestInfo=Ly;M8.__decorate([(0,OS.AsnProp)({type:D8.AlgorithmIdentifier})],Ly.prototype,"digestAlgorithm",void 0);M8.__decorate([(0,OS.AsnProp)({type:OS.OctetString})],Ly.prototype,"digest",void 0)});var U8=g(Zy=>{"use strict";Object.defineProperty(Zy,"__esModule",{value:!0});var uR=(O(),I(E));uR.__exportStar(N8(),Zy);uR.__exportStar(R8(),Zy);uR.__exportStar(q8(),Zy)});var pR=g(Ou=>{"use strict";var lR;Object.defineProperty(Ou,"__esModule",{value:!0});Ou.OtherPrimeInfos=Ou.OtherPrimeInfo=void 0;var NS=(O(),I(E)),xo=R(),Eu=class{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};Ou.OtherPrimeInfo=Eu;NS.__decorate([(0,xo.AsnProp)({type:xo.AsnPropTypes.Integer,converter:xo.AsnIntegerArrayBufferConverter})],Eu.prototype,"prime",void 0);NS.__decorate([(0,xo.AsnProp)({type:xo.AsnPropTypes.Integer,converter:xo.AsnIntegerArrayBufferConverter})],Eu.prototype,"exponent",void 0);NS.__decorate([(0,xo.AsnProp)({type:xo.AsnPropTypes.Integer,converter:xo.AsnIntegerArrayBufferConverter})],Eu.prototype,"coefficient",void 0);var dR=lR=class extends xo.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,lR.prototype)}};Ou.OtherPrimeInfos=dR;Ou.OtherPrimeInfos=dR=lR=NS.__decorate([(0,xo.AsnType)({type:xo.AsnTypeTypes.Sequence,itemType:Eu})],dR)});var B8=g(zS=>{"use strict";Object.defineProperty(zS,"__esModule",{value:!0});zS.RSAPrivateKey=void 0;var Di=(O(),I(E)),$t=R(),bme=pR(),Jn=class{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};zS.RSAPrivateKey=Jn;Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer})],Jn.prototype,"version",void 0);Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer,converter:$t.AsnIntegerArrayBufferConverter})],Jn.prototype,"modulus",void 0);Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer,converter:$t.AsnIntegerArrayBufferConverter})],Jn.prototype,"publicExponent",void 0);Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer,converter:$t.AsnIntegerArrayBufferConverter})],Jn.prototype,"privateExponent",void 0);Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer,converter:$t.AsnIntegerArrayBufferConverter})],Jn.prototype,"prime1",void 0);Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer,converter:$t.AsnIntegerArrayBufferConverter})],Jn.prototype,"prime2",void 0);Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer,converter:$t.AsnIntegerArrayBufferConverter})],Jn.prototype,"exponent1",void 0);Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer,converter:$t.AsnIntegerArrayBufferConverter})],Jn.prototype,"exponent2",void 0);Di.__decorate([(0,$t.AsnProp)({type:$t.AsnPropTypes.Integer,converter:$t.AsnIntegerArrayBufferConverter})],Jn.prototype,"coefficient",void 0);Di.__decorate([(0,$t.AsnProp)({type:bme.OtherPrimeInfos,optional:!0})],Jn.prototype,"otherPrimeInfos",void 0)});var Z8=g(RS=>{"use strict";Object.defineProperty(RS,"__esModule",{value:!0});RS.RSAPublicKey=void 0;var L8=(O(),I(E)),Op=R(),Vy=class{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}};RS.RSAPublicKey=Vy;L8.__decorate([(0,Op.AsnProp)({type:Op.AsnPropTypes.Integer,converter:Op.AsnIntegerArrayBufferConverter})],Vy.prototype,"modulus",void 0);L8.__decorate([(0,Op.AsnProp)({type:Op.AsnPropTypes.Integer,converter:Op.AsnIntegerArrayBufferConverter})],Vy.prototype,"publicExponent",void 0)});var fR=g(Na=>{"use strict";Object.defineProperty(Na,"__esModule",{value:!0});var jp=(O(),I(E));jp.__exportStar(U8(),Na);jp.__exportStar(TS(),Na);jp.__exportStar(qy(),Na);jp.__exportStar(pR(),Na);jp.__exportStar(B8(),Na);jp.__exportStar(Z8(),Na)});var MS={};To(MS,{__assign:()=>hR,__asyncDelegator:()=>jme,__asyncGenerator:()=>Ome,__asyncValues:()=>Nme,__await:()=>Fy,__awaiter:()=>Ame,__classPrivateFieldGet:()=>Dme,__classPrivateFieldSet:()=>qme,__createBinding:()=>Cme,__decorate:()=>Sme,__exportStar:()=>Tme,__extends:()=>wme,__generator:()=>Pme,__importDefault:()=>Mme,__importStar:()=>Rme,__makeTemplateObject:()=>zme,__metadata:()=>$me,__param:()=>kme,__read:()=>V8,__rest:()=>xme,__spread:()=>Ime,__spreadArrays:()=>Eme,__values:()=>gR});function wme(t,e){mR(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function xme(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r}function Sme(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,r,i):s(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i}function kme(t,e){return function(r,n){e(r,n,t)}}function $me(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Ame(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(l){try{u(n.next(l))}catch(d){s(d)}}function c(l){try{u(n.throw(l))}catch(d){s(d)}}function u(l){l.done?i(l.value):o(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function Pme(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Cme(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Tme(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function gR(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function V8(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function Ime(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(V8(arguments[e]));return t}function Eme(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}function Fy(t){return this instanceof Fy?(this.v=t,this):new Fy(t)}function Ome(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),o,i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(p){n[p]&&(o[p]=function(f){return new Promise(function(h,m){i.push([p,f,h,m])>1||a(p,f)})})}function a(p,f){try{c(n[p](f))}catch(h){d(i[0][3],h)}}function c(p){p.value instanceof Fy?Promise.resolve(p.value.v).then(u,l):d(i[0][2],p)}function u(p){a("next",p)}function l(p){a("throw",p)}function d(p,f){p(f),i.shift(),i.length&&a(i[0][0],i[0][1])}}function jme(t){var e,r;return e={},n("next"),n("throw",function(o){throw o}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(o,i){e[o]=t[o]?function(s){return(r=!r)?{value:Fy(t[o](s)),done:o==="return"}:i?i(s):s}:i}}function Nme(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof gR=="function"?gR(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(s){return new Promise(function(a,c){s=t[i](s),o(a,c,s.done,s.value)})}}function o(i,s,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},s)}}function zme(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Rme(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Mme(t){return t&&t.__esModule?t:{default:t}}function Dme(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function qme(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var mR,hR,DS=A(()=>{mR=function(t,e){return mR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},mR(t,e)};hR=function(){return hR=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},hR.apply(this,arguments)}});var _R=g(vR=>{"use strict";Object.defineProperty(vR,"__esModule",{value:!0});var yR;(function(t){t[t.Transient=0]="Transient",t[t.Singleton=1]="Singleton",t[t.ResolutionScoped=2]="ResolutionScoped",t[t.ContainerScoped=3]="ContainerScoped"})(yR||(yR={}));vR.default=yR});var F8=g(bR=>{"use strict";Object.defineProperty(bR,"__esModule",{value:!0});var Ume=_R();Object.defineProperty(bR,"Lifecycle",{enumerable:!0,get:function(){return Ume.default}})});var ju=g(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.defineInjectionTokenMetadata=ti.getParamInfo=ti.INJECTION_TOKEN_METADATA_KEY=void 0;ti.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function Bme(t){let e=Reflect.getMetadata("design:paramtypes",t)||[],r=Reflect.getOwnMetadata(ti.INJECTION_TOKEN_METADATA_KEY,t)||{};return Object.keys(r).forEach(n=>{e[+n]=r[n]}),e}ti.getParamInfo=Bme;function Lme(t,e){return function(r,n,o){let i=Reflect.getOwnMetadata(ti.INJECTION_TOKEN_METADATA_KEY,r)||{};i[o]=e?{token:t,transform:e.transformToken,transformArgs:e.args||[]}:t,Reflect.defineMetadata(ti.INJECTION_TOKEN_METADATA_KEY,i,r)}}ti.defineInjectionTokenMetadata=Lme});var wR=g(qS=>{"use strict";Object.defineProperty(qS,"__esModule",{value:!0});qS.isClassProvider=void 0;function Zme(t){return!!t.useClass}qS.isClassProvider=Zme});var xR=g(US=>{"use strict";Object.defineProperty(US,"__esModule",{value:!0});US.isFactoryProvider=void 0;function Vme(t){return!!t.useFactory}US.isFactoryProvider=Vme});var LS=g(Np=>{"use strict";Object.defineProperty(Np,"__esModule",{value:!0});Np.delay=Np.DelayedConstructor=void 0;var BS=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let r={},n=!1,o,i=()=>(n||(o=e(this.wrap()),n=!0),o);return new Proxy(r,this.createHandler(i))}createHandler(e){let r={},n=o=>{r[o]=(...i)=>{i[0]=e();let s=Reflect[o];return s(...i)}};return this.reflectMethods.forEach(n),r}};Np.DelayedConstructor=BS;function Fme(t){if(typeof t>"u")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new BS(t)}Np.delay=Fme});var ZS=g(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.isConstructorToken=qi.isTransformDescriptor=qi.isTokenDescriptor=qi.isNormalToken=void 0;var Hme=LS();function Kme(t){return typeof t=="string"||typeof t=="symbol"}qi.isNormalToken=Kme;function Wme(t){return typeof t=="object"&&"token"in t&&"multiple"in t}qi.isTokenDescriptor=Wme;function Gme(t){return typeof t=="object"&&"token"in t&&"transform"in t}qi.isTransformDescriptor=Gme;function Jme(t){return typeof t=="function"||t instanceof Hme.DelayedConstructor}qi.isConstructorToken=Jme});var SR=g(VS=>{"use strict";Object.defineProperty(VS,"__esModule",{value:!0});VS.isTokenProvider=void 0;function Xme(t){return!!t.useToken}VS.isTokenProvider=Xme});var kR=g(FS=>{"use strict";Object.defineProperty(FS,"__esModule",{value:!0});FS.isValueProvider=void 0;function Yme(t){return t.useValue!=null}FS.isValueProvider=Yme});var $R=g(Nu=>{"use strict";Object.defineProperty(Nu,"__esModule",{value:!0});var Qme=wR();Object.defineProperty(Nu,"isClassProvider",{enumerable:!0,get:function(){return Qme.isClassProvider}});var ehe=xR();Object.defineProperty(Nu,"isFactoryProvider",{enumerable:!0,get:function(){return ehe.isFactoryProvider}});var the=ZS();Object.defineProperty(Nu,"isNormalToken",{enumerable:!0,get:function(){return the.isNormalToken}});var rhe=SR();Object.defineProperty(Nu,"isTokenProvider",{enumerable:!0,get:function(){return rhe.isTokenProvider}});var nhe=kR();Object.defineProperty(Nu,"isValueProvider",{enumerable:!0,get:function(){return nhe.isValueProvider}})});var H8=g(HS=>{"use strict";Object.defineProperty(HS,"__esModule",{value:!0});HS.isProvider=void 0;var ohe=wR(),ihe=kR(),she=SR(),ahe=xR();function che(t){return ohe.isClassProvider(t)||ihe.isValueProvider(t)||she.isTokenProvider(t)||ahe.isFactoryProvider(t)}HS.isProvider=che});var CR=g(PR=>{"use strict";Object.defineProperty(PR,"__esModule",{value:!0});var AR=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let r=this._registryMap.get(e);return r[r.length-1]||null}set(e,r){this.ensure(e),this._registryMap.get(e).push(r)}setAll(e,r){this._registryMap.set(e,r)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};PR.default=AR});var K8=g(IR=>{"use strict";Object.defineProperty(IR,"__esModule",{value:!0});var uhe=CR(),TR=class extends uhe.default{};IR.default=TR});var W8=g(OR=>{"use strict";Object.defineProperty(OR,"__esModule",{value:!0});var ER=class{constructor(){this.scopedResolutions=new Map}};OR.default=ER});var jR=g(KS=>{"use strict";Object.defineProperty(KS,"__esModule",{value:!0});KS.formatErrorCtor=void 0;function lhe(t,e){return t===null?`at position #${e}`:`"${t.split(",")[e].trim()}" at position #${e}`}function dhe(t,e,r="    "){return[t,...e.message.split(`
`).map(n=>r+n)].join(`
`)}function phe(t,e,r){let[,n=null]=t.toString().match(/constructor\(([\w, ]+)\)/)||[],o=lhe(n,e);return dhe(`Cannot inject the dependency ${o} of "${t.name}" constructor. Reason:`,r)}KS.formatErrorCtor=phe});var G8=g(WS=>{"use strict";Object.defineProperty(WS,"__esModule",{value:!0});WS.isDisposable=void 0;function fhe(t){return!(typeof t.dispose!="function"||t.dispose.length>0)}WS.isDisposable=fhe});var X8=g(zu=>{"use strict";Object.defineProperty(zu,"__esModule",{value:!0});zu.PostResolutionInterceptors=zu.PreResolutionInterceptors=void 0;var J8=CR(),GS=class extends J8.default{};zu.PreResolutionInterceptors=GS;var JS=class extends J8.default{};zu.PostResolutionInterceptors=JS;var NR=class{constructor(){this.preResolution=new GS,this.postResolution=new JS}};zu.default=NR});var za=g(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});As.instance=As.typeInfo=void 0;var mhe=(DS(),I(MS)),mn=$R(),hhe=H8(),XS=ZS(),ghe=K8(),En=_R(),YS=W8(),yhe=jR(),vhe=LS(),_he=G8(),bhe=X8();As.typeInfo=new Map;var zR=class t{constructor(e){this.parent=e,this._registry=new ghe.default,this.interceptors=new bhe.default,this.disposed=!1,this.disposables=new Set}register(e,r,n={lifecycle:En.default.Transient}){this.ensureNotDisposed();let o;if(hhe.isProvider(r)?o=r:o={useClass:r},mn.isTokenProvider(o)){let i=[e],s=o;for(;s!=null;){let a=s.useToken;if(i.includes(a))throw new Error(`Token registration cycle detected! ${[...i,a].join(" -> ")}`);i.push(a);let c=this._registry.get(a);c&&mn.isTokenProvider(c.provider)?s=c.provider:s=null}}if((n.lifecycle===En.default.Singleton||n.lifecycle==En.default.ContainerScoped||n.lifecycle==En.default.ResolutionScoped)&&(mn.isValueProvider(o)||mn.isFactoryProvider(o)))throw new Error(`Cannot use lifecycle "${En.default[n.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:o,options:n}),this}registerType(e,r){return this.ensureNotDisposed(),mn.isNormalToken(r)?this.register(e,{useToken:r}):this.register(e,{useClass:r})}registerInstance(e,r){return this.ensureNotDisposed(),this.register(e,{useValue:r})}registerSingleton(e,r){if(this.ensureNotDisposed(),mn.isNormalToken(e)){if(mn.isNormalToken(r))return this.register(e,{useToken:r},{lifecycle:En.default.Singleton});if(r)return this.register(e,{useClass:r},{lifecycle:En.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let n=e;return r&&!mn.isNormalToken(r)&&(n=r),this.register(e,{useClass:n},{lifecycle:En.default.Singleton})}resolve(e,r=new YS.default,n=!1){this.ensureNotDisposed();let o=this.getRegistration(e);if(!o&&mn.isNormalToken(e)){if(n)return;throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"Single"),o){let i=this.resolveRegistration(o,r);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(XS.isConstructorToken(e)){let i=this.construct(e,r);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,r){if(this.interceptors.preResolution.has(e)){let n=[];for(let o of this.interceptors.preResolution.getAll(e))o.options.frequency!="Once"&&n.push(o),o.callback(e,r);this.interceptors.preResolution.setAll(e,n)}}executePostResolutionInterceptor(e,r,n){if(this.interceptors.postResolution.has(e)){let o=[];for(let i of this.interceptors.postResolution.getAll(e))i.options.frequency!="Once"&&o.push(i),i.callback(e,r,n);this.interceptors.postResolution.setAll(e,o)}}resolveRegistration(e,r){if(this.ensureNotDisposed(),e.options.lifecycle===En.default.ResolutionScoped&&r.scopedResolutions.has(e))return r.scopedResolutions.get(e);let n=e.options.lifecycle===En.default.Singleton,o=e.options.lifecycle===En.default.ContainerScoped,i=n||o,s;return mn.isValueProvider(e.provider)?s=e.provider.useValue:mn.isTokenProvider(e.provider)?s=i?e.instance||(e.instance=this.resolve(e.provider.useToken,r)):this.resolve(e.provider.useToken,r):mn.isClassProvider(e.provider)?s=i?e.instance||(e.instance=this.construct(e.provider.useClass,r)):this.construct(e.provider.useClass,r):mn.isFactoryProvider(e.provider)?s=e.provider.useFactory(this):s=this.construct(e.provider,r),e.options.lifecycle===En.default.ResolutionScoped&&r.scopedResolutions.set(e,s),s}resolveAll(e,r=new YS.default,n=!1){this.ensureNotDisposed();let o=this.getAllRegistrations(e);if(!o&&mn.isNormalToken(e)){if(n)return[];throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"All"),o){let s=o.map(a=>this.resolveRegistration(a,r));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,r)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,r=!1){return this.ensureNotDisposed(),this._registry.has(e)||r&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,r]of this._registry.entries())this._registry.setAll(e,r.filter(n=>!mn.isValueProvider(n.provider)).map(n=>(n.instance=void 0,n)))}createChildContainer(){this.ensureNotDisposed();let e=new t(this);for(let[r,n]of this._registry.entries())n.some(({options:o})=>o.lifecycle===En.default.ContainerScoped)&&e._registry.setAll(r,n.map(o=>o.options.lifecycle===En.default.ContainerScoped?{provider:o.provider,options:o.options}:o));return e}beforeResolution(e,r,n={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:r,options:n})}afterResolution(e,r,n={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:r,options:n})}dispose(){return mhe.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(r=>{let n=r.dispose();n&&e.push(n)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,r){if(e instanceof vhe.DelayedConstructor)return e.createProxy(o=>this.resolve(o,r));let n=(()=>{let o=As.typeInfo.get(e);if(!o||o.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let i=o.map(this.resolveParams(r,e));return new e(...i)})();return _he.isDisposable(n)&&this.disposables.add(n),n}resolveParams(e,r){return(n,o)=>{try{return XS.isTokenDescriptor(n)?XS.isTransformDescriptor(n)?n.multiple?this.resolve(n.transform).transform(this.resolveAll(n.token,new YS.default,n.isOptional),...n.transformArgs):this.resolve(n.transform).transform(this.resolve(n.token,e,n.isOptional),...n.transformArgs):n.multiple?this.resolveAll(n.token,new YS.default,n.isOptional):this.resolve(n.token,e,n.isOptional):XS.isTransformDescriptor(n)?this.resolve(n.transform,e).transform(this.resolve(n.token,e),...n.transformArgs):this.resolve(n,e)}catch(i){throw new Error(yhe.formatErrorCtor(r,o,i))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};As.instance=new zR;As.default=As.instance});var Y8=g(MR=>{"use strict";Object.defineProperty(MR,"__esModule",{value:!0});var whe=ju(),Ps=za(),RR=ZS(),xhe=jR();function She(){return function(t){let e=whe.getParamInfo(t);return class extends t{constructor(...r){super(...r.concat(e.slice(r.length).map((n,o)=>{try{return RR.isTokenDescriptor(n)?RR.isTransformDescriptor(n)?n.multiple?Ps.instance.resolve(n.transform).transform(Ps.instance.resolveAll(n.token),...n.transformArgs):Ps.instance.resolve(n.transform).transform(Ps.instance.resolve(n.token),...n.transformArgs):n.multiple?Ps.instance.resolveAll(n.token):Ps.instance.resolve(n.token):RR.isTransformDescriptor(n)?Ps.instance.resolve(n.transform).transform(Ps.instance.resolve(n.token),...n.transformArgs):Ps.instance.resolve(n)}catch(i){let s=o+r.length;throw new Error(xhe.formatErrorCtor(t,s,i))}})))}}}}MR.default=She});var Q8=g(DR=>{"use strict";Object.defineProperty(DR,"__esModule",{value:!0});var khe=ju();function $he(t,e){let r={token:t,multiple:!1,isOptional:e&&e.isOptional};return khe.defineInjectionTokenMetadata(r)}DR.default=$he});var QS=g(qR=>{"use strict";Object.defineProperty(qR,"__esModule",{value:!0});var Ahe=ju(),Phe=za(),eK=za();function Che(t){return function(e){Phe.typeInfo.set(e,Ahe.getParamInfo(e)),t&&t.token&&(Array.isArray(t.token)?t.token.forEach(r=>{eK.instance.register(r,e)}):eK.instance.register(t.token,e))}}qR.default=Che});var tK=g(UR=>{"use strict";Object.defineProperty(UR,"__esModule",{value:!0});var The=(DS(),I(MS)),Ihe=za();function Ehe(t=[]){return function(e){return t.forEach(r=>{var{token:n,options:o}=r,i=The.__rest(r,["token","options"]);return Ihe.instance.register(n,i,o)}),e}}UR.default=Ehe});var rK=g(BR=>{"use strict";Object.defineProperty(BR,"__esModule",{value:!0});var Ohe=QS(),jhe=za();function Nhe(){return function(t){Ohe.default()(t),jhe.instance.registerSingleton(t)}}BR.default=Nhe});var nK=g(LR=>{"use strict";Object.defineProperty(LR,"__esModule",{value:!0});var zhe=ju();function Rhe(t,e){let r={token:t,multiple:!0,isOptional:e&&e.isOptional};return zhe.defineInjectionTokenMetadata(r)}LR.default=Rhe});var oK=g(ZR=>{"use strict";Object.defineProperty(ZR,"__esModule",{value:!0});var Mhe=ju();function Dhe(t,e,...r){let n={token:t,multiple:!0,transform:e,transformArgs:r};return Mhe.defineInjectionTokenMetadata(n)}ZR.default=Dhe});var iK=g(VR=>{"use strict";Object.defineProperty(VR,"__esModule",{value:!0});var qhe=ju();function Uhe(t,e,...r){return qhe.defineInjectionTokenMetadata(t,{transformToken:e,args:r})}VR.default=Uhe});var sK=g(FR=>{"use strict";Object.defineProperty(FR,"__esModule",{value:!0});var Bhe=QS(),Lhe=za();function Zhe(t,e){return function(r){Bhe.default()(r),Lhe.instance.register(e||r,r,{lifecycle:t})}}FR.default=Zhe});var aK=g(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});var Vhe=Y8();Object.defineProperty(ri,"autoInjectable",{enumerable:!0,get:function(){return Vhe.default}});var Fhe=Q8();Object.defineProperty(ri,"inject",{enumerable:!0,get:function(){return Fhe.default}});var Hhe=QS();Object.defineProperty(ri,"injectable",{enumerable:!0,get:function(){return Hhe.default}});var Khe=tK();Object.defineProperty(ri,"registry",{enumerable:!0,get:function(){return Khe.default}});var Whe=rK();Object.defineProperty(ri,"singleton",{enumerable:!0,get:function(){return Whe.default}});var Ghe=nK();Object.defineProperty(ri,"injectAll",{enumerable:!0,get:function(){return Ghe.default}});var Jhe=oK();Object.defineProperty(ri,"injectAllWithTransform",{enumerable:!0,get:function(){return Jhe.default}});var Xhe=iK();Object.defineProperty(ri,"injectWithTransform",{enumerable:!0,get:function(){return Xhe.default}});var Yhe=sK();Object.defineProperty(ri,"scoped",{enumerable:!0,get:function(){return Yhe.default}})});var cK=g(HR=>{"use strict";Object.defineProperty(HR,"__esModule",{value:!0});function Qhe(t){let e;return r=>(e==null&&(e=t(r)),e)}HR.default=Qhe});var uK=g(KR=>{"use strict";Object.defineProperty(KR,"__esModule",{value:!0});function ege(t){let e=new WeakMap;return r=>{let n=e.get(r);return n==null&&(n=t(r),e.set(r,n)),n}}KR.default=ege});var lK=g(WR=>{"use strict";Object.defineProperty(WR,"__esModule",{value:!0});function tge(t,e,r,n=!0){let o,i;return s=>{let a=t(s);return(!n||i!==a)&&((i=a)?o=s.resolve(e):o=s.resolve(r)),o}}WR.default=tge});var dK=g(Hy=>{"use strict";Object.defineProperty(Hy,"__esModule",{value:!0});var rge=cK();Object.defineProperty(Hy,"instanceCachingFactory",{enumerable:!0,get:function(){return rge.default}});var nge=uK();Object.defineProperty(Hy,"instancePerContainerCachingFactory",{enumerable:!0,get:function(){return nge.default}});var oge=lK();Object.defineProperty(Hy,"predicateAwareClassFactory",{enumerable:!0,get:function(){return oge.default}})});var pK=g(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});var GR=(DS(),I(MS));if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var ige=F8();Object.defineProperty(Ra,"Lifecycle",{enumerable:!0,get:function(){return ige.Lifecycle}});GR.__exportStar(aK(),Ra);GR.__exportStar(dK(),Ra);GR.__exportStar($R(),Ra);var sge=LS();Object.defineProperty(Ra,"delay",{enumerable:!0,get:function(){return sge.delay}});var age=za();Object.defineProperty(Ra,"container",{enumerable:!0,get:function(){return age.instance}})});var QR=g(Mu=>{"use strict";var JR;Object.defineProperty(Mu,"__esModule",{value:!0});Mu.PKCS12AttrSet=Mu.PKCS12Attribute=void 0;var YR=(O(),I(E)),Ru=R(),zp=class{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}};Mu.PKCS12Attribute=zp;YR.__decorate([(0,Ru.AsnProp)({type:Ru.AsnPropTypes.ObjectIdentifier})],zp.prototype,"attrId",void 0);YR.__decorate([(0,Ru.AsnProp)({type:Ru.AsnPropTypes.Any,repeated:"set"})],zp.prototype,"attrValues",void 0);var XR=JR=class extends Ru.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,JR.prototype)}};Mu.PKCS12AttrSet=XR;Mu.PKCS12AttrSet=XR=JR=YR.__decorate([(0,Ru.AsnType)({type:Ru.AsnTypeTypes.Sequence,itemType:zp})],XR)});var fK=g(Ky=>{"use strict";var eM;Object.defineProperty(Ky,"__esModule",{value:!0});Ky.AuthenticatedSafe=void 0;var cge=(O(),I(E)),tM=R(),uge=Ny(),rM=eM=class extends tM.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,eM.prototype)}};Ky.AuthenticatedSafe=rM;Ky.AuthenticatedSafe=rM=eM=cge.__decorate([(0,tM.AsnType)({type:tM.AsnTypeTypes.Sequence,itemType:uge.ContentInfo})],rM)});var nM=g(rt=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});rt.id_bagtypes=rt.id_pbewithSHAAnd40BitRC2_CBC=rt.id_pbeWithSHAAnd128BitRC2_CBC=rt.id_pbeWithSHAAnd2_KeyTripleDES_CBC=rt.id_pbeWithSHAAnd3_KeyTripleDES_CBC=rt.id_pbeWithSHAAnd40BitRC4=rt.id_pbeWithSHAAnd128BitRC4=rt.id_pkcs_12PbeIds=rt.id_pkcs_12=rt.id_pkcs=rt.id_rsadsi=void 0;rt.id_rsadsi="1.2.840.113549";rt.id_pkcs=`${rt.id_rsadsi}.1`;rt.id_pkcs_12=`${rt.id_pkcs}.12`;rt.id_pkcs_12PbeIds=`${rt.id_pkcs_12}.1`;rt.id_pbeWithSHAAnd128BitRC4=`${rt.id_pkcs_12PbeIds}.1`;rt.id_pbeWithSHAAnd40BitRC4=`${rt.id_pkcs_12PbeIds}.2`;rt.id_pbeWithSHAAnd3_KeyTripleDES_CBC=`${rt.id_pkcs_12PbeIds}.3`;rt.id_pbeWithSHAAnd2_KeyTripleDES_CBC=`${rt.id_pkcs_12PbeIds}.4`;rt.id_pbeWithSHAAnd128BitRC2_CBC=`${rt.id_pkcs_12PbeIds}.5`;rt.id_pbewithSHAAnd40BitRC2_CBC=`${rt.id_pkcs_12PbeIds}.6`;rt.id_bagtypes=`${rt.id_pkcs_12}.10.1`});var ek=g(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.id_pkcs_9=Qr.id_SafeContents=Qr.id_SecretBag=Qr.id_CRLBag=Qr.id_certBag=Qr.id_pkcs8ShroudedKeyBag=Qr.id_keyBag=void 0;var Rp=nM();Qr.id_keyBag=`${Rp.id_bagtypes}.1`;Qr.id_pkcs8ShroudedKeyBag=`${Rp.id_bagtypes}.2`;Qr.id_certBag=`${Rp.id_bagtypes}.3`;Qr.id_CRLBag=`${Rp.id_bagtypes}.4`;Qr.id_SecretBag=`${Rp.id_bagtypes}.5`;Qr.id_SafeContents=`${Rp.id_bagtypes}.6`;Qr.id_pkcs_9="1.2.840.113549.1.9"});var hK=g(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.id_sdsiCertificate=So.id_x509Certificate=So.id_certTypes=So.CertBag=void 0;var mK=(O(),I(E)),tk=R(),lge=ek(),Wy=class{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}};So.CertBag=Wy;mK.__decorate([(0,tk.AsnProp)({type:tk.AsnPropTypes.ObjectIdentifier})],Wy.prototype,"certId",void 0);mK.__decorate([(0,tk.AsnProp)({type:tk.AsnPropTypes.Any,context:0})],Wy.prototype,"certValue",void 0);So.id_certTypes=`${lge.id_pkcs_9}.22`;So.id_x509Certificate=`${So.id_certTypes}.1`;So.id_sdsiCertificate=`${So.id_certTypes}.2`});var yK=g(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});Cs.id_x509CRL=Cs.id_crlTypes=Cs.CRLBag=void 0;var gK=(O(),I(E)),rk=R(),dge=ek(),Gy=class{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}};Cs.CRLBag=Gy;gK.__decorate([(0,rk.AsnProp)({type:rk.AsnPropTypes.ObjectIdentifier})],Gy.prototype,"crlId",void 0);gK.__decorate([(0,rk.AsnProp)({type:rk.AsnPropTypes.Any,context:0})],Gy.prototype,"crltValue",void 0);Cs.id_crlTypes=`${dge.id_pkcs_9}.23`;Cs.id_x509CRL=`${Cs.id_crlTypes}.1`});var bK=g(Mp=>{"use strict";Object.defineProperty(Mp,"__esModule",{value:!0});Mp.EncryptedPrivateKeyInfo=Mp.EncryptedData=void 0;var vK=(O(),I(E)),oM=R(),_K=et(),Jy=class extends oM.OctetString{};Mp.EncryptedData=Jy;var Xy=class{constructor(e={}){this.encryptionAlgorithm=new _K.AlgorithmIdentifier,this.encryptedData=new Jy,Object.assign(this,e)}};Mp.EncryptedPrivateKeyInfo=Xy;vK.__decorate([(0,oM.AsnProp)({type:_K.AlgorithmIdentifier})],Xy.prototype,"encryptionAlgorithm",void 0);vK.__decorate([(0,oM.AsnProp)({type:Jy})],Xy.prototype,"encryptedData",void 0)});var wK=g(ni=>{"use strict";var iM;Object.defineProperty(ni,"__esModule",{value:!0});ni.PrivateKeyInfo=ni.Attributes=ni.PrivateKey=ni.Version=void 0;var Qy=(O(),I(E)),Ts=R(),aM=et(),sM;(function(t){t[t.v1=0]="v1"})(sM||(ni.Version=sM={}));var Yy=class extends Ts.OctetString{};ni.PrivateKey=Yy;var nk=iM=class extends Ts.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,iM.prototype)}};ni.Attributes=nk;ni.Attributes=nk=iM=Qy.__decorate([(0,Ts.AsnType)({type:Ts.AsnTypeTypes.Sequence,itemType:aM.Attribute})],nk);var Du=class{constructor(e={}){this.version=sM.v1,this.privateKeyAlgorithm=new aM.AlgorithmIdentifier,this.privateKey=new Yy,Object.assign(this,e)}};ni.PrivateKeyInfo=Du;Qy.__decorate([(0,Ts.AsnProp)({type:Ts.AsnPropTypes.Integer})],Du.prototype,"version",void 0);Qy.__decorate([(0,Ts.AsnProp)({type:aM.AlgorithmIdentifier})],Du.prototype,"privateKeyAlgorithm",void 0);Qy.__decorate([(0,Ts.AsnProp)({type:Yy})],Du.prototype,"privateKey",void 0);Qy.__decorate([(0,Ts.AsnProp)({type:nk,implicit:!0,context:0,optional:!0})],Du.prototype,"attributes",void 0)});var ik=g(ok=>{"use strict";Object.defineProperty(ok,"__esModule",{value:!0});var xK=(O(),I(E));xK.__exportStar(bK(),ok);xK.__exportStar(wK(),ok)});var kK=g(ev=>{"use strict";Object.defineProperty(ev,"__esModule",{value:!0});ev.KeyBag=void 0;var pge=(O(),I(E)),fge=ik(),SK=R(),cM=class extends fge.PrivateKeyInfo{};ev.KeyBag=cM;ev.KeyBag=cM=pge.__decorate([(0,SK.AsnType)({type:SK.AsnTypeTypes.Sequence})],cM)});var AK=g(tv=>{"use strict";Object.defineProperty(tv,"__esModule",{value:!0});tv.PKCS8ShroudedKeyBag=void 0;var mge=(O(),I(E)),hge=ik(),$K=R(),uM=class extends hge.EncryptedPrivateKeyInfo{};tv.PKCS8ShroudedKeyBag=uM;tv.PKCS8ShroudedKeyBag=uM=mge.__decorate([(0,$K.AsnType)({type:$K.AsnTypeTypes.Sequence})],uM)});var CK=g(ak=>{"use strict";Object.defineProperty(ak,"__esModule",{value:!0});ak.SecretBag=void 0;var PK=(O(),I(E)),sk=R(),rv=class{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}};ak.SecretBag=rv;PK.__decorate([(0,sk.AsnProp)({type:sk.AsnPropTypes.ObjectIdentifier})],rv.prototype,"secretTypeId",void 0);PK.__decorate([(0,sk.AsnProp)({type:sk.AsnPropTypes.Any,context:0})],rv.prototype,"secretValue",void 0)});var TK=g(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});var Dp=(O(),I(E));Dp.__exportStar(hK(),Ma);Dp.__exportStar(yK(),Ma);Dp.__exportStar(kK(),Ma);Dp.__exportStar(AK(),Ma);Dp.__exportStar(CK(),Ma);Dp.__exportStar(ek(),Ma)});var dM=g(ck=>{"use strict";Object.defineProperty(ck,"__esModule",{value:!0});ck.MacData=void 0;var lM=(O(),I(E)),IK=fR(),qp=R(),Up=class{constructor(e={}){this.mac=new IK.DigestInfo,this.macSalt=new qp.OctetString,this.iterations=1,Object.assign(this,e)}};ck.MacData=Up;lM.__decorate([(0,qp.AsnProp)({type:IK.DigestInfo})],Up.prototype,"mac",void 0);lM.__decorate([(0,qp.AsnProp)({type:qp.OctetString})],Up.prototype,"macSalt",void 0);lM.__decorate([(0,qp.AsnProp)({type:qp.AsnPropTypes.Integer,defaultValue:1})],Up.prototype,"iterations",void 0)});var jK=g(lk=>{"use strict";Object.defineProperty(lk,"__esModule",{value:!0});lk.PFX=void 0;var pM=(O(),I(E)),uk=R(),EK=Ny(),OK=dM(),Bp=class{constructor(e={}){this.version=3,this.authSafe=new EK.ContentInfo,this.macData=new OK.MacData,Object.assign(this,e)}};lk.PFX=Bp;pM.__decorate([(0,uk.AsnProp)({type:uk.AsnPropTypes.Integer})],Bp.prototype,"version",void 0);pM.__decorate([(0,uk.AsnProp)({type:EK.ContentInfo})],Bp.prototype,"authSafe",void 0);pM.__decorate([(0,uk.AsnProp)({type:OK.MacData,optional:!0})],Bp.prototype,"macData",void 0)});var NK=g(Uu=>{"use strict";var fM;Object.defineProperty(Uu,"__esModule",{value:!0});Uu.SafeContents=Uu.SafeBag=void 0;var dk=(O(),I(E)),Da=R(),gge=QR(),qu=class{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}};Uu.SafeBag=qu;dk.__decorate([(0,Da.AsnProp)({type:Da.AsnPropTypes.ObjectIdentifier})],qu.prototype,"bagId",void 0);dk.__decorate([(0,Da.AsnProp)({type:Da.AsnPropTypes.Any,context:0})],qu.prototype,"bagValue",void 0);dk.__decorate([(0,Da.AsnProp)({type:gge.PKCS12Attribute,repeated:"set",optional:!0})],qu.prototype,"bagAttributes",void 0);var mM=fM=class extends Da.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,fM.prototype)}};Uu.SafeContents=mM;Uu.SafeContents=mM=fM=dk.__decorate([(0,Da.AsnType)({type:Da.AsnTypeTypes.Sequence,itemType:qu})],mM)});var zK=g(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});var Bu=(O(),I(E));Bu.__exportStar(QR(),Is);Bu.__exportStar(fK(),Is);Bu.__exportStar(TK(),Is);Bu.__exportStar(dM(),Is);Bu.__exportStar(nM(),Is);Bu.__exportStar(jK(),Is);Bu.__exportStar(NK(),Is)});var RK=g(w=>{"use strict";var hM,gM,yM;Object.defineProperty(w,"__esModule",{value:!0});w.DateOfBirth=w.UnstructuredAddress=w.UnstructuredName=w.EmailAddress=w.EncryptedPrivateKeyInfo=w.UserPKCS12=w.Pkcs7PDU=w.PKCS9String=w.id_at_pseudonym=w.crlTypes=w.id_certTypes=w.id_smime=w.id_pkcs9_mr_signingTimeMatch=w.id_pkcs9_mr_caseIgnoreMatch=w.id_pkcs9_sx_signingTime=w.id_pkcs9_sx_pkcs9String=w.id_pkcs9_at_countryOfResidence=w.id_pkcs9_at_countryOfCitizenship=w.id_pkcs9_at_gender=w.id_pkcs9_at_placeOfBirth=w.id_pkcs9_at_dateOfBirth=w.id_ietf_at=w.id_pkcs9_at_pkcs7PDU=w.id_pkcs9_at_sequenceNumber=w.id_pkcs9_at_randomNonce=w.id_pkcs9_at_encryptedPrivateKeyInfo=w.id_pkcs9_at_pkcs15Token=w.id_pkcs9_at_userPKCS12=w.id_pkcs9_at_localKeyId=w.id_pkcs9_at_friendlyName=w.id_pkcs9_at_smimeCapabilities=w.id_pkcs9_at_extensionRequest=w.id_pkcs9_at_signingDescription=w.id_pkcs9_at_extendedCertificateAttributes=w.id_pkcs9_at_unstructuredAddress=w.id_pkcs9_at_challengePassword=w.id_pkcs9_at_counterSignature=w.id_pkcs9_at_signingTime=w.id_pkcs9_at_messageDigest=w.id_pkcs9_at_contentType=w.id_pkcs9_at_unstructuredName=w.id_pkcs9_at_emailAddress=w.id_pkcs9_oc_naturalPerson=w.id_pkcs9_oc_pkcsEntity=w.id_pkcs9_mr=w.id_pkcs9_sx=w.id_pkcs9_at=w.id_pkcs9_oc=w.id_pkcs9_mo=w.id_pkcs9=void 0;w.SMIMECapabilities=w.SMIMECapability=w.SigningDescription=w.LocalKeyId=w.FriendlyName=w.ExtendedCertificateAttributes=w.ExtensionRequest=w.ChallengePassword=w.CounterSignature=w.SequenceNumber=w.RandomNonce=w.SigningTime=w.MessageDigest=w.ContentType=w.Pseudonym=w.CountryOfResidence=w.CountryOfCitizenship=w.Gender=w.PlaceOfBirth=void 0;var at=(O(),I(E)),ee=R(),RM=Ny(),yge=zK(),vge=ik(),Es=et(),_ge=Ez();w.id_pkcs9="1.2.840.113549.1.9";w.id_pkcs9_mo=`${w.id_pkcs9}.0`;w.id_pkcs9_oc=`${w.id_pkcs9}.24`;w.id_pkcs9_at=`${w.id_pkcs9}.25`;w.id_pkcs9_sx=`${w.id_pkcs9}.26`;w.id_pkcs9_mr=`${w.id_pkcs9}.27`;w.id_pkcs9_oc_pkcsEntity=`${w.id_pkcs9_oc}.1`;w.id_pkcs9_oc_naturalPerson=`${w.id_pkcs9_oc}.2`;w.id_pkcs9_at_emailAddress=`${w.id_pkcs9}.1`;w.id_pkcs9_at_unstructuredName=`${w.id_pkcs9}.2`;w.id_pkcs9_at_contentType=`${w.id_pkcs9}.3`;w.id_pkcs9_at_messageDigest=`${w.id_pkcs9}.4`;w.id_pkcs9_at_signingTime=`${w.id_pkcs9}.5`;w.id_pkcs9_at_counterSignature=`${w.id_pkcs9}.6`;w.id_pkcs9_at_challengePassword=`${w.id_pkcs9}.7`;w.id_pkcs9_at_unstructuredAddress=`${w.id_pkcs9}.8`;w.id_pkcs9_at_extendedCertificateAttributes=`${w.id_pkcs9}.9`;w.id_pkcs9_at_signingDescription=`${w.id_pkcs9}.13`;w.id_pkcs9_at_extensionRequest=`${w.id_pkcs9}.14`;w.id_pkcs9_at_smimeCapabilities=`${w.id_pkcs9}.15`;w.id_pkcs9_at_friendlyName=`${w.id_pkcs9}.20`;w.id_pkcs9_at_localKeyId=`${w.id_pkcs9}.21`;w.id_pkcs9_at_userPKCS12="2.16.840.1.113730.3.1.216";w.id_pkcs9_at_pkcs15Token=`${w.id_pkcs9_at}.1`;w.id_pkcs9_at_encryptedPrivateKeyInfo=`${w.id_pkcs9_at}.2`;w.id_pkcs9_at_randomNonce=`${w.id_pkcs9_at}.3`;w.id_pkcs9_at_sequenceNumber=`${w.id_pkcs9_at}.4`;w.id_pkcs9_at_pkcs7PDU=`${w.id_pkcs9_at}.5`;w.id_ietf_at="1.3.6.1.5.5.7.9";w.id_pkcs9_at_dateOfBirth=`${w.id_ietf_at}.1`;w.id_pkcs9_at_placeOfBirth=`${w.id_ietf_at}.2`;w.id_pkcs9_at_gender=`${w.id_ietf_at}.3`;w.id_pkcs9_at_countryOfCitizenship=`${w.id_ietf_at}.4`;w.id_pkcs9_at_countryOfResidence=`${w.id_ietf_at}.5`;w.id_pkcs9_sx_pkcs9String=`${w.id_pkcs9_sx}.1`;w.id_pkcs9_sx_signingTime=`${w.id_pkcs9_sx}.2`;w.id_pkcs9_mr_caseIgnoreMatch=`${w.id_pkcs9_mr}.1`;w.id_pkcs9_mr_signingTimeMatch=`${w.id_pkcs9_mr}.2`;w.id_smime=`${w.id_pkcs9}.16`;w.id_certTypes=`${w.id_pkcs9}.22`;w.crlTypes=`${w.id_pkcs9}.23`;w.id_at_pseudonym=`${_ge.id_at}.65`;var nv=class extends Es.DirectoryString{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};w.PKCS9String=nv;at.__decorate([(0,ee.AsnProp)({type:ee.AsnPropTypes.IA5String})],nv.prototype,"ia5String",void 0);w.PKCS9String=nv=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],nv);var vM=class extends RM.ContentInfo{};w.Pkcs7PDU=vM;w.Pkcs7PDU=vM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Sequence})],vM);var _M=class extends yge.PFX{};w.UserPKCS12=_M;w.UserPKCS12=_M=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Sequence})],_M);var bM=class extends vge.EncryptedPrivateKeyInfo{};w.EncryptedPrivateKeyInfo=bM;w.EncryptedPrivateKeyInfo=bM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Sequence})],bM);var pk=class{constructor(e=""){this.value=e}toString(){return this.value}};w.EmailAddress=pk;at.__decorate([(0,ee.AsnProp)({type:ee.AsnPropTypes.IA5String})],pk.prototype,"value",void 0);w.EmailAddress=pk=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],pk);var wM=class extends nv{};w.UnstructuredName=wM;w.UnstructuredName=wM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],wM);var xM=class extends Es.DirectoryString{};w.UnstructuredAddress=xM;w.UnstructuredAddress=xM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],xM);var fk=class{constructor(e=new Date){this.value=e}};w.DateOfBirth=fk;at.__decorate([(0,ee.AsnProp)({type:ee.AsnPropTypes.GeneralizedTime})],fk.prototype,"value",void 0);w.DateOfBirth=fk=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],fk);var SM=class extends Es.DirectoryString{};w.PlaceOfBirth=SM;w.PlaceOfBirth=SM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],SM);var mk=class{constructor(e="M"){this.value=e}toString(){return this.value}};w.Gender=mk;at.__decorate([(0,ee.AsnProp)({type:ee.AsnPropTypes.PrintableString})],mk.prototype,"value",void 0);w.Gender=mk=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],mk);var ov=class{constructor(e=""){this.value=e}toString(){return this.value}};w.CountryOfCitizenship=ov;at.__decorate([(0,ee.AsnProp)({type:ee.AsnPropTypes.PrintableString})],ov.prototype,"value",void 0);w.CountryOfCitizenship=ov=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],ov);var kM=class extends ov{};w.CountryOfResidence=kM;w.CountryOfResidence=kM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],kM);var $M=class extends Es.DirectoryString{};w.Pseudonym=$M;w.Pseudonym=$M=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],$M);var hk=class{constructor(e=""){this.value=e}toString(){return this.value}};w.ContentType=hk;at.__decorate([(0,ee.AsnProp)({type:ee.AsnPropTypes.ObjectIdentifier})],hk.prototype,"value",void 0);w.ContentType=hk=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],hk);var AM=class extends ee.OctetString{};w.MessageDigest=AM;var PM=class extends Es.Time{};w.SigningTime=PM;w.SigningTime=PM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],PM);var CM=class extends ee.OctetString{};w.RandomNonce=CM;var gk=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};w.SequenceNumber=gk;at.__decorate([(0,ee.AsnProp)({type:ee.AsnPropTypes.Integer})],gk.prototype,"value",void 0);w.SequenceNumber=gk=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],gk);var TM=class extends RM.SignerInfo{};w.CounterSignature=TM;w.CounterSignature=TM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Sequence})],TM);var IM=class extends Es.DirectoryString{};w.ChallengePassword=IM;w.ChallengePassword=IM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],IM);var EM=hM=class extends Es.Extensions{constructor(e){super(e),Object.setPrototypeOf(this,hM.prototype)}};w.ExtensionRequest=EM;w.ExtensionRequest=EM=hM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Sequence})],EM);var OM=gM=class extends ee.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,gM.prototype)}};w.ExtendedCertificateAttributes=OM;w.ExtendedCertificateAttributes=OM=gM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Set,itemType:RM.Attribute})],OM);var yk=class{constructor(e=""){this.value=e}toString(){return this.value}};w.FriendlyName=yk;at.__decorate([(0,ee.AsnProp)({type:ee.AsnPropTypes.BmpString})],yk.prototype,"value",void 0);w.FriendlyName=yk=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Choice})],yk);var jM=class extends ee.OctetString{};w.LocalKeyId=jM;var NM=class extends Es.DirectoryString{};w.SigningDescription=NM;var vk=class extends Es.AlgorithmIdentifier{};w.SMIMECapability=vk;w.SMIMECapability=vk=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Sequence})],vk);var zM=yM=class extends ee.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,yM.prototype)}};w.SMIMECapabilities=zM;w.SMIMECapabilities=zM=yM=at.__decorate([(0,ee.AsnType)({type:ee.AsnTypeTypes.Sequence,itemType:vk})],zM)});var UM=g(iv=>{"use strict";var MM;Object.defineProperty(iv,"__esModule",{value:!0});iv.Attributes=void 0;var bge=(O(),I(E)),DM=R(),wge=et(),qM=MM=class extends DM.AsnArray{constructor(e){super(e),Object.setPrototypeOf(this,MM.prototype)}};iv.Attributes=qM;iv.Attributes=qM=MM=bge.__decorate([(0,DM.AsnType)({type:DM.AsnTypeTypes.Sequence,itemType:wge.Attribute})],qM)});var BM=g(wk=>{"use strict";Object.defineProperty(wk,"__esModule",{value:!0});wk.CertificationRequestInfo=void 0;var bk=(O(),I(E)),sv=R(),_k=et(),MK=UM(),Lu=class{constructor(e={}){this.version=0,this.subject=new _k.Name,this.subjectPKInfo=new _k.SubjectPublicKeyInfo,this.attributes=new MK.Attributes,Object.assign(this,e)}};wk.CertificationRequestInfo=Lu;bk.__decorate([(0,sv.AsnProp)({type:sv.AsnPropTypes.Integer})],Lu.prototype,"version",void 0);bk.__decorate([(0,sv.AsnProp)({type:_k.Name})],Lu.prototype,"subject",void 0);bk.__decorate([(0,sv.AsnProp)({type:_k.SubjectPublicKeyInfo})],Lu.prototype,"subjectPKInfo",void 0);bk.__decorate([(0,sv.AsnProp)({type:MK.Attributes,implicit:!0,context:0,optional:!0})],Lu.prototype,"attributes",void 0)});var UK=g(Sk=>{"use strict";Object.defineProperty(Sk,"__esModule",{value:!0});Sk.CertificationRequest=void 0;var LM=(O(),I(E)),xk=R(),DK=BM(),qK=et(),Lp=class{constructor(e={}){this.certificationRequestInfo=new DK.CertificationRequestInfo,this.signatureAlgorithm=new qK.AlgorithmIdentifier,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};Sk.CertificationRequest=Lp;LM.__decorate([(0,xk.AsnProp)({type:DK.CertificationRequestInfo,raw:!0})],Lp.prototype,"certificationRequestInfo",void 0);LM.__decorate([(0,xk.AsnProp)({type:qK.AlgorithmIdentifier})],Lp.prototype,"signatureAlgorithm",void 0);LM.__decorate([(0,xk.AsnProp)({type:xk.AsnPropTypes.BitString})],Lp.prototype,"signature",void 0)});var BK=g(av=>{"use strict";Object.defineProperty(av,"__esModule",{value:!0});var ZM=(O(),I(E));ZM.__exportStar(UM(),av);ZM.__exportStar(UK(),av);ZM.__exportStar(BM(),av)});var $W=g(B=>{"use strict";Z9();var z=R(),re=et(),U=ps(),M=(O(),I(E)),xge=Ny(),Mk=O8(),jn=fR(),Pt=pK(),JM=RK(),Dk=BK();function Jv(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,Object.freeze(e)}var N=Jv(re),On=Jv(xge),Vt=Jv(Mk),At=Jv(jn),Jp=Jv(JM),tf="crypto.algorithm",qk=class{getAlgorithms(){return Pt.container.resolveAll(tf)}toAsnAlgorithm(e){({...e});for(let r of this.getAlgorithms()){let n=r.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){let r=new re.AlgorithmIdentifier({algorithm:e.name});if("parameters"in e){let n=e;r.parameters=n.parameters}return r}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(let n of this.getAlgorithms()){let o=n.toWebAlgorithm(e);if(o)return o}return{name:e.algorithm,parameters:e.parameters}}},si="crypto.algorithmProvider";Pt.container.registerSingleton(si,qk);var Ak,Mn="1.3.36.3.3.2.8.1.1",LK=`${Mn}.1`,ZK=`${Mn}.2`,VK=`${Mn}.3`,FK=`${Mn}.4`,HK=`${Mn}.5`,KK=`${Mn}.6`,WK=`${Mn}.7`,GK=`${Mn}.8`,JK=`${Mn}.9`,XK=`${Mn}.10`,YK=`${Mn}.11`,QK=`${Mn}.12`,eW=`${Mn}.13`,tW=`${Mn}.14`,rW="brainpoolP160r1",nW="brainpoolP160t1",oW="brainpoolP192r1",iW="brainpoolP192t1",sW="brainpoolP224r1",aW="brainpoolP224t1",cW="brainpoolP256r1",uW="brainpoolP256t1",lW="brainpoolP320r1",dW="brainpoolP320t1",pW="brainpoolP384r1",fW="brainpoolP384t1",mW="brainpoolP512r1",hW="brainpoolP512t1",Xt="ECDSA";B.EcAlgorithm=Ak=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Xt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return Vt.ecdsaWithSHA1;case"sha-256":return Vt.ecdsaWithSHA256;case"sha-384":return Vt.ecdsaWithSHA384;case"sha-512":return Vt.ecdsaWithSHA512}else if("namedCurve"in e){let r="";switch(e.namedCurve){case"P-256":r=Vt.id_secp256r1;break;case"K-256":r=Ak.SECP256K1;break;case"P-384":r=Vt.id_secp384r1;break;case"P-521":r=Vt.id_secp521r1;break;case rW:r=LK;break;case nW:r=ZK;break;case oW:r=VK;break;case iW:r=FK;break;case sW:r=HK;break;case aW:r=KK;break;case cW:r=WK;break;case uW:r=GK;break;case lW:r=JK;break;case dW:r=XK;break;case pW:r=YK;break;case fW:r=QK;break;case mW:r=eW;break;case hW:r=tW;break}if(r)return new re.AlgorithmIdentifier({algorithm:Vt.id_ecPublicKey,parameters:z.AsnConvert.serialize(new Vt.ECParameters({namedCurve:r}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case Vt.id_ecdsaWithSHA1:return{name:Xt,hash:{name:"SHA-1"}};case Vt.id_ecdsaWithSHA256:return{name:Xt,hash:{name:"SHA-256"}};case Vt.id_ecdsaWithSHA384:return{name:Xt,hash:{name:"SHA-384"}};case Vt.id_ecdsaWithSHA512:return{name:Xt,hash:{name:"SHA-512"}};case Vt.id_ecPublicKey:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(z.AsnConvert.parse(e.parameters,Vt.ECParameters).namedCurve){case Vt.id_secp256r1:return{name:Xt,namedCurve:"P-256"};case Ak.SECP256K1:return{name:Xt,namedCurve:"K-256"};case Vt.id_secp384r1:return{name:Xt,namedCurve:"P-384"};case Vt.id_secp521r1:return{name:Xt,namedCurve:"P-521"};case LK:return{name:Xt,namedCurve:rW};case ZK:return{name:Xt,namedCurve:nW};case VK:return{name:Xt,namedCurve:oW};case FK:return{name:Xt,namedCurve:iW};case HK:return{name:Xt,namedCurve:sW};case KK:return{name:Xt,namedCurve:aW};case WK:return{name:Xt,namedCurve:cW};case GK:return{name:Xt,namedCurve:uW};case JK:return{name:Xt,namedCurve:lW};case XK:return{name:Xt,namedCurve:dW};case YK:return{name:Xt,namedCurve:pW};case QK:return{name:Xt,namedCurve:fW};case eW:return{name:Xt,namedCurve:mW};case tW:return{name:Xt,namedCurve:hW}}}}return null}};B.EcAlgorithm.SECP256K1="1.3.132.0.10";B.EcAlgorithm=Ak=M.__decorate([Pt.injectable()],B.EcAlgorithm);Pt.container.registerSingleton(tf,B.EcAlgorithm);var wW=Symbol("name"),xW=Symbol("value"),Be=class{constructor(e,r={},n=""){this[wW]=e,this[xW]=n;for(let o in r)this[o]=r[o]}};Be.NAME=wW;Be.VALUE=xW;var Uk=class{static toTextObject(e){let r=new Be("Algorithm Identifier",{},ko.toString(e.algorithm));if(e.parameters)if(e.algorithm===Vt.id_ecPublicKey){let n=new B.EcAlgorithm().toWebAlgorithm(e);n&&"namedCurve"in n?r["Named Curve"]=n.namedCurve:r.Parameters=e.parameters}else r.Parameters=e.parameters;return r}},ko=class{static toString(e){let r=this.items[e];return r||e}};ko.items={[At.id_sha1]:"sha1",[At.id_sha224]:"sha224",[At.id_sha256]:"sha256",[At.id_sha384]:"sha384",[At.id_sha512]:"sha512",[At.id_rsaEncryption]:"rsaEncryption",[At.id_sha1WithRSAEncryption]:"sha1WithRSAEncryption",[At.id_sha224WithRSAEncryption]:"sha224WithRSAEncryption",[At.id_sha256WithRSAEncryption]:"sha256WithRSAEncryption",[At.id_sha384WithRSAEncryption]:"sha384WithRSAEncryption",[At.id_sha512WithRSAEncryption]:"sha512WithRSAEncryption",[Vt.id_ecPublicKey]:"ecPublicKey",[Vt.id_ecdsaWithSHA1]:"ecdsaWithSHA1",[Vt.id_ecdsaWithSHA224]:"ecdsaWithSHA224",[Vt.id_ecdsaWithSHA256]:"ecdsaWithSHA256",[Vt.id_ecdsaWithSHA384]:"ecdsaWithSHA384",[Vt.id_ecdsaWithSHA512]:"ecdsaWithSHA512",[N.id_kp_serverAuth]:"TLS WWW server authentication",[N.id_kp_clientAuth]:"TLS WWW client authentication",[N.id_kp_codeSigning]:"Code Signing",[N.id_kp_emailProtection]:"E-mail Protection",[N.id_kp_timeStamping]:"Time Stamping",[N.id_kp_OCSPSigning]:"OCSP Signing",[On.id_signedData]:"Signed Data"};var ai=class{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,r=0){let n=[],o=this.pad(r++),i="",s=e[Be.VALUE];s&&(i=` ${s}`),n.push(`${o}${e[Be.NAME]}:${i}`),o=this.pad(r);for(let a in e){if(typeof a=="symbol")continue;let c=e[a],u=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${o}${u}${c}`);else if(c instanceof Date)n.push(`${o}${u}${c.toUTCString()}`);else if(Array.isArray(c))for(let l of c)l[Be.NAME]=a,n.push(...this.serializeObj(l,r));else if(c instanceof Be)c[Be.NAME]=a,n.push(...this.serializeObj(c,r));else if(U.BufferSourceConverter.isBufferSource(c))a?(n.push(`${o}${u}`),n.push(...this.serializeBufferSource(c,r+1))):n.push(...this.serializeBufferSource(c,r));else if("toTextObject"in c){let l=c.toTextObject();l[Be.NAME]=a,n.push(...this.serializeObj(l,r))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,r=0){let n=this.pad(r),o=U.BufferSourceConverter.toUint8Array(e),i=[];for(let s=0;s<o.length;){let a=[];for(let c=0;c<16&&s<o.length;c++){c===8&&a.push("");let u=o[s++].toString(16).padStart(2,"0");a.push(u)}i.push(`${n}${a.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}};ai.oidSerializer=ko;ai.algorithmSerializer=Uk;var Zp,Ui=class t{get rawData(){return M.__classPrivateFieldGet(this,Zp,"f")||M.__classPrivateFieldSet(this,Zp,z.AsnConvert.serialize(this.asn),"f"),M.__classPrivateFieldGet(this,Zp,"f")}constructor(...e){Zp.set(this,void 0),U.BufferSourceConverter.isBufferSource(e[0])?(this.asn=z.AsnConvert.parse(e[0],e[1]),M.__classPrivateFieldSet(this,Zp,U.BufferSourceConverter.toArrayBuffer(e[0]),"f"),this.onInit(this.asn)):(this.asn=e[0],this.onInit(this.asn))}equal(e){return e instanceof t?U.isEqual(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return z.AsnConvert.toString(this.rawData);case"text":return ai.serialize(this.toTextObject());case"hex":return U.Convert.ToHex(this.rawData);case"base64":return U.Convert.ToBase64(this.rawData);case"base64url":return U.Convert.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new Be(this.getTextName(),{},e)}};Zp=new WeakMap;Ui.NAME="ASN";var Nn=class t extends Ui{constructor(...e){let r;U.BufferSourceConverter.isBufferSource(e[0])?r=U.BufferSourceConverter.toArrayBuffer(e[0]):r=z.AsnConvert.serialize(new re.Extension({extnID:e[0],critical:e[1],extnValue:new z.OctetString(U.BufferSourceConverter.toArrayBuffer(e[2]))})),super(r,re.Extension)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[Be.NAME]===t.NAME&&(e[Be.NAME]=ko.toString(this.type)),e}},SW,Xp=class t{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[SW]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(t.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(t.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,r){return this.items.forEach(e,r)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=t.DEFAULT){let r=this.items.get(e.toLowerCase());if(!r)throw new Error(`Cannot get Crypto by name '${e}'`);return r}set(e,r){if(typeof e=="string"){if(!r)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),r)}else this.items.set(t.DEFAULT,e);return this}};SW=Symbol.toStringTag;Xp.DEFAULT="default";var Ft=new Xp,Sge=/^[0-2](?:\.[1-9][0-9]*)+$/;function kge(t){return new RegExp(Sge).test(t)}var Rv=class{constructor(e={}){this.items={};for(let r in e)this.register(r,e[r])}get(e){return this.items[e]||null}findId(e){return kge(e)?e:this.get(e)}register(e,r){this.items[e]=r,this.items[r]=e}},zn=new Rv;zn.register("CN","2.5.4.3");zn.register("L","2.5.4.7");zn.register("ST","2.5.4.8");zn.register("O","2.5.4.10");zn.register("OU","2.5.4.11");zn.register("C","2.5.4.6");zn.register("DC","0.9.2342.19200300.100.1.25");zn.register("E","1.2.840.113549.1.9.1");zn.register("G","2.5.4.42");zn.register("I","2.5.4.43");zn.register("SN","2.5.4.4");zn.register("T","2.5.4.12");function $ge(t,e){return`\\${U.Convert.ToHex(U.Convert.FromUtf8String(e)).toUpperCase()}`}function Age(t){return t.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,$ge)}var xr=class t{static isASCII(e){for(let r=0;r<e.length;r++)if(e.charCodeAt(r)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,r={}){this.extraNames=new Rv,this.asn=new re.Name;for(let n in r)if(Object.prototype.hasOwnProperty.call(r,n)){let o=r[n];this.extraNames.register(n,o)}typeof e=="string"?this.asn=this.fromString(e):e instanceof re.Name?this.asn=e:U.BufferSourceConverter.isBufferSource(e)?this.asn=z.AsnConvert.parse(e,re.Name):this.asn=this.fromJSON(e)}getField(e){let r=this.extraNames.findId(e)||zn.findId(e),n=[];for(let o of this.asn)for(let i of o)i.type===r&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||zn.get(e)}toString(){return this.asn.map(e=>e.map(r=>{let n=this.getName(r.type)||r.type,o=r.value.anyValue?`#${U.Convert.ToHex(r.value.anyValue)}`:Age(r.value.toString());return`${n}=${o}`}).join("+")).join(", ")}toJSON(){var e;let r=[];for(let n of this.asn){let o={};for(let i of n){let s=this.getName(i.type)||i.type;(e=o[s])!==null&&e!==void 0||(o[s]=[]),o[s].push(i.value.anyValue?`#${U.Convert.ToHex(i.value.anyValue)}`:i.value.toString())}r.push(o)}return r}fromString(e){let r=new re.Name,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,o=null,i=",";for(;o=n.exec(`${e},`);){let[,s,a]=o,c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),o[3]=c);let u=o[3];s=this.getTypeOid(s);let l=this.createAttribute(s,a);i==="+"?r[r.length-1].push(l):r.push(new re.RelativeDistinguishedName([l])),i=u}return r}fromJSON(e){let r=new re.Name;for(let n of e){let o=new re.RelativeDistinguishedName;for(let i in n){let s=this.getTypeOid(i),a=n[i];for(let c of a){let u=this.createAttribute(s,c);o.push(u)}}r.push(o)}return r}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,r){let n=new re.AttributeTypeAndValue({type:e});if(typeof r=="object")for(let o in r)switch(o){case"ia5String":n.value.ia5String=r[o];break;case"utf8String":n.value.utf8String=r[o];break;case"universalString":n.value.universalString=r[o];break;case"bmpString":n.value.bmpString=r[o];break;case"printableString":n.value.printableString=r[o];break}else if(r[0]==="#")n.value.anyValue=U.Convert.FromHex(r.slice(1));else{let o=this.processStringValue(r);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=o:t.isPrintableString(o)?n.value.printableString=o:n.value.utf8String=o}return n}processStringValue(e){let r=/"(.*?[^\\])?"/.exec(e);return r&&(e=r[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return z.AsnConvert.serialize(this.asn)}async getThumbprint(...e){var r;let n,o="SHA-1";return e.length>=1&&!(!((r=e[0])===null||r===void 0)&&r.subtle)?(o=e[0]||o,n=e[1]||Ft.get()):n=e[0]||Ft.get(),await n.subtle.digest(o,this.toArrayBuffer())}},kW="Cannot initialize GeneralName from ASN.1 data.",gW=`${kW} Unsupported string format in use.`,Pge=`${kW} Value doesn't match to GUID regular expression.`,yW=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,vW="1.3.6.1.4.1.311.25.1",_W="1.3.6.1.4.1.311.20.2.3",Pk="dns",Ck="dn",Tk="email",Ik="ip",Ek="url",Ok="guid",jk="upn",cv="id",oi=class extends Ui{constructor(...e){let r;if(e.length===2)switch(e[0]){case Ck:{let n=new xr(e[1]).toArrayBuffer(),o=z.AsnConvert.parse(n,N.Name);r=new N.GeneralName({directoryName:o});break}case Pk:r=new N.GeneralName({dNSName:e[1]});break;case Tk:r=new N.GeneralName({rfc822Name:e[1]});break;case Ok:{let n=new RegExp(yW,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");let o=n.slice(1).map((i,s)=>s<3?U.Convert.ToHex(new Uint8Array(U.Convert.FromHex(i)).reverse()):i).join("");r=new N.GeneralName({otherName:new N.OtherName({typeId:vW,value:z.AsnConvert.serialize(new z.OctetString(U.Convert.FromHex(o)))})});break}case Ik:r=new N.GeneralName({iPAddress:e[1]});break;case cv:r=new N.GeneralName({registeredID:e[1]});break;case jk:{r=new N.GeneralName({otherName:new N.OtherName({typeId:_W,value:z.AsnConvert.serialize(z.AsnUtf8StringConverter.toASN(e[1]))})});break}case Ek:r=new N.GeneralName({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else U.BufferSourceConverter.isBufferSource(e[0])?r=z.AsnConvert.parse(e[0],N.GeneralName):r=e[0];super(r)}onInit(e){if(e.dNSName!=null)this.type=Pk,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=Tk,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=Ik,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=Ek,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=cv,this.value=e.registeredID;else if(e.directoryName!=null)this.type=Ck,this.value=new xr(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===vW){this.type=Ok;let r=z.AsnConvert.parse(e.otherName.value,z.OctetString),n=new RegExp(yW,"i").exec(U.Convert.ToHex(r));if(!n)throw new Error(Pge);this.value=n.slice(1).map((o,i)=>i<3?U.Convert.ToHex(new Uint8Array(U.Convert.FromHex(o)).reverse()):o).join("-")}else if(e.otherName.typeId===_W)this.type=jk,this.value=z.AsnConvert.parse(e.otherName.value,N.DirectoryString).toString();else throw new Error(gW);else throw new Error(gW)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case Ck:case Pk:case Ok:case Ik:case cv:case jk:case Ek:e=this.type.toUpperCase();break;case Tk:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let r=this.value;return this.type===cv&&(r=ko.toString(r)),new Be(e,void 0,r)}},Bi=class extends Ui{constructor(e){let r;if(e instanceof N.GeneralNames)r=e;else if(Array.isArray(e)){let n=[];for(let o of e)if(o instanceof N.GeneralName)n.push(o);else{let i=z.AsnConvert.parse(new oi(o.type,o.value).rawData,N.GeneralName);n.push(i)}r=new N.GeneralNames(n)}else if(U.BufferSourceConverter.isBufferSource(e))r=z.AsnConvert.parse(e,N.GeneralNames);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(r)}onInit(e){let r=[];for(let n of e){let o=null;try{o=new oi(n)}catch{continue}r.push(o)}this.items=r}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){let e=super.toTextObjectEmpty();for(let r of this.items){let n=r.toTextObject(),o=e[n[Be.NAME]];Array.isArray(o)||(o=[],e[n[Be.NAME]]=o),o.push(n)}return e}};Bi.NAME="GeneralNames";var zv="-{5}",Mv="\\n",Cge=`[^${Mv}]+`,Tge=`${zv}BEGIN (${Cge}(?=${zv}))${zv}`,Ige=`${zv}END \\1${zv}`,Yp="\\n",Ege=`[^:${Mv}]+`,Oge=`(?:[^${Mv}]+${Yp}(?: +[^${Mv}]+${Yp})*)`,jge="[a-zA-Z0-9=+/]+",Nge=`(?:${jge}${Yp})+`,bW=`${Tge}${Yp}(?:((?:${Ege}: ${Oge})+))?${Yp}?(${Nge})${Ige}`,Pr=class{static isPem(e){return typeof e=="string"&&new RegExp(bW,"g").test(e.replace(/\r/g,""))}static decodeWithHeaders(e){e=e.replace(/\r/g,"");let r=new RegExp(bW,"g"),n=[],o=null;for(;o=r.exec(e);){let i=o[3].replace(new RegExp(`[${Mv}]+`,"g"),""),s={type:o[1],headers:[],rawData:U.Convert.FromBase64(i)},a=o[2];if(a){let c=a.split(new RegExp(Yp,"g")),u=null;for(let l of c){let[d,p]=l.split(/:(.*)/);if(p===void 0){if(!u)throw new Error("Cannot parse PEM string. Incorrect header value");u.value+=d.trim()}else u&&s.headers.push(u),u={key:d,value:p.trim()}}u&&s.headers.push(u)}n.push(s)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){let r=this.decode(e);if(!r.length)throw new RangeError("PEM string doesn't contain any objects");return r[0]}static encode(e,r){if(Array.isArray(e)){let n=new Array;return r?e.forEach(o=>{if(!U.BufferSourceConverter.isBufferSource(o))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:r,rawData:U.BufferSourceConverter.toArrayBuffer(o)}))}):e.forEach(o=>{if(!("type"in o))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(o))}),n.join(`
`)}else{if(!r)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:r,rawData:U.BufferSourceConverter.toArrayBuffer(e)})}}static encodeStruct(e){var r;let n=e.type.toLocaleUpperCase(),o=[];if(o.push(`-----BEGIN ${n}-----`),!((r=e.headers)===null||r===void 0)&&r.length){for(let u of e.headers)o.push(`${u.key}: ${u.value}`);o.push("")}let i=U.Convert.ToBase64(e.rawData),s,a=0,c=Array();for(;a<i.length&&(i.length-a<64?s=i.substring(a):(s=i.substring(a,a+64),a+=64),s.length!==0);)if(c.push(s),s.length<64)break;return o.push(...c),o.push(`-----END ${n}-----`),o.join(`
`)}};Pr.CertificateTag="CERTIFICATE";Pr.CrlTag="CRL";Pr.CertificateRequestTag="CERTIFICATE REQUEST";Pr.PublicKeyTag="PUBLIC KEY";Pr.PrivateKeyTag="PRIVATE KEY";var Rn=class t extends Ui{static isAsnEncoded(e){return U.BufferSourceConverter.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(Pr.isPem(e))return Pr.decode(e)[0];if(U.Convert.isHex(e))return U.Convert.FromHex(e);if(U.Convert.isBase64(e))return U.Convert.FromBase64(e);if(U.Convert.isBase64Url(e))return U.Convert.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{let r=U.BufferSourceConverter.toUint8Array(e);if(r.length>0&&r[0]===48)return U.BufferSourceConverter.toArrayBuffer(e);let n=U.Convert.ToBinary(e);if(Pr.isPem(n))return Pr.decode(n)[0];if(U.Convert.isHex(n))return U.Convert.FromHex(n);if(U.Convert.isBase64(n))return U.Convert.FromBase64(n);if(U.Convert.isBase64Url(n))return U.Convert.FromBase64Url(n);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}}constructor(...e){t.isAsnEncoded(e[0])?super(t.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){return e==="pem"?Pr.encode(this.rawData,this.tag):super.toString(e)}},ii=class t extends Rn{static async create(e,r=Ft.get()){if(e instanceof t)return e;if(Xp.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");let n=await r.subtle.exportKey("spki",e);return new t(n)}else{if(e.publicKey)return e.publicKey;if(U.BufferSourceConverter.isBufferSource(e))return new t(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){Rn.isAsnEncoded(e)?super(e,re.SubjectPublicKeyInfo):super(e),this.tag=Pr.PublicKeyTag}async export(...e){let r,n=["verify"],o={hash:"SHA-256",...this.algorithm};e.length>1?(o=e[0]||o,n=e[1]||n,r=e[2]||Ft.get()):r=e[0]||Ft.get();let i=this.rawData,s=z.AsnConvert.parse(this.rawData,re.SubjectPublicKeyInfo);return s.algorithm.algorithm===jn.id_RSASSA_PSS&&(i=zge(s,i)),r.subtle.importKey("spki",i,o,!0,n)}onInit(e){let r=Pt.container.resolve(si),n=this.algorithm=r.toWebAlgorithm(e.algorithm);if(e.algorithm.algorithm===jn.id_rsaEncryption){let o=z.AsnConvert.parse(e.subjectPublicKey,jn.RSAPublicKey),i=U.BufferSourceConverter.toUint8Array(o.modulus);n.publicExponent=U.BufferSourceConverter.toUint8Array(o.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3}}async getThumbprint(...e){var r;let n,o="SHA-1";return e.length>=1&&!(!((r=e[0])===null||r===void 0)&&r.subtle)?(o=e[0]||o,n=e[1]||Ft.get()):n=e[0]||Ft.get(),await n.subtle.digest(o,this.rawData)}async getKeyIdentifier(...e){let r,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],r=Ft.get()):r=e[0]:e.length===2?(n=e[0],r=e[1]):r=Ft.get();let o=z.AsnConvert.parse(this.rawData,re.SubjectPublicKeyInfo);return await r.subtle.digest(n,o.subjectPublicKey)}toTextObject(){let e=this.toTextObjectEmpty(),r=z.AsnConvert.parse(this.rawData,re.SubjectPublicKeyInfo);switch(e.Algorithm=ai.serializeAlgorithm(r.algorithm),r.algorithm.algorithm){case Mk.id_ecPublicKey:e["EC Point"]=r.subjectPublicKey;break;case jn.id_rsaEncryption:default:e["Raw Data"]=r.subjectPublicKey}return e}};function zge(t,e){return t.algorithm=new re.AlgorithmIdentifier({algorithm:jn.id_rsaEncryption,parameters:null}),e=z.AsnConvert.serialize(t),e}var Dv=class t extends Nn{static async create(e,r=!1,n=Ft.get()){if("name"in e&&"serialNumber"in e)return new t(e,r);let i=await(await ii.create(e,n)).getKeyIdentifier(n);return new t(U.Convert.ToHex(i),r)}constructor(...e){if(U.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){let r=new N.AuthorityKeyIdentifier({keyIdentifier:new N.KeyIdentifier(U.Convert.FromHex(e[0]))});super(N.id_ce_authorityKeyIdentifier,e[1],z.AsnConvert.serialize(r))}else{let r=e[0],n=r.name instanceof Bi?z.AsnConvert.parse(r.name.rawData,N.GeneralNames):r.name,o=new N.AuthorityKeyIdentifier({authorityCertIssuer:n,authorityCertSerialNumber:U.Convert.FromHex(r.serialNumber)});super(N.id_ce_authorityKeyIdentifier,e[1],z.AsnConvert.serialize(o))}}onInit(e){super.onInit(e);let r=z.AsnConvert.parse(e.extnValue,N.AuthorityKeyIdentifier);r.keyIdentifier&&(this.keyId=U.Convert.ToHex(r.keyIdentifier)),(r.authorityCertIssuer||r.authorityCertSerialNumber)&&(this.certId={name:r.authorityCertIssuer||[],serialNumber:r.authorityCertSerialNumber?U.Convert.ToHex(r.authorityCertSerialNumber):""})}toTextObject(){let e=this.toTextObjectWithoutValue(),r=z.AsnConvert.parse(this.value,N.AuthorityKeyIdentifier);return r.authorityCertIssuer&&(e["Authority Issuer"]=new Bi(r.authorityCertIssuer).toTextObject()),r.authorityCertSerialNumber&&(e["Authority Serial Number"]=r.authorityCertSerialNumber),r.keyIdentifier&&(e[""]=r.keyIdentifier),e}};Dv.NAME="Authority Key Identifier";var qv=class extends Nn{constructor(...e){if(U.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let r=z.AsnConvert.parse(this.value,re.BasicConstraints);this.ca=r.cA,this.pathLength=r.pathLenConstraint}else{let r=new re.BasicConstraints({cA:e[0],pathLenConstraint:e[1]});super(re.id_ce_basicConstraints,e[2],z.AsnConvert.serialize(r)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}};qv.NAME="Basic Constraints";B.ExtendedKeyUsage=void 0;(function(t){t.serverAuth="1.3.6.1.5.5.7.3.1",t.clientAuth="1.3.6.1.5.5.7.3.2",t.codeSigning="1.3.6.1.5.5.7.3.3",t.emailProtection="1.3.6.1.5.5.7.3.4",t.timeStamping="1.3.6.1.5.5.7.3.8",t.ocspSigning="1.3.6.1.5.5.7.3.9"})(B.ExtendedKeyUsage||(B.ExtendedKeyUsage={}));var Uv=class extends Nn{constructor(...e){if(U.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let r=z.AsnConvert.parse(this.value,N.ExtendedKeyUsage);this.usages=r.map(n=>n)}else{let r=new N.ExtendedKeyUsage(e[0]);super(N.id_ce_extKeyUsage,e[1],z.AsnConvert.serialize(r)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(r=>ko.toString(r)).join(", "),e}};Uv.NAME="Extended Key Usages";B.KeyUsageFlags=void 0;(function(t){t[t.digitalSignature=1]="digitalSignature",t[t.nonRepudiation=2]="nonRepudiation",t[t.keyEncipherment=4]="keyEncipherment",t[t.dataEncipherment=8]="dataEncipherment",t[t.keyAgreement=16]="keyAgreement",t[t.keyCertSign=32]="keyCertSign",t[t.cRLSign=64]="cRLSign",t[t.encipherOnly=128]="encipherOnly",t[t.decipherOnly=256]="decipherOnly"})(B.KeyUsageFlags||(B.KeyUsageFlags={}));var Bv=class extends Nn{constructor(...e){if(U.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let r=z.AsnConvert.parse(this.value,re.KeyUsage);this.usages=r.toNumber()}else{let r=new re.KeyUsage(e[0]);super(re.id_ce_keyUsage,e[1],z.AsnConvert.serialize(r)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue(),r=z.AsnConvert.parse(this.value,re.KeyUsage);return e[""]=r.toJSON().join(", "),e}};Bv.NAME="Key Usages";var Lv=class t extends Nn{static async create(e,r=!1,n=Ft.get()){let i=await(await ii.create(e,n)).getKeyIdentifier(n);return new t(U.Convert.ToHex(i),r)}constructor(...e){if(U.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let r=z.AsnConvert.parse(this.value,N.SubjectKeyIdentifier);this.keyId=U.Convert.ToHex(r)}else{let r=typeof e[0]=="string"?U.Convert.FromHex(e[0]):e[0],n=new N.SubjectKeyIdentifier(r);super(N.id_ce_subjectKeyIdentifier,e[1],z.AsnConvert.serialize(n)),this.keyId=U.Convert.ToHex(r)}}toTextObject(){let e=this.toTextObjectWithoutValue(),r=z.AsnConvert.parse(this.value,N.SubjectKeyIdentifier);return e[""]=r,e}};Lv.NAME="Subject Key Identifier";var Zv=class extends Nn{constructor(...e){U.BufferSourceConverter.isBufferSource(e[0])?super(e[0]):super(N.id_ce_subjectAltName,e[1],new Bi(e[0]||[]).rawData)}onInit(e){super.onInit(e);let r=z.AsnConvert.parse(e.extnValue,N.SubjectAlternativeName);this.names=new Bi(r)}toTextObject(){let e=this.toTextObjectWithoutValue(),r=this.names.toTextObject();for(let n in r)e[n]=r[n];return e}};Zv.NAME="Subject Alternative Name";var Cr=class{static register(e,r){this.items.set(e,r)}static create(e){let r=new Nn(e),n=this.items.get(r.type);return n?new n(e):r}};Cr.items=new Map;var Vv=class extends Nn{constructor(...e){var r;if(U.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let n=z.AsnConvert.parse(this.value,N.CertificatePolicies);this.policies=n.map(o=>o.policyIdentifier)}else{let n=e[0],o=(r=e[1])!==null&&r!==void 0?r:!1,i=new N.CertificatePolicies(n.map(s=>new N.PolicyInformation({policyIdentifier:s})));super(N.id_ce_certificatePolicies,o,z.AsnConvert.serialize(i)),this.policies=n}}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(r=>new Be("",{},ko.toString(r))),e}};Vv.NAME="Certificate Policies";Cr.register(N.id_ce_certificatePolicies,Vv);var Fv=class extends Nn{constructor(...e){var r;if(U.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){let o=e[0].map(s=>new N.DistributionPoint({distributionPoint:new N.DistributionPointName({fullName:[new N.GeneralName({uniformResourceIdentifier:s})]})})),i=new N.CRLDistributionPoints(o);super(N.id_ce_cRLDistributionPoints,e[1],z.AsnConvert.serialize(i))}else{let n=new N.CRLDistributionPoints(e[0]);super(N.id_ce_cRLDistributionPoints,e[1],z.AsnConvert.serialize(n))}(r=this.distributionPoints)!==null&&r!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);let r=z.AsnConvert.parse(e.extnValue,N.CRLDistributionPoints);this.distributionPoints=r}toTextObject(){let e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(r=>{var n;let o={};return r.distributionPoint&&(o[""]=(n=r.distributionPoint.fullName)===null||n===void 0?void 0:n.map(i=>new oi(i).toString()).join(", ")),r.reasons&&(o.Reasons=r.reasons.toString()),r.cRLIssuer&&(o["CRL Issuer"]=r.cRLIssuer.map(i=>i.toString()).join(", ")),o}),e}};Fv.NAME="CRL Distribution Points";var Hv=class extends Nn{constructor(...e){var r,n,o,i;if(U.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof N.AuthorityInfoAccessSyntax){let s=new N.AuthorityInfoAccessSyntax(e[0]);super(N.id_pe_authorityInfoAccess,e[1],z.AsnConvert.serialize(s))}else{let s=e[0],a=new N.AuthorityInfoAccessSyntax;$k(a,s,N.id_ad_ocsp,"ocsp"),$k(a,s,N.id_ad_caIssuers,"caIssuers"),$k(a,s,N.id_ad_timeStamping,"timeStamping"),$k(a,s,N.id_ad_caRepository,"caRepository"),super(N.id_pe_authorityInfoAccess,e[1],z.AsnConvert.serialize(a))}(r=this.ocsp)!==null&&r!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(o=this.timeStamping)!==null&&o!==void 0||(this.timeStamping=[]),(i=this.caRepository)!==null&&i!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],z.AsnConvert.parse(e.extnValue,N.AuthorityInfoAccessSyntax).forEach(n=>{switch(n.accessMethod){case N.id_ad_ocsp:this.ocsp.push(new oi(n.accessLocation));break;case N.id_ad_caIssuers:this.caIssuers.push(new oi(n.accessLocation));break;case N.id_ad_timeStamping:this.timeStamping.push(new oi(n.accessLocation));break;case N.id_ad_caRepository:this.caRepository.push(new oi(n.accessLocation));break}})}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ocsp.length&&kk(e,"OCSP",this.ocsp),this.caIssuers.length&&kk(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&kk(e,"Time Stamping",this.timeStamping),this.caRepository.length&&kk(e,"CA Repository",this.caRepository),e}};Hv.NAME="Authority Info Access";function kk(t,e,r){if(r.length===1)t[e]=r[0].toTextObject();else{let n=new Be("");r.forEach((o,i)=>{let s=o.toTextObject(),a=`${s[Be.NAME]} ${i+1}`,c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(s)}),t[e]=n}}function $k(t,e,r,n){let o=e[n];o&&(Array.isArray(o)?o:[o]).forEach(s=>{typeof s=="string"&&(s=new oi("url",s)),t.push(new N.AccessDescription({accessMethod:r,accessLocation:z.AsnConvert.parse(s.rawData,N.GeneralName)}))})}var Kv=class extends Nn{constructor(...e){U.BufferSourceConverter.isBufferSource(e[0])?super(e[0]):super(N.id_ce_issuerAltName,e[1],new Bi(e[0]||[]).rawData)}onInit(e){super.onInit(e);let r=z.AsnConvert.parse(e.extnValue,N.GeneralNames);this.names=new Bi(r)}toTextObject(){let e=this.toTextObjectWithoutValue(),r=this.names.toTextObject();for(let n in r)e[n]=r[n];return e}};Kv.NAME="Issuer Alternative Name";var Zu=class t extends Ui{constructor(...e){let r;if(U.BufferSourceConverter.isBufferSource(e[0]))r=U.BufferSourceConverter.toArrayBuffer(e[0]);else{let n=e[0],o=Array.isArray(e[1])?e[1].map(i=>U.BufferSourceConverter.toArrayBuffer(i)):[];r=z.AsnConvert.serialize(new re.Attribute({type:n,values:o}))}super(r,re.Attribute)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Value=this.values.map(r=>new Be("",{"":r})),e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty();return e[Be.NAME]===t.NAME&&(e[Be.NAME]=ko.toString(this.type)),e}};Zu.NAME="Attribute";var Wv=class extends Zu{constructor(...e){var r;if(U.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=new Jp.ChallengePassword({printableString:e[0]});super(Jp.id_pkcs9_at_challengePassword,[z.AsnConvert.serialize(n)])}(r=this.password)!==null&&r!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){let r=z.AsnConvert.parse(this.values[0],Jp.ChallengePassword);this.password=r.toString()}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[Be.VALUE]=this.password,e}};Wv.NAME="Challenge Password";var Qp=class extends Zu{constructor(...e){var r;if(U.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=e[0],o=new N.Extensions;for(let i of n)o.push(z.AsnConvert.parse(i.rawData,N.Extension));super(Jp.id_pkcs9_at_extensionRequest,[z.AsnConvert.serialize(o)])}(r=this.items)!==null&&r!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){let r=z.AsnConvert.parse(this.values[0],N.Extensions);this.items=r.map(n=>Cr.create(z.AsnConvert.serialize(n)))}}toTextObject(){let e=this.toTextObjectWithoutValue(),r=this.items.map(n=>n.toTextObject());for(let n of r)e[n[Be.NAME]]=n;return e}};Qp.NAME="Extensions";var Vu=class{static register(e,r){this.items.set(e,r)}static create(e){let r=new Zu(e),n=this.items.get(r.type);return n?new n(e):r}};Vu.items=new Map;var Os="crypto.signatureFormatter",Bk=class{toAsnSignature(e,r){return U.BufferSourceConverter.toArrayBuffer(r)}toWebSignature(e,r){return U.BufferSourceConverter.toArrayBuffer(r)}},Nk;B.RsaAlgorithm=Nk=class{static createPssParams(e,r){let n=Nk.getHashAlgorithm(e);return n?new At.RsaSaPssParams({hashAlgorithm:n,maskGenAlgorithm:new re.AlgorithmIdentifier({algorithm:At.id_mgf1,parameters:z.AsnConvert.serialize(n)}),saltLength:r}):null}static getHashAlgorithm(e){let r=Pt.container.resolve(si);return typeof e=="string"?r.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?r.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let r;if(typeof e.hash=="string")r=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")r=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(r.toLowerCase()){case"sha-1":return new re.AlgorithmIdentifier({algorithm:At.id_sha1WithRSAEncryption,parameters:null});case"sha-256":return new re.AlgorithmIdentifier({algorithm:At.id_sha256WithRSAEncryption,parameters:null});case"sha-384":return new re.AlgorithmIdentifier({algorithm:At.id_sha384WithRSAEncryption,parameters:null});case"sha-512":return new re.AlgorithmIdentifier({algorithm:At.id_sha512WithRSAEncryption,parameters:null})}}else return new re.AlgorithmIdentifier({algorithm:At.id_rsaEncryption,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");let r=Nk.createPssParams(e.hash,e.saltLength);if(!r)throw new Error("Cannot create PSS parameters");return new re.AlgorithmIdentifier({algorithm:At.id_RSASSA_PSS,parameters:z.AsnConvert.serialize(r)})}else return new re.AlgorithmIdentifier({algorithm:At.id_RSASSA_PSS,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case At.id_rsaEncryption:return{name:"RSASSA-PKCS1-v1_5"};case At.id_sha1WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case At.id_sha256WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case At.id_sha384WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case At.id_sha512WithRSAEncryption:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case At.id_RSASSA_PSS:if(e.parameters){let r=z.AsnConvert.parse(e.parameters,At.RsaSaPssParams);return{name:"RSA-PSS",hash:Pt.container.resolve(si).toWebAlgorithm(r.hashAlgorithm),saltLength:r.saltLength}}else return{name:"RSA-PSS"}}return null}};B.RsaAlgorithm=Nk=M.__decorate([Pt.injectable()],B.RsaAlgorithm);Pt.container.registerSingleton(tf,B.RsaAlgorithm);B.ShaAlgorithm=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new re.AlgorithmIdentifier({algorithm:jn.id_sha1});case"sha-256":return new re.AlgorithmIdentifier({algorithm:jn.id_sha256});case"sha-384":return new re.AlgorithmIdentifier({algorithm:jn.id_sha384});case"sha-512":return new re.AlgorithmIdentifier({algorithm:jn.id_sha512})}return null}toWebAlgorithm(e){switch(e.algorithm){case jn.id_sha1:return{name:"SHA-1"};case jn.id_sha256:return{name:"SHA-256"};case jn.id_sha384:return{name:"SHA-384"};case jn.id_sha512:return{name:"SHA-512"}}return null}};B.ShaAlgorithm=M.__decorate([Pt.injectable()],B.ShaAlgorithm);Pt.container.registerSingleton(tf,B.ShaAlgorithm);var Li=class t{addPadding(e,r){let n=U.BufferSourceConverter.toUint8Array(r),o=new Uint8Array(e);return o.set(n,e-n.length),o.buffer}removePadding(e,r=!1){let n=U.BufferSourceConverter.toUint8Array(e);for(let o=0;o<n.length;o++)if(n[o]){n=n.slice(o);break}if(r&&n[0]>127){let o=new Uint8Array(n.length+1);return o.set(n,1),o.buffer}return n.buffer}toAsnSignature(e,r){if(e.name==="ECDSA"){let n=e.namedCurve,o=t.namedCurveSize.get(n)||t.defaultNamedCurveSize,i=new Mk.ECDSASigValue,s=U.BufferSourceConverter.toUint8Array(r);return i.r=this.removePadding(s.slice(0,o),!0),i.s=this.removePadding(s.slice(o,o+o),!0),z.AsnConvert.serialize(i)}return null}toWebSignature(e,r){if(e.name==="ECDSA"){let n=z.AsnConvert.parse(r,Mk.ECDSASigValue),o=e.namedCurve,i=t.namedCurveSize.get(o)||t.defaultNamedCurveSize,s=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return U.combine(s,a)}return null}};Li.namedCurveSize=new Map;Li.defaultNamedCurveSize=32;var zk="1.3.101.110",VM="1.3.101.111",Rk="1.3.101.112",FM="1.3.101.113";B.EdAlgorithm=class{toAsnAlgorithm(e){let r=null;switch(e.name.toLowerCase()){case"ed25519":r=Rk;break;case"x25519":r=zk;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":r=Rk;break;case"ed448":r=FM;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":r=zk;break;case"x448":r=VM;break}}return r?new re.AlgorithmIdentifier({algorithm:r}):null}toWebAlgorithm(e){switch(e.algorithm){case Rk:return{name:"Ed25519"};case FM:return{name:"EdDSA",namedCurve:"Ed448"};case zk:return{name:"X25519"};case VM:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};B.EdAlgorithm=M.__decorate([Pt.injectable()],B.EdAlgorithm);Pt.container.registerSingleton(tf,B.EdAlgorithm);var uv,lv,dv,pv,fv,mv,hv,Vp,Gv=class extends Rn{get subjectName(){return M.__classPrivateFieldGet(this,lv,"f")||M.__classPrivateFieldSet(this,lv,new xr(this.asn.certificationRequestInfo.subject),"f"),M.__classPrivateFieldGet(this,lv,"f")}get subject(){return M.__classPrivateFieldGet(this,dv,"f")||M.__classPrivateFieldSet(this,dv,this.subjectName.toString(),"f"),M.__classPrivateFieldGet(this,dv,"f")}get signatureAlgorithm(){if(!M.__classPrivateFieldGet(this,pv,"f")){let e=Pt.container.resolve(si);M.__classPrivateFieldSet(this,pv,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return M.__classPrivateFieldGet(this,pv,"f")}get signature(){return M.__classPrivateFieldGet(this,fv,"f")||M.__classPrivateFieldSet(this,fv,this.asn.signature,"f"),M.__classPrivateFieldGet(this,fv,"f")}get publicKey(){return M.__classPrivateFieldGet(this,mv,"f")||M.__classPrivateFieldSet(this,mv,new ii(this.asn.certificationRequestInfo.subjectPKInfo),"f"),M.__classPrivateFieldGet(this,mv,"f")}get attributes(){return M.__classPrivateFieldGet(this,hv,"f")||M.__classPrivateFieldSet(this,hv,this.asn.certificationRequestInfo.attributes.map(e=>Vu.create(z.AsnConvert.serialize(e))),"f"),M.__classPrivateFieldGet(this,hv,"f")}get extensions(){if(!M.__classPrivateFieldGet(this,Vp,"f")){M.__classPrivateFieldSet(this,Vp,[],"f");let e=this.getAttribute(JM.id_pkcs9_at_extensionRequest);e instanceof Qp&&M.__classPrivateFieldSet(this,Vp,e.items,"f")}return M.__classPrivateFieldGet(this,Vp,"f")}get tbs(){return M.__classPrivateFieldGet(this,uv,"f")||M.__classPrivateFieldSet(this,uv,this.asn.certificationRequestInfoRaw||z.AsnConvert.serialize(this.asn.certificationRequestInfo),"f"),M.__classPrivateFieldGet(this,uv,"f")}constructor(e){let r=Rn.isAsnEncoded(e)?[e,Dk.CertificationRequest]:[e];super(r[0],r[1]),uv.set(this,void 0),lv.set(this,void 0),dv.set(this,void 0),pv.set(this,void 0),fv.set(this,void 0),mv.set(this,void 0),hv.set(this,void 0),Vp.set(this,void 0),this.tag=Pr.CertificateRequestTag}onInit(e){}getAttribute(e){for(let r of this.attributes)if(r.type===e)return r;return null}getAttributes(e){return this.attributes.filter(r=>r.type===e)}getExtension(e){for(let r of this.extensions)if(r.type===e)return r;return null}getExtensions(e){return this.extensions.filter(r=>r.type===e)}async verify(e=Ft.get()){let r={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(r,["verify"],e),o=Pt.container.resolveAll(Os).reverse(),i=null;for(let a of o)if(i=a.toWebSignature(r,this.signature),i)break;if(!i)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,i,this.tbs)}toTextObject(){let e=this.toTextObjectEmpty(),r=z.AsnConvert.parse(this.rawData,Dk.CertificationRequest),n=r.certificationRequestInfo,o=new Be("",{Version:`${re.Version[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){let i=new Be("");for(let s of this.attributes){let a=s.toTextObject();i[a[Be.NAME]]=a}o.Attributes=i}return e.Data=o,e.Signature=new Be("",{Algorithm:ai.serializeAlgorithm(r.signatureAlgorithm),"":r.signature}),e}};uv=new WeakMap,lv=new WeakMap,dv=new WeakMap,pv=new WeakMap,fv=new WeakMap,mv=new WeakMap,hv=new WeakMap,Vp=new WeakMap;Gv.NAME="PKCS#10 Certificate Request";var HM=class{static async create(e,r=Ft.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");let n=await r.subtle.exportKey("spki",e.keys.publicKey),o=new Dk.CertificationRequest({certificationRequestInfo:new Dk.CertificationRequestInfo({subjectPKInfo:z.AsnConvert.parse(n,re.SubjectPublicKeyInfo)})});if(e.name){let d=e.name instanceof xr?e.name:new xr(e.name);o.certificationRequestInfo.subject=z.AsnConvert.parse(d.toArrayBuffer(),re.Name)}if(e.attributes)for(let d of e.attributes)o.certificationRequestInfo.attributes.push(z.AsnConvert.parse(d.rawData,re.Attribute));if(e.extensions&&e.extensions.length){let d=new re.Attribute({type:JM.id_pkcs9_at_extensionRequest}),p=new re.Extensions;for(let f of e.extensions)p.push(z.AsnConvert.parse(f.rawData,re.Extension));d.values.push(z.AsnConvert.serialize(p)),o.certificationRequestInfo.attributes.push(d)}let i={...e.signingAlgorithm,...e.keys.privateKey.algorithm},s=Pt.container.resolve(si);o.signatureAlgorithm=s.toAsnAlgorithm(i);let a=z.AsnConvert.serialize(o.certificationRequestInfo),c=await r.subtle.sign(i,e.keys.privateKey,a),u=Pt.container.resolveAll(Os).reverse(),l=null;for(let d of u)if(l=d.toAsnSignature(i,c),l)break;if(!l)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return o.signature=l,new Gv(z.AsnConvert.serialize(o))}},gv,yv,vv,_v,bv,wv,xv,Sv,kv,$v,Fp,Av,qa=class extends Rn{get publicKey(){return M.__classPrivateFieldGet(this,Av,"f")||M.__classPrivateFieldSet(this,Av,new ii(this.asn.tbsCertificate.subjectPublicKeyInfo),"f"),M.__classPrivateFieldGet(this,Av,"f")}get serialNumber(){if(!M.__classPrivateFieldGet(this,yv,"f")){let e=this.asn.tbsCertificate,r=new Uint8Array(e.serialNumber);r.length>1&&r[0]===0&&r[1]>127&&(r=r.slice(1)),M.__classPrivateFieldSet(this,yv,U.Convert.ToHex(r),"f")}return M.__classPrivateFieldGet(this,yv,"f")}get subjectName(){return M.__classPrivateFieldGet(this,vv,"f")||M.__classPrivateFieldSet(this,vv,new xr(this.asn.tbsCertificate.subject),"f"),M.__classPrivateFieldGet(this,vv,"f")}get subject(){return M.__classPrivateFieldGet(this,_v,"f")||M.__classPrivateFieldSet(this,_v,this.subjectName.toString(),"f"),M.__classPrivateFieldGet(this,_v,"f")}get issuerName(){return M.__classPrivateFieldGet(this,bv,"f")||M.__classPrivateFieldSet(this,bv,new xr(this.asn.tbsCertificate.issuer),"f"),M.__classPrivateFieldGet(this,bv,"f")}get issuer(){return M.__classPrivateFieldGet(this,wv,"f")||M.__classPrivateFieldSet(this,wv,this.issuerName.toString(),"f"),M.__classPrivateFieldGet(this,wv,"f")}get notBefore(){if(!M.__classPrivateFieldGet(this,xv,"f")){let e=this.asn.tbsCertificate.validity.notBefore.utcTime||this.asn.tbsCertificate.validity.notBefore.generalTime;if(!e)throw new Error("Cannot get 'notBefore' value");M.__classPrivateFieldSet(this,xv,e,"f")}return M.__classPrivateFieldGet(this,xv,"f")}get notAfter(){if(!M.__classPrivateFieldGet(this,Sv,"f")){let e=this.asn.tbsCertificate.validity.notAfter.utcTime||this.asn.tbsCertificate.validity.notAfter.generalTime;if(!e)throw new Error("Cannot get 'notAfter' value");M.__classPrivateFieldSet(this,Sv,e,"f")}return M.__classPrivateFieldGet(this,Sv,"f")}get signatureAlgorithm(){if(!M.__classPrivateFieldGet(this,kv,"f")){let e=Pt.container.resolve(si);M.__classPrivateFieldSet(this,kv,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return M.__classPrivateFieldGet(this,kv,"f")}get signature(){return M.__classPrivateFieldGet(this,$v,"f")||M.__classPrivateFieldSet(this,$v,this.asn.signatureValue,"f"),M.__classPrivateFieldGet(this,$v,"f")}get extensions(){return M.__classPrivateFieldGet(this,Fp,"f")||(M.__classPrivateFieldSet(this,Fp,[],"f"),this.asn.tbsCertificate.extensions&&M.__classPrivateFieldSet(this,Fp,this.asn.tbsCertificate.extensions.map(e=>Cr.create(z.AsnConvert.serialize(e))),"f")),M.__classPrivateFieldGet(this,Fp,"f")}get tbs(){return M.__classPrivateFieldGet(this,gv,"f")||M.__classPrivateFieldSet(this,gv,this.asn.tbsCertificateRaw||z.AsnConvert.serialize(this.asn.tbsCertificate),"f"),M.__classPrivateFieldGet(this,gv,"f")}constructor(e){let r=Rn.isAsnEncoded(e)?[e,re.Certificate]:[e];super(r[0],r[1]),gv.set(this,void 0),yv.set(this,void 0),vv.set(this,void 0),_v.set(this,void 0),bv.set(this,void 0),wv.set(this,void 0),xv.set(this,void 0),Sv.set(this,void 0),kv.set(this,void 0),$v.set(this,void 0),Fp.set(this,void 0),Av.set(this,void 0),this.tag=Pr.CertificateTag}onInit(e){}getExtension(e){for(let r of this.extensions)if(typeof e=="string"){if(r.type===e)return r}else if(r instanceof e)return r;return null}getExtensions(e){return this.extensions.filter(r=>typeof e=="string"?r.type===e:r instanceof e)}async verify(e={},r=Ft.get()){let n,o,i=e.publicKey;try{if(!i)n={...this.publicKey.algorithm,...this.signatureAlgorithm},o=await this.publicKey.export(n,["verify"],r);else if("publicKey"in i)n={...i.publicKey.algorithm,...this.signatureAlgorithm},o=await i.publicKey.export(n,["verify"],r);else if(i instanceof ii)n={...i.algorithm,...this.signatureAlgorithm},o=await i.export(n,["verify"],r);else if(U.BufferSourceConverter.isBufferSource(i)){let u=new ii(i);n={...u.algorithm,...this.signatureAlgorithm},o=await u.export(n,["verify"],r)}else n={...i.algorithm,...this.signatureAlgorithm},o=i}catch{return!1}let s=Pt.container.resolveAll(Os).reverse(),a=null;for(let u of s)if(a=u.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let c=await r.subtle.verify(this.signatureAlgorithm,o,a,this.tbs);if(e.signatureOnly)return c;{let l=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<l&&l<this.notAfter.getTime()}}async getThumbprint(...e){let r,n="SHA-1";return e[0]&&(e[0].subtle?r=e[0]:(n=e[0]||n,r=e[1])),r??(r=Ft.get()),await r.subtle.digest(n,this.rawData)}async isSelfSigned(e=Ft.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){let e=this.toTextObjectEmpty(),r=z.AsnConvert.parse(this.rawData,re.Certificate),n=r.tbsCertificate,o=new Be("",{Version:`${re.Version[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":ai.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new Be("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(o["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(o["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){let i=new Be("");for(let s of this.extensions){let a=s.toTextObject();i[a[Be.NAME]]=a}o.Extensions=i}return e.Data=o,e.Signature=new Be("",{Algorithm:ai.serializeAlgorithm(r.signatureAlgorithm),"":r.signatureValue}),e}};gv=new WeakMap,yv=new WeakMap,vv=new WeakMap,_v=new WeakMap,bv=new WeakMap,wv=new WeakMap,xv=new WeakMap,Sv=new WeakMap,kv=new WeakMap,$v=new WeakMap,Fp=new WeakMap,Av=new WeakMap;qa.NAME="Certificate";var Lk=class extends Array{constructor(e){if(super(),Rn.isAsnEncoded(e))this.import(e);else if(e instanceof qa)this.push(e);else if(Array.isArray(e))for(let r of e)this.push(r)}export(e){let r=new On.SignedData;r.version=1,r.encapContentInfo.eContentType=On.id_data,r.encapContentInfo.eContent=new On.EncapsulatedContent({single:new z.OctetString}),r.certificates=new On.CertificateSet(this.map(i=>new On.CertificateChoices({certificate:z.AsnConvert.parse(i.rawData,re.Certificate)})));let n=new On.ContentInfo({contentType:On.id_signedData,content:z.AsnConvert.serialize(r)}),o=z.AsnConvert.serialize(n);return e==="raw"?o:this.toString(e)}import(e){let r=Rn.toArrayBuffer(e),n=z.AsnConvert.parse(r,On.ContentInfo);if(n.contentType!==On.id_signedData)throw new TypeError("Cannot parse CMS package. Incoming data is not a SignedData object.");let o=z.AsnConvert.parse(n.content,On.SignedData);this.clear();for(let i of o.certificates||[])i.certificate&&this.push(new qa(i.certificate))}clear(){for(;this.pop(););}toString(e="pem"){let r=this.export("raw");switch(e){case"pem":return Pr.encode(r,"CMS");case"pem-chain":return this.map(n=>n.toString("pem")).join(`
`);case"asn":return z.AsnConvert.toString(r);case"hex":return U.Convert.ToHex(r);case"base64":return U.Convert.ToBase64(r);case"base64url":return U.Convert.ToBase64Url(r);case"text":return ai.serialize(this.toTextObject());default:throw TypeError("Argument 'format' is unsupported value")}}toTextObject(){let e=z.AsnConvert.parse(this.export("raw"),On.ContentInfo),r=z.AsnConvert.parse(e.content,On.SignedData);return new Be("X509Certificates",{"Content Type":ko.toString(e.contentType),Content:new Be("",{Version:`${On.CMSVersion[r.version]} (${r.version})`,Certificates:new Be("",{Certificate:this.map(o=>o.toTextObject())})})})}},KM=class{constructor(e={}){this.certificates=[],e.certificates&&(this.certificates=e.certificates)}async build(e,r=Ft.get()){let n=new Lk(e),o=e;for(;o=await this.findIssuer(o,r);){let i=await o.getThumbprint(r);for(let s of n){let a=await s.getThumbprint(r);if(U.isEqual(i,a))throw new Error("Cannot build a certificate chain. Circular dependency.")}n.push(o)}return n}async findIssuer(e,r=Ft.get()){if(!await e.isSelfSigned(r)){let n=e.getExtension(N.id_ce_authorityKeyIdentifier);for(let o of this.certificates)if(o.subject===e.issuer){if(n){if(n.keyId){let i=o.getExtension(N.id_ce_subjectKeyIdentifier);if(i&&i.keyId!==n.keyId)continue}else if(n.certId){let i=o.getExtension(N.id_ce_subjectAltName);if(i&&!(n.certId.serialNumber===o.serialNumber&&U.isEqual(z.AsnConvert.serialize(n.certId.name),z.AsnConvert.serialize(i))))continue}}try{let i={...o.publicKey.algorithm,...e.signatureAlgorithm},s=await o.publicKey.export(i,["verify"],r);if(!await e.verify({publicKey:s,signatureOnly:!0},r))continue}catch{continue}return o}}return null}};function XM(t,e=Ft.get()){let r=U.BufferSourceConverter.toUint8Array(U.Convert.FromHex(t||"")),n=r&&r.length&&r.some(i=>i>0)?new Uint8Array(r):void 0;n||(n=e.getRandomValues(new Uint8Array(16)));let o=0;for(;o<n.length-1&&n[o]===0;)o++;if(n=n.slice(o),n[0]>127){let i=new Uint8Array(n.length+1);i[0]=0,i.set(n,1),n=i}return n.buffer}var WM=class{static async createSelfSigned(e,r=Ft.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},r)}static async create(e,r=Ft.get()){var n;let o;e.publicKey instanceof ii?o=e.publicKey.rawData:"publicKey"in e.publicKey?o=e.publicKey.publicKey.rawData:U.BufferSourceConverter.isBufferSource(e.publicKey)?o=e.publicKey:o=await r.subtle.exportKey("spki",e.publicKey);let i=XM(e.serialNumber,r),s=e.notBefore||new Date,a=e.notAfter||new Date(s.getTime()+31536e6),c=new N.Certificate({tbsCertificate:new N.TBSCertificate({version:N.Version.v3,serialNumber:i,validity:new N.Validity({notBefore:s,notAfter:a}),extensions:new N.Extensions(((n=e.extensions)===null||n===void 0?void 0:n.map(y=>z.AsnConvert.parse(y.rawData,N.Extension)))||[]),subjectPublicKeyInfo:z.AsnConvert.parse(o,N.SubjectPublicKeyInfo)})});if(e.subject){let y=e.subject instanceof xr?e.subject:new xr(e.subject);c.tbsCertificate.subject=z.AsnConvert.parse(y.toArrayBuffer(),N.Name)}if(e.issuer){let y=e.issuer instanceof xr?e.issuer:new xr(e.issuer);c.tbsCertificate.issuer=z.AsnConvert.parse(y.toArrayBuffer(),N.Name)}let u={hash:"SHA-256"},l="signingKey"in e?{...u,...e.signingAlgorithm,...e.signingKey.algorithm}:{...u,...e.signingAlgorithm},d=Pt.container.resolve(si);c.tbsCertificate.signature=c.signatureAlgorithm=d.toAsnAlgorithm(l);let p=z.AsnConvert.serialize(c.tbsCertificate),f="signingKey"in e?await r.subtle.sign(l,e.signingKey,p):e.signature,h=Pt.container.resolveAll(Os).reverse(),m=null;for(let y of h)if(m=y.toAsnSignature(l,f),m)break;if(!m)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=m,new qa(z.AsnConvert.serialize(c))}},Pv,Cv,Hp,Kp,Wp;B.X509CrlReason=void 0;(function(t){t[t.unspecified=0]="unspecified",t[t.keyCompromise=1]="keyCompromise",t[t.cACompromise=2]="cACompromise",t[t.affiliationChanged=3]="affiliationChanged",t[t.superseded=4]="superseded",t[t.cessationOfOperation=5]="cessationOfOperation",t[t.certificateHold=6]="certificateHold",t[t.removeFromCRL=8]="removeFromCRL",t[t.privilegeWithdrawn=9]="privilegeWithdrawn",t[t.aACompromise=10]="aACompromise"})(B.X509CrlReason||(B.X509CrlReason={}));var ef=class extends Ui{get serialNumber(){return M.__classPrivateFieldGet(this,Pv,"f")||M.__classPrivateFieldSet(this,Pv,U.Convert.ToHex(this.asn.userCertificate),"f"),M.__classPrivateFieldGet(this,Pv,"f")}get revocationDate(){return M.__classPrivateFieldGet(this,Cv,"f")||M.__classPrivateFieldSet(this,Cv,this.asn.revocationDate.getTime(),"f"),M.__classPrivateFieldGet(this,Cv,"f")}get reason(){return M.__classPrivateFieldGet(this,Hp,"f")===void 0&&this.extensions,M.__classPrivateFieldGet(this,Hp,"f")}get invalidity(){return M.__classPrivateFieldGet(this,Kp,"f")===void 0&&this.extensions,M.__classPrivateFieldGet(this,Kp,"f")}get extensions(){return M.__classPrivateFieldGet(this,Wp,"f")||(M.__classPrivateFieldSet(this,Wp,[],"f"),this.asn.crlEntryExtensions&&M.__classPrivateFieldSet(this,Wp,this.asn.crlEntryExtensions.map(e=>{let r=Cr.create(z.AsnConvert.serialize(e));switch(r.type){case re.id_ce_cRLReasons:M.__classPrivateFieldGet(this,Hp,"f")===void 0&&M.__classPrivateFieldSet(this,Hp,z.AsnConvert.parse(r.value,re.CRLReason).reason,"f");break;case re.id_ce_invalidityDate:M.__classPrivateFieldGet(this,Kp,"f")===void 0&&M.__classPrivateFieldSet(this,Kp,z.AsnConvert.parse(r.value,re.InvalidityDate).value,"f");break}return r}),"f")),M.__classPrivateFieldGet(this,Wp,"f")}constructor(...e){let r;if(U.BufferSourceConverter.isBufferSource(e[0])?r=U.BufferSourceConverter.toArrayBuffer(e[0]):typeof e[0]=="string"?r=z.AsnConvert.serialize(new re.RevokedCertificate({userCertificate:XM(e[0]),revocationDate:new re.Time(e[1]),crlEntryExtensions:e[2]})):e[0]instanceof re.RevokedCertificate&&(r=e[0]),!r)throw new TypeError("Cannot create X509CrlEntry instance. Wrong constructor arguments.");super(r,re.RevokedCertificate),Pv.set(this,void 0),Cv.set(this,void 0),Hp.set(this,void 0),Kp.set(this,void 0),Wp.set(this,void 0)}onInit(e){}};Pv=new WeakMap,Cv=new WeakMap,Hp=new WeakMap,Kp=new WeakMap,Wp=new WeakMap;var Tv,Iv,Ev,Ov,jv,Nv,Gp,Zk=class extends Rn{get version(){return this.asn.tbsCertList.version}get signatureAlgorithm(){if(!M.__classPrivateFieldGet(this,Iv,"f")){let e=Pt.container.resolve(si);M.__classPrivateFieldSet(this,Iv,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return M.__classPrivateFieldGet(this,Iv,"f")}get signature(){return this.asn.signature}get issuer(){return this.issuerName.toString()}get issuerName(){return M.__classPrivateFieldGet(this,Ev,"f")||M.__classPrivateFieldSet(this,Ev,new xr(this.asn.tbsCertList.issuer),"f"),M.__classPrivateFieldGet(this,Ev,"f")}get thisUpdate(){if(!M.__classPrivateFieldGet(this,Ov,"f")){let e=this.asn.tbsCertList.thisUpdate.getTime();if(!e)throw new Error("Cannot get 'thisUpdate' value");M.__classPrivateFieldSet(this,Ov,e,"f")}return M.__classPrivateFieldGet(this,Ov,"f")}get nextUpdate(){var e;return M.__classPrivateFieldGet(this,jv,"f")===void 0&&M.__classPrivateFieldSet(this,jv,((e=this.asn.tbsCertList.nextUpdate)===null||e===void 0?void 0:e.getTime())||void 0,"f"),M.__classPrivateFieldGet(this,jv,"f")}get entries(){var e;return M.__classPrivateFieldGet(this,Nv,"f")||M.__classPrivateFieldSet(this,Nv,((e=this.asn.tbsCertList.revokedCertificates)===null||e===void 0?void 0:e.map(r=>new ef(r)))||[],"f"),M.__classPrivateFieldGet(this,Nv,"f")}get extensions(){return M.__classPrivateFieldGet(this,Gp,"f")||(M.__classPrivateFieldSet(this,Gp,[],"f"),this.asn.tbsCertList.crlExtensions&&M.__classPrivateFieldSet(this,Gp,this.asn.tbsCertList.crlExtensions.map(e=>Cr.create(z.AsnConvert.serialize(e))),"f")),M.__classPrivateFieldGet(this,Gp,"f")}get tbs(){return M.__classPrivateFieldGet(this,Tv,"f")||M.__classPrivateFieldSet(this,Tv,this.asn.tbsCertListRaw||z.AsnConvert.serialize(this.asn.tbsCertList),"f"),M.__classPrivateFieldGet(this,Tv,"f")}get tbsCertListSignatureAlgorithm(){return this.asn.tbsCertList.signature}get certListSignatureAlgorithm(){return this.asn.signatureAlgorithm}constructor(e){super(e,Rn.isAsnEncoded(e)?re.CertificateList:void 0),this.tag=Pr.CrlTag,Tv.set(this,void 0),Iv.set(this,void 0),Ev.set(this,void 0),Ov.set(this,void 0),jv.set(this,void 0),Nv.set(this,void 0),Gp.set(this,void 0)}onInit(e){}getExtension(e){for(let r of this.extensions)if(typeof e=="string"){if(r.type===e)return r}else if(r instanceof e)return r;return null}getExtensions(e){return this.extensions.filter(r=>typeof e=="string"?r.type===e:r instanceof e)}async verify(e,r=Ft.get()){if(!this.certListSignatureAlgorithm.isEqual(this.tbsCertListSignatureAlgorithm))throw new Error("algorithm identifier in the sequence tbsCertList and CertificateList mismatch");let n,o,i=e.publicKey;try{i instanceof qa?(n={...i.publicKey.algorithm,...i.signatureAlgorithm},o=await i.publicKey.export(n,["verify"])):i instanceof ii?(n={...i.algorithm,...this.signatureAlgorithm},o=await i.export(n,["verify"])):(n={...i.algorithm,...this.signatureAlgorithm},o=i)}catch{return!1}let s=Pt.container.resolveAll(Os).reverse(),a=null;for(let c of s)if(a=c.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return await r.subtle.verify(this.signatureAlgorithm,o,a,this.tbs)}async getThumbprint(...e){let r,n="SHA-1";return e[0]&&(e[0].subtle?r=e[0]:(n=e[0]||n,r=e[1])),r??(r=Ft.get()),await r.subtle.digest(n,this.rawData)}findRevoked(e){let r=typeof e=="string"?e:e.serialNumber,n=XM(r);for(let o of this.asn.tbsCertList.revokedCertificates||[])if(U.BufferSourceConverter.isEqual(o.userCertificate,n))return new ef(z.AsnConvert.serialize(o));return null}};Tv=new WeakMap,Iv=new WeakMap,Ev=new WeakMap,Ov=new WeakMap,jv=new WeakMap,Nv=new WeakMap,Gp=new WeakMap;var GM=class{static async create(e,r=Ft.get()){var n;let o=e.issuer instanceof xr?e.issuer:new xr(e.issuer),i=new N.CertificateList({tbsCertList:new N.TBSCertList({version:N.Version.v2,issuer:z.AsnConvert.parse(o.toArrayBuffer(),N.Name),thisUpdate:new re.Time(e.thisUpdate||new Date)})});if(e.nextUpdate&&(i.tbsCertList.nextUpdate=new re.Time(e.nextUpdate)),e.extensions&&e.extensions.length&&(i.tbsCertList.crlExtensions=new N.Extensions(e.extensions.map(p=>z.AsnConvert.parse(p.rawData,N.Extension))||[])),e.entries&&e.entries.length){i.tbsCertList.revokedCertificates=[];for(let p of e.entries){let f=Rn.toArrayBuffer(p.serialNumber);if(i.tbsCertList.revokedCertificates.findIndex(y=>U.isEqual(y.userCertificate,f))>-1)throw new Error(`Certificate serial number ${p.serialNumber} already exists in tbsCertList`);let m=new re.RevokedCertificate({userCertificate:f,revocationDate:new re.Time(p.revocationDate||new Date)});if("extensions"in p&&(!((n=p.extensions)===null||n===void 0)&&n.length)?m.crlEntryExtensions=p.extensions.map(y=>z.AsnConvert.parse(y.rawData,N.Extension)):m.crlEntryExtensions=[],!(p instanceof ef)&&(p.reason&&m.crlEntryExtensions.push(new N.Extension({extnID:N.id_ce_cRLReasons,critical:!1,extnValue:new z.OctetString(z.AsnConvert.serialize(new N.CRLReason(p.reason)))})),p.invalidity&&m.crlEntryExtensions.push(new N.Extension({extnID:N.id_ce_invalidityDate,critical:!1,extnValue:new z.OctetString(z.AsnConvert.serialize(new N.InvalidityDate(p.invalidity)))})),p.issuer)){let y=e.issuer instanceof xr?e.issuer:new xr(e.issuer);m.crlEntryExtensions.push(new N.Extension({extnID:N.id_ce_certificateIssuer,critical:!1,extnValue:new z.OctetString(z.AsnConvert.serialize(z.AsnConvert.parse(y.toArrayBuffer(),N.Name)))}))}i.tbsCertList.revokedCertificates.push(m)}}let s={...e.signingAlgorithm,...e.signingKey.algorithm},a=Pt.container.resolve(si);i.tbsCertList.signature=i.signatureAlgorithm=a.toAsnAlgorithm(s);let c=z.AsnConvert.serialize(i.tbsCertList),u=await r.subtle.sign(s,e.signingKey,c),l=Pt.container.resolveAll(Os).reverse(),d=null;for(let p of l)if(d=p.toAsnSignature(s,u),d)break;if(!d)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return i.signature=d,new Zk(z.AsnConvert.serialize(i))}};Cr.register(N.id_ce_basicConstraints,qv);Cr.register(N.id_ce_extKeyUsage,Uv);Cr.register(N.id_ce_keyUsage,Bv);Cr.register(N.id_ce_subjectKeyIdentifier,Lv);Cr.register(N.id_ce_authorityKeyIdentifier,Dv);Cr.register(N.id_ce_subjectAltName,Zv);Cr.register(N.id_ce_cRLDistributionPoints,Fv);Cr.register(N.id_pe_authorityInfoAccess,Hv);Cr.register(N.id_ce_issuerAltName,Kv);Vu.register(Jp.id_pkcs9_at_challengePassword,Wv);Vu.register(Jp.id_pkcs9_at_extensionRequest,Qp);Pt.container.registerSingleton(Os,Bk);Pt.container.registerSingleton(Os,Li);Li.namedCurveSize.set("P-256",32);Li.namedCurveSize.set("K-256",32);Li.namedCurveSize.set("P-384",48);Li.namedCurveSize.set("P-521",66);B.AlgorithmProvider=qk;B.AsnData=Ui;B.AsnDefaultSignatureFormatter=Bk;B.AsnEcSignatureFormatter=Li;B.Attribute=Zu;B.AttributeFactory=Vu;B.AuthorityInfoAccessExtension=Hv;B.AuthorityKeyIdentifierExtension=Dv;B.BasicConstraintsExtension=qv;B.CRLDistributionPointsExtension=Fv;B.CertificatePolicyExtension=Vv;B.ChallengePasswordAttribute=Wv;B.CryptoProvider=Xp;B.DN=Ck;B.DNS=Pk;B.DefaultAlgorithmSerializer=Uk;B.EMAIL=Tk;B.ExtendedKeyUsageExtension=Uv;B.Extension=Nn;B.ExtensionFactory=Cr;B.ExtensionsAttribute=Qp;B.GUID=Ok;B.GeneralName=oi;B.GeneralNames=Bi;B.IP=Ik;B.IssuerAlternativeNameExtension=Kv;B.KeyUsagesExtension=Bv;B.Name=xr;B.NameIdentifier=Rv;B.OidSerializer=ko;B.PemConverter=Pr;B.PemData=Rn;B.Pkcs10CertificateRequest=Gv;B.Pkcs10CertificateRequestGenerator=HM;B.PublicKey=ii;B.REGISTERED_ID=cv;B.SubjectAlternativeNameExtension=Zv;B.SubjectKeyIdentifierExtension=Lv;B.TextConverter=ai;B.TextObject=Be;B.UPN=jk;B.URL=Ek;B.X509Certificate=qa;B.X509CertificateGenerator=WM;B.X509Certificates=Lk;B.X509ChainBuilder=KM;B.X509Crl=Zk;B.X509CrlEntry=ef;B.X509CrlGenerator=GM;B.cryptoProvider=Ft;B.diAlgorithm=tf;B.diAlgorithmProvider=si;B.diAsnSignatureFormatter=Os;B.idEd25519=Rk;B.idEd448=FM;B.idX25519=zk;B.idX448=VM});var zW=g(NW=>{var{X509CertificateGenerator:YM,X509Certificate:QM,cryptoProvider:Rge,X509ChainBuilder:Mge,BasicConstraintsExtension:AW,KeyUsagesExtension:PW,KeyUsageFlags:ci,ExtendedKeyUsageExtension:CW,ExtendedKeyUsage:Fu,SubjectAlternativeNameExtension:TW,GeneralName:_Ne}=$W(),tD=require("crypto"),$o=tD.webcrypto;Rge.set($o);function IW(t){var e=parseInt(t[0],16);return e<8?t:(e-=8,e.toString()+t.substring(1))}function Vk(t){switch(t){case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:return"SHA-1"}}function EW(t,e){let r=Vk(t);return e==="ec"?{name:"ECDSA",hash:r}:{name:"RSASSA-PKCS1-v1_5",hash:r}}function OW(t){let e=t.keyType||"rsa",r=Vk(t.algorithm||"sha1");return e==="ec"?{name:"ECDSA",namedCurve:t.curve||"P-256"}:{name:"RSASSA-PKCS1-v1_5",modulusLength:t.keySize||2048,publicExponent:new Uint8Array([1,0,1]),hash:r}}function Dge(t,e){if(!t||t.length===0)return[new AW(!1,void 0,!0),new PW(ci.digitalSignature|ci.keyEncipherment,!0),new CW([Fu.serverAuth,Fu.clientAuth],!1),new TW([{type:"dns",value:e},...e==="localhost"?[{type:"ip",value:"127.0.0.1"}]:[]],!1)];let r=[];for(let n of t){let o=n.critical||!1;switch(n.name){case"basicConstraints":r.push(new AW(n.cA||!1,n.pathLenConstraint,o));break;case"keyUsage":let i=0;n.digitalSignature&&(i|=ci.digitalSignature),(n.nonRepudiation||n.contentCommitment)&&(i|=ci.nonRepudiation),n.keyEncipherment&&(i|=ci.keyEncipherment),n.dataEncipherment&&(i|=ci.dataEncipherment),n.keyAgreement&&(i|=ci.keyAgreement),n.keyCertSign&&(i|=ci.keyCertSign),n.cRLSign&&(i|=ci.cRLSign),n.encipherOnly&&(i|=ci.encipherOnly),n.decipherOnly&&(i|=ci.decipherOnly),r.push(new PW(i,o));break;case"extKeyUsage":let s=[];n.serverAuth&&s.push(Fu.serverAuth),n.clientAuth&&s.push(Fu.clientAuth),n.codeSigning&&s.push(Fu.codeSigning),n.emailProtection&&s.push(Fu.emailProtection),n.timeStamping&&s.push(Fu.timeStamping),r.push(new CW(s,o));break;case"subjectAltName":let a=(n.altNames||[]).map(c=>{switch(c.type){case 1:return{type:"email",value:c.value};case 2:return{type:"dns",value:c.value};case 6:return{type:"url",value:c.value};case 7:return{type:"ip",value:c.ip||c.value};default:return c.ip?{type:"ip",value:c.ip}:c.dns?{type:"dns",value:c.dns}:c.email?{type:"email",value:c.email}:c.uri||c.url?{type:"url",value:c.uri||c.url}:{type:"dns",value:c.value}}});r.push(new TW(a,o));break;default:}}return r}function eD(t){let e={commonName:"CN",countryName:"C",ST:"ST",localityName:"L",organizationName:"O",OU:"OU"};return t.map(r=>{let n=r.name||r.shortName;return`${e[n]||n}=${r.value}`}).join(", ")}function qge(t){return{prime256v1:"P-256",secp384r1:"P-384",secp521r1:"P-521","P-256":"P-256","P-384":"P-384","P-521":"P-521"}[t]||t}function Uge(t){let e=t.asymmetricKeyDetails;return e&&e.namedCurve?qge(e.namedCurve):"P-256"}async function jW(t,e,r){let n=tD.createPrivateKey(t),o=n.asymmetricKeyType,i=r||o,a=n.export({type:"pkcs8",format:"pem"}).replace(/-----BEGIN PRIVATE KEY-----/,"").replace(/-----END PRIVATE KEY-----/,"").replace(/\s/g,""),c=Buffer.from(a,"base64"),u;return i==="ec"?u={name:"ECDSA",namedCurve:Uge(n)}:u={name:"RSASSA-PKCS1-v1_5",hash:Vk(e)},await $o.subtle.importKey("pkcs8",c,u,!0,["sign"])}async function Bge(t,e,r,n){let o=t.replace(/-----BEGIN PUBLIC KEY-----/,"").replace(/-----END PUBLIC KEY-----/,"").replace(/\s/g,""),i=Buffer.from(o,"base64"),s;return r==="ec"?s={name:"ECDSA",namedCurve:n||"P-256"}:s={name:"RSASSA-PKCS1-v1_5",hash:Vk(e)},await $o.subtle.importKey("spki",i,s,!0,["verify"])}async function Lge(t,e,r,n){let{privateKey:o,publicKey:i}=t,s=$o.getRandomValues(new Uint8Array(9)),a=IW(Buffer.from(s).toString("hex")),c=r.notBeforeDate||new Date,u;r.notAfterDate?u=r.notAfterDate:(u=new Date(c),u.setDate(u.getDate()+365)),e=e||[{name:"commonName",value:"example.org"},{name:"countryName",value:"US"},{shortName:"ST",value:"Virginia"},{name:"localityName",value:"Blacksburg"},{name:"organizationName",value:"Test"},{shortName:"OU",value:"Test"}];let l=eD(e),d=r.keyType||"rsa",p=EW(r.algorithm,d),f=e.find(Gt=>Gt.name==="commonName"||Gt.shortName==="CN"),h=f?f.value:"localhost",m=Dge(r.extensions,h),y;if(n){let Gt=new QM(n.cert),Za=await jW(n.key,r.algorithm||"sha256",d);y=await YM.create({serialNumber:a,subject:l,issuer:Gt.subject,notBefore:c,notAfter:u,signingAlgorithm:p,publicKey:i,signingKey:Za,extensions:m})}else y=await YM.createSelfSigned({serialNumber:a,name:l,notBefore:c,notAfter:u,signingAlgorithm:p,keys:{privateKey:o,publicKey:i},extensions:m});let v=y.rawData,b=await $o.subtle.digest("SHA-1",v),x=Buffer.from(b).toString("hex").match(/.{2}/g).join(":"),C=await $o.subtle.exportKey("pkcs8",o),$=await $o.subtle.exportKey("spki",i),L;r.passphrase?L=tD.createPrivateKey({key:Buffer.from(C),format:"der",type:"pkcs8"}).export({type:"pkcs8",format:"pem",cipher:"aes-256-cbc",passphrase:r.passphrase}):L=`-----BEGIN PRIVATE KEY-----
`+Buffer.from(C).toString("base64").match(/.{1,64}/g).join(`
`)+`
-----END PRIVATE KEY-----
`;let xe=`-----BEGIN PUBLIC KEY-----
`+Buffer.from($).toString("base64").match(/.{1,64}/g).join(`
`)+`
-----END PUBLIC KEY-----
`,ve=y.toString("pem"),Se={private:L,public:xe,cert:ve,fingerprint:x};if(r&&r.clientCertificate){let Gt=typeof r.clientCertificate=="object"?r.clientCertificate:{},Za=Gt.keySize||r.clientCertificateKeySize||2048,df=Gt.algorithm||r.algorithm||"sha1",i_=Gt.cn||r.clientCertificateCN||"John Doe jdoe123",s_=Gt.keyType||d,a_=Gt.curve||r.curve||"P-256",c_=OW({keyType:s_,keySize:Za,algorithm:df,curve:a_}),el=await $o.subtle.generateKey(c_,!0,["sign","verify"]),_e=$o.getRandomValues(new Uint8Array(9)),Ds=IW(Buffer.from(_e).toString("hex")),pf=Gt.notBeforeDate||new Date,Tt;Gt.notAfterDate?Tt=Gt.notAfterDate:(Tt=new Date(pf),Tt.setFullYear(pf.getFullYear()+1));let tl=JSON.parse(JSON.stringify(e));for(let Va=0;Va<tl.length;Va++)tl[Va].name==="commonName"&&(tl[Va]={name:"commonName",value:i_});let c$=eD(tl),u_=eD(e),u$=EW(df,d),Yn=await YM.create({serialNumber:Ds,subject:c$,issuer:u_,notBefore:pf,notAfter:Tt,signingAlgorithm:u$,publicKey:el.publicKey,signingKey:o}),l_=await $o.subtle.exportKey("pkcs8",el.privateKey),qs=await $o.subtle.exportKey("spki",el.publicKey);Se.clientprivate=`-----BEGIN PRIVATE KEY-----
`+Buffer.from(l_).toString("base64").match(/.{1,64}/g).join(`
`)+`
-----END PRIVATE KEY-----
`,Se.clientpublic=`-----BEGIN PUBLIC KEY-----
`+Buffer.from(qs).toString("base64").match(/.{1,64}/g).join(`
`)+`
-----END PUBLIC KEY-----
`,Se.clientcert=Yn.toString("pem")}let Fe=new QM(y.rawData),Yt=[Fe];if(n){let Gt=new QM(n.cert);Yt.push(Gt)}if((await new Mge({certificates:Yt}).build(Fe)).length===0)throw new Error("Certificate could not be verified.");return Se}NW.generate=async function(e,r){e=e||void 0,r=r||{};let n=r.keyType||"rsa",o=r.curve||"P-256",i;if(r.keyPair)i={privateKey:await jW(r.keyPair.privateKey,r.algorithm||"sha1",n),publicKey:await Bge(r.keyPair.publicKey,r.algorithm||"sha1",n,o)};else{let s=OW(r);i=await $o.subtle.generateKey(s,!0,["sign","verify"])}return await Lge(i,e,r,r.ca)}});var js=g((wNe,DW)=>{"use strict";var RW=["nodebuffer","arraybuffer","fragments"],MW=typeof Blob<"u";MW&&RW.push("blob");DW.exports={BINARY_TYPES:RW,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:MW,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Xv=g((xNe,Fk)=>{"use strict";var{EMPTY_BUFFER:Zge}=js(),rD=Buffer[Symbol.species];function Vge(t,e){if(t.length===0)return Zge;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let o=0;o<t.length;o++){let i=t[o];r.set(i,n),n+=i.length}return n<e?new rD(r.buffer,r.byteOffset,n):r}function qW(t,e,r,n,o){for(let i=0;i<o;i++)r[n+i]=t[i]^e[i&3]}function UW(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function Fge(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function nD(t){if(nD.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new rD(t):ArrayBuffer.isView(t)?e=new rD(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),nD.readOnly=!1),e}Fk.exports={concat:Vge,mask:qW,toArrayBuffer:Fge,toBuffer:nD,unmask:UW};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");Fk.exports.mask=function(e,r,n,o,i){i<48?qW(e,r,n,o,i):t.mask(e,r,n,o,i)},Fk.exports.unmask=function(e,r){e.length<32?UW(e,r):t.unmask(e,r)}}catch{}});var ZW=g((SNe,LW)=>{"use strict";var BW=Symbol("kDone"),oD=Symbol("kRun"),iD=class{constructor(e){this[BW]=()=>{this.pending--,this[oD]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[oD]()}[oD](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[BW])}}};LW.exports=iD});var Qv=g((kNe,KW)=>{"use strict";var Yv=require("zlib"),VW=Xv(),Hge=ZW(),{kStatusCode:FW}=js(),Kge=Buffer[Symbol.species],Wge=Buffer.from([0,0,255,255]),Kk=Symbol("permessage-deflate"),Ns=Symbol("total-length"),rf=Symbol("callback"),Ua=Symbol("buffers"),nf=Symbol("error"),Hk,sD=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Hk){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Hk=new Hge(o)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[rf];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(o=>!(r.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>o.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let o=r[n];if(o.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(o=o[0],n==="client_max_window_bits"){if(o!==!0){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else if(n==="server_max_window_bits"){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=i}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=o})}),e}decompress(e,r,n){Hk.add(o=>{this._decompress(e,r,(i,s)=>{o(),n(i,s)})})}compress(e,r,n){Hk.add(o=>{this._compress(e,r,(i,s)=>{o(),n(i,s)})})}_decompress(e,r,n){let o=this._isServer?"client":"server";if(!this._inflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?Yv.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=Yv.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[Kk]=this,this._inflate[Ns]=0,this._inflate[Ua]=[],this._inflate.on("error",Jge),this._inflate.on("data",HW)}this._inflate[rf]=n,this._inflate.write(e),r&&this._inflate.write(Wge),this._inflate.flush(()=>{let i=this._inflate[nf];if(i){this._inflate.close(),this._inflate=null,n(i);return}let s=VW.concat(this._inflate[Ua],this._inflate[Ns]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Ns]=0,this._inflate[Ua]=[],r&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),n(null,s)})}_compress(e,r,n){let o=this._isServer?"server":"client";if(!this._deflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?Yv.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=Yv.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[Ns]=0,this._deflate[Ua]=[],this._deflate.on("data",Gge)}this._deflate[rf]=n,this._deflate.write(e),this._deflate.flush(Yv.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=VW.concat(this._deflate[Ua],this._deflate[Ns]);r&&(i=new Kge(i.buffer,i.byteOffset,i.length-4)),this._deflate[rf]=null,this._deflate[Ns]=0,this._deflate[Ua]=[],r&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),n(null,i)})}};KW.exports=sD;function Gge(t){this[Ua].push(t),this[Ns]+=t.length}function HW(t){if(this[Ns]+=t.length,this[Kk]._maxPayload<1||this[Ns]<=this[Kk]._maxPayload){this[Ua].push(t);return}this[nf]=new RangeError("Max payload size exceeded"),this[nf].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[nf][FW]=1009,this.removeListener("data",HW),this.reset()}function Jge(t){if(this[Kk]._inflate=null,this[nf]){this[rf](this[nf]);return}t[FW]=1007,this[rf](t)}});var of=g(($Ne,Wk)=>{"use strict";var{isUtf8:WW}=require("buffer"),{hasBlob:Xge}=js(),Yge=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Qge(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function aD(t){let e=t.length,r=0;for(;r<e;)if((t[r]&128)===0)r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function eye(t){return Xge&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}Wk.exports={isBlob:eye,isValidStatusCode:Qge,isValidUTF8:aD,tokenChars:Yge};if(WW)Wk.exports.isValidUTF8=function(t){return t.length<24?aD(t):WW(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");Wk.exports.isValidUTF8=function(e){return e.length<32?aD(e):t(e)}}catch{}});var pD=g((ANe,tG)=>{"use strict";var{Writable:tye}=require("stream"),GW=Qv(),{BINARY_TYPES:rye,EMPTY_BUFFER:JW,kStatusCode:nye,kWebSocket:oye}=js(),{concat:cD,toArrayBuffer:iye,unmask:sye}=Xv(),{isValidStatusCode:aye,isValidUTF8:XW}=of(),Gk=Buffer[Symbol.species],Ao=0,YW=1,QW=2,eG=3,uD=4,lD=5,Jk=6,dD=class extends tye{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||rye[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[oye]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=Ao}_write(e,r,n){if(this._opcode===8&&this._state==Ao)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Gk(n.buffer,n.byteOffset+e,n.length-e),new Gk(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],o=r.length-e;e>=n.length?r.set(this._buffers.shift(),o):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),o),this._buffers[0]=new Gk(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case Ao:this.getInfo(e);break;case YW:this.getPayloadLength16(e);break;case QW:this.getPayloadLength64(e);break;case eG:this.getMask();break;case uD:this.getData(e);break;case lD:case Jk:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if((r[0]&48)!==0){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(o);return}let n=(r[0]&64)===64;if(n&&!this._extensions[GW.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(o);return}if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(o);return}this._payloadLength===126?this._state=YW:this._payloadLength===127?this._state=QW:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(o);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=eG:this._state=uD}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=uD}getData(e){let r=JW;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&sye(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=lD,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[GW.extensionName].decompress(e,this._fin,(o,i)=>{if(o)return r(o);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(s);return}this._fragments.push(i)}this.dataMessage(r),this._state===Ao&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=Ao;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=cD(n,r):this._binaryType==="arraybuffer"?o=iye(cD(n,r)):this._binaryType==="blob"?o=new Blob(n):o=n,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=Ao):(this._state=Jk,setImmediate(()=>{this.emit("message",o,!0),this._state=Ao,this.startLoop(e)}))}else{let o=cD(n,r);if(!this._skipUTF8Validation&&!XW(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===lD||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=Ao):(this._state=Jk,setImmediate(()=>{this.emit("message",o,!1),this._state=Ao,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,JW),this.end();else{let n=e.readUInt16BE(0);if(!aye(n)){let i=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(i);return}let o=new Gk(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!XW(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(i);return}this._loop=!1,this.emit("conclude",n,o),this.end()}this._state=Ao;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=Ao):(this._state=Jk,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=Ao,this.startLoop(r)}))}createError(e,r,n,o,i){this._loop=!1,this._errored=!0;let s=new e(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(s,this.createError),s.code=i,s[nye]=o,s}};tG.exports=dD});var hD=g((CNe,oG)=>{"use strict";var{Duplex:PNe}=require("stream"),{randomFillSync:cye}=require("crypto"),rG=Qv(),{EMPTY_BUFFER:uye,kWebSocket:lye,NOOP:dye}=js(),{isBlob:sf,isValidStatusCode:pye}=of(),{mask:nG,toBuffer:Hu}=Xv(),Po=Symbol("kByteLength"),fye=Buffer.alloc(4),Xk=8*1024,Ku,af=Xk,ui=0,mye=1,hye=2,fD=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=ui,this.onerror=dye,this[lye]=void 0}static frame(e,r){let n,o=!1,i=2,s=!1;r.mask&&(n=r.maskBuffer||fye,r.generateMask?r.generateMask(n):(af===Xk&&(Ku===void 0&&(Ku=Buffer.alloc(Xk)),cye(Ku,0,Xk),af=0),n[0]=Ku[af++],n[1]=Ku[af++],n[2]=Ku[af++],n[3]=Ku[af++]),s=(n[0]|n[1]|n[2]|n[3])===0,i=6);let a;typeof e=="string"?(!r.mask||s)&&r[Po]!==void 0?a=r[Po]:(e=Buffer.from(e),a=e.length):(a=e.length,o=r.mask&&r.readOnly&&!s);let c=a;a>=65536?(i+=8,c=127):a>125&&(i+=2,c=126);let u=Buffer.allocUnsafe(o?a+i:i);return u[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(u[0]|=64),u[1]=c,c===126?u.writeUInt16BE(a,2):c===127&&(u[2]=u[3]=0,u.writeUIntBE(a,4,6)),r.mask?(u[1]|=128,u[i-4]=n[0],u[i-3]=n[1],u[i-2]=n[2],u[i-1]=n[3],s?[u,e]:o?(nG(e,n,u,i,a),[u]):(nG(e,n,e,0,a),[u,e])):[u,e]}close(e,r,n,o){let i;if(e===void 0)i=uye;else{if(typeof e!="number"||!pye(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof r=="string"?i.write(r,2):i.set(r,2)}}let s={[Po]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==ui?this.enqueue([this.dispatch,i,!1,s,o]):this.sendFrame(t.frame(i,s),o)}ping(e,r,n){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):sf(e)?(o=e.size,i=!1):(e=Hu(e),o=e.length,i=Hu.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[Po]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};sf(e)?this._state!==ui?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):this._state!==ui?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}pong(e,r,n){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):sf(e)?(o=e.size,i=!1):(e=Hu(e),o=e.length,i=Hu.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[Po]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};sf(e)?this._state!==ui?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):this._state!==ui?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}send(e,r,n){let o=this._extensions[rG.extensionName],i=r.binary?2:1,s=r.compress,a,c;typeof e=="string"?(a=Buffer.byteLength(e),c=!1):sf(e)?(a=e.size,c=!1):(e=Hu(e),a=e.length,c=Hu.readOnly),this._firstFragment?(this._firstFragment=!1,s&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=a>=o._threshold),this._compress=s):(s=!1,i=0),r.fin&&(this._firstFragment=!0);let u={[Po]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:s};sf(e)?this._state!==ui?this.enqueue([this.getBlobData,e,this._compress,u,n]):this.getBlobData(e,this._compress,u,n):this._state!==ui?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}getBlobData(e,r,n,o){this._bufferedBytes+=n[Po],this._state=hye,e.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(mD,this,a,o);return}this._bufferedBytes-=n[Po];let s=Hu(i);r?this.dispatch(s,r,n,o):(this._state=ui,this.sendFrame(t.frame(s,n),o),this.dequeue())}).catch(i=>{process.nextTick(gye,this,i,o)})}dispatch(e,r,n,o){if(!r){this.sendFrame(t.frame(e,n),o);return}let i=this._extensions[rG.extensionName];this._bufferedBytes+=n[Po],this._state=mye,i.compress(e,n.fin,(s,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");mD(this,c,o);return}this._bufferedBytes-=n[Po],this._state=ui,n.readOnly=!1,this.sendFrame(t.frame(a,n),o),this.dequeue()})}dequeue(){for(;this._state===ui&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][Po],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][Po],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};oG.exports=fD;function mD(t,e,r){typeof r=="function"&&r(e);for(let n=0;n<t._queue.length;n++){let o=t._queue[n],i=o[o.length-1];typeof i=="function"&&i(e)}}function gye(t,e,r){mD(t,e,r),t.onerror(e)}});var fG=g((TNe,pG)=>{"use strict";var{kForOnEventAttribute:e_,kListener:gD}=js(),iG=Symbol("kCode"),sG=Symbol("kData"),aG=Symbol("kError"),cG=Symbol("kMessage"),uG=Symbol("kReason"),cf=Symbol("kTarget"),lG=Symbol("kType"),dG=Symbol("kWasClean"),zs=class{constructor(e){this[cf]=null,this[lG]=e}get target(){return this[cf]}get type(){return this[lG]}};Object.defineProperty(zs.prototype,"target",{enumerable:!0});Object.defineProperty(zs.prototype,"type",{enumerable:!0});var Wu=class extends zs{constructor(e,r={}){super(e),this[iG]=r.code===void 0?0:r.code,this[uG]=r.reason===void 0?"":r.reason,this[dG]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[iG]}get reason(){return this[uG]}get wasClean(){return this[dG]}};Object.defineProperty(Wu.prototype,"code",{enumerable:!0});Object.defineProperty(Wu.prototype,"reason",{enumerable:!0});Object.defineProperty(Wu.prototype,"wasClean",{enumerable:!0});var uf=class extends zs{constructor(e,r={}){super(e),this[aG]=r.error===void 0?null:r.error,this[cG]=r.message===void 0?"":r.message}get error(){return this[aG]}get message(){return this[cG]}};Object.defineProperty(uf.prototype,"error",{enumerable:!0});Object.defineProperty(uf.prototype,"message",{enumerable:!0});var t_=class extends zs{constructor(e,r={}){super(e),this[sG]=r.data===void 0?null:r.data}get data(){return this[sG]}};Object.defineProperty(t_.prototype,"data",{enumerable:!0});var yye={addEventListener(t,e,r={}){for(let o of this.listeners(t))if(!r[e_]&&o[gD]===e&&!o[e_])return;let n;if(t==="message")n=function(i,s){let a=new t_("message",{data:s?i:i.toString()});a[cf]=this,Yk(e,this,a)};else if(t==="close")n=function(i,s){let a=new Wu("close",{code:i,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[cf]=this,Yk(e,this,a)};else if(t==="error")n=function(i){let s=new uf("error",{error:i,message:i.message});s[cf]=this,Yk(e,this,s)};else if(t==="open")n=function(){let i=new zs("open");i[cf]=this,Yk(e,this,i)};else return;n[e_]=!!r[e_],n[gD]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[gD]===e&&!r[e_]){this.removeListener(t,r);break}}};pG.exports={CloseEvent:Wu,ErrorEvent:uf,Event:zs,EventTarget:yye,MessageEvent:t_};function Yk(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var yD=g((INe,mG)=>{"use strict";var{tokenChars:r_}=of();function Zi(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function vye(t){let e=Object.create(null),r=Object.create(null),n=!1,o=!1,i=!1,s,a,c=-1,u=-1,l=-1,d=0;for(;d<t.length;d++)if(u=t.charCodeAt(d),s===void 0)if(l===-1&&r_[u]===1)c===-1&&(c=d);else if(d!==0&&(u===32||u===9))l===-1&&c!==-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d);let f=t.slice(c,l);u===44?(Zi(e,f,r),r=Object.create(null)):s=f,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);else if(a===void 0)if(l===-1&&r_[u]===1)c===-1&&(c=d);else if(u===32||u===9)l===-1&&c!==-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d),Zi(r,t.slice(c,l),!0),u===44&&(Zi(e,s,r),r=Object.create(null),s=void 0),c=l=-1}else if(u===61&&c!==-1&&l===-1)a=t.slice(c,d),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(o){if(r_[u]!==1)throw new SyntaxError(`Unexpected character at index ${d}`);c===-1?c=d:n||(n=!0),o=!1}else if(i)if(r_[u]===1)c===-1&&(c=d);else if(u===34&&c!==-1)i=!1,l=d;else if(u===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(u===34&&t.charCodeAt(d-1)===61)i=!0;else if(l===-1&&r_[u]===1)c===-1&&(c=d);else if(c!==-1&&(u===32||u===9))l===-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d);let f=t.slice(c,l);n&&(f=f.replace(/\\/g,""),n=!1),Zi(r,a,f),u===44&&(Zi(e,s,r),r=Object.create(null),s=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);if(c===-1||i||u===32||u===9)throw new SyntaxError("Unexpected end of input");l===-1&&(l=d);let p=t.slice(c,l);return s===void 0?Zi(e,p,r):(a===void 0?Zi(r,p,!0):n?Zi(r,a,p.replace(/\\/g,"")):Zi(r,a,p),Zi(e,s,r)),e}function _ye(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(o=>{let i=n[o];return Array.isArray(i)||(i=[i]),i.map(s=>s===!0?o:`${o}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}mG.exports={format:_ye,parse:vye}});var r$=g((jNe,AG)=>{"use strict";var bye=require("events"),wye=require("https"),xye=require("http"),yG=require("net"),Sye=require("tls"),{randomBytes:kye,createHash:$ye}=require("crypto"),{Duplex:ENe,Readable:ONe}=require("stream"),{URL:vD}=require("url"),Ba=Qv(),Aye=pD(),Pye=hD(),{isBlob:Cye}=of(),{BINARY_TYPES:hG,CLOSE_TIMEOUT:Tye,EMPTY_BUFFER:Qk,GUID:Iye,kForOnEventAttribute:_D,kListener:Eye,kStatusCode:Oye,kWebSocket:Tr,NOOP:vG}=js(),{EventTarget:{addEventListener:jye,removeEventListener:Nye}}=fG(),{format:zye,parse:Rye}=yD(),{toBuffer:Mye}=Xv(),_G=Symbol("kAborted"),bD=[8,13],Rs=["CONNECTING","OPEN","CLOSING","CLOSED"],Dye=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,Wt=class t extends bye{constructor(e,r,n){super(),this._binaryType=hG[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Qk,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),bG(this,e,r,n)):(this._autoPong=n.autoPong,this._closeTimeout=n.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){hG.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let o=new Aye({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new Pye(e,this._extensions,n.generateMask);this._receiver=o,this._sender=i,this._socket=e,o[Tr]=this,i[Tr]=this,e[Tr]=this,o.on("conclude",Bye),o.on("drain",Lye),o.on("error",Zye),o.on("message",Vye),o.on("ping",Fye),o.on("pong",Hye),i.onerror=Kye,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",SG),e.on("data",t$),e.on("end",kG),e.on("error",$G),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Ba.extensionName]&&this._extensions[Ba.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Xn(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),xG(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){wD(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Qk,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){wD(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Qk,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){wD(this,e,n);return}let o={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[Ba.extensionName]||(o.compress=!1),this._sender.send(e||Qk,o,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Xn(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(Wt,"CONNECTING",{enumerable:!0,value:Rs.indexOf("CONNECTING")});Object.defineProperty(Wt.prototype,"CONNECTING",{enumerable:!0,value:Rs.indexOf("CONNECTING")});Object.defineProperty(Wt,"OPEN",{enumerable:!0,value:Rs.indexOf("OPEN")});Object.defineProperty(Wt.prototype,"OPEN",{enumerable:!0,value:Rs.indexOf("OPEN")});Object.defineProperty(Wt,"CLOSING",{enumerable:!0,value:Rs.indexOf("CLOSING")});Object.defineProperty(Wt.prototype,"CLOSING",{enumerable:!0,value:Rs.indexOf("CLOSING")});Object.defineProperty(Wt,"CLOSED",{enumerable:!0,value:Rs.indexOf("CLOSED")});Object.defineProperty(Wt.prototype,"CLOSED",{enumerable:!0,value:Rs.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(Wt.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(Wt.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[_D])return e[Eye];return null},set(e){for(let r of this.listeners(t))if(r[_D]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[_D]:!0})}})});Wt.prototype.addEventListener=jye;Wt.prototype.removeEventListener=Nye;AG.exports=Wt;function bG(t,e,r,n){let o={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:Tye,protocolVersion:bD[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=o.autoPong,t._closeTimeout=o.closeTimeout,!bD.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${bD.join(", ")})`);let i;if(e instanceof vD)i=e;else try{i=new vD(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),t._url=i.href;let s=i.protocol==="wss:",a=i.protocol==="ws+unix:",c;if(i.protocol!=="ws:"&&!s&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"),c){let m=new SyntaxError(c);if(t._redirects===0)throw m;e$(t,m);return}let u=s?443:80,l=kye(16).toString("base64"),d=s?wye.request:xye.request,p=new Set,f;if(o.createConnection=o.createConnection||(s?Uye:qye),o.defaultPort=o.defaultPort||u,o.port=i.port||u,o.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},o.path=i.pathname+i.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(f=new Ba(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=zye({[Ba.extensionName]:f.offer()})),r.length){for(let m of r){if(typeof m!="string"||!Dye.test(m)||p.has(m))throw new SyntaxError("An invalid or duplicated subprotocol was specified");p.add(m)}o.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(i.username||i.password)&&(o.auth=`${i.username}:${i.password}`),a){let m=o.path.split(":");o.socketPath=m[0],o.path=m[1]}let h;if(o.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=s,t._originalHostOrSocketPath=a?o.socketPath:i.host;let m=n&&n.headers;if(n={...n,headers:{}},m)for(let[y,v]of Object.entries(m))n.headers[y.toLowerCase()]=v}else if(t.listenerCount("redirect")===0){let m=a?t._originalIpc?o.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:i.host===t._originalHostOrSocketPath;(!m||t._originalSecure&&!s)&&(delete o.headers.authorization,delete o.headers.cookie,m||delete o.headers.host,o.auth=void 0)}o.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),h=t._req=d(o),t._redirects&&t.emit("redirect",t.url,h)}else h=t._req=d(o);o.timeout&&h.on("timeout",()=>{Xn(t,h,"Opening handshake has timed out")}),h.on("error",m=>{h===null||h[_G]||(h=t._req=null,e$(t,m))}),h.on("response",m=>{let y=m.headers.location,v=m.statusCode;if(y&&o.followRedirects&&v>=300&&v<400){if(++t._redirects>o.maxRedirects){Xn(t,h,"Maximum redirects exceeded");return}h.abort();let b;try{b=new vD(y,e)}catch{let C=new SyntaxError(`Invalid URL: ${y}`);e$(t,C);return}bG(t,b,r,n)}else t.emit("unexpected-response",h,m)||Xn(t,h,`Unexpected server response: ${m.statusCode}`)}),h.on("upgrade",(m,y,v)=>{if(t.emit("upgrade",m),t.readyState!==Wt.CONNECTING)return;h=t._req=null;let b=m.headers.upgrade;if(b===void 0||b.toLowerCase()!=="websocket"){Xn(t,y,"Invalid Upgrade header");return}let x=$ye("sha1").update(l+Iye).digest("base64");if(m.headers["sec-websocket-accept"]!==x){Xn(t,y,"Invalid Sec-WebSocket-Accept header");return}let C=m.headers["sec-websocket-protocol"],$;if(C!==void 0?p.size?p.has(C)||($="Server sent an invalid subprotocol"):$="Server sent a subprotocol but none was requested":p.size&&($="Server sent no subprotocol"),$){Xn(t,y,$);return}C&&(t._protocol=C);let L=m.headers["sec-websocket-extensions"];if(L!==void 0){if(!f){Xn(t,y,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let xe;try{xe=Rye(L)}catch{Xn(t,y,"Invalid Sec-WebSocket-Extensions header");return}let ve=Object.keys(xe);if(ve.length!==1||ve[0]!==Ba.extensionName){Xn(t,y,"Server indicated an extension that was not requested");return}try{f.accept(xe[Ba.extensionName])}catch{Xn(t,y,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[Ba.extensionName]=f}t.setSocket(y,v,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(h,t):h.end()}function e$(t,e){t._readyState=Wt.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function qye(t){return t.path=t.socketPath,yG.connect(t)}function Uye(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=yG.isIP(t.host)?"":t.host),Sye.connect(t)}function Xn(t,e,r){t._readyState=Wt.CLOSING;let n=new Error(r);Error.captureStackTrace(n,Xn),e.setHeader?(e[_G]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(e$,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function wD(t,e,r){if(e){let n=Cye(e)?e.size:Mye(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${Rs[t.readyState]})`);process.nextTick(r,n)}}function Bye(t,e){let r=this[Tr];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[Tr]!==void 0&&(r._socket.removeListener("data",t$),process.nextTick(wG,r._socket),t===1005?r.close():r.close(t,e))}function Lye(){let t=this[Tr];t.isPaused||t._socket.resume()}function Zye(t){let e=this[Tr];e._socket[Tr]!==void 0&&(e._socket.removeListener("data",t$),process.nextTick(wG,e._socket),e.close(t[Oye])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function gG(){this[Tr].emitClose()}function Vye(t,e){this[Tr].emit("message",t,e)}function Fye(t){let e=this[Tr];e._autoPong&&e.pong(t,!this._isServer,vG),e.emit("ping",t)}function Hye(t){this[Tr].emit("pong",t)}function wG(t){t.resume()}function Kye(t){let e=this[Tr];e.readyState!==Wt.CLOSED&&(e.readyState===Wt.OPEN&&(e._readyState=Wt.CLOSING,xG(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function xG(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),t._closeTimeout)}function SG(){let t=this[Tr];if(this.removeListener("close",SG),this.removeListener("data",t$),this.removeListener("end",kG),t._readyState=Wt.CLOSING,!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&this._readableState.length!==0){let e=this.read(this._readableState.length);t._receiver.write(e)}t._receiver.end(),this[Tr]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",gG),t._receiver.on("finish",gG))}function t$(t){this[Tr]._receiver.write(t)||this.pause()}function kG(){let t=this[Tr];t._readyState=Wt.CLOSING,t._receiver.end(),this.end()}function $G(){let t=this[Tr];this.removeListener("error",$G),this.on("error",vG),t&&(t._readyState=Wt.CLOSING,this.destroy())}});var IG=g((zNe,TG)=>{"use strict";var NNe=r$(),{Duplex:Wye}=require("stream");function PG(t){t.emit("close")}function Gye(){!this.destroyed&&this._writableState.finished&&this.destroy()}function CG(t){this.removeListener("error",CG),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function Jye(t,e){let r=!0,n=new Wye({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(i,s){let a=!s&&n._readableState.objectMode?i.toString():i;n.push(a)||t.pause()}),t.once("error",function(i){n.destroyed||(r=!1,n.destroy(i))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(o,i){if(t.readyState===t.CLOSED){i(o),process.nextTick(PG,n);return}let s=!1;t.once("error",function(c){s=!0,i(c)}),t.once("close",function(){s||i(o),process.nextTick(PG,n)}),r&&t.terminate()},n._final=function(o){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(o)});return}t._socket!==null&&(t._socket._writableState.finished?(o(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){o()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(o,i,s){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(o,i,s)});return}t.send(o,s)},n.on("end",Gye),n.on("error",CG),n}TG.exports=Jye});var OG=g((RNe,EG)=>{"use strict";var{tokenChars:Xye}=of();function Yye(t){let e=new Set,r=-1,n=-1,o=0;for(o;o<t.length;o++){let s=t.charCodeAt(o);if(n===-1&&Xye[s]===1)r===-1&&(r=o);else if(o!==0&&(s===32||s===9))n===-1&&r!==-1&&(n=o);else if(s===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${o}`);n===-1&&(n=o);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let i=t.slice(r,o);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}EG.exports={parse:Yye}});var qG=g((DNe,DG)=>{"use strict";var Qye=require("events"),n$=require("http"),{Duplex:MNe}=require("stream"),{createHash:eve}=require("crypto"),jG=yD(),Gu=Qv(),tve=OG(),rve=r$(),{CLOSE_TIMEOUT:nve,GUID:ove,kWebSocket:ive}=js(),sve=/^[+/0-9A-Za-z]{22}==$/,NG=0,zG=1,MG=2,xD=class extends Qye{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:nve,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:rve,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=n$.createServer((n,o)=>{let i=n$.STATUS_CODES[426];o.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),o.end(i)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=ave(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,i,s)=>{this.handleUpgrade(o,i,s,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=NG}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===MG){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(n_,this);return}if(e&&this.once("close",e),this._state!==zG)if(this._state=zG,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(n_,this):process.nextTick(n_,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{n_(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,o){r.on("error",RG);let i=e.headers["sec-websocket-key"],s=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){Ju(this,e,r,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){Ju(this,e,r,400,"Invalid Upgrade header");return}if(i===void 0||!sve.test(i)){Ju(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){Ju(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){o_(r,400);return}let c=e.headers["sec-websocket-protocol"],u=new Set;if(c!==void 0)try{u=tve.parse(c)}catch{Ju(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let l=e.headers["sec-websocket-extensions"],d={};if(this.options.perMessageDeflate&&l!==void 0){let p=new Gu(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let f=jG.parse(l);f[Gu.extensionName]&&(p.accept(f[Gu.extensionName]),d[Gu.extensionName]=p)}catch{Ju(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let p={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(p,(f,h,m,y)=>{if(!f)return o_(r,h||401,m,y);this.completeUpgrade(d,i,u,e,r,n,o)});return}if(!this.options.verifyClient(p))return o_(r,401)}this.completeUpgrade(d,i,u,e,r,n,o)}completeUpgrade(e,r,n,o,i,s,a){if(!i.readable||!i.writable)return i.destroy();if(i[ive])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>NG)return o_(i,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${eve("sha1").update(r+ove).digest("base64")}`],l=new this.options.WebSocket(null,void 0,this.options);if(n.size){let d=this.options.handleProtocols?this.options.handleProtocols(n,o):n.values().next().value;d&&(u.push(`Sec-WebSocket-Protocol: ${d}`),l._protocol=d)}if(e[Gu.extensionName]){let d=e[Gu.extensionName].params,p=jG.format({[Gu.extensionName]:[d]});u.push(`Sec-WebSocket-Extensions: ${p}`),l._extensions=e}this.emit("headers",u,o),i.write(u.concat(`\r
`).join(`\r
`)),i.removeListener("error",RG),l.setSocket(i,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(l),l.on("close",()=>{this.clients.delete(l),this._shouldEmitClose&&!this.clients.size&&process.nextTick(n_,this)})),a(l,o)}};DG.exports=xD;function ave(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function n_(t){t._state=MG,t.emit("close")}function RG(){this.destroy()}function o_(t,e,r,n){r=r||n$.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${n$.STATUS_CODES[e]}\r
`+Object.keys(n).map(o=>`${o}: ${n[o]}`).join(`\r
`)+`\r
\r
`+r)}function Ju(t,e,r,n,o,i){if(t.listenerCount("wsClientError")){let s=new Error(o);Error.captureStackTrace(s,Ju),t.emit("wsClientError",s,r,e)}else o_(r,n,o,i)}});var VG={};To(VG,{Receiver:()=>BG.default,Sender:()=>LG.default,WebSocket:()=>SD.default,WebSocketServer:()=>ZG.default,createWebSocketStream:()=>UG.default,default:()=>cve});var UG,BG,LG,SD,ZG,cve,FG=A(()=>{UG=It(IG(),1),BG=It(pD(),1),LG=It(hD(),1),SD=It(r$(),1),ZG=It(qG(),1),cve=SD.default});var mve={};To(mve,{activate:()=>pve,deactivate:()=>fve});module.exports=I(mve);var le=It(require("vscode"));var Sr=require("crypto"),kD=require("http"),KG=require("https"),Yu=It(require("os")),P=It(require("vscode")),lf=It(require("fs")),$D=It(require("path"));var Io=It(require("fs")),rl=It(require("path")),MD=It(require("vscode")),p_=class{storageDir;writeQueue=[];flushInterval;FLUSH_MS=2e3;context;cachedLifetimeStats=null;dailyStatsCache=null;DAILY_STATS_CACHE_TTL_MS=3e4;constructor(e){this.context=e,this.storageDir=rl.join(e.globalStorageUri.fsPath,"audit_logs"),this.initAsync()}async initAsync(){await this.ensureStorageDir(),this.startPeriodicFlush(),this.cleanupOldLogs().catch(e=>{})}async cleanupOldLogs(){let r=MD.workspace.getConfiguration("githubCopilotApi.audit").get("retentionDays",30);if(!(r<=0))try{let n=await Io.promises.readdir(this.storageDir),o=Date.now(),i=r*24*60*60*1e3;for(let s of n){if(!s.startsWith("audit-")||!s.endsWith(".jsonl"))continue;let a=s.slice(6,-6),c=new Date(a).getTime();if(!isNaN(c)&&o-c>i){let u=rl.join(this.storageDir,s);await Io.promises.unlink(u)}}}catch{}}async ensureStorageDir(){try{await Io.promises.mkdir(this.storageDir,{recursive:!0})}catch(e){e.code}}async logRequest(e){this.writeQueue.push(e),this.cachedLifetimeStats&&(this.cachedLifetimeStats.totalRequests++,this.cachedLifetimeStats.totalTokensIn+=e.tokensIn||0,this.cachedLifetimeStats.totalTokensOut+=e.tokensOut||0,this.cachedLifetimeStats.totalRequests%10===0&&this.context.globalState.update("lifetimeStats",this.cachedLifetimeStats))}startPeriodicFlush(){this.flushInterval&&clearInterval(this.flushInterval),this.flushInterval=setInterval(()=>this.flush(),this.FLUSH_MS)}async flush(){if(this.writeQueue.length===0)return;let e=[...this.writeQueue];this.writeQueue=[];let r=new Map;for(let n of e){let o=n.timestamp.split("T")[0];r.has(o)||r.set(o,[]),r.get(o).push(n)}for(let[n,o]of r){let i=rl.join(this.storageDir,`audit-${n}.jsonl`),s=o.map(a=>JSON.stringify(a)).join(`
`)+`
`;try{await Io.promises.appendFile(i,s,"utf8")}catch{}}}async getDailyStats(e=30){if(this.dailyStatsCache&&this.dailyStatsCache.days===e&&Date.now()-this.dailyStatsCache.timestamp<this.DAILY_STATS_CACHE_TTL_MS)return this.dailyStatsCache.data;let r=[],n=new Date;for(let i=0;i<e;i++){let s=new Date(n);s.setDate(s.getDate()-i);let a=s.toISOString().split("T")[0],c=rl.join(this.storageDir,`audit-${a}.jsonl`),u=!1;try{await Io.promises.access(c),u=!0}catch{u=!1}if(u)try{let d=(await Io.promises.readFile(c,"utf8")).trim().split(`
`),p=0,f=0,h=0,m=0,y=0,v=new Set;for(let b of d)if(b)try{let x=JSON.parse(b);p++,f+=x.durationMs,x.tokensIn&&(h+=x.tokensIn),x.tokensOut&&(m+=x.tokensOut),x.status>=400&&y++,x.ip&&v.add(x.ip)}catch{}r.push({date:a,totalRequests:p,avgLatency:p>0?Math.round(f/p):0,tokensIn:h,tokensOut:m,totalTokens:h+m,errorCount:y,uniqueIps:v.size})}catch{}else r.push({date:a,totalRequests:0,avgLatency:0,tokensIn:0,tokensOut:0,totalTokens:0,errorCount:0,uniqueIps:0})}let o=r.sort((i,s)=>i.date.localeCompare(s.date));return this.dailyStatsCache={data:o,timestamp:Date.now(),days:e},o}async getTodayStats(){let e=await this.getDailyStats(1);if(e.length>0){let r=new Date().toISOString().split("T")[0];if(e[e.length-1].date===r)return e[e.length-1]}return{date:new Date().toISOString().split("T")[0],totalRequests:0,avgLatency:0,tokensIn:0,tokensOut:0,totalTokens:0,errorCount:0,uniqueIps:0}}async getLogEntries(e=1,r=10){try{if(!Io.existsSync(this.storageDir))return{total:0,entries:[]};let o=(await Io.promises.readdir(this.storageDir)).filter(u=>u.startsWith("audit-")&&u.endsWith(".jsonl")).sort().reverse(),i=[];for(let u of o.slice(0,14))try{let l=await Io.promises.readFile(rl.join(this.storageDir,u),"utf8"),d=[];l.split(`
`).forEach(p=>{if(p.trim())try{let f=JSON.parse(p);f&&f.timestamp&&d.push(f)}catch{}}),i=i.concat(d.reverse())}catch{}i.sort((u,l)=>new Date(l.timestamp).getTime()-new Date(u.timestamp).getTime());let s=i.length,a=(e-1)*r,c=a+r;return{total:s,entries:i.slice(a,c)}}catch{return{total:0,entries:[]}}}getLogFolderPath(){return this.storageDir}async getLifetimeStats(){if(this.cachedLifetimeStats)return this.cachedLifetimeStats;let e=this.context.globalState.get("lifetimeStats");if(e)return this.cachedLifetimeStats=e,e;let r=await this.getDailyStats(365);return this.cachedLifetimeStats=r.reduce((n,o)=>({totalRequests:n.totalRequests+o.totalRequests,totalTokensIn:n.totalTokensIn+o.tokensIn,totalTokensOut:n.totalTokensOut+o.tokensOut}),{totalRequests:0,totalTokensIn:0,totalTokensOut:0}),await this.context.globalState.update("lifetimeStats",this.cachedLifetimeStats),this.cachedLifetimeStats}dispose(){this.flushInterval&&(clearInterval(this.flushInterval),this.flush())}};var uve="GitHub.copilot-chat",lve="@id:GitHub.copilot-chat",K=class extends Error{constructor(r,n,o,i,s){super(n);this.status=r;this.type=o;this.code=i;this.details=s;this.name="ApiError"}},dve=[{id:"ssn",name:"US Social Security",pattern:"\\b\\d{3}-\\d{2}-\\d{4}\\b",enabled:!1,isBuiltin:!0},{id:"credit-card",name:"Credit/Debit Card",pattern:"\\b(?:\\d{4}[- ]?){3}\\d{4}\\b",enabled:!1,isBuiltin:!0},{id:"aadhaar",name:"Aadhaar Number",pattern:"\\b\\d{4}\\s?\\d{4}\\s?\\d{4}\\b",enabled:!1,isBuiltin:!0},{id:"passport-in",name:"Indian Passport",pattern:"\\b[A-Z]\\d{7}\\b",enabled:!1,isBuiltin:!0},{id:"passport-us",name:"US Passport",pattern:"\\b\\d{9}\\b",enabled:!1,isBuiltin:!0},{id:"email",name:"Email Address",pattern:"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}",enabled:!1,isBuiltin:!0},{id:"url",name:"URLs",pattern:"https?://[^\\s]+",enabled:!1,isBuiltin:!0},{id:"phone-us",name:"US Phone Number",pattern:"\\b\\d{3}[-.]?\\d{3}[-.]?\\d{4}\\b",enabled:!1,isBuiltin:!0},{id:"phone-in",name:"Indian Phone",pattern:"\\b[6-9]\\d{9}\\b",enabled:!1,isBuiltin:!0},{id:"api-key",name:"API Keys",pattern:"(sk-[a-zA-Z0-9]{20,})|(api[_-]?key[=:]\\s*[\\w-]+)",enabled:!1,isBuiltin:!0},{id:"password-json",name:"Passwords in JSON",pattern:'"password"\\s*:\\s*"[^"]*"',enabled:!1,isBuiltin:!0},{id:"bearer-token",name:"Bearer Tokens",pattern:"Bearer\\s+[A-Za-z0-9\\-._~+/]+=*",enabled:!1,isBuiltin:!0}],o$=class{constructor(e,r,n){this.output=e;this.statusItem=r;this.context=n,this.auditService=new p_(n);let o=P.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("githubCopilotApi.server")){if(this.suppressRestart)return;this.restart().catch(s=>{this.logError("Failed to restart API server after configuration change",s)})}});this.disposables.push(o),this.initializeStats().catch(i=>{}),setImmediate(()=>this.loadHistory())}httpServer;wsServer;disposables=[];config=HG();disposed=!1;activeRequests=0;isHttps=!1;suppressRestart=!1;_onDidChangeStatus=new P.EventEmitter;onDidChangeStatus=this._onDidChangeStatus.event;_onDidLogRequest=new P.EventEmitter;onDidLogRequest=this._onDidLogRequest.event;_onDidLogRequestStart=new P.EventEmitter;onDidLogRequestStart=this._onDidLogRequestStart.event;domainCache=new Map;domainRefreshInterval;usageStats={totalRequests:0,totalTokensIn:0,totalTokensOut:0,requestsByEndpoint:{},startTime:Date.now()};realtimeStats={requestsPerMinute:0,avgLatencyMs:0,latencyHistory:[],tokensPerMinute:0,errorRate:0,lastMinuteRequests:[],lastMinuteErrors:0};requestHistory=[];connections=new Set;isShuttingDown=!1;MAX_HISTORY_SIZE=100;context;rateLimitBucket=[];requestCache=new Map;CACHE_TTL_MS=5e3;statsInterval;activeConnectionsPerIp=new Map;auditService;mcpService;mcpInitPromise;async initializeStats(){try{let e=await this.auditService.getLifetimeStats();this.usageStats.totalRequests=e.totalRequests,this.usageStats.totalTokensIn=e.totalTokensIn,this.usageStats.totalTokensOut=e.totalTokensOut}catch{}}async ensureMcpService(){if(P.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0))return this.mcpService?this.mcpService:(this.mcpInitPromise||(this.mcpInitPromise=(async()=>{let{McpService:r}=await Promise.resolve().then(()=>(B9(),U9));this.mcpService=new r(this.output),await this.mcpService.initialize()})()),await this.mcpInitPromise,this.mcpService)}async getStatus(){return{running:!!this.httpServer,isHttps:this.isHttps,config:this.config,activeRequests:this.activeRequests,networkInfo:this.getNetworkInfo(),stats:this.getStats(),realtimeStats:this.realtimeStats,historyCount:this.requestHistory.length,mcp:this.getMcpStatus(),copilot:await this.getCopilotHealth()}}async getCopilotHealth(){let e=P.extensions.all,r=e.find(s=>s.id.toLowerCase()==="github.copilot"||s.id.toLowerCase()==="github.copilot-nightly"||s.packageJSON?.publisher==="GitHub"&&s.packageJSON?.name==="copilot"),n=e.find(s=>s.id.toLowerCase()==="github.copilot-chat"||s.packageJSON?.publisher==="GitHub"&&s.packageJSON?.name==="copilot-chat"),o=!1;try{let s=await P.lm.selectChatModels({vendor:"copilot"});o=s&&s.length>0}catch{o=!1}return{installed:!!r||o,chatInstalled:!!n||o,signedIn:o,ready:o||!!r&&!!n&&o}}getMcpStatus(){return{enabled:P.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0),servers:this.mcpService?.getConnectedServers()??[],tools:this.mcpService?.getTools()??[]}}getStats(){return{...this.usageStats,uptimeMs:Date.now()-this.usageStats.startTime,avgLatencyMs:this.realtimeStats.avgLatencyMs,requestsPerMinute:this.realtimeStats.requestsPerMinute,errorRate:this.realtimeStats.errorRate,mcp:this.getMcpStatus()}}getHistory(e){let r=[...this.requestHistory].reverse();return e?r.slice(0,e):r}async getDailyStats(e){return this.auditService.getDailyStats(e)}async getAuditLogs(e,r){return this.auditService.getLogEntries(e,r)}getLogFolderPath(){return this.auditService.getLogFolderPath()}clearHistory(){this.requestHistory=[],this.saveHistory(),this._onDidChangeStatus.fire()}loadHistory(){if(!this.context)return;let e=this.context.globalState.get("requestHistory",[]);this.requestHistory=e.slice(-this.MAX_HISTORY_SIZE)}saveHistory(){this.context&&this.context.globalState.update("requestHistory",this.requestHistory.slice(-this.MAX_HISTORY_SIZE))}addHistoryEntry(e){let r=this.redactSensitiveData(e);this.requestHistory.push(r),this.requestHistory.length>this.MAX_HISTORY_SIZE&&(this.requestHistory=this.requestHistory.slice(-this.MAX_HISTORY_SIZE)),this.requestHistory.length%10===0&&this.saveHistory(),this._onDidChangeStatus.fire()}redactSensitiveData(e){let r=this.config.redactionPatterns.filter(i=>i.enabled);if(!r.length)return e;let n=i=>{let s=i;for(let a of r)try{let c=new RegExp(a.pattern,"gi");s=s.replace(c,"[REDACTED]")}catch{}return s},o=i=>{if(typeof i=="string")return n(i);if(Array.isArray(i))return i.map(o);if(i&&typeof i=="object"){let s={};for(let[a,c]of Object.entries(i))s[a]=o(c);return s}return i};return o(e)}redactMessagesContent(e){let r=this.config.redactionPatterns.filter(o=>o.enabled);if(!r.length)return e;let n=o=>{let i=o;for(let s of r)try{let a=new RegExp(s.pattern,"gi");i=i.replace(a,"[REDACTED]")}catch{}return i};return e.map(o=>{let i=o.content;return typeof i=="string"?i=n(i):Array.isArray(i)&&(i=i.map(s=>typeof s=="string"?n(s):s&&typeof s=="object"&&typeof s.text=="string"?{...s,text:n(s.text)}:s)),{...o,content:i}})}redactPromptString(e){let r=this.config.redactionPatterns.filter(o=>o.enabled);if(!r.length)return e;let n=e;for(let o of r)try{let i=new RegExp(o.pattern,"gi");n=n.replace(i,"[REDACTED]")}catch{}return n}startStatsUpdater(){this.statsInterval=setInterval(()=>{this.updateRealtimeStats(),this._onDidChangeStatus.fire()},5e3)}startDomainCacheRefresh(){this.refreshDomainCache(),this.domainRefreshInterval=setInterval(()=>{this.refreshDomainCache()},300*1e3)}updateRealtimeStats(){let r=Date.now()-6e4;if(this.realtimeStats.latencyHistory=this.realtimeStats.latencyHistory.filter(n=>n.timestamp>r),this.realtimeStats.lastMinuteRequests=this.realtimeStats.lastMinuteRequests.filter(n=>n>r),this.realtimeStats.requestsPerMinute=this.realtimeStats.lastMinuteRequests.length,this.realtimeStats.latencyHistory.length>0){let n=this.realtimeStats.latencyHistory.reduce((o,i)=>o+i.latency,0);this.realtimeStats.avgLatencyMs=Math.round(n/this.realtimeStats.latencyHistory.length)}else this.realtimeStats.avgLatencyMs=0;this.realtimeStats.lastMinuteRequests.length>0?this.realtimeStats.errorRate=Math.round(this.realtimeStats.lastMinuteErrors/this.realtimeStats.lastMinuteRequests.length*100):this.realtimeStats.errorRate=0,this.realtimeStats.lastMinuteRequests.length===0&&(this.realtimeStats.lastMinuteErrors=0)}recordRequestStats(e,r,n,o){let i=Date.now();this.usageStats.totalRequests++,this.usageStats.totalTokensIn+=r,this.usageStats.totalTokensOut+=n,this.realtimeStats.lastMinuteRequests.push(i),this.realtimeStats.latencyHistory.push({timestamp:i,latency:e}),o&&this.realtimeStats.lastMinuteErrors++,this.realtimeStats.tokensPerMinute=Math.round((this.usageStats.totalTokensIn+this.usageStats.totalTokensOut)/Math.max(1,(i-this.usageStats.startTime)/6e4))}async addRedactionPattern(e,r){try{new RegExp(r);let n=this.config.redactionPatterns,i={id:`custom-${Date.now()}`,name:e,pattern:r,enabled:!0,isBuiltin:!1};return await this.updateServerConfig({redactionPatterns:[...n,i]}),!0}catch{return!1}}async removeRedactionPattern(e){let r=this.config.redactionPatterns.filter(n=>n.id!==e);await this.updateServerConfig({redactionPatterns:r})}async toggleRedactionPattern(e,r){let n=this.config.redactionPatterns.map(o=>o.id===e?{...o,enabled:r}:o);await this.updateServerConfig({redactionPatterns:n})}getRedactionPatterns(){return[...this.config.redactionPatterns]}async addIpAllowlistEntry(e){let r=e.trim();if(!r)return!1;let n=/^[\d\.\/]+$|^[\da-fA-F:\/]+$/.test(r),o=/^[a-zA-Z0-9]([a-zA-Z0-9\-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]*[a-zA-Z0-9])?)+$/.test(r);if(!n&&!o)return!1;let i=[...this.config.ipAllowlist,r];return await P.workspace.getConfiguration("githubCopilotApi").update("server.ipAllowlist",i,P.ConfigurationTarget.Global),!0}async removeIpAllowlistEntry(e){let r=this.config.ipAllowlist.filter(n=>n!==e);await this.updateServerConfig({ipAllowlist:r})}getNetworkInfo(){if(this.config.host!=="0.0.0.0")return null;let e=Yu.hostname(),r=[],n=Yu.networkInterfaces();for(let o of Object.keys(n)){let i=n[o];if(i)for(let s of i)!s.internal&&s.family==="IPv4"&&r.push(s.address)}return{hostname:e,localIPs:r}}async startServer(){await this.updateServerConfig({enabled:!0})}async stopServer(){await this.updateServerConfig({enabled:!1})}async toggleHttp(){await this.updateServerConfig({enableHttp:!this.config.enableHttp,enabled:!0})}async toggleWebSocket(){await this.updateServerConfig({enableWebSocket:!this.config.enableWebSocket,enabled:!0})}async toggleLogging(){await this.updateServerConfig({enableLogging:!this.config.enableLogging})}getAuditService(){return this.auditService}getServerStatus(){return{activeConnections:this.connections.size}}async toggleHttps(){await this.updateServerConfig({enableHttps:!this.config.enableHttps,enabled:!0})}async setApiKey(e){let r=(e??"").trim();await this.updateServerConfig({apiKey:r})}async setRateLimit(e){let r=Number.isFinite(e)?Math.max(0,Math.floor(e)):60;await this.updateServerConfig({rateLimitPerMinute:r})}getVersion(){return this.context?.extension.packageJSON.version||"0.0.1"}async setHost(e){let r=(e??"").trim();r&&await this.updateServerConfig({host:r,enabled:!0})}async setPort(e){let r=Number.isFinite(e)?Math.max(1,Math.min(65535,Math.floor(e))):this.config.port;await this.updateServerConfig({port:r,enabled:!0})}async toggleMcp(e){this.suppressRestart=!0,await P.workspace.getConfiguration("githubCopilotApi.mcp").update("enabled",e,P.ConfigurationTarget.Global),e&&await(await this.ensureMcpService())?.refreshServers(),this.config.mcpEnabled=e,this.suppressRestart=!1}async setDefaultModel(e){let r=(e??"").trim();r&&await this.updateServerConfig({defaultModel:r,enabled:!0})}async setRequestTimeout(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):180;await this.updateServerConfig({requestTimeoutSeconds:r})}async setMaxPayloadSize(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):1;await this.updateServerConfig({maxPayloadSizeMb:r})}async setMaxConnectionsPerIp(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):10;await this.updateServerConfig({maxConnectionsPerIp:r})}async setMaxConcurrency(e){let r=Number.isFinite(e)?Math.max(1,Math.floor(e)):4;await this.updateServerConfig({maxConcurrentRequests:r})}async start(){if(this.disposed)return;if(this.startStatsUpdater(),this.startDomainCacheRefresh(),await this.stop(),this.config=HG(),!this.config.enabled){this.updateStatusBar("stopped","Server disabled in settings"),this._onDidChangeStatus.fire();return}this.updateStatusBar("starting"),this._onDidChangeStatus.fire();let e=(o,i)=>{this.connections.add(i),i.on("close",()=>this.connections.delete(i));let s=Date.now(),a=(0,Sr.randomUUID)().slice(0,8);this._onDidLogRequestStart.fire({requestId:a,method:o.method||"UNKNOWN",path:o.url||"/",timestamp:new Date().toISOString()}),this.handleHttpRequest(o,i,a,s).catch(c=>{let u=Date.now()-s;c instanceof K?(this.logRequest(a,o.method||"UNKNOWN",o.url||"/",c.status,u,{error:c.message,requestHeaders:o.headers}),this.sendError(i,c)):(this.logRequest(a,o.method||"UNKNOWN",o.url||"/",500,u,{error:c instanceof Error?c.message:String(c),requestHeaders:o.headers}),this.logError("Unhandled error in HTTP request handler",c),this.sendError(i,new K(500,"An unexpected error occurred.","server_error")))}).finally(()=>{this.activeRequests--,this._onDidChangeStatus.fire()}),this.activeRequests++,this._onDidChangeStatus.fire()},r=!1;if(this.config.enableHttps)try{let o=null;if(this.config.tlsCertPath&&this.config.tlsKeyPath){let i=this.config.tlsCertPath.startsWith("~")?$D.join(Yu.homedir(),this.config.tlsCertPath.slice(1)):this.config.tlsCertPath,s=this.config.tlsKeyPath.startsWith("~")?$D.join(Yu.homedir(),this.config.tlsKeyPath.slice(1)):this.config.tlsKeyPath;lf.existsSync(i)&&lf.existsSync(s)&&(o={cert:lf.readFileSync(i),key:lf.readFileSync(s)},this.logInfo(`HTTPS enabled with certificate from ${i}`))}if(!o){let i=zW(),s=[{name:"commonName",value:"localhost"}],a=i.generate(s,{days:365,keySize:2048,algorithm:"sha256"});o={cert:a.cert,key:a.private},this.logInfo("HTTPS enabled with auto-generated self-signed certificate (valid 365 days)")}this.httpServer=(0,KG.createServer)(o,e),r=!0}catch(o){this.logError("Failed to setup HTTPS, falling back to HTTP",o),this.httpServer=(0,kD.createServer)(e)}else this.httpServer=(0,kD.createServer)(e);if(this.isHttps=r,this.httpServer.on("error",o=>{this.logError("HTTP server error",o)}),this.config.enableWebSocket){let{WebSocketServer:o}=await Promise.resolve().then(()=>(FG(),VG));this.wsServer=new o({noServer:!0}),this.wsServer.on("error",s=>{this.logError("WebSocket server error",s)});let i=["/v1/realtime","/anthropic/v1/realtime","/google/v1/realtime","/llama/v1/realtime"];this.httpServer.on("upgrade",(s,a,c)=>{if(!s.url){a.destroy();return}let u=this.buildUrl(s.url),l=i.find(d=>u.pathname===d);l?this.wsServer?.handleUpgrade(s,a,c,d=>{d._endpoint=l,this.handleWebSocketConnection(d,l)}):a.destroy()})}await new Promise((o,i)=>{let s=a=>{this.httpServer?.off("error",s),i(a)};this.httpServer?.once("error",s),this.httpServer?.listen(this.config.port,this.config.host,()=>{this.httpServer?.off("error",s),o()})});let n=this.httpServer.address();if(n){let i=`${r?"https":"http"}://${n.address}:${n.port}`;this.logInfo(`${r?"HTTPS":"HTTP"} server listening on ${i}`),this.updateStatusBar("running",`${r?"HTTPS":"HTTP"}${this.config.enableWebSocket?"+WS":""} on ${i}`),this._onDidChangeStatus.fire()}}async restart(){this.disposed||(this.logInfo("Restarting API server to apply configuration changes..."),await this.start())}async stop(){this.wsServer&&await new Promise(e=>{for(let r of this.wsServer?.clients??[])r.close(1001,"Server shutting down");this.wsServer?.close(()=>e())}),this.httpServer&&await new Promise((e,r)=>{this.httpServer?.close(n=>{n?r(n):e()})}),this.httpServer=void 0,this.wsServer=void 0,this.activeRequests=0,this.updateStatusBar("stopped"),this._onDidChangeStatus.fire()}async dispose(){if(this.disposed=!0,this.isShuttingDown=!0,this.logInfo("Shutting down API Gateway..."),this.statsInterval&&(clearInterval(this.statsInterval),this.statsInterval=void 0),this.domainRefreshInterval&&(clearInterval(this.domainRefreshInterval),this.domainRefreshInterval=void 0),this.saveHistory(),this.activeRequests>0){this.logInfo(`Waiting for ${this.activeRequests} active requests to complete...`);let e=0;for(;this.activeRequests>0&&e<3e3;)await new Promise(r=>setTimeout(r,100)),e+=100;this.activeRequests>0&&this.logInfo(`Forcing close of ${this.activeRequests} remaining requests.`)}for(let e of this.connections)e.writableEnded||(e.writeHead(503,{"Content-Type":"application/json"}),e.end(JSON.stringify({error:{message:"Server is shutting down",type:"service_unavailable"}})));this.connections.clear(),await this.stop().catch(e=>{this.logError("Failed to stop API server during dispose",e)});for(let e of this.disposables.splice(0))e.dispose();await this.mcpService?.dispose(),this._onDidChangeStatus.dispose(),this.logInfo("API Gateway shut down successfully.")}async handleHttpRequest(e,r,n,o){if(this.isShuttingDown){r.writeHead(503,{"Content-Type":"application/json"}),r.end(JSON.stringify({error:{message:"Server is shutting down",type:"service_unavailable"}}));return}if(this.setCorsHeaders(r),r.setHeader("X-Request-ID",n),e.method==="OPTIONS"){r.writeHead(204),r.end();return}if(!this.config.enableHttp)throw new K(503,"HTTP API is disabled. Enable it from the Copilot API controls.","service_unavailable","http_disabled");let i=this.buildUrl(e.url),s=this.getClientIp(e),a=this.activeConnectionsPerIp.get(s)||0;if(a>=this.config.maxConnectionsPerIp)throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,429,Date.now()-o,{requestHeaders:e.headers}),new K(429,`Too many connections from your IP. Maximum ${this.config.maxConnectionsPerIp} concurrent connections allowed.`,"rate_limit_error","too_many_connections");if(this.activeConnectionsPerIp.set(s,a+1),r.on("close",()=>{let p=this.activeConnectionsPerIp.get(s)||1;p<=1?this.activeConnectionsPerIp.delete(s):this.activeConnectionsPerIp.set(s,p-1)}),this.config.apiKey&&i.pathname!=="/health"){let p=e.headers.authorization;if((p?.startsWith("Bearer ")?p.slice(7):null)!==this.config.apiKey)throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,401,Date.now()-o,{requestHeaders:e.headers}),new K(401,"Invalid or missing API key. Provide a valid Bearer token.","authentication_error","invalid_api_key")}if(!this.checkRateLimit()){this.logRequest(n,e.method||"UNKNOWN",i.pathname,429,Date.now()-o,{requestHeaders:e.headers});let p=this.rateLimitBucket.length>0?this.rateLimitBucket[0]:Date.now(),f=Math.ceil((p+6e4-Date.now())/1e3);throw new K(429,`Rate limit exceeded (${this.config.rateLimitPerMinute} requests/min). Please wait ${f>0?f:1} seconds before retrying.`,"rate_limit_error","rate_limit_exceeded")}if(!this.checkIpAllowlist(e))throw this.logRequest(n,e.method||"UNKNOWN",i.pathname,403,Date.now()-o,{requestHeaders:e.headers}),new K(403,"Access denied. Your IP address is not allowed.","access_denied","ip_not_allowed");if(this.usageStats.totalRequests++,this.usageStats.requestsByEndpoint[i.pathname]=(this.usageStats.requestsByEndpoint[i.pathname]||0)+1,e.method==="GET"&&i.pathname==="/health"){try{let p=await P.lm.selectChatModels({vendor:"copilot"});p&&p.length>0?this.sendJson(r,200,{status:"ok",service:"github-copilot-api-vscode",copilot:"available",models:p.length}):this.sendJson(r,200,{status:"degraded",service:"github-copilot-api-vscode",copilot:"unavailable",message:"No Copilot models found. Check if GitHub Copilot is installed and signed in."})}catch{this.sendJson(r,200,{status:"degraded",service:"github-copilot-api-vscode",copilot:"error",message:"Failed to check Copilot availability."})}return}if(e.method==="GET"&&i.pathname==="/openapi.json"){this.sendJson(r,200,this.getOpenApiSpec());return}if(e.method==="GET"&&i.pathname==="/docs"){this.sendSwaggerUi(r);return}if(e.method==="GET"&&i.pathname==="/v1/usage"){let p=Math.floor((Date.now()-this.usageStats.startTime)/1e3);this.sendJson(r,200,{object:"usage",total_requests:this.usageStats.totalRequests,total_tokens:{input:this.usageStats.totalTokensIn,output:this.usageStats.totalTokensOut,total:this.usageStats.totalTokensIn+this.usageStats.totalTokensOut},requests_by_endpoint:this.usageStats.requestsByEndpoint,uptime_seconds:p,active_requests:this.activeRequests});return}if(e.method==="GET"&&i.pathname==="/v1/models"){let p=await this.getAvailableModels();this.sendJson(r,200,{object:"list",data:p});return}let c=i.pathname.match(/^\/v1\/models\/(.+)$/);if(e.method==="GET"&&c){let p=decodeURIComponent(c[1]),h=(await this.getAvailableModels()).find(m=>m.id===p);if(!h)throw new K(404,`Model '${p}' not found`,"not_found","model_not_found");this.sendJson(r,200,h);return}if(e.method==="GET"&&i.pathname==="/v1/tools"){let p=await this.ensureMcpService(),f=p?await p.getAllTools():[];this.sendJson(r,200,{object:"list",data:f.map(h=>({type:"function",server:h.serverName,function:{name:h.name,description:h.description||"",parameters:h.inputSchema||{}}}))});return}if(e.method==="POST"&&i.pathname==="/v1/tools/call"){let p=await this.readJsonBody(e),{server:f,name:h,arguments:m}=p||{};if(!f||!h)throw new K(400,"server and name are required","invalid_request_error","missing_params");let y=await this.ensureMcpService();if(!y)throw new K(503,"MCP service not available","service_unavailable","mcp_unavailable");let v=await y.callTool(f,h,m||{});this.sendJson(r,200,{object:"tool_result",server:f,name:h,result:v});return}if(e.method==="GET"&&i.pathname==="/v1/mcp/servers"){let p=await this.ensureMcpService(),f=p?p.getConnectedServers():[],h=p?await p.getAllTools():[],m=f.map(v=>({name:v,status:"connected",tools:h.filter(b=>b.serverName===v).map(b=>b.name)})),y=h.filter(v=>v.serverName==="vscode");y.length>0&&m.push({name:"vscode",status:"built-in",tools:y.map(v=>v.name)}),this.sendJson(r,200,{object:"list",data:m});return}if(e.method==="POST"&&i.pathname==="/v1/mcp/servers/refresh"){let p=await this.ensureMcpService();p&&await p.refreshServers();let f=p?p.getConnectedServers():[];this.sendJson(r,200,{object:"refresh_result",message:"MCP servers refreshed",connected:f});return}if(e.method==="POST"&&i.pathname==="/v1/chat/completions"){let p=await this.readJsonBody(e);if(p?.stream===!0)await this.processStreamingChatCompletion(p,e,r,n,o);else{let f=await this.processChatCompletion(p,{source:"http",endpoint:"/v1/chat/completions"});this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.prompt_tokens,tokensOut:f?.usage?.completion_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}return}if(e.method==="POST"&&i.pathname==="/v1/messages"){let p=await this.readJsonBody(e);if(p?.model&&!this.resolveModel(p.model))throw new K(400,`Model '${p.model}' is not supported.`,"invalid_request_error","model_not_found");if(p?.stream===!0)await this.processStreamingAnthropicMessages(p,e,r,n,o);else try{let f=await this.processAnthropicMessages(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.input_tokens,tokensOut:f?.usage?.output_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}catch(f){let h=f instanceof K?f:new K(500,f.message||"Internal Server Error","api_error");this.sendJson(r,h.status,{type:"error",error:{type:h.code||"api_error",message:h.message}})}return}if(e.method==="POST"&&i.pathname==="/v1/completions"){let p=await this.readJsonBody(e);if(p?.stream===!0)await this.processStreamingCompletion(p,e,r,n,o);else{let f=await this.processCompletion(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.prompt_tokens,tokensOut:f?.usage?.completion_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}return}if(e.method==="POST"&&i.pathname==="/v1/tokenize"){let p=await this.readJsonBody(e),f=await this.processTokenize(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f);return}if(e.method==="POST"&&i.pathname==="/v1/count_tokens"){let p=await this.readJsonBody(e),f=await this.processTokenize(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f);return}if(e.method==="POST"&&i.pathname==="/v1/responses"){let p=await this.readJsonBody(e);if(p?.stream===!0)await this.processStreamingResponsesApi(p,e,r,n,o);else{let f=await this.processResponsesApi(p);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.input_tokens,tokensOut:f?.usage?.output_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}return}let u=i.pathname.match(/^\/v1beta\/models\/(.+):generateContent$/),l=i.pathname.match(/^\/v1beta\/models\/(.+):streamGenerateContent$/);if(e.method==="POST"&&(u||l)){let p=decodeURIComponent((u||l)[1]),f=await this.readJsonBody(e);if(p&&!this.resolveModel(p))throw new K(400,`Model '${p}' is not supported.`,"invalid_request_error","model_not_found");if(l)await this.processStreamingGoogleGenerateContent(p,f,e,r,n,o);else try{let h=await this.processGoogleGenerateContent(p,f);this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:f,responsePayload:h,tokensIn:h?.usageMetadata?.promptTokenCount,tokensOut:h?.usageMetadata?.candidatesTokenCount,model:p,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,h)}catch(h){let m=h instanceof K?h:new K(500,h.message||"Internal Server Error","server_error");this.sendJson(r,m.status,{error:{code:m.status,message:m.message,status:m.code||"INTERNAL"}})}return}if(e.method==="POST"&&i.pathname==="/llama/v1/chat/completions"){let p=await this.readJsonBody(e);if(p?.max_completion_tokens&&!p?.max_tokens&&(p.max_tokens=p.max_completion_tokens),p?.stream===!0)await this.processStreamingChatCompletion(p,e,r,n,o);else{let f=await this.processChatCompletion(p,{source:"http",endpoint:"/llama/v1/chat/completions"});this.logRequest(n,e.method,i.pathname,200,Date.now()-o,{requestPayload:p,responsePayload:f,tokensIn:f?.usage?.prompt_tokens,tokensOut:f?.usage?.completion_tokens,model:p?.model,requestHeaders:e.headers,responseHeaders:r.getHeaders()}),this.sendJson(r,200,f)}return}if(e.method==="POST"&&i.pathname==="/v1/embeddings")throw new K(501,"Embeddings are not supported by Copilot.","not_implemented","embeddings_not_supported");if(i.pathname.startsWith("/v1/images"))throw new K(501,"Image generation is not supported by Copilot.","not_implemented","images_not_supported");if(i.pathname.startsWith("/v1/audio"))throw new K(501,"Audio processing is not supported by Copilot.","not_implemented","audio_not_supported");let d=["/v1/realtime","/anthropic/v1/realtime","/google/v1/realtime","/llama/v1/realtime"];if(e.method==="GET"&&d.includes(i.pathname)){r.writeHead(426,{"Content-Type":"application/json",Upgrade:"websocket"}),r.end(JSON.stringify({error:{message:"This is a WebSocket endpoint. Please use a WebSocket client and Upgrade header.",type:"upgrade_required",code:"websocket_only"}}));return}throw new K(404,`No route for ${e.method??"UNKNOWN"} ${i.pathname}`,"not_found")}async processStreamingGoogleGenerateContent(e,r,n,o,i,s){let a=[];if(r.systemInstruction){let p=r.systemInstruction.parts.map(f=>f.text).join(" ");a.push(P.LanguageModelChatMessage.User(this.redactPromptString(p)))}for(let p of r.contents){let f=p.role==="model"?P.LanguageModelChatMessageRole.Assistant:P.LanguageModelChatMessageRole.User,h=p.parts.map(y=>y.text).join(" "),m=this.redactPromptString(h);f===P.LanguageModelChatMessageRole.User?a.push(P.LanguageModelChatMessage.User(m)):a.push(P.LanguageModelChatMessage.Assistant(m))}let c=this.resolveModel(e),u=a.map(p=>typeof p.content=="string"?p.content:p.content.map(f=>"text"in f?f.text:"").join(" ")).join(`
`);o.writeHead(200,{"Content-Type":"application/json","X-HTTP-Content-Type-Options":"nosniff","Transfer-Encoding":"chunked"});let l="",d=new P.CancellationTokenSource;n.on("close",()=>{d.cancel()});try{let p=await P.lm.selectChatModels({vendor:"copilot"});if(!p||p.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let f=this.findCopilotModel(c,p);if(!f)throw new K(404,`Model "${c}" not found. Available models: ${p.map(b=>b.id).join(", ")}`,"invalid_request_error","model_not_found");let h=await f.sendRequest(a,{},d.token);o.write(`[
`);let m=!0;for await(let b of h.stream){if(d.token.isCancellationRequested)break;if(b instanceof P.LanguageModelTextPart){l+=b.value,m||o.write(`,
`);let x={candidates:[{content:{role:"model",parts:[{text:b.value}]},finishReason:"STOP",index:0}],usageMetadata:{promptTokenCount:0,candidatesTokenCount:0,totalTokenCount:0}};o.write(JSON.stringify(x)),m=!1}}d.token.isCancellationRequested||(o.write(`
]
`),o.end());let y=0,v=0;try{y=await f.countTokens(u,d.token),v=await f.countTokens(l,d.token)}catch{}i&&this.logRequest(i,"POST",`/v1beta/models/${e}:streamGenerateContent`,200,Date.now()-(s||0),{requestPayload:r,responsePayload:{candidates:[{content:{parts:[{text:l}]}}]},tokensIn:y,tokensOut:v,model:c})}catch(p){if(d.token.isCancellationRequested)return;let f=p instanceof K?p:new K(500,p.message||"Internal Server Error","server_error");o.write(JSON.stringify({error:{code:f.status,message:f.message,status:f.code}})),o.end()}finally{d.dispose()}}async processStreamingAnthropicMessages(e,r,n,o,i){let s=[];e.system&&s.push(P.LanguageModelChatMessage.User(this.redactPromptString(e.system)));for(let f of e.messages){let h=f.role==="user"?P.LanguageModelChatMessageRole.User:P.LanguageModelChatMessageRole.Assistant,m=typeof f.content=="string"?f.content:f.content.map(v=>v.text).join(" "),y=this.redactPromptString(m);h===P.LanguageModelChatMessageRole.User?s.push(P.LanguageModelChatMessage.User(y)):s.push(P.LanguageModelChatMessage.Assistant(y))}let a=this.resolveModel(e.model),c=s.map(f=>typeof f.content=="string"?f.content:f.content.map(h=>"text"in h?h.text:"").join(" ")).join(`
`);n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});let u="ant-"+(0,Sr.randomUUID)(),l="",d=new P.CancellationTokenSource;r.on("close",()=>{d.cancel()});let p=setInterval(()=>{n.writableEnded||n.write(`: ping

`)},15e3);try{let f=await P.lm.selectChatModels({vendor:"copilot"});if(!f||f.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let h=this.findCopilotModel(a,f);if(!h)throw new K(404,`Model "${a}" not found. Available models: ${f.map(b=>b.id).join(", ")}`,"invalid_request_error","model_not_found");let m=await h.sendRequest(s,{},d.token);n.write(`event: message_start
data: ${JSON.stringify({type:"message_start",message:{id:u,type:"message",role:"assistant",content:[],model:a,stop_reason:null,stop_sequence:null,usage:{input_tokens:0,output_tokens:0}}})}

`),n.write(`event: content_block_start
data: ${JSON.stringify({type:"content_block_start",index:0,content_block:{type:"text",text:""}})}

`);for await(let b of m.stream){if(d.token.isCancellationRequested)break;b instanceof P.LanguageModelTextPart&&(l+=b.value,n.write(`event: content_block_delta
data: ${JSON.stringify({type:"content_block_delta",index:0,delta:{type:"text_delta",text:b.value}})}

`))}d.token.isCancellationRequested||(n.write(`event: content_block_stop
data: ${JSON.stringify({type:"content_block_stop",index:0})}

`),n.write(`event: message_delta
data: ${JSON.stringify({type:"message_delta",delta:{stop_reason:"end_turn",stop_sequence:null},usage:{output_tokens:0}})}

`),n.write(`event: message_stop
data: ${JSON.stringify({type:"message_stop"})}

`),n.end());let y=0,v=0;try{y=await h.countTokens(c,d.token),v=await h.countTokens(l,d.token)}catch{}o&&this.logRequest(o,"POST","/v1/messages",200,Date.now()-(i||0),{requestPayload:e,responsePayload:{id:u,type:"message",content:[{type:"text",text:l}]},tokensIn:y,tokensOut:v,model:a})}catch(f){if(d.token.isCancellationRequested)return;let h=f instanceof K?f:new K(500,f.message||"Internal Server Error","server_error");n.write(`event: error
data: ${JSON.stringify({type:"error",error:{type:h.code||"api_error",message:h.message}})}

`),n.end()}finally{clearInterval(p),d.dispose()}}async getAvailableModels(){let e=Math.floor(Date.now()/1e3);return(await P.lm.selectChatModels({vendor:"copilot"})).map(o=>({id:o.id,object:"model",created:e,owned_by:o.vendor||"github-copilot",name:o.name,family:o.family,version:o.version,max_input_tokens:o.maxInputTokens,capabilities:{chat_completion:!0,text_completion:!0,streaming:!0,token_counting:!0}}))}async processStreamingChatCompletion(e,r,n,o,i){let s=this.normalizeChatMessages(e);s=this.injectSystemPrompt(s),s=this.redactMessagesContent(s);let a=this.resolveModel(e?.model),c=this.normalizeTools(e?.tools||e?.functions),u=e?.tool_choice||e?.function_call,l=`chatcmpl-${(0,Sr.randomUUID)()}`,d=Math.floor(Date.now()/1e3),p="";n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});try{let f=await P.lm.selectChatModels({vendor:"copilot"});if(!f||f.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let h=this.findCopilotModel(a,f);if(!h)throw new K(404,`Model "${a}" not found. Available models: ${f.map(ve=>ve.id).join(", ")}`,"invalid_request_error","model_not_found");let m=[];for(let ve of s){let Se=typeof ve.content=="string"?ve.content:JSON.stringify(ve.content);switch(ve.role){case"system":m.push(P.LanguageModelChatMessage.User(`[System]: ${Se}`));break;case"user":m.push(P.LanguageModelChatMessage.User(Se));break;case"assistant":if(ve.tool_calls&&ve.tool_calls.length>0){let Yt=ve.tool_calls.map(en=>`[Called function: ${en.function?.name||en.name}(${en.function?.arguments||JSON.stringify(en.arguments)})]`).join(`
`);m.push(P.LanguageModelChatMessage.Assistant(Yt))}else m.push(P.LanguageModelChatMessage.Assistant(Se));break;case"tool":let Fe=`[Tool result for ${ve.tool_call_id||"unknown"}]: ${Se}`;m.push(P.LanguageModelChatMessage.User(Fe));break;default:m.push(P.LanguageModelChatMessage.User(Se))}}let y={};c&&c.length>0&&(y.tools=c,u==="required"||u==="any"?y.toolMode=P.LanguageModelChatToolMode.Required:y.toolMode=P.LanguageModelChatToolMode.Auto);let v=await h.sendRequest(m,y,new P.CancellationTokenSource().token),b=[],x=0;for await(let ve of v.stream)if(ve instanceof P.LanguageModelTextPart){p+=ve.value;let Se={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{content:ve.value},finish_reason:null}]};n.write(`data: ${JSON.stringify(Se)}

`)}else if(ve instanceof P.LanguageModelToolCallPart){let Se=`call_${(0,Sr.randomUUID)().slice(0,24)}`,Fe=typeof ve.input=="string"?ve.input:JSON.stringify(ve.input);b.push({id:Se,name:ve.name,arguments:Fe});let Yt={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{tool_calls:[{index:x,id:Se,type:"function",function:{name:ve.name,arguments:Fe}}]},finish_reason:null}]};n.write(`data: ${JSON.stringify(Yt)}

`),x++}let C=b.length>0?"tool_calls":"stop",$={id:l,object:"chat.completion.chunk",created:d,model:a,choices:[{index:0,delta:{},finish_reason:C}]};n.write(`data: ${JSON.stringify($)}

`),n.write(`data: [DONE]

`),n.end();let L=0,xe=0;try{let ve=m.map(Se=>typeof Se.content=="string"?Se.content:JSON.stringify(Se.content)).join(`
`);L=await h.countTokens(ve,new P.CancellationTokenSource().token),xe=await h.countTokens(p,new P.CancellationTokenSource().token)}catch{}o&&i&&this.logRequest(o,"POST","/v1/chat/completions",200,Date.now()-i,{requestPayload:e,responsePayload:{streamed:!0,content_preview:p.slice(0,500),tool_calls:b},model:e?.model,requestHeaders:r.headers,responseHeaders:n.getHeaders(),tokensIn:L,tokensOut:xe})}catch(f){let h={error:{message:f instanceof Error?f.message:"Unknown error",type:"server_error"}};n.write(`data: ${JSON.stringify(h)}

`),n.end(),o&&i&&this.logRequest(o,"POST","/v1/chat/completions",500,Date.now()-i,{requestPayload:e,error:f instanceof Error?f.message:String(f),model:e?.model,requestHeaders:r.headers})}}async processTokenize(e){let r=e?.text||e?.input||"",n=this.resolveModel(e?.model),o=await P.lm.selectChatModels({vendor:"copilot"});if(!o||o.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let s=await(this.findCopilotModel(n,o)||o[0]).countTokens(r);return{object:"token_count",model:n,token_count:s,text_length:r.length}}async processResponsesApi(e){let r=e?.input,n=[];if(e.instructions&&n.push({role:"system",content:e.instructions}),typeof r=="string")n.push({role:"user",content:r});else if(Array.isArray(r))for(let p of r)typeof p=="string"?n.push({role:"user",content:p}):(p.type==="message"||!p.type)&&n.push({role:p.role||"user",content:typeof p.content=="string"?p.content:JSON.stringify(p.content)});e.instructions||(n=this.injectSystemPrompt(n));let o=[];for(let p of n){let f=this.redactPromptString(String(p.content));p.role==="system"||p.role==="user"?o.push(P.LanguageModelChatMessage.User(f)):p.role==="assistant"&&o.push(P.LanguageModelChatMessage.Assistant(f))}let i=this.resolveModel(e?.model),s=await P.lm.selectChatModels({vendor:"copilot"});if(!s||s.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let a=this.findCopilotModel(i,s);if(!a)throw new K(404,`Model "${i}" not found. Available models: ${s.map(p=>p.id).join(", ")}`,"invalid_request_error","model_not_found");let c={},u=await this.runWithConcurrency(async()=>{let p=await a.sendRequest(o,c,new P.CancellationTokenSource().token),f="";for await(let h of p.stream)h instanceof P.LanguageModelTextPart&&(f+=h.value);return f}),l=0,d=0;try{let p=n.map(f=>String(f.content)).join(`
`);l=await a.countTokens(p),d=await a.countTokens(u||"")}catch{}return{id:`resp-${(0,Sr.randomUUID)()}`,object:"response",created_at:Math.floor(Date.now()/1e3),model:i,status:"completed",output:[{type:"message",id:`msg-${(0,Sr.randomUUID)()}`,role:"assistant",content:[{type:"output_text",text:u||""}]}],usage:{input_tokens:l,output_tokens:d,total_tokens:l+d}}}async processStreamingResponsesApi(e,r,n,o,i){let s=e?.input,a=[];if(e.instructions&&a.push({role:"system",content:e.instructions}),typeof s=="string")a.push({role:"user",content:s});else if(Array.isArray(s))for(let m of s)typeof m=="string"?a.push({role:"user",content:m}):(m.type==="message"||!m.type)&&a.push({role:m.role||"user",content:typeof m.content=="string"?m.content:JSON.stringify(m.content)});e.instructions||(a=this.injectSystemPrompt(a));let c=[];for(let m of a){let y=this.redactPromptString(String(m.content));m.role==="system"||m.role==="user"?c.push(P.LanguageModelChatMessage.User(y)):m.role==="assistant"&&c.push(P.LanguageModelChatMessage.Assistant(y))}let u=this.resolveModel(e?.model),l=`resp-${(0,Sr.randomUUID)()}`,d=`msg-${(0,Sr.randomUUID)()}`;n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});let p=new P.CancellationTokenSource;r.on("close",()=>{p.cancel()});let f=setInterval(()=>{n.writableEnded||n.write(`: ping

`)},15e3),h="";try{let m=await P.lm.selectChatModels({vendor:"copilot"});if(!m||m.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let y=this.findCopilotModel(u,m);if(!y)throw new K(404,`Model "${u}" not found.`,"invalid_request_error","model_not_found");let v=await y.sendRequest(c,{},p.token);n.write(`event: response.created
data: ${JSON.stringify({type:"response.created",response:{id:l,object:"response",created_at:Math.floor(Date.now()/1e3),model:u,status:"in_progress",output:[]}})}

`),n.write(`event: response.content_part.added
data: ${JSON.stringify({type:"response.content_part.added",item_id:d,content_index:0,part:{type:"output_text",text:""}})}

`);for await(let b of v.stream){if(p.token.isCancellationRequested)break;b instanceof P.LanguageModelTextPart&&(h+=b.value,n.write(`event: response.output_text.delta
data: ${JSON.stringify({type:"response.output_text.delta",item_id:d,content_index:0,delta:b.value})}

`))}if(!p.token.isCancellationRequested){n.write(`event: response.content_part.done
data: ${JSON.stringify({type:"response.content_part.done",item_id:d,content_index:0,part:{type:"output_text",text:h}})}

`);let b=0,x=0;try{let C=a.map($=>String($.content)).join(`
`);b=await y.countTokens(C),x=await y.countTokens(h)}catch{}n.write(`event: response.completed
data: ${JSON.stringify({type:"response.completed",response:{id:l,object:"response",created_at:Math.floor(Date.now()/1e3),model:u,status:"completed",output:[{type:"message",id:d,role:"assistant",content:[{type:"output_text",text:h}]}],usage:{input_tokens:b,output_tokens:x,total_tokens:b+x}}})}

`),n.end(),o&&this.logRequest(o,"POST","/v1/responses",200,Date.now()-(i||0),{requestPayload:e,responsePayload:{id:l,content:h},tokensIn:b,tokensOut:x,model:u})}}catch(m){if(p.token.isCancellationRequested)return;let y=m instanceof K?m:new K(500,m.message||"Internal Server Error","api_error");n.write(`event: error
data: ${JSON.stringify({type:"error",error:{type:y.type,message:y.message,code:y.code}})}

`),n.end()}finally{clearInterval(f),p.dispose()}}async processAnthropicMessages(e){let r=[];e.system&&r.push(P.LanguageModelChatMessage.User(this.redactPromptString(e.system)));for(let c of e.messages){let u=c.role==="user"?P.LanguageModelChatMessageRole.User:P.LanguageModelChatMessageRole.Assistant,l=typeof c.content=="string"?c.content:c.content.map(p=>p.text).join(" "),d=this.redactPromptString(l);u===P.LanguageModelChatMessageRole.User?r.push(P.LanguageModelChatMessage.User(d)):r.push(P.LanguageModelChatMessage.Assistant(d))}let n=this.resolveModel(e.model),o=r.map(c=>typeof c.content=="string"?c.content:c.content.map(u=>"text"in u?u.text:"").join(" ")).join(`
`),i=await this.runWithConcurrency(async()=>{let c=await P.lm.selectChatModels({vendor:"copilot"});if(!c||c.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let u=this.findCopilotModel(n,c);if(!u)throw new K(404,`Model "${n}" not found. Available models: ${c.map(p=>p.id).join(", ")}`,"invalid_request_error","model_not_found");let l=await u.sendRequest(r,{},new P.CancellationTokenSource().token),d="";for await(let p of l.stream)p instanceof P.LanguageModelTextPart&&(d+=p.value);return d}),s=0,a=0;try{let c=r.map(l=>l.content).join(" "),u=await P.lm.selectChatModels({vendor:"copilot"});if(u&&u.length>0){let l=u[0];s=await l.countTokens(c),a=await l.countTokens(i||"")}}catch{}return{id:"ant-"+(0,Sr.randomUUID)(),type:"message",role:"assistant",content:[{type:"text",text:i||""}],model:n,stop_reason:"end_turn",stop_sequence:null,usage:{input_tokens:s,output_tokens:a}}}async processGoogleGenerateContent(e,r){let n=[];if(r.systemInstruction){let u=r.systemInstruction.parts.map(l=>l.text).join(" ");n.push(P.LanguageModelChatMessage.User(this.redactPromptString(u)))}for(let u of r.contents){let l=u.role==="model"?P.LanguageModelChatMessageRole.Assistant:P.LanguageModelChatMessageRole.User,d=u.parts.map(f=>f.text).join(" "),p=this.redactPromptString(d);l===P.LanguageModelChatMessageRole.User?n.push(P.LanguageModelChatMessage.User(p)):n.push(P.LanguageModelChatMessage.Assistant(p))}let o=this.resolveModel(e),i=n.map(u=>typeof u.content=="string"?u.content:u.content.map(l=>"text"in l?l.text:"").join(" ")).join(`
`),s=await this.runWithConcurrency(async()=>{let u=await P.lm.selectChatModels({vendor:"copilot"});if(!u||u.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let l=this.findCopilotModel(o,u);if(!l)throw new K(404,`Model "${o}" not found. Available models: ${u.map(f=>f.id).join(", ")}`,"invalid_request_error","model_not_found");let d=await l.sendRequest(n,{},new P.CancellationTokenSource().token),p="";for await(let f of d.stream)f instanceof P.LanguageModelTextPart&&(p+=f.value);return p}),a=0,c=0;try{let u=n.map(d=>d.content).join(" "),l=await P.lm.selectChatModels({vendor:"copilot"});if(l&&l.length>0){let d=l[0];a=await d.countTokens(u),c=await d.countTokens(s||"")}}catch{}return{candidates:[{content:{role:"model",parts:[{text:s||""}]},finishReason:"STOP",index:0}],usageMetadata:{promptTokenCount:a,candidatesTokenCount:c,totalTokenCount:a+c}}}async processChatCompletion(e,r){let n=this.normalizeChatMessages(e);n=this.injectSystemPrompt(n),n=this.redactMessagesContent(n);let o=this.resolveModel(e?.model),i=await P.lm.selectChatModels({vendor:"copilot"});if(!i||i.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let s=this.findCopilotModel(o,i);if(!s)throw new K(404,`Model "${o}" not found. Available models: ${i.map(C=>C.id).join(", ")}`,"invalid_request_error","model_not_found");let a=this.normalizeTools(e?.tools||e?.functions)||[],c=await this.ensureMcpService(),l=(c?await c.getAllTools():[]).map(C=>({name:`mcp_${C.serverName}_${C.name}`,description:C.description||`Tool from MCP server ${C.serverName}`,inputSchema:C.inputSchema})),d=[...a,...l],p=e?.tool_choice||e?.function_call;if(e?.response_format?.type==="json_object"){let C=n.map($=>$.role).lastIndexOf("user");if(C>=0){let $=n[C].content;n[C]={...n[C],content:`${$}

IMPORTANT: You MUST respond with valid JSON only.No markdown, no explanation, just pure JSON.`}}}let h=0,m=5,y;for(;h<m;){if(y=await this.runWithConcurrency(()=>this.invokeCopilotWithTools(n,d,p,s)),y.toolCalls&&y.toolCalls.length>0){let C=y.toolCalls.filter($=>$.name.startsWith("mcp_"));if(C.length>0){n.push({role:"assistant",content:y.content||null,tool_calls:y.toolCalls.map($=>({id:`call_${(0,Sr.randomUUID)().slice(0,24)}`,type:"function",function:{name:$.name,arguments:typeof $.arguments=="string"?$.arguments:JSON.stringify($.arguments)}}))});for(let $ of C){let L=$.name.split("_"),xe=L[1],ve=L.slice(2).join("_");try{let Se=await this.ensureMcpService();if(!Se)throw new Error("MCP service not available");let Fe=await Se.callTool(xe,ve,$.arguments);n.push({role:"tool",tool_call_id:`call_${(0,Sr.randomUUID)().slice(0,24)}`,content:JSON.stringify(Fe)})}catch(Se){n.push({role:"tool",tool_call_id:`call_${(0,Sr.randomUUID)().slice(0,24)}`,content:`Error executing MCP tool: ${Se.message}`})}}h++;continue}}break}let v=Math.floor(Date.now()/1e3),b=0,x=0;try{let C=await P.lm.selectChatModels({vendor:"copilot"});if(C&&C.length>0){let $=C[0],L=n.map(Se=>typeof Se.content=="string"?Se.content:JSON.stringify(Se.content)).join(`
`);b=await $.countTokens(L);let xe=y.content||"",ve=y.toolCalls?JSON.stringify(y.toolCalls):"";x=await $.countTokens(xe+ve)}}catch{}return y.toolCalls&&y.toolCalls.length>0?{id:`chatcmpl-${(0,Sr.randomUUID)()}`,object:"chat.completion",created:v,model:o,choices:[{index:0,message:{role:"assistant",content:y.content||null,tool_calls:y.toolCalls.map((C,$)=>({id:`call_${(0,Sr.randomUUID)().slice(0,24)}`,type:"function",function:{name:C.name,arguments:typeof C.arguments=="string"?C.arguments:JSON.stringify(C.arguments)}}))},finish_reason:"tool_calls"}],usage:{prompt_tokens:b,completion_tokens:x,total_tokens:b+x},system_fingerprint:null}:{id:`chatcmpl-${(0,Sr.randomUUID)()}`,object:"chat.completion",created:v,model:o,actual_model:s?.id||"unknown",choices:[{index:0,message:{role:"assistant",content:y.content},finish_reason:"stop"}],usage:{prompt_tokens:b,completion_tokens:x,total_tokens:b+x},system_fingerprint:null}}normalizeTools(e){if(!(!e||!Array.isArray(e)||e.length===0))return e.map(r=>{let n=r.type==="function"?r.function:r;return{name:n.name,description:n.description||"",inputSchema:n.parameters||n.inputSchema||void 0}})}async invokeCopilotWithTools(e,r,n,o){let i=await this.getCopilotHealth();if(!i.installed)throw new K(503,"GitHub Copilot extension is not installed. Install it from the VS Code Marketplace: https://marketplace.visualstudio.com/items?itemName=GitHub.copilot","service_unavailable","copilot_not_installed");if(!i.chatInstalled)throw new K(503,"GitHub Copilot Chat extension is not installed. Install it from the VS Code Marketplace: https://marketplace.visualstudio.com/items?itemName=GitHub.copilot-chat","service_unavailable","copilot_chat_not_installed");if(!i.signedIn)throw new K(401,'Not signed in to GitHub Copilot. Open VS Code Command Palette (Cmd+Shift+P) and run "GitHub Copilot: Sign In".',"unauthorized","copilot_not_signed_in");let s=o;if(!s){let d=await P.lm.selectChatModels({vendor:"copilot"});if(!d||d.length===0)throw new K(503,"No Copilot language model available. Ensure you have an active GitHub Copilot subscription and VS Code is connected to the internet.","service_unavailable","copilot_unavailable");s=d[0]}let a=[];for(let d of e){let p=typeof d.content=="string"?d.content:JSON.stringify(d.content);switch(d.role){case"system":a.push(P.LanguageModelChatMessage.User(`[System]: ${p}`));break;case"user":a.push(P.LanguageModelChatMessage.User(p));break;case"assistant":if(d.tool_calls&&d.tool_calls.length>0){let h=d.tool_calls.map(m=>`[Called function: $ { tc.function?.name || tc.name }(${m.function?.arguments||JSON.stringify(m.arguments)})]`).join(`
`);a.push(P.LanguageModelChatMessage.Assistant(h))}else a.push(P.LanguageModelChatMessage.Assistant(p));break;case"tool":let f=`[Tool result for ${d.tool_call_id||"unknown"}]: ${p} `;a.push(P.LanguageModelChatMessage.User(f));break;default:a.push(P.LanguageModelChatMessage.User(p))}}let c={};r&&r.length>0&&(c.tools=r,n==="required"||n==="any"?c.toolMode=P.LanguageModelChatToolMode.Required:c.toolMode=P.LanguageModelChatToolMode.Auto);let u=new P.CancellationTokenSource,l=setTimeout(()=>u.cancel(),(this.config.requestTimeoutSeconds||180)*1e3);try{let d=await s.sendRequest(a,c,u.token),p="",f=[];for await(let h of d.stream){if(u.token.isCancellationRequested)throw new K(504,`Request timed out after ${this.config.requestTimeoutSeconds}s. Try a shorter prompt or check your network connection.`,"gateway_timeout","request_timeout");h instanceof P.LanguageModelTextPart?p+=h.value:h instanceof P.LanguageModelToolCallPart&&f.push({name:h.name,arguments:h.input})}return{content:p.trim(),toolCalls:f.length>0?f:void 0}}catch(d){throw d instanceof K?d:u.token.isCancellationRequested?new K(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout"):new K(502,`Failed to retrieve Copilot response: ${Xu(d)} `,"bad_gateway","command_failed",{cause:d})}finally{clearTimeout(l),u.dispose()}}async processCompletion(e){let r=this.normalizePromptInput(e?.prompt);if(!r)throw new K(400,"prompt is required","invalid_request_error","missing_prompt");r=this.redactPromptString(r);let n=this.resolveModel(e?.model),o=await P.lm.selectChatModels({vendor:"copilot"});if(!o||o.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let i=this.findCopilotModel(n,o);if(!i)throw new K(404,`Model "${n}" not found. Available models: ${o.map(l=>l.id).join(", ")}`,"invalid_request_error","model_not_found");let s=await this.runWithConcurrency(()=>this.invokeCopilot(r,i)),a=Math.floor(Date.now()/1e3),c=0,u=0;try{let l=await P.lm.selectChatModels({vendor:"copilot"});if(l&&l.length>0){let d=l[0],p=r;c=await d.countTokens(p);let f=s||"";u=await d.countTokens(f)}}catch{}return{id:`cmpl - ${(0,Sr.randomUUID)()} `,object:"text_completion",created:a,model:n,choices:[{index:0,text:s,finish_reason:"stop",logprobs:null}],usage:{prompt_tokens:c,completion_tokens:u,total_tokens:c+u}}}async processStreamingCompletion(e,r,n,o,i){let s=this.normalizePromptInput(e?.prompt);if(!s)throw new K(400,"prompt is required","invalid_request_error","missing_prompt");s=this.redactPromptString(s);let a=this.resolveModel(e?.model),c=`cmpl-${(0,Sr.randomUUID)()}`,u=Math.floor(Date.now()/1e3);n.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*"});let l=new P.CancellationTokenSource;r.on("close",()=>{l.cancel()});let d="";try{let p=await P.lm.selectChatModels({vendor:"copilot"});if(!p||p.length===0)throw new K(503,"No Copilot language model available.","service_unavailable","copilot_unavailable");let f=this.findCopilotModel(a,p);if(!f)throw new K(404,`Model "${a}" not found.`,"invalid_request_error","model_not_found");let h=[P.LanguageModelChatMessage.User(s)],m=await f.sendRequest(h,{},l.token);for await(let y of m.stream){if(l.token.isCancellationRequested)break;if(y instanceof P.LanguageModelTextPart){d+=y.value;let v={id:c,object:"text_completion",created:u,model:a,choices:[{index:0,text:y.value,finish_reason:null,logprobs:null}]};n.write(`data: ${JSON.stringify(v)}

`)}}if(!l.token.isCancellationRequested){let y={id:c,object:"text_completion",created:u,model:a,choices:[{index:0,text:"",finish_reason:"stop",logprobs:null}]};if(n.write(`data: ${JSON.stringify(y)}

`),n.write(`data: [DONE]

`),n.end(),o){let v=0,b=0;try{v=await f.countTokens(s),b=await f.countTokens(d)}catch{}this.logRequest(o,"POST","/v1/completions",200,Date.now()-(i||0),{requestPayload:e,responsePayload:{id:c,text:d},tokensIn:v,tokensOut:b,model:a})}}}catch(p){if(l.token.isCancellationRequested)return;let f=p instanceof K?p:new K(500,p.message||"Internal Server Error","api_error");n.write(`data: ${JSON.stringify({error:{message:f.message,type:f.type,code:f.code}})}

`),n.end()}finally{l.dispose()}}async handleWebSocketMessage(e,r,n){let o=typeof r=="string"?r:r.toString("utf8"),i;try{i=JSON.parse(o)}catch{throw new K(400,"WebSocket payload must be valid JSON.","invalid_request_error","invalid_json")}let s=i?.type??i?.event??i?.action;if(s==="ping"){e.send(JSON.stringify({type:"pong",timestamp:Date.now()}));return}if(s==="models.list"){let a=await this.getAvailableModels();e.send(JSON.stringify({type:"models.result",data:{object:"list",data:a}}));return}switch(n){case"/v1/realtime":case"/llama/v1/realtime":await this.handleOpenAIWebSocketMessage(e,i,s,n);return;case"/anthropic/v1/realtime":await this.handleAnthropicWebSocketMessage(e,i,s);return;case"/google/v1/realtime":await this.handleGoogleWebSocketMessage(e,i,s);return;default:throw new K(400,`Unknown WebSocket endpoint: ${n}`,"invalid_request_error","unknown_endpoint")}}async handleOpenAIWebSocketMessage(e,r,n,o){if(!n||n==="chat.completions.create"){let i=r?.data??r?.request??r;o==="/llama/v1/realtime"&&i?.max_completion_tokens&&!i?.max_tokens&&(i.max_tokens=i.max_completion_tokens);let s=await this.processChatCompletion(i,{source:"websocket",endpoint:o});e.send(JSON.stringify({type:"chat.completion.result",data:s}));return}if(n==="completions.create"){let i=r?.data??r?.request??r,s=await this.processCompletion(i);e.send(JSON.stringify({type:"completion.result",data:s}));return}throw new K(400,`Unsupported OpenAI WebSocket message type: ${n}`,"invalid_request_error","unsupported_ws_message")}async handleAnthropicWebSocketMessage(e,r,n){if(!n||n==="messages.create"){let o=r?.data??r?.request??r,i=await this.processAnthropicMessages(o);e.send(JSON.stringify({type:"message.result",data:i}));return}throw new K(400,`Unsupported Anthropic WebSocket message type: ${n}`,"invalid_request_error","unsupported_ws_message")}async handleGoogleWebSocketMessage(e,r,n){if(!n||n==="generateContent"){let o=r?.data??r?.request??r,i=r?.model??"gemini-pro",s=await this.processGoogleGenerateContent(i,o);e.send(JSON.stringify({type:"content.result",data:s}));return}throw new K(400,`Unsupported Google WebSocket message type: ${n}`,"invalid_request_error","unsupported_ws_message")}handleWebSocketConnection(e,r){e.send(JSON.stringify({type:"session.created",session:{id:(0,Sr.randomUUID)(),model:this.config.defaultModel,created:Math.floor(Date.now()/1e3),endpoint:r}})),e.on("message",n=>{this.handleWebSocketMessage(e,n,r).catch(o=>{o instanceof K?this.sendWsError(e,o):(this.logError("Unhandled WebSocket error",o),this.sendWsError(e,new K(500,"An unexpected error occurred.","server_error")))})}),e.on("error",n=>{this.logError("WebSocket client error",n)})}async runWithConcurrency(e){if(this.activeRequests>=this.config.maxConcurrentRequests)throw new K(429,`Too many concurrent requests (max ${this.config.maxConcurrentRequests}). Your request has been queued. Try again in a moment.`,"rate_limit_exceeded","concurrency_limit");this.activeRequests+=1;try{return await e()}finally{this.activeRequests-=1}}async invokeCopilot(e,r){let n=r;if(!n){let a=await P.lm.selectChatModels({vendor:"copilot"});if(!a||a.length===0)throw new K(503,"No Copilot language model available. Make sure GitHub Copilot is installed and signed in.","service_unavailable","copilot_unavailable");n=a[0]}let o=[P.LanguageModelChatMessage.User(e)],i=new P.CancellationTokenSource,s=setTimeout(()=>i.cancel(),(this.config.requestTimeoutSeconds||180)*1e3);try{let a=await n.sendRequest(o,{},i.token),c="";for await(let u of a.text){if(i.token.isCancellationRequested)throw new K(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout");c+=u}if(!c.trim())throw new K(502,"Copilot did not return any content.","bad_gateway","empty_response");return c.trim()}catch(a){throw a instanceof K?a:i.token.isCancellationRequested?new K(504,"Request timed out waiting for Copilot response.","gateway_timeout","request_timeout"):new K(502,`Failed to retrieve Copilot response: ${Xu(a)} `,"bad_gateway","command_failed",{cause:a})}finally{clearTimeout(s),i.dispose()}}extractTextFromChatResult(e){if(e){if(typeof e=="string")return e.trim()||void 0;if(Array.isArray(e))return e.map(r=>typeof r=="string"?r:"").join(" ").trim()||void 0;if(typeof e=="object"){let r=e,n=r.response??r.result??r.body;if(typeof n=="string")return n.trim()||void 0;if(n&&typeof n=="object"){let o=n.text??n.message;if(typeof o=="string"&&o.trim())return o.trim();let i=n.responseContent;if(Array.isArray(i)){let s=i.map(a=>typeof a=="string"?a:a&&typeof a=="object"&&typeof a.text=="string"?String(a.text):"").join("").trim();if(s)return s}}if(Array.isArray(r.choices)&&r.choices.length>0){let o=r.choices[0];if(typeof o?.text=="string"&&o.text.trim())return o.text.trim();let i=o?.message;if(i&&typeof i.content=="string"&&i.content.trim())return i.content.trim()}}}}normalizeChatMessages(e){let r=e?.messages;if(Array.isArray(r)&&r.length>0)return r.map((o,i)=>({role:typeof o?.role=="string"?o.role:i===r.length-1?"user":"system",content:o?.content,tool_calls:o?.tool_calls,tool_call_id:o?.tool_call_id}));let n=this.normalizePromptInput(e?.prompt??e?.input);if(n)return[{role:"user",content:n}];throw new K(400,"messages must be a non-empty array or prompt must be provided.","invalid_request_error","missing_messages")}normalizePromptInput(e){if(typeof e=="string")return e.trim()||void 0;if(Array.isArray(e))return e.map(n=>typeof n=="string"?n:"").join(`
`).trim()||void 0}composePrompt(e){return e.map(({role:r,content:n})=>{let o=r||"user",i=this.flattenMessageContent(n);return`[${o}]
${i} `}).join(`

`)}flattenMessageContent(e){return typeof e=="string"?e:e==null?"":Array.isArray(e)?e.map(r=>typeof r=="string"?r:r&&typeof r=="object"&&typeof r.text=="string"?String(r.text):"").join(`
`):String(e)}resolveModel(e){return typeof e=="string"&&e.trim()?e.trim():this.config.defaultModel}findCopilotModel(e,r){if(!r||r.length===0)return null;let n=e.toLowerCase(),o=r.find(s=>s.id.toLowerCase()===n);if(o)return o;let i=r.find(s=>s.family?.toLowerCase()===n);return i||null}injectSystemPrompt(e){return!this.config.defaultSystemPrompt||e.some(n=>n.role==="system")?e:[{role:"system",content:this.config.defaultSystemPrompt},...e]}async readJsonBody(e){let r=[],n=0;if(await new Promise((i,s)=>{e.on("data",a=>{let c=typeof a=="string"?Buffer.from(a):a;n+=c.length;let u=(this.config.maxPayloadSizeMb||1)*1024*1024;if(n>u){e.destroy(),s(new K(413,`Request body too large.Maximum size is ${Math.round(u/1024)} KB.`,"invalid_request_error","payload_too_large"));return}r.push(c)}),e.on("end",()=>i()),e.on("error",a=>s(a))}),r.length===0)return{};let o=Buffer.concat(r).toString("utf8");if(!o.trim())return{};try{return JSON.parse(o)}catch(i){throw new K(400,"Request body must be valid JSON.","invalid_request_error","invalid_json",{cause:i})}}sendJson(e,r,n){e.headersSent||(e.statusCode=r,e.setHeader("Content-Type","application/json")),e.end(JSON.stringify(n))}sendSwaggerUi(e){let r=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot API - Swagger UI</title>
    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5/swagger-ui.css">
    <style>
        body { margin: 0; background: #fafafa; }
        .swagger-ui .topbar { display: none; }
        .swagger-ui .info { margin: 30px 0; }
        .swagger-ui .info .title { font-size: 2em; }
    </style>
</head>
<body>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function() {
            SwaggerUIBundle({
                url: '/openapi.json',
                dom_id: '#swagger-ui',
                presets: [SwaggerUIBundle.presets.apis, SwaggerUIBundle.SwaggerUIStandalonePreset],
                layout: 'BaseLayout',
                deepLinking: true,
                showExtensions: true,
                showCommonExtensions: true
            });
        };
    </script>
</body>
</html>`;e.statusCode=200,e.setHeader("Content-Type","text/html"),e.end(r)}getOpenApiSpec(){return{openapi:"3.1.0",info:{title:"Copilot API Gateway",description:"Local OpenAI-compatible API server powered by GitHub Copilot. Provides REST and WebSocket endpoints for chat completions, text completions, tokenization, and more.",version:"1.0.0",contact:{name:"GitHub Copilot API VS Code Extension"},license:{name:"MIT"}},servers:[{url:"/",description:"Local Copilot API Server"}],tags:[{name:"Chat",description:"Chat completion endpoints"},{name:"Completions",description:"Text completion endpoints"},{name:"Anthropic",description:"Anthropic Messages API compatible endpoints"},{name:"Google",description:"Google Generative AI API compatible endpoints"},{name:"Llama",description:"Meta Llama API compatible endpoints"},{name:"Models",description:"Model information"},{name:"Utilities",description:"Utility endpoints"},{name:"Tools",description:"MCP and VS Code tool endpoints"},{name:"WebSocket",description:"Real-time WebSocket endpoints for all providers"}],paths:{"/v1/chat/completions":{post:{tags:["Chat"],summary:"Create chat completion",description:"Creates a chat completion for the given messages using the OpenAI format.\n\n**Supported Features:**\n- **Streaming:** Server-Sent Events (SSE)\n- **Function Calling:** Tool use with `tools` and `tool_choice`\n- **JSON Mode:** Structured output with `response_format`\n- **Token usage:** Detailed usage statistics",operationId:"createChatCompletion",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ChatCompletionRequest"},examples:{basic:{summary:"Basic chat",value:{model:this.config.defaultModel,messages:[{role:"user",content:"Hello!"}]}},streaming:{summary:"Streaming response",value:{model:this.config.defaultModel,messages:[{role:"user",content:"Tell me a story"}],stream:!0}},tools:{summary:"With tools/functions",value:{model:this.config.defaultModel,messages:[{role:"user",content:"What is the weather?"}],tools:[{type:"function",function:{name:"get_weather",description:"Get weather for a location",parameters:{type:"object",properties:{location:{type:"string"}},required:["location"]}}}]}}}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/ChatCompletionResponse"}},"text/event-stream":{description:"Server-sent events for streaming responses"}}},400:{description:"Bad request",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},401:{description:"Unauthorized",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},429:{description:"Rate limited",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/completions":{post:{tags:["Completions"],summary:"Create text completion",description:`Creates a text completion for the given prompt.

**Features:**
- **Streaming:** Server-Sent Events with \`stream: true\`
- **Token usage:** Detailed usage statistics`,operationId:"createCompletion",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/CompletionRequest"},examples:{basic:{summary:"Basic completion",value:{model:this.config.defaultModel,prompt:"Once upon a time",max_tokens:100}},streaming:{summary:"Streaming response",value:{model:this.config.defaultModel,prompt:"Write a story about",stream:!0}}}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/CompletionResponse"}},"text/event-stream":{description:"SSE stream when stream=true"}}},400:{description:"Bad request"},401:{description:"Unauthorized"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/responses":{post:{tags:["Chat"],summary:"Create response (OpenAI 2026 Responses API)",description:"OpenAI Responses API for creating model responses. Supports streaming via SSE.\n\n**Features:**\n- **Streaming:** Server-Sent Events with `stream: true`\n- **Instructions:** System prompt via `instructions` field\n- **Multi-turn:** Array-based `input` for conversations\n- **Codex CLI compatible**",operationId:"createResponse",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ResponsesRequest"},examples:{basic:{summary:"Simple text input",value:{model:this.config.defaultModel,input:"What is 2+2?"}},withInstructions:{summary:"With system instructions",value:{model:this.config.defaultModel,input:"Write a haiku about coding",instructions:"You are a creative poet. Be concise and artistic."}},streaming:{summary:"Streaming response",value:{model:this.config.defaultModel,input:"Tell me a story",stream:!0}}}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/ResponsesResponse"}},"text/event-stream":{description:"SSE stream when stream=true"}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/models":{get:{tags:["Models"],summary:"List models",description:"Lists all available models from GitHub Copilot.",operationId:"listModels",responses:{200:{description:"List of models",content:{"application/json":{schema:{$ref:"#/components/schemas/ModelList"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/models/{model_id}":{get:{tags:["Models"],summary:"Get model",description:"Retrieves details about a specific model.",operationId:"getModel",parameters:[{name:"model_id",in:"path",required:!0,schema:{type:"string"},description:"The ID of the model"}],responses:{200:{description:"Model details",content:{"application/json":{schema:{$ref:"#/components/schemas/Model"}}}},404:{description:"Model not found"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/tokenize":{post:{tags:["Utilities"],summary:"Count tokens",description:"Counts the number of tokens in the given text.",operationId:"tokenize",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/TokenizeRequest"},example:{model:this.config.defaultModel,text:"Hello, world!"}}}},responses:{200:{description:"Token count",content:{"application/json":{schema:{$ref:"#/components/schemas/TokenizeResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/usage":{get:{tags:["Utilities"],summary:"Get usage statistics",description:"Returns usage statistics including request counts, token usage, and uptime.",operationId:"getUsage",responses:{200:{description:"Usage statistics",content:{"application/json":{schema:{$ref:"#/components/schemas/UsageResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/tools":{get:{tags:["Tools"],summary:"List available tools",description:"Lists all available tools from connected MCP servers and VS Code built-in tools.",operationId:"listTools",responses:{200:{description:"List of tools",content:{"application/json":{schema:{$ref:"#/components/schemas/ToolList"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/tools/call":{post:{tags:["Tools"],summary:"Call a tool",description:"Invokes a specific tool from an MCP server or VS Code built-in tools.",operationId:"callTool",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/ToolCallRequest"},example:{server:"vscode",name:"readFile",arguments:{path:"/path/to/file.txt"}}}}},responses:{200:{description:"Tool result",content:{"application/json":{schema:{$ref:"#/components/schemas/ToolCallResponse"}}}},400:{description:"Bad request"},503:{description:"MCP service unavailable"}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/mcp/servers":{get:{tags:["Tools"],summary:"List MCP servers",description:"Lists all connected MCP servers and their available tools.",operationId:"listMcpServers",responses:{200:{description:"List of MCP servers",content:{"application/json":{schema:{$ref:"#/components/schemas/McpServerList"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/mcp/servers/refresh":{post:{tags:["Tools"],summary:"Refresh MCP connections",description:"Reconnects to all configured MCP servers.",operationId:"refreshMcpServers",responses:{200:{description:"Refresh result",content:{"application/json":{schema:{$ref:"#/components/schemas/McpRefreshResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1/messages":{post:{tags:["Anthropic"],summary:"Anthropic Messages API",description:"Create a message using the Anthropic-compatible API format.",operationId:"anthropicMessages",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/AnthropicMessageRequest"},example:{model:"claude-3-5-sonnet-20240620",max_tokens:1024,messages:[{role:"user",content:"Hello, Claude"}]}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/AnthropicMessageResponse"}},"text/event-stream":{description:"Anthropic-style event stream"}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1beta/models/{model}:generateContent":{post:{tags:["Google"],summary:"Google Generative AI generateContent",description:"Generate content using the Google-compatible API format.",operationId:"googleGenerateContent",parameters:[{name:"model",in:"path",required:!0,schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentRequest"},example:{contents:[{role:"user",parts:[{text:"Write a story about a magic backpack"}]}],generationConfig:{temperature:.9,maxOutputTokens:200}}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentResponse"}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/v1beta/models/{model}:streamGenerateContent":{post:{tags:["Google"],summary:"Google Generative AI streamGenerateContent",description:"Stream content generation using the Google-compatible API format.",operationId:"googleStreamGenerateContent",parameters:[{name:"model",in:"path",required:!0,schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/GoogleGenerateContentRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/GoogleGenerateContentResponse"}}}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/llama/v1/chat/completions":{post:{tags:["Llama"],summary:"Llama Chat Completions",description:"Create a chat completion using the Llama-compatible API format.\n\nCompatible with `llama-api` Python/JS SDKs. Supports standard OpenAI parameters including `max_completion_tokens`.",operationId:"llamaChatCompletions",requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/LlamaMessageRequest"}}}},responses:{200:{description:"Successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/LlamaMessageResponse"}},"text/event-stream":{description:"OpenAI-style SSE event stream for streaming responses"}}}},security:this.config.apiKey?[{bearerAuth:[]}]:[]}},"/health":{get:{tags:["Utilities"],summary:"Health check",description:"Simple health check endpoint for monitoring.",operationId:"healthCheck",responses:{200:{description:"Service is healthy",content:{"application/json":{schema:{type:"object",properties:{status:{type:"string",example:"ok"},service:{type:"string",example:"github-copilot-api-vscode"}}}}}}}}},"/v1/realtime":{get:{tags:["WebSocket"],summary:"OpenAI Realtime WebSocket",description:"Initiate a WebSocket connection for real-time chat completions using the OpenAI format. Requires `Upgrade: websocket` header.",operationId:"connectOpenAIRealtime",responses:{101:{description:"Switching Protocols to WebSocket"},426:{description:"Upgrade Required - Use WebSocket client"}}}},"/anthropic/v1/realtime":{get:{tags:["WebSocket","Anthropic"],summary:"Anthropic Realtime WebSocket",description:"Initiate a WebSocket connection using the Anthropic Messages API format.",operationId:"connectAnthropicRealtime",responses:{101:{description:"Switching Protocols to WebSocket"},426:{description:"Upgrade Required - Use WebSocket client"}}}},"/google/v1/realtime":{get:{tags:["WebSocket","Google"],summary:"Google Realtime WebSocket",description:"Initiate a WebSocket connection using the Google Gemini format.",operationId:"connectGoogleRealtime",responses:{101:{description:"Switching Protocols to WebSocket"},426:{description:"Upgrade Required - Use WebSocket client"}}}},"/llama/v1/realtime":{get:{tags:["WebSocket","Llama"],summary:"Llama Realtime WebSocket",description:"Initiate a WebSocket connection using the Llama/OpenAI format.",operationId:"connectLlamaRealtime",responses:{101:{description:"Switching Protocols to WebSocket"},426:{description:"Upgrade Required - Use WebSocket client"}}}}},components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer",description:"API key authentication (optional, configure in extension settings)"}},schemas:{ChatCompletionRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string",description:"Model ID to use",example:this.config.defaultModel},messages:{type:"array",items:{$ref:"#/components/schemas/Message"},description:"List of messages in the conversation"},stream:{type:"boolean",default:!1,description:"Enable streaming responses"},temperature:{type:"number",minimum:0,maximum:2,description:"Sampling temperature"},max_tokens:{type:"integer",description:"Maximum tokens to generate"},tools:{type:"array",items:{$ref:"#/components/schemas/Tool"},description:"List of tools/functions available"},tool_choice:{type:"string",description:"How to select tools: auto, none, or specific"},response_format:{type:"object",properties:{type:{type:"string",enum:["text","json_object"]}},description:"Response format (json_object for JSON mode)"}}},Message:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["system","user","assistant","tool"],description:"Role of the message sender"},content:{type:"string",description:"Message content"},name:{type:"string",description:"Name of the sender (optional)"},tool_calls:{type:"array",items:{$ref:"#/components/schemas/ToolCall"}},tool_call_id:{type:"string",description:"ID of tool call this message responds to"}}},Tool:{type:"object",required:["type","function"],properties:{type:{type:"string",enum:["function"]},function:{type:"object",required:["name"],properties:{name:{type:"string"},description:{type:"string"},parameters:{type:"object",description:"JSON Schema for function parameters"}}}}},ToolCall:{type:"object",properties:{id:{type:"string"},type:{type:"string",enum:["function"]},function:{type:"object",properties:{name:{type:"string"},arguments:{type:"string"}}}}},ChatCompletionResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"chat.completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{index:{type:"integer"},message:{$ref:"#/components/schemas/Message"},finish_reason:{type:"string",enum:["stop","length","tool_calls"]}}}},usage:{$ref:"#/components/schemas/Usage"}}},CompletionRequest:{type:"object",required:["model","prompt"],properties:{model:{type:"string"},prompt:{type:"string",description:"Text prompt to complete"},max_tokens:{type:"integer",default:100},temperature:{type:"number"}}},CompletionResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"text_completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{text:{type:"string"},index:{type:"integer"},finish_reason:{type:"string"}}}},usage:{$ref:"#/components/schemas/Usage"}}},ResponsesRequest:{type:"object",required:["input"],properties:{model:{type:"string",description:"Model ID to use for generation"},input:{oneOf:[{type:"string",description:"Simple text input"},{type:"array",items:{type:"object",properties:{role:{type:"string",enum:["user","assistant","system"]},content:{type:"string"}}},description:"Array of message objects for multi-turn conversations"}]},instructions:{type:"string",description:"System prompt / instructions for the model"},stream:{type:"boolean",description:"Enable SSE streaming",default:!1},temperature:{type:"number",minimum:0,maximum:2,description:"Sampling temperature"},top_p:{type:"number",minimum:0,maximum:1,description:"Nucleus sampling parameter"},max_output_tokens:{type:"integer",description:"Maximum tokens to generate"},tools:{type:"array",items:{type:"object"},description:"Tool definitions for function calling"},metadata:{type:"object",description:"Custom metadata key-value pairs"}}},ResponsesResponse:{type:"object",properties:{id:{type:"string",description:"Unique response ID"},object:{type:"string",enum:["response"]},created_at:{type:"integer",description:"Unix timestamp"},model:{type:"string"},status:{type:"string",enum:["completed","failed","in_progress","cancelled"]},output:{type:"array",items:{type:"object",properties:{type:{type:"string",enum:["message"]},id:{type:"string"},role:{type:"string",enum:["assistant"]},content:{type:"array",items:{type:"object",properties:{type:{type:"string",enum:["output_text"]},text:{type:"string"}}}}}}},usage:{type:"object",properties:{input_tokens:{type:"integer"},output_tokens:{type:"integer"},total_tokens:{type:"integer"}}}}},TokenizeRequest:{type:"object",required:["text"],properties:{model:{type:"string"},text:{type:"string",description:"Text to tokenize"}}},TokenizeResponse:{type:"object",properties:{model:{type:"string"},token_count:{type:"integer"}}},ToolList:{type:"object",properties:{object:{type:"string",example:"list"},data:{type:"array",items:{type:"object",properties:{type:{type:"string",example:"function"},server:{type:"string",description:'MCP server name or "vscode"'},function:{type:"object",properties:{name:{type:"string"},description:{type:"string"},parameters:{type:"object"}}}}}}}},ToolCallRequest:{type:"object",required:["server","name"],properties:{server:{type:"string",description:'MCP server name or "vscode"'},name:{type:"string",description:"Tool name"},arguments:{type:"object",description:"Tool arguments"}}},ToolCallResponse:{type:"object",properties:{object:{type:"string",example:"tool_result"},server:{type:"string"},name:{type:"string"},result:{type:"object",description:"Result from the tool execution"}}},McpServerList:{type:"object",properties:{object:{type:"string",example:"list"},data:{type:"array",items:{type:"object",properties:{name:{type:"string"},status:{type:"string"},tools:{type:"array",items:{type:"string"}}}}}}},McpRefreshResponse:{type:"object",properties:{object:{type:"string",example:"refresh_result"},message:{type:"string"},connected:{type:"array",items:{type:"string"}}}},ModelList:{type:"object",properties:{object:{type:"string",example:"list"},data:{type:"array",items:{$ref:"#/components/schemas/Model"}}}},Model:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"model"},created:{type:"integer"},owned_by:{type:"string"}}},UsageResponse:{type:"object",properties:{object:{type:"string",example:"usage"},total_requests:{type:"integer"},total_tokens:{type:"object",properties:{input:{type:"integer"},output:{type:"integer"},total:{type:"integer"}}},uptime_seconds:{type:"integer"},active_requests:{type:"integer"}}},Usage:{type:"object",properties:{prompt_tokens:{type:"integer"},completion_tokens:{type:"integer"},total_tokens:{type:"integer"}}},Error:{type:"object",properties:{error:{type:"object",properties:{message:{type:"string"},type:{type:"string"},code:{type:"string"}}}}},AnthropicMessageRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string"},messages:{type:"array",items:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["user","assistant"]},content:{type:"string"}}}},system:{type:"string"},max_tokens:{type:"integer"},stream:{type:"boolean"}}},AnthropicMessageResponse:{type:"object",properties:{id:{type:"string"},type:{type:"string",example:"message"},role:{type:"string",example:"assistant"},content:{type:"array",items:{type:"object",properties:{type:{type:"string",example:"text"},text:{type:"string"}}}},model:{type:"string"},stop_reason:{type:"string"},usage:{type:"object",properties:{input_tokens:{type:"integer"},output_tokens:{type:"integer"}}}}},GoogleGenerateContentRequest:{type:"object",required:["contents"],properties:{contents:{type:"array",items:{type:"object",required:["parts"],properties:{role:{type:"string",enum:["user","model"]},parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}}},systemInstruction:{type:"object",properties:{parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}},generationConfig:{type:"object"}}},GoogleGenerateContentResponse:{type:"object",properties:{candidates:{type:"array",items:{type:"object",properties:{content:{type:"object",properties:{role:{type:"string"},parts:{type:"array",items:{type:"object",properties:{text:{type:"string"}}}}}},finishReason:{type:"string"}}}},usageMetadata:{type:"object",properties:{promptTokenCount:{type:"integer"},candidatesTokenCount:{type:"integer"},totalTokenCount:{type:"integer"}}}}},LlamaMessageRequest:{type:"object",required:["model","messages"],properties:{model:{type:"string",description:"Model ID to use"},messages:{type:"array",description:"List of messages in the conversation",items:{type:"object",required:["role","content"],properties:{role:{type:"string",enum:["system","user","assistant","tool"]},content:{type:"string"}}}},temperature:{type:"number",minimum:0,maximum:2},max_tokens:{type:"integer",description:"Maximum tokens to generate"},max_completion_tokens:{type:"integer",description:"Llama-style max tokens parameter"},stream:{type:"boolean",default:!1},top_p:{type:"number"},stop:{oneOf:[{type:"string"},{type:"array",items:{type:"string"}}]}}},LlamaMessageResponse:{type:"object",properties:{id:{type:"string"},object:{type:"string",example:"chat.completion"},created:{type:"integer"},model:{type:"string"},choices:{type:"array",items:{type:"object",properties:{index:{type:"integer"},message:{type:"object",properties:{role:{type:"string",example:"assistant"},content:{type:"string"}}},finish_reason:{type:"string",enum:["stop","length","tool_calls","content_filter"]}}}},usage:{type:"object",properties:{prompt_tokens:{type:"integer"},completion_tokens:{type:"integer"},total_tokens:{type:"integer"}}}}}}}}}sendError(e,r){let n=r.status??500,o={error:{message:r.message,type:r.type,code:r.code??null,param:null}};this.sendJson(e,n,o)}sendWsError(e,r){e.send(JSON.stringify({type:"error",error:{message:r.message,type:r.type,code:r.code??null}}))}setCorsHeaders(e){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Headers","authorization, content-type, x-requested-with"),e.setHeader("Access-Control-Allow-Methods","GET,POST,OPTIONS")}checkRateLimit(){if(this.config.rateLimitPerMinute<=0)return!0;let e=Date.now(),r=e-6e4;return this.rateLimitBucket=this.rateLimitBucket.filter(n=>n>r),this.rateLimitBucket.length>=this.config.rateLimitPerMinute?!1:(this.rateLimitBucket.push(e),!0)}getClientIp(e){let r=e.headers["x-forwarded-for"];if(r){let i=(typeof r=="string"?r:r[0])?.split(",")[0]?.trim();if(i)return i}let n=e.socket.remoteAddress||"unknown";return n.startsWith("::ffff:")?n.substring(7):n}checkIpAllowlist(e){let r=this.config.ipAllowlist;if(!r||r.length===0)return!0;let n=e.socket.remoteAddress;if(!n)return!1;let o=n.startsWith("::ffff:")?n.substring(7):n;for(let i of r)if(i.includes("/")){if(this.isIpInCidr(o,i))return!0}else if(/^[\d\.]+$|^[\da-fA-F:]+$/.test(i)){if(i===o)return!0}else{let s=this.domainCache.get(i);if(s&&s.includes(o))return!0}return!1}async refreshDomainCache(){let e=await import("dns").then(r=>r.promises);for(let r of this.config.ipAllowlist)if(/[a-zA-Z]/.test(r)&&!r.includes("/"))try{let n=await e.resolve4(r).catch(()=>[]),o=await e.resolve6(r).catch(()=>[]),i=[...n,...o];i.length>0&&this.domainCache.set(r,i)}catch{}}isIpInCidr(e,r){try{let[n,o]=r.split("/"),i=~(2**(32-parseInt(o,10))-1),s=e.split(".").map(Number),a=n.split(".").map(Number),c=s[0]<<24|s[1]<<16|s[2]<<8|s[3],u=a[0]<<24|a[1]<<16|a[2]<<8|a[3];return(c&i)===(u&i)}catch{return!1}}logRequest(e,r,n,o,i,s){let a=o>=400,c=s?.tokensIn??0,u=s?.tokensOut??0;this.recordRequestStats(i,c,u,a);let l={timestamp:new Date().toISOString(),requestId:e,method:r,path:n,status:o,durationMs:i,tokensIn:s?.tokensIn,tokensOut:s?.tokensOut,error:s?.error,model:s?.model,requestBody:s?.requestPayload,responseBody:s?.responsePayload,requestHeaders:s?.requestHeaders,responseHeaders:s?.responseHeaders},d=this.redactSensitiveData(l);if(this.auditService.logRequest(d),this._onDidLogRequest.fire(d),this.wsServer){let p=JSON.stringify({type:"log",data:d});this.wsServer.clients.forEach(f=>{f.readyState===1&&f.send(p)})}if(this.config.enableLogging){let p=a?"\u274C":o>=300?"\u26A0\uFE0F":"\u2705";this.output.appendLine(`[${new Date().toLocaleTimeString()}] ${p} ${r} ${n} ${o} (${i}ms)`),s?.error&&this.output.appendLine(`  Error: ${s.error}`)}}getCacheKey(e){return JSON.stringify({model:e?.model,messages:e?.messages,prompt:e?.prompt,tools:e?.tools,stream:e?.stream})}getFromCache(e){let r=this.requestCache.get(e);if(r&&Date.now()-r.timestamp<this.CACHE_TTL_MS)return r.response;this.requestCache.delete(e)}setCache(e,r){if(this.requestCache.size>100){let n=Date.now();for(let[o,i]of this.requestCache.entries())n-i.timestamp>this.CACHE_TTL_MS&&this.requestCache.delete(o)}this.requestCache.set(e,{response:r,timestamp:Date.now()})}buildUrl(e){let r=`http://${this.config.host}:${this.config.port}`;return new URL(e??"/",r)}async updateServerConfig(e){this.config={...this.config,...e},this._onDidChangeStatus.fire();let r=P.workspace.getConfiguration("githubCopilotApi"),n=[];e.enabled!==void 0&&n.push(Promise.resolve(r.update("server.enabled",e.enabled,P.ConfigurationTarget.Global))),e.enableHttp!==void 0&&n.push(Promise.resolve(r.update("server.enableHttp",e.enableHttp,P.ConfigurationTarget.Global))),e.enableWebSocket!==void 0&&n.push(Promise.resolve(r.update("server.enableWebSocket",e.enableWebSocket,P.ConfigurationTarget.Global))),e.enableHttps!==void 0&&n.push(Promise.resolve(r.update("server.enableHttps",e.enableHttps,P.ConfigurationTarget.Global))),e.host!==void 0&&n.push(Promise.resolve(r.update("server.host",e.host,P.ConfigurationTarget.Global))),e.port!==void 0&&n.push(Promise.resolve(r.update("server.port",e.port,P.ConfigurationTarget.Global))),e.maxConcurrentRequests!==void 0&&n.push(Promise.resolve(r.update("server.maxConcurrentRequests",e.maxConcurrentRequests,P.ConfigurationTarget.Global))),e.defaultModel!==void 0&&n.push(Promise.resolve(r.update("server.defaultModel",e.defaultModel,P.ConfigurationTarget.Global))),e.enableLogging!==void 0&&n.push(Promise.resolve(r.update("server.enableLogging",e.enableLogging,P.ConfigurationTarget.Global))),e.apiKey!==void 0&&n.push(Promise.resolve(r.update("server.apiKey",e.apiKey,P.ConfigurationTarget.Global))),e.rateLimitPerMinute!==void 0&&n.push(Promise.resolve(r.update("server.rateLimitPerMinute",e.rateLimitPerMinute,P.ConfigurationTarget.Global))),e.requestTimeoutSeconds!==void 0&&n.push(Promise.resolve(r.update("server.requestTimeoutSeconds",e.requestTimeoutSeconds,P.ConfigurationTarget.Global))),e.maxPayloadSizeMb!==void 0&&n.push(Promise.resolve(r.update("server.maxPayloadSizeMb",e.maxPayloadSizeMb,P.ConfigurationTarget.Global))),e.maxConnectionsPerIp!==void 0&&n.push(Promise.resolve(r.update("server.maxConnectionsPerIp",e.maxConnectionsPerIp,P.ConfigurationTarget.Global))),e.redactionPatterns!==void 0&&n.push(Promise.resolve(r.update("server.redactionPatterns",e.redactionPatterns,P.ConfigurationTarget.Global))),e.ipAllowlist!==void 0&&n.push(Promise.resolve(r.update("server.ipAllowlist",e.ipAllowlist,P.ConfigurationTarget.Global))),this.suppressRestart=!0;try{await Promise.all(n)}finally{this.suppressRestart=!1}await this.restart()}updateStatusBar(e,r){let n=`${this.config.enableHttp?"HTTP":""}${this.config.enableHttp&&this.config.enableWebSocket?"+":""}${this.config.enableWebSocket?"WS":""}`||"disabled";if(e==="starting"){this.statusItem.text="$(broadcast) Copilot API: Starting\u2026",this.statusItem.tooltip="Starting Copilot API gateway",this.statusItem.show();return}if(e==="running"){this.statusItem.text=`$(broadcast) Copilot API: On (${n})`;let o=`${this.config.host}:${this.config.port}`;this.statusItem.tooltip=r||`Copilot API is running on ${o}`,this.statusItem.show();return}this.statusItem.text="$(broadcast) Copilot API: Off",this.statusItem.tooltip=r??"Copilot API gateway is stopped",this.statusItem.hide()}async showControlPalette(){let e=P.workspace.getConfiguration("githubCopilotApi"),r=[{label:"$(check) Start HTTP + WebSocket",description:"Enable and start all endpoints"},{label:"$(primitive-square) Stop Server",description:"Disable all endpoints"},{label:`${this.config.enableHttp?"$(circle-slash)":"$(play)"} Toggle HTTP`,description:this.config.enableHttp?"Disable HTTP REST endpoints":"Enable HTTP REST endpoints"},{label:`${this.config.enableWebSocket?"$(circle-slash)":"$(play)"} Toggle WebSocket`,description:this.config.enableWebSocket?"Disable WebSocket realtime endpoint":"Enable WebSocket realtime endpoint"},{label:"$(globe) Listen on localhost",description:"Bind to 127.0.0.1"},{label:"$(rss) Listen on all interfaces",description:"Bind to 0.0.0.0 for LAN access"},{label:"$(plug) Change port",description:`Current: ${this.config.port}`},{label:"$(settings) Open settings",description:"Open Copilot API settings"}],n=await P.window.showQuickPick(r,{placeHolder:"Copilot API controls"});if(n){if(n.label.includes("Start")){await e.update("server.enabled",!0,P.ConfigurationTarget.Global),await e.update("server.enableHttp",!0,P.ConfigurationTarget.Global),await e.update("server.enableWebSocket",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("Stop")){await e.update("server.enabled",!1,P.ConfigurationTarget.Global);return}if(n.label.includes("Toggle HTTP")){await e.update("server.enableHttp",!this.config.enableHttp,P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("Toggle WebSocket")){await e.update("server.enableWebSocket",!this.config.enableWebSocket,P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("localhost")){await e.update("server.host","127.0.0.1",P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("all interfaces")){await e.update("server.host","0.0.0.0",P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global);return}if(n.label.includes("Change port")){let o=await P.window.showInputBox({title:"Set API server port",value:String(this.config.port),validateInput:i=>{let s=Number(i);return!Number.isFinite(s)||s<=0||s>65535?"Enter a valid port between 1 and 65535":null}});o&&(await e.update("server.port",Number(o),P.ConfigurationTarget.Global),await e.update("server.enabled",!0,P.ConfigurationTarget.Global));return}n.label.includes("settings")&&await P.commands.executeCommand("workbench.action.openSettings","githubCopilotApi.server")}}logInfo(e){this.output.appendLine(`[${new Date().toISOString()}] INFO ${e}`)}logError(e,r){this.output.appendLine(`[${new Date().toISOString()}] ERROR ${e}: ${Xu(r)}`)}};async function i$(){let t=P.extensions.getExtension(uve);if(!t)return await P.window.showWarningMessage("GitHub Copilot Chat extension is required. Install it from the Marketplace to continue.","Open Marketplace","Cancel")==="Open Marketplace"&&await P.commands.executeCommand("workbench.extensions.search",lve),!1;if(!t.isActive)try{await t.activate()}catch(e){return P.window.showErrorMessage(`Failed to activate GitHub Copilot Chat: ${Xu(e)}`),!1}return!0}function AD(t){if(typeof t=="string")return t.trim()||void 0;if(Array.isArray(t))return t.map(e=>typeof e=="string"?e:"").join(" ").trim()||void 0}function HG(){let t=P.workspace.getConfiguration("githubCopilotApi"),e=t.get("server.enabled",!1),r=t.get("server.enableHttp",!0),n=t.get("server.enableWebSocket",!0),o=t.get("server.enableHttps",!1),i=t.get("server.tlsCertPath","").trim(),s=t.get("server.tlsKeyPath","").trim(),a=t.get("server.host","127.0.0.1").trim()||"127.0.0.1",c=t.get("server.port",3030),u=Number.isFinite(c)?Math.max(1,Math.floor(c)):3030,l=t.get("server.maxConcurrentRequests",4),d=Number.isFinite(l)?Math.max(1,Math.floor(l)):4,p=(t.get("server.defaultModel","gpt-4o-copilot")??"gpt-4o-copilot").trim()||"gpt-4o-copilot",f=t.get("server.apiKey","").trim(),h=t.get("server.enableLogging",!1),m=t.get("server.rateLimitPerMinute",60),y=Number.isFinite(m)?Math.max(0,Math.floor(m)):60,v=t.get("server.defaultSystemPrompt","").trim(),x=t.get("server.redactionPatterns",[]).map((Fe,Yt)=>typeof Fe=="string"?{id:`migrated-${Yt}`,name:`Custom Pattern ${Yt+1}`,pattern:Fe,enabled:!0,isBuiltin:!1}:Fe),C=[];for(let Fe of dve){let Yt=x.find(en=>en.id===Fe.id);Yt?C.push({...Fe,enabled:Yt.enabled}):C.push(Fe)}for(let Fe of x)Fe.isBuiltin||C.push(Fe);let $=t.get("server.ipAllowlist",[]),L=t.get("server.requestTimeoutSeconds",180),xe=t.get("server.maxPayloadSizeMb",1),ve=t.get("server.maxConnectionsPerIp",10),Se=P.workspace.getConfiguration("githubCopilotApi.mcp").get("enabled",!0);return{enabled:e,enableHttp:r,enableWebSocket:n,enableHttps:o,tlsCertPath:i,tlsKeyPath:s,host:a,port:u,maxConcurrentRequests:d,defaultModel:p,apiKey:f,enableLogging:h,rateLimitPerMinute:y,defaultSystemPrompt:v,redactionPatterns:C,ipAllowlist:$,requestTimeoutSeconds:L,maxPayloadSizeMb:xe,maxConnectionsPerIp:ve,mcpEnabled:Se}}function Xu(t){return t instanceof Error&&t.message?t.message:String(t)}var Ct=It(require("vscode")),La=class t{constructor(e,r){this._extensionUri=e;this._gatewayAccessor=r;this._init()}static viewType="copilotApiControls";_view;static currentPanel;_lastRunningState;static panelDisposables=[];_gateway;async _init(){}async resolveWebviewView(e,r,n){this._view=e,this._gateway=await this._gatewayAccessor(),this._hookEvents(this._gateway),e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},await(async()=>{this._gateway&&(e.webview.html=await this._getSidebarHtml(e.webview))})(),e.webview.onDidReceiveMessage(async i=>{if(this._gateway)switch(i.type){case"openDashboard":await t.createOrShow(this._extensionUri,this._gatewayAccessor);break;case"startServer":this._gateway.startServer();break;case"stopServer":this._gateway.stopServer();break;case"openSwagger":{let s=await this._gateway.getStatus(),a=`http://${s.config.host}:${s.config.port}/docs`;Ct.env.openExternal(Ct.Uri.parse(a));break}case"openWiki":await t.openWiki(this._extensionUri,this._gateway);break;case"openUrl":typeof i.value=="string"&&Ct.commands.executeCommand("vscode.open",Ct.Uri.parse(i.value));break;case"editSystemPrompt":Ct.commands.executeCommand("github-copilot-api-vscode.editSystemPrompt");break;default:t.handleMessage(i,this._gateway)}})}_hookEvents(e){e.onDidChangeStatus(async()=>{let r=await e.getStatus();if(this._lastRunningState===r.running){let n=e.getServerStatus().activeConnections;this._view&&(this._view.webview.postMessage({type:"statsData",data:r.stats}),this._view.webview.postMessage({type:"realtimeStats",data:{...r.realtimeStats,activeConnections:n}})),t.currentPanel&&(t.currentPanel.webview.postMessage({type:"statsData",data:r.stats}),t.currentPanel.webview.postMessage({type:"realtimeStats",data:{...r.realtimeStats,activeConnections:n}}));return}this._lastRunningState=r.running,this._view&&(this._view.webview.html=await this._getSidebarHtml(this._view.webview)),t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,e))}),e.onDidLogRequest(r=>{this._view&&this._view.webview.postMessage({type:"liveLog",value:r}),t.currentPanel&&t.currentPanel.webview.postMessage({type:"liveLog",value:r})}),e.onDidLogRequestStart(r=>{this._view&&this._view.webview.postMessage({type:"liveLogStart",value:r}),t.currentPanel&&t.currentPanel.webview.postMessage({type:"liveLogStart",value:r})})}static async createOrShow(e,r,n){let o=Ct.window.activeTextEditor?.viewColumn??Ct.ViewColumn.One,i=await r();if(t.currentPanel){t.currentPanel.reveal(o),t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,i),n&&t.currentPanel.webview.postMessage({type:"scrollTo",target:n});return}let s=Ct.window.createWebviewPanel("copilotApiDashboard","Copilot API Dashboard",o,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});t.currentPanel=s,s.webview.onDidReceiveMessage(a=>{t.handleMessage(a,i)},void 0,t.panelDisposables),s.webview.html=await t.getPanelHtml(s.webview,i),n&&setTimeout(()=>{s.webview.postMessage({type:"scrollTo",target:n})},300),s.onDidDispose(()=>{t.currentPanel=void 0;for(let a of t.panelDisposables)a.dispose();t.panelDisposables=[]},null,t.panelDisposables)}static wikiPanel;static async openWiki(e,r){let n=Ct.window.activeTextEditor?.viewColumn??Ct.ViewColumn.One;if(t.wikiPanel){t.wikiPanel.reveal(n);return}let o=Ct.window.createWebviewPanel("copilotApiWiki","\u{1F4DA} API Usage Guide",n,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});t.wikiPanel=o,o.webview.html=await t.getWikiHtml(o.webview,r),o.onDidDispose(()=>{t.wikiPanel=void 0})}static async getWikiHtml(e,r){let n=PD(),o=await r.getStatus(),i=o.config,s=o.running,a=r.getServerStatus().activeConnections,c=r.getAuditService(),u=await c.getLifetimeStats(),l=await c.getTodayStats(),d=2.5/1e6,p=10/1e6,f=u.totalTokensIn*d+u.totalTokensOut*p,h=l.tokensIn*d+l.tokensOut*p,m=y=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(y);return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}';">
    <title>API Usage Guide</title>
    <style>
        body {
            font-family: var(--vscode-font-family);
            padding: 20px;
            color: var(--vscode-foreground);
            background: var(--vscode-editor-background);
            line-height: 1.6;
        }
        h1 { margin-top: 0; }
        .muted { opacity: 0.7; }
        .wiki-tab {
            padding: 10px 20px;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            background: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
            transition: all 0.2s;
        }
        .wiki-tab.active {
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
        }
        .wiki-tab:hover {
            opacity: 0.9;
        }
        .wiki-panel {
            display: none;
        }
        .wiki-panel.active {
            display: block;
        }
        pre {
            background: var(--vscode-textBlockQuote-background);
            padding: 14px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            font-family: var(--vscode-editor-font-family);
        }
        h4 {
            color: var(--vscode-textLink-foreground);
            margin-top: 24px;
        }
        .tool-card {
            background: var(--vscode-textBlockQuote-background);
            padding: 14px;
            border-radius: 8px;
            border-left: 3px solid var(--vscode-textLink-foreground);
            margin-bottom: 12px;
        }
        code {
            font-size: 12px;
            color: var(--vscode-textPreformat-foreground);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>\u{1F4DA} API Usage Guide</h1>
    <p class="muted">Complete reference for connecting to the Copilot API Gateway from various languages.</p>

    <div id="wiki-tabs" style="display: flex; gap: 4px; margin: 20px 0 16px; flex-wrap: wrap;">
        <button class="wiki-tab active" data-tab="python">\u{1F40D} Python</button>
        <button class="wiki-tab" data-tab="javascript">\u{1F4DC} JavaScript</button>
        <button class="wiki-tab" data-tab="curl">\u{1F527} cURL</button>
        <button class="wiki-tab" data-tab="mcp">\u{1F50C} MCP Tools</button>
    </div>

    <div id="wiki-content" style="background: var(--vscode-sideBar-background); border-radius: 0 8px 8px 8px; padding: 20px;">
        <!-- Python Tab -->
        <div class="wiki-panel active" data-panel="python">
            <h4 style="margin-top: 0;">\u{1F4E6} Installation</h4>
            <pre>pip install openai</pre>

            <h4>\u{1F680} Quick Start</h4>
            <pre>from openai import OpenAI

client = OpenAI(
    base_url="http://${i.host}:${i.port}/v1",
    api_key="not-needed"
)

response = client.chat.completions.create(
    model="gpt-4o",
    messages=[
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": "Hello!"}
    ]
)

print(response.choices[0].message.content)</pre>

            <h4>\u{1F4E1} Streaming</h4>
            <pre>stream = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": "Tell me a story"}],
    stream=True
)

for chunk in stream:
    if chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="", flush=True)</pre>
        </div>

        <!-- JavaScript Tab -->
        <div class="wiki-panel" data-panel="javascript">
            <h4 style="margin-top: 0;">\u{1F4E6} Installation</h4>
            <pre>npm install openai</pre>

            <h4>\u{1F680} Quick Start</h4>
            <pre>import OpenAI from 'openai';

const openai = new OpenAI({
  baseURL: 'http://${i.host}:${i.port}/v1',
  apiKey: 'not-needed'
});

const completion = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [{ role: 'user', content: 'Hello!' }]
});

console.log(completion.choices[0].message.content);</pre>

            <h4>\u{1F4E1} Streaming</h4>
            <pre>const stream = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [{ role: 'user', content: 'Tell me a story' }],
  stream: true
});

for await (const chunk of stream) {
  process.stdout.write(chunk.choices[0]?.delta?.content || '');
}</pre>
        </div>

        <!-- cURL Tab -->
        <div class="wiki-panel" data-panel="curl">
            <h4 style="margin-top: 0;">\u{1F527} Basic Request</h4>
            <pre>curl -X POST http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'</pre>

            <h4>\u{1F4E1} Streaming</h4>
            <pre>curl -X POST http://${i.host}:${i.port}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "Hello!"}],
    "stream": true
  }'</pre>

            <h4>\u{1F4CB} List Models</h4>
            <pre>curl http://${i.host}:${i.port}/v1/models</pre>
        </div>

        <!-- MCP Tab -->
        <div class="wiki-panel" data-panel="mcp">
            <h4 style="margin-top: 0;">\u{1F50C} Built-in VS Code Tools</h4>
            <p class="muted">These tools are automatically available via MCP:</p>

            <div class="tool-card" style="border-left-color: #10b981;">
                <code>vscode_read_file</code>
                <div class="muted" style="font-size: 11px; margin-top: 4px;">Read the contents of any file in the workspace</div>
            </div>

            <div class="tool-card" style="border-left-color: #3b82f6;">
                <code>vscode_list_files</code>
                <div class="muted" style="font-size: 11px; margin-top: 4px;">List files in a directory with optional glob pattern</div>
            </div>

            <div class="tool-card" style="border-left-color: #f59e0b;">
                <code>vscode_open_file</code>
                <div class="muted" style="font-size: 11px; margin-top: 4px;">Open a file in VS Code editor</div>
            </div>

            <div class="tool-card" style="border-left-color: #ef4444;">
                <code>vscode_get_diagnostics</code>
            <h4 style="margin-top: 0;">\u{1F50C} Model Context Protocol (MCP)</h4>
            <p>Connect GitHub Copilot to your local tools and data using the <a href="https://modelcontextprotocol.io">Model Context Protocol</a>.</p>

            <h4>1. Configuration</h4>
            <p>Edit your VS Code <code>settings.json</code> to add MCP servers:</p>
            <pre>{
  "githubCopilotApi.mcp.enabled": true,
  "githubCopilotApi.mcp.servers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/Users/me/projects"]
    },
    "postgres": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-postgres", "postgresql://localhost/mydb"]
    }
  }
}</pre>

            <h4>2. Usage</h4>
            <p>Once configured, restart the server. Tools provided by these servers (e.g., <code>read_file</code>, <code>query_database</code>) will be automatically available to the API.</p>
            <p>You can then use them in your API requests by enabling tool use, or letting your agent framework discover them.</p>

            <div class="tool-card">
                <strong>\u{1F4A1} Pro Tip:</strong> Use the "Tools" tab in the dashboard (coming soon) to verify connected servers and see available tools.
            </div>
        </div>
    </div>

    <script nonce="${n}">
        const tabs = document.querySelectorAll('.wiki-tab');
        const panels = document.querySelectorAll('.wiki-panel');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all
                tabs.forEach(t => t.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));

                // Add active class to clicked tab and corresponding panel
                tab.classList.add('active');
                const panelId = tab.getAttribute('data-tab');
                document.querySelector(\`.wiki-panel[data-panel="\${panelId}"]\`).classList.add('active');
            });
        });
    </script>
</body>
</html>`}static handleMessage(e,r){switch(e.type){case"openChat":Ct.commands.executeCommand("github-copilot-api-vscode.openCopilotChat");break;case"askCopilot":Ct.commands.executeCommand("github-copilot-api-vscode.askCopilot");break;case"showControls":Ct.commands.executeCommand("github-copilot-api-vscode.showServerControls");break;case"startServer":r.startServer();break;case"stopServer":r.stopServer();break;case"openUrl":typeof e.value=="string"&&Ct.commands.executeCommand("vscode.open",Ct.Uri.parse(e.value));break;case"toggleHttp":r.toggleHttp();break;case"toggleWs":r.toggleWebSocket();break;case"toggleLogging":r.toggleLogging();break;case"toggleHttps":r.toggleHttps();break;case"setApiKey":typeof e.value=="string"&&r.setApiKey(e.value);break;case"setRateLimit":typeof e.value=="number"&&r.setRateLimit(e.value);break;case"hostLocal":r.setHost("127.0.0.1");break;case"hostLan":r.setHost("0.0.0.0");break;case"setHost":typeof e.value=="string"&&r.setHost(e.value);break;case"setPort":typeof e.value=="number"&&r.setPort(e.value);break;case"setModel":typeof e.value=="string"&&r.setDefaultModel(e.value);break;case"clearHistory":r.clearHistory();break;case"toggleMcp":typeof e.value=="boolean"&&r.toggleMcp(e.value);break;case"addRedactionPattern":if(e.value&&typeof e.value=="object"){let{name:o,pattern:i}=e.value;r.addRedactionPattern(o,i).then(async s=>{s?t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r)):Ct.window.showErrorMessage("Invalid regex pattern")})}break;case"removeRedactionPattern":typeof e.value=="string"&&r.removeRedactionPattern(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"toggleRedactionPattern":if(e.value&&typeof e.value=="object"){let{id:o,enabled:i}=e.value;r.toggleRedactionPattern(o,i)}break;case"addIpAllowlistEntry":typeof e.value=="string"&&r.addIpAllowlistEntry(e.value).then(async o=>{o?t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r)):Ct.window.showErrorMessage("Invalid IP address or CIDR range")});break;case"removeIpAllowlistEntry":typeof e.value=="string"&&r.removeIpAllowlistEntry(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setRequestTimeout":typeof e.value=="number"&&r.setRequestTimeout(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxPayloadSize":typeof e.value=="number"&&r.setMaxPayloadSize(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxConnectionsPerIp":typeof e.value=="number"&&r.setMaxConnectionsPerIp(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"setMaxConcurrency":typeof e.value=="number"&&r.setMaxConcurrency(e.value).then(async()=>{t.currentPanel&&(t.currentPanel.webview.html=await t.getPanelHtml(t.currentPanel.webview,r))});break;case"getHistory":if(t.currentPanel){let o=r.getHistory(50);t.currentPanel.webview.postMessage({type:"historyData",data:o})}break;case"getStats":if(t.currentPanel){let o=r.getStats(),i=r.getServerStatus().activeConnections;t.currentPanel.webview.postMessage({type:"statsData",data:o}),t.currentPanel.webview.postMessage({type:"realtimeStats",data:{requestsPerMinute:o.requestsPerMinute,avgLatencyMs:o.avgLatencyMs,errorRate:o.errorRate,activeConnections:i}})}break;case"getAuditStats":t.currentPanel&&r.getDailyStats(30).then(o=>{t.currentPanel?.webview.postMessage({type:"auditStatsData",data:o})});break;case"getAuditLogs":if(t.currentPanel){let o=e.value||{},i=o.page||1,s=o.pageSize||10;r.getAuditLogs(i,s).then(a=>{t.currentPanel?.webview.postMessage({type:"auditLogData",data:a.entries,page:i,total:a.total,pageSize:s})}).catch(a=>{t.currentPanel?.webview.postMessage({type:"auditLogData",data:[],page:i,total:0,pageSize:s})})}break;case"openLogFolder":let n=r.getLogFolderPath();n?Ct.commands.executeCommand("revealFileInOS",Ct.Uri.file(n)):Ct.window.showErrorMessage("Log folder not found");break;case"editSystemPrompt":Ct.commands.executeCommand("github-copilot-api-vscode.editSystemPrompt");break}}async _getSidebarHtml(e){let r=PD();if(!this._gateway)return"<p>Loading...</p>";let n=await this._gateway.getStatus(),o=n.running,i=o?"var(--vscode-testing-iconPassed)":"var(--vscode-testing-iconFailed)",s=o?"Running":"Stopped",a=n.isHttps?"https":"http",c=n.config.host==="0.0.0.0"&&n.networkInfo?.localIPs?.length?n.networkInfo.localIPs[0]:n.config.host,u=`${a}://${c}:${n.config.port}`,l=n.stats||{totalRequests:0,totalTokensIn:0,totalTokensOut:0,requestsPerMinute:0,avgLatencyMs:0},d=n.realtimeStats||{requestsPerMinute:0,avgLatencyMs:0,errorRate:0},p=await this._gateway.getDailyStats(7),f=Math.max(...p.map(x=>x.totalRequests),1),h=20,m=6,y=50,v=(h+m)*7,b=p.map((x,C)=>{let $=Math.max(2,x.totalRequests/f*y),L=C*(h+m),xe=y-$,ve=new Date(x.date).toLocaleDateString("en",{weekday:"short"}).charAt(0);return`
                <rect x="${L}" y="${xe}" width="${h}" height="${$}" rx="3" fill="var(--vscode-charts-blue)" opacity="0.8"/>
                <text x="${L+h/2}" y="${y+12}" font-size="8" fill="var(--vscode-descriptionForeground)" text-anchor="middle">${ve}</text>
            `}).join("");return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${r}';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 0; font-family: var(--vscode-font-family); color: var(--vscode-foreground); background: var(--vscode-sideBar-background); }
        .section { padding: 12px; border-bottom: 1px solid var(--vscode-widget-border); }
        .section:last-child { border-bottom: none; }
        .section-title { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.6; margin-bottom: 10px; font-weight: 600; }
        .status-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: ${i}; box-shadow: 0 0 6px ${i}; }
        .url { font-family: var(--vscode-editor-font-family); font-size: 10px; opacity: 0.7; word-break: break-all; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .stat-card { background: var(--vscode-editor-background); border-radius: 6px; padding: 8px 10px; text-align: center; border: 1px solid var(--vscode-widget-border); }
        .stat-value { font-size: 18px; font-weight: 700; color: var(--vscode-foreground); }
        .stat-label { font-size: 9px; text-transform: uppercase; opacity: 0.6; margin-top: 2px; }
        .chart-container { background: var(--vscode-editor-background); border-radius: 8px; padding: 12px; border: 1px solid var(--vscode-widget-border); }
        .chart-title { font-size: 11px; font-weight: 600; margin-bottom: 8px; opacity: 0.9; }
        button { width: 100%; padding: 8px 12px; margin-bottom: 6px; background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; border-radius: 4px; cursor: pointer; font-family: var(--vscode-font-family); font-weight: 500; font-size: 12px; }
        button:hover { background: var(--vscode-button-hoverBackground); }
        button.secondary { background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }
        button.secondary:hover { background: var(--vscode-button-secondaryHoverBackground); }
        .btn-row { display: flex; gap: 6px; margin-bottom: 6px; }
        .btn-row button { flex: 1; padding: 6px 8px; font-size: 11px; margin-bottom: 0; }
        .copilot-status { font-size: 10px; opacity: 0.7; display: flex; align-items: center; gap: 5px; margin-top: 4px; }
        .copilot-dot { width: 6px; height: 6px; border-radius: 50%; }
    </style>
</head>
<body>
    <!-- Status Section (at top) -->
    <div class="section">
        <div class="section-title">Server Status</div>
        <div class="status-row">
            <div class="dot"></div>
            <strong>${s}</strong>
        </div>
        <div class="url">${u}</div>
        <div class="copilot-status">
            <div class="copilot-dot" style="background: ${n.copilot.ready?"var(--vscode-testing-iconPassed)":"var(--vscode-editorWarning-foreground)"}"></div>
            Copilot: ${n.copilot.ready?"Ready":n.copilot.signedIn?"Checking":"Sign-in Needed"}
        </div>
    </div>

    <!-- Quick Copy Section -->
    <div class="section">
        <div class="section-title">\u{1F4CB} Quick Copy</div>
        <div class="btn-row">
            <button id="btn-copy-url" class="secondary" title="Copy API URL">URL</button>
            <button id="btn-copy-curl" class="secondary" title="Copy curl command">curl</button>
            <button id="btn-copy-python" class="secondary" title="Copy Python code">Python</button>
        </div>
    </div>

    <!-- Actions Section -->
    <div class="section">
        <div class="section-title">\u26A1 Actions</div>
        <div class="actions">
            <button id="btn-toggle" class="secondary">${o?"\u23F9 Stop Server":"\u25B6 Start Server"}</button>
            <button id="btn-edit-system-prompt" class="secondary">\u{1F4DD} System Prompt</button>
            <button id="btn-swagger" class="secondary">\u{1F4DD} Swagger API</button>
            <button id="btn-wiki" class="secondary">\u{1F4DA} Wiki</button>
            <button id="btn-docs" class="secondary">\u{1F4DA} How to Use</button>
            <button id="btn-dashboard" class="primary">Open Dashboard \u2197</button>
            <button id="btn-notes" class="secondary">\u{1F4D6} Things you should read</button>
        </div>
    </div>

    <!-- Analytics Section -->
    <div class="section">
        <div class="section-title">\u{1F4CA} Live Stats</div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="stat-rpm">${d.requestsPerMinute}</div>
                <div class="stat-label">Req/Min</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-latency">${d.avgLatencyMs}<span style="font-size: 10px; opacity: 0.6;">ms</span></div>
                <div class="stat-label">Latency</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">Requests (Last 7 Days)</div>
            <svg width="${v}" height="${y+16}" style="display: block; margin: 0 auto;">
                ${b}
            </svg>
        </div>
    </div>

    <!-- Token Usage Section -->
    <div class="section">
        <div class="section-title">\u{1F3AB} Token Usage</div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="stat-tokens-in" style="font-size: 14px; color: var(--vscode-charts-green);">${this.formatNumber(l.totalTokensIn)}</div>
                <div class="stat-label">Tokens In</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-tokens-out" style="font-size: 14px; color: var(--vscode-charts-orange);">${this.formatNumber(l.totalTokensOut)}</div>
                <div class="stat-label">Tokens Out</div>
        </div>
    </div>

    <!-- GitHub Star Section -->
    <div class="section" style="text-align: center; padding: 16px 12px;">
        <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
            <a href="https://github.com/suhaibbinyounis/github-copilot-api-vscode" 
               target="_blank" 
               style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border-radius: 6px; text-decoration: none; font-size: 12px; font-weight: 500; transition: background 0.15s ease;">
                \u2B50 Star
            </a>
            <a href="https://github.com/sponsors/suhaibbinyounis" 
               target="_blank" 
               style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: linear-gradient(135deg, #ea4aaa 0%, #db61a2 100%); color: white; border-radius: 6px; text-decoration: none; font-size: 12px; font-weight: 500; transition: opacity 0.15s ease;">
                \u{1F496} Sponsor
            </a>
        </div>
        <div style="margin-top: 10px; font-size: 10px; opacity: 0.65; line-height: 1.4;">
            Enjoying this extension? A star helps others discover it.<br>
            If it's saved you time or money, consider sponsoring \u2014 it keeps this project alive. \u{1F499}
        </div>
    </div>

    <script nonce="${r}">
        const vscode = acquireVsCodeApi();
        const serverUrl = '${u}';
        const curlCommand = \`curl -X POST ${u}/v1/chat/completions \\\\
  -H "Content-Type: application/json" \\\\
  -d '{"model": "gpt-4o", "messages": [{"role": "user", "content": "Hello!"}]}'\`;
        const pythonCode = \`from openai import OpenAI

client = OpenAI(base_url="${u}/v1", api_key="optional")
response = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": "Hello!"}]
)
print(response.choices[0].message.content)\`;

        function copyWithFeedback(btn, text) {
            navigator.clipboard.writeText(text).then(() => {
                const original = btn.textContent;
                btn.textContent = '\u2713 Copied!';
                btn.style.background = 'var(--vscode-testing-iconPassed)';
                btn.style.color = 'var(--vscode-editor-background)';
                setTimeout(() => {
                    btn.textContent = original;
                    btn.style.background = '';
                    btn.style.color = '';
                }, 1500);
            });
        }

        document.getElementById('btn-copy-url').addEventListener('click', (e) => copyWithFeedback(e.target, serverUrl));
        document.getElementById('btn-copy-curl').addEventListener('click', (e) => copyWithFeedback(e.target, curlCommand));
        document.getElementById('btn-copy-python').addEventListener('click', (e) => copyWithFeedback(e.target, pythonCode));
        document.getElementById('btn-dashboard').addEventListener('click', () => vscode.postMessage({ type: 'openDashboard' }));
        document.getElementById('btn-toggle').addEventListener('click', () => vscode.postMessage({ type: '${o?"stopServer":"startServer"}' }));
        document.getElementById('btn-edit-system-prompt').addEventListener('click', () => vscode.postMessage({ type: 'editSystemPrompt' }));
        document.getElementById('btn-swagger').addEventListener('click', () => vscode.postMessage({ type: 'openSwagger' }));
        document.getElementById('btn-swagger').addEventListener('click', () => vscode.postMessage({ type: 'openSwagger' }));
        document.getElementById('btn-wiki').addEventListener('click', () => vscode.postMessage({ type: 'openWiki' }));
        const btnDocs = document.getElementById('btn-docs');
        if (btnDocs) {
            btnDocs.addEventListener('click', () => vscode.postMessage({ type: 'openUrl', value: 'https://notes.suhaib.in/docs/vscode/extensions/github-copilot-api-gateway/' }));
        }
        const btnNotes = document.getElementById('btn-notes');
        if (btnNotes) {
            btnNotes.addEventListener('click', () => vscode.postMessage({ type: 'openUrl', value: 'https://notes.suhaib.in' }));
        }

        // Listen for real-time stats updates from extension
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        window.addEventListener('message', event => {
            const message = event.data;
            if (message.type === 'realtimeStats' && message.data) {
                const stats = message.data;
                const rpmEl = document.getElementById('stat-rpm');
                const latencyEl = document.getElementById('stat-latency');
                if (rpmEl) rpmEl.textContent = stats.requestsPerMinute;
                if (latencyEl) latencyEl.innerHTML = stats.avgLatencyMs + '<span style="font-size: 10px; opacity: 0.6;">ms</span>';
            }
            if (message.type === 'statsData' && message.data) {
                const stats = message.data;
                const tokensInEl = document.getElementById('stat-tokens-in');
                const tokensOutEl = document.getElementById('stat-tokens-out');
                if (tokensInEl) tokensInEl.textContent = formatNumber(stats.totalTokensIn);
                if (tokensOutEl) tokensOutEl.textContent = formatNumber(stats.totalTokensOut);
            }
        });
    </script>
</body>
</html>`}formatNumber(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}static async getPanelHtml(e,r){let n=PD(),o=await r.getStatus(),i=o.config,s=o.running,a=s?"var(--vscode-testing-iconPassed)":"var(--vscode-testing-iconFailed)",c=s?"Running":"Stopped",u=o.isHttps?"https":"http",l=o.networkInfo,d=i.host==="0.0.0.0"&&l?.localIPs?.length?l.localIPs[0]:i.host,p=`${u}://${d}:${i.port}`,f=r.getServerStatus().activeConnections,h=r.getAuditService(),m=await h.getLifetimeStats(),y=await h.getTodayStats(),v=2.5/1e6,b=10/1e6,x=m.totalTokensIn*v+m.totalTokensOut*b,C=y.tokensIn*v+y.tokensOut*b,$=L=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(L);return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}' https://cdn.jsdelivr.net; connect-src http: https:;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot API Dashboard</title>
    <title>Copilot API Dashboard</title>
    <!-- Removed Chart.js for reliability -->
    <style>
        :root {
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color-scheme: var(--vscode-color-scheme);
        }
        body {
            margin: 0; padding: 0; min-height: 100vh;
            background-color: var(--vscode-editor-background);
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            font-size: 13px; /* Enhanced legibility */
            line-height: 1.5;
        }
        
        /* Layout */
        .page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 32px 64px; /* More breathing room */
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        /* Typography */
        h1 { margin: 0; font-size: 28px; letter-spacing: -0.5px; font-weight: 600; color: var(--vscode-foreground); }
        h3 { margin-top: 0; margin-bottom: 16px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; opacity: 0.9; color: var(--vscode-foreground); }
        h4 { margin: 0; font-size: 14px; font-weight: 600; color: var(--vscode-foreground); }
        p { margin: 0; font-size: 13px; color: var(--vscode-descriptionForeground); line-height: 1.5; }
        
        .hero { display: flex; justify-content: space-between; align-items: flex-start; gap: 32px; padding-bottom: 16px; }
        .hero p { margin-top: 8px; font-size: 14px; max-width: 600px; }
        
        .badge {
            display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px;
            border-radius: 999px;
            background: var(--vscode-badge-background);
            color: var(--vscode-badge-foreground);
            font-size: 11px; font-weight: 600;
        }

        /* Cards */
        .card {
            background-color: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-widget-border);
            border-radius: 12px;
            padding: 24px; /* increased padding */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s var(--ease-smooth), box-shadow 0.2s var(--ease-smooth), border-color 0.2s var(--ease-smooth);
        }
        .card:hover {
            border-color: var(--vscode-focusBorder);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
        }
        .card.full-width { grid-column: 1 / -1; }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            margin-top: 4px;
        }
        .stat-sub {
            font-size: 12px;
            opacity: 0.6;
            margin-top: 4px;
        }
        .money-saved {
            color: var(--vscode-testing-iconPassed); /* Green-ish usually */
        }
        
        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .info-grid { display: grid; grid-template-columns: 140px 1fr; gap: 12px; font-size: 13px; align-items: center; }
        .label { color: var(--vscode-descriptionForeground); font-weight: 500; }
        .value { color: var(--vscode-foreground); font-family: var(--vscode-editor-font-family); }

        /* Actions & Buttons */
        .actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }
        
        button {
            display: inline-flex; justify-content: center; align-items: center; gap: 8px;
            width: 100%; height: 32px; /* Touch target */
            padding: 0 16px;
            background-color: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: 1px solid transparent;
            border-radius: 999px; /* Pill shape */
            cursor: pointer;
            font-family: inherit; font-size: 13px; font-weight: 500;
            transition: all 0.2s var(--ease-smooth);
        }
        button:hover {
            background-color: var(--vscode-button-hoverBackground);
            transform: translateY(-1px);
        }
        button:active { transform: scale(0.98); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        button.secondary {
            background-color: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
        }
        button.secondary:hover {
            background-color: var(--vscode-button-secondaryHoverBackground);
        }

        .section-title {
            font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
            color: var(--vscode-descriptionForeground);
            margin-bottom: 12px; display: flex; align-items: center; gap: 8px;
        }
        .section-title::after {
            content: ''; flex: 1; height: 1px; background-color: var(--vscode-widget-border); opacity: 0.5;
        }

        /* Inputs */
        input[type="text"], input[type="number"], select {
            background-color: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            border: 1px solid var(--vscode-widget-border);
            padding: 6px 10px;
            border-radius: 6px;
            font-family: inherit; font-size: 13px;
        }
        input:focus, select:focus {
            border-color: var(--vscode-focusBorder);
            outline: 1px solid var(--vscode-focusBorder);
        }
        
        .switch { position: relative; width: 40px; height: 22px; }
        .switch input { display: none; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--vscode-input-background); border: 1px solid var(--vscode-widget-border);
            transition: .2s var(--ease-smooth); border-radius: 999px;
        }
        .slider:before {
            position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px;
            background-color: var(--vscode-foreground); transition: .2s var(--ease-spring); border-radius: 50%;
        }
        input:checked + .slider { background: var(--vscode-testing-iconPassed); border-color: var(--vscode-testing-iconPassed); }
        input:checked + .slider:before { transform: translateX(18px); background: var(--vscode-editor-background); }

        /* Components */
        .toggle-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 16px; /* Larger touch target */
            border-bottom: 1px solid var(--vscode-widget-border);
            background: transparent;
        }
        .toggle-row:last-child { border-bottom: none; }

        .pill-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .pill {
            padding: 4px 12px; border-radius: 999px;
            border: 1px solid var(--vscode-widget-border);
            background: var(--vscode-editor-background);
            color: var(--vscode-foreground);
            cursor: pointer; font-size: 12px;
            transition: all 0.15s ease;
        }
        .pill:hover { border-color: var(--vscode-testing-iconPassed); color: var(--vscode-testing-iconPassed); }

        /* Documentation Cards */
        .docs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
        .doc-card {
            border: 1px solid var(--vscode-widget-border);
            border-radius: 12px; padding: 16px;
            background: var(--vscode-editor-background); /* Flat background */
            cursor: pointer;
            transition: border-color 0.2s var(--ease-smooth), transform 0.2s var(--ease-smooth);
        }
        .doc-card:hover { border-color: var(--vscode-focusBorder); transform: translateY(-2px); }
        .doc-card h4 { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .doc-card p { opacity: 0.8; }
        .doc-card code {
            font-family: var(--vscode-editor-font-family); font-size: 11px;
            padding: 2px 6px; border-radius: 4px;
            background: var(--vscode-textBlockQuote-background);
            color: var(--vscode-textPreformat-foreground);
        }

        /* Status & Logs */
        .status-dot {
            width: 10px; height: 10px; border-radius: 50%;
            background-color: ${a};
            box-shadow: 0 0 0 4px color-mix(in srgb, ${a} 20%, transparent); /* Soft glow ring */
        }
        
        .log-container {
            background: var(--vscode-editor-background); /* Consistent background */
            font-family: var(--vscode-editor-font-family);
            font-size: 12px; line-height: 1.6;
            padding: 16px; border-radius: 8px;
            height: 350px; overflow-y: auto;
            border: 1px solid var(--vscode-widget-border);
            margin-top: 16px;
        }
        .log-line { display: flex; gap: 12px; padding: 2px 0; border-bottom: 1px solid transparent; }
        .log-line:hover { background: var(--vscode-list-hoverBackground); }
        .log-time { color: var(--vscode-descriptionForeground); font-size: 11px; min-width: 80px; }
        .log-method { font-weight: 600; color: var(--vscode-textLink-foreground); min-width: 50px; }
        .log-path { color: var(--vscode-textPreformat-foreground); flex: 1; word-break: break-all; }
        .log-status.success { color: var(--vscode-testing-iconPassed); }
        .log-status.error { color: var(--vscode-testing-iconFailed); }
        .log-latency { color: var(--vscode-descriptionForeground); font-size: 11px; min-width: 60px; text-align: right; }

        .muted { color: var(--vscode-descriptionForeground); font-size: 12px; }
        a { color: var(--vscode-textLink-foreground); text-decoration: none; }
        a:hover { text-decoration: underline; }

        /* Animations */
        @keyframes pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 0.3; } }
        .log-line.pending { opacity: 0.7; animation: pulse 2s ease-in-out infinite; }
        
        .spinner { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Modern Sidebar Design - Constant Dark Theme */
        @media (max-width: 600px) {
            body {
                background-color: #09090b; /* Zinc 950 */
                color: #fafafa; /* Zinc 50 */
            }
            
            .page {
                padding: 16px 16px 32px;
                gap: 12px;
                max-width: 100%;
            }

            /* Compact Hero */
            .hero {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
                padding-bottom: 0;
                border-bottom: 1px solid #27272a; /* Zinc 800 */
                padding-bottom: 12px;
                margin-bottom: 4px;
            }
            .hero h1 { 
                font-size: 18px; 
                display: flex; 
                align-items: center; 
                gap: 8px;
                color: #ffffff;
            }
            .hero p { display: none; }
             
            /* Unified Status Pill in Hero */
            .hero h1:after {
                content: '';
                display: inline-block;
                width: 8px; height: 8px;
                border-radius: 50%;
                background-color: ${a};
                box-shadow: 0 0 10px ${a};
                margin-left: auto;
                animation: pulse 2s infinite;
            }

            /* Filled Cards for Sidebar */
            .card {
                background-color: #18181b; /* Zinc 900 */
                border: 1px solid #27272a; /* Zinc 800 */
                box-shadow: none;
                padding: 16px;
                border-radius: 8px;
            }
            .card:hover {
                background-color: #27272a; /* Zinc 800 */
                transform: none;
                border-color: #3f3f46; /* Zinc 700 */
            }

            /* Typography Overrides */
            h3, h4 { color: #e4e4e7; opacity: 1; } /* Zinc 200 */
            .muted { color: #a1a1aa; opacity: 1; } /* Zinc 400 */
            
            /* Input overrides for dark theme consistency */
            button {
                background-color: #2563eb; /* Blue 600 */
                color: white;
                border: none;
            }
            button:hover { background-color: #1d4ed8; } /* Blue 700 */
            button.secondary {
                background-color: #27272a; /* Zinc 800 */
                color: #e4e4e7;
            }
            button.secondary:hover { background-color: #3f3f46; } /* Zinc 700 */

            /* Grid Stacking */
            .grid, .info-grid, .docs-grid {
                grid-template-columns: 1fr !important;
                gap: 12px;
            }

            /* Buttons */
            .actions { 
                grid-template-columns: 1fr;
                gap: 8px;
            }
            button {
                width: 100%;
                height: 36px;
                border-radius: 6px;
            }
            
            /* Status Stats Grid - Make them mini cards */
            .info-grid {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }
            .info-grid .label { display: none; }
            .info-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                background: transparent;
            }
            .info-grid > div {
                 background: #18181b;
                 padding: 8px;
                 border-radius: 4px;
                 border: 1px solid #27272a;
                 display: flex;
                 flex-direction: column;
                 align-items: center;
                 text-align: center;
            }
            .info-grid .label { 
                display: block; 
                font-size: 10px; 
                margin-bottom: 2px;
                color: #a1a1aa; /* Zinc 400 */
            }
            .info-grid .value { 
                font-size: 14px; 
                font-weight: 600;
                color: #fafafa;
            }
            
            /* Hide non-essential elements */
            .badge { display: none; }
            #server-url { 
                font-size: 11px; 
                color: #a1a1aa;
                word-break: break-all; 
            }

            /* Aggressive Contrast Overrides */
            a { color: #60a5fa !important; } /* Blue 400 */
            .label { color: #a1a1aa !important; } /* Zinc 400 */
            
            /* Form Elements - Force Dark */
            input, select, textarea {
                background-color: #27272a !important; /* Zinc 800 */
                color: #fafafa !important; /* Zinc 50 */
                border-color: #3f3f46 !important; /* Zinc 700 */
            }
            input:focus, select:focus, textarea:focus {
                border-color: #60a5fa !important; /* Blue 400 */
            }
        }

    </style>
</head>
<body>
    <div class="page">
        <div class="hero">
            <div>
                <h1>Copilot API Dashboard</h1>
                <p>Monitor and control your local Copilot API Gateway.</p>
                <div style="margin-top: 8px; font-size: 13px; opacity: 0.9; font-family: var(--vscode-editor-font-family); display: flex; align-items: center; gap: 8px;">
                    <span style="opacity: 0.6;">Running on:</span>
                    <strong id="server-url">${p}</strong>
                    <button id="btn-copy-url" class="secondary" style="padding: 4px 8px; font-size: 11px; min-width: auto;" title="Copy URL">\u{1F4CB} Copy</button>
                </div>
            </div>
            <div style="display: flex; gap: 8px;">
                <button id="btn-toggle-server" class="${o.running?"danger":"success"}" data-running="${o.running}" style="min-width: 140px;">
                    ${o.running?"Stop Server":"Start Server"}
                </button>
                <button class="secondary" id="btn-open-chat" title="Open Copilot Chat" style="min-width: 90px;">\u{1F4AC} Chat</button>
                <button class="secondary" id="btn-ask-copilot" title="Ask Copilot" style="min-width: 90px;">\u2753 Ask</button>
                <button class="secondary" id="btn-docs" title="Read Documentation" style="min-width: 90px;">\u{1F4DA} Docs</button>
                <button class="secondary" id="btn-settings" title="Settings">\u2699\uFE0F</button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 24px;">
            <div class="card">
                <h3 style="font-size: 12px; text-transform: uppercase; opacity: 0.7; margin-bottom: 8px;">\u{1F4B8} Est. Savings</h3>
                <div style="font-size: 28px; font-weight: 600; color: var(--vscode-testing-iconPassed);">${$(x)}</div>
                <div style="font-size: 11px; opacity: 0.6; margin-top: 4px;">+${$(C)} today</div>
                <div style="font-size: 9px; opacity: 0.4; margin-top: 8px;">*Approx. based on GPT-4o pricing</div>
            </div>
            <div class="card">
                <h3 style="font-size: 12px; text-transform: uppercase; opacity: 0.7; margin-bottom: 8px;">\u{1F4CA} Traffic</h3>
                <div style="font-size: 28px; font-weight: 600;">${m.totalRequests||0}</div>
                <div style="font-size: 11px; opacity: 0.6; margin-top: 4px;">Total Requests</div>
            </div>
            <div class="card">
                <h3 style="font-size: 12px; text-transform: uppercase; opacity: 0.7; margin-bottom: 8px;">\u26A1 Latency</h3>
                <div style="font-size: 28px; font-weight: 600;">${y.avgLatency||0}<span style="font-size: 14px; opacity: 0.6;">ms</span></div>
                <div style="font-size: 11px; opacity: 0.6; margin-top: 4px;">Avg Today</div>
            </div>
            <div class="card">
                <h3 style="font-size: 12px; text-transform: uppercase; opacity: 0.7; margin-bottom: 8px;">\u{1F465} Connections</h3>
                <div id="stat-connections" style="font-size: 28px; font-weight: 600;">${f}</div>
                <div style="font-size: 11px; opacity: 0.6; margin-top: 4px;">Active Clients</div>
            </div>
        </div>

        <!-- Copilot Health Banner -->
        ${o.copilot.ready?"":`
        <div style="background: var(--vscode-statusBarItem-warningBackground); color: var(--vscode-statusBarItem-warningForeground); padding: 12px 16px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: center; gap: 12px; font-weight: 500; border: 1px solid rgba(0,0,0,0.1);">
            <span style="font-size: 20px;">\u26A0\uFE0F</span>
            <div style="flex: 1;">
                <div style="font-size: 14px;">GitHub Copilot is not fully ready</div>
                <div style="font-size: 12px; opacity: 0.9; font-weight: 400;">
                    ${o.copilot.installed?"":"\u2022 GitHub Copilot extension is missing. "}
                    ${o.copilot.chatInstalled?"":"\u2022 GitHub Copilot Chat extension is missing. "}
                    ${o.copilot.signedIn?"":"\u2022 You are not signed in to GitHub Copilot. "}
                </div>
            </div>
            <button class="secondary" onclick="vscode.postMessage({ type: 'askCopilot' })" style="width: auto; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: inherit;">Resolve</button>
        </div>
        `}

        <!-- Server Status Card -->
        <div class="card full-width">
            <div class="status-row" style="justify-content: space-between; margin-bottom: 24px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="status-dot" class="status-dot"></div>
                    <span id="server-status-text" style="font-size: 16px;">${c}</span>
                </div>
                <div class="muted">
                    v${r.getVersion()}
                </div>
            </div>



            <div class="info-grid">
                <div class="label">Connection</div>
                <div class="value">
                    ${i.enableHttp?"HTTP ":""}
                    ${i.enableWebSocket?"WebSocket ":""}
                </div>
                <div class="label">Auth Mode</div>
                <div class="value">${i.apiKey?"API Key (Protected)":"Open (No Auth)"}</div>
                <div class="label">Default Model</div>
                <div class="value">${i.defaultModel}</div>
                <div class="label">Copilot Health</div>
                <div class="value" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <span class="badge" style="background: ${o.copilot.chatInstalled?"var(--vscode-charts-green)":o.copilot.signedIn?"var(--vscode-charts-yellow)":"var(--vscode-charts-red)"}; color: ${o.copilot.chatInstalled||o.copilot.signedIn?"var(--vscode-editor-background)":"white"}; padding: 1px 6px; border-radius: 4px; font-size: 10px;">Chat: ${o.copilot.chatInstalled?"Installed":o.copilot.signedIn?"Not Detected":"Missing"}</span>
                    <span class="badge" style="background: ${o.copilot.signedIn?"var(--vscode-charts-green)":"var(--vscode-charts-red)"}; color: ${o.copilot.signedIn?"var(--vscode-editor-background)":"white"}; padding: 1px 6px; border-radius: 4px; font-size: 10px;">Auth: ${o.copilot.signedIn?"Signed In":"Signed Out"}</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Configuration Card -->
            <div class="card">
                <h3>\u2699\uFE0F Server Configuration</h3>
                <div class="stacked">
                    <div class="toggle-row">
                        <span>Enable HTTP Server</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-http" ${i.enableHttp?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <span>Enable WebSocket</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-ws" ${i.enableWebSocket?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <span>Detailed Logging</span>
                            <span title="Enables verbose output to the VS Code Output channel. Useful for debugging." style="cursor: help; opacity: 0.6; font-size: 14px;">\u2139\uFE0F</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-logging" ${i.enableLogging?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <span>Enable HTTPS</span>
                            <span title="Use HTTPS/TLS encryption. Falls back to HTTP if certificates are not configured." style="cursor: help; opacity: 0.6; font-size: 14px;">\u{1F512}</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-https" ${i.enableHttps?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div style="margin-top: 16px;">
                        <div style="display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap; align-items: flex-end;">
                            <div style="flex: 1; min-width: 120px;">
                                <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px;">HOST</span>
                                <input type="text" id="custom-host" value="${i.host}" placeholder="127.0.0.1" style="width: 100%; box-sizing: border-box;">
                            </div>
                            <div style="width: 80px; flex-shrink: 0;">
                                <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px;">PORT</span>
                                <input type="number" id="custom-port" value="${i.port}" style="width: 100%; box-sizing: border-box;">
                            </div>
                            <div style="flex-shrink: 0;">
                                <button class="secondary" id="btn-set-host" style="height: 32px; padding: 0 16px; white-space: nowrap;">Apply</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="secondary" id="btn-host-local" style="flex: 1;">Bind Localhost</button>
                            <button class="secondary" id="btn-host-lan" style="flex: 1;">Bind LAN (0.0.0.0)</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Card -->
            <div class="card">
                <h3>\u{1F512} Security</h3>
                <div class="stacked">
                    <div class="toggle-row">
                        <span>Enable Authentication</span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-auth" ${i.apiKey?"checked":""}>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div style="margin-top: 12px;">
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <input type="password" id="api-key-input" value="${i.apiKey||""}" placeholder="sk-..." style="flex: 1;">
                            <button class="secondary" id="btn-show-key" style="width: 40px;" title="Show/Hide Key">\u{1F441}</button>
                            <button class="secondary" id="btn-copy-key" style="width: 40px;" title="Copy Key">\u{1F4CB}</button>
                        </div>
                        <div class="actions">
                            <button class="secondary" id="btn-generate-key">Generate New Key</button>
                            <button class="secondary" id="btn-set-apikey">Set Manual Key</button>
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 8px;">RATE LIMIT</span>
                        <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                            <input type="number" id="rate-limit-input" value="${i.rateLimitPerMinute||0}" placeholder="0 = unlimited" style="width: 100px !important;">
                            <span class="muted">req/min</span>
                            <button class="secondary" id="btn-set-ratelimit" style="width: auto; padding: 6px 16px;">Set</button>
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <div class="inline-form" style="margin-bottom: 8px;">
                            <span style="font-size: 12px; font-weight: 600;">ALLOW IP / DOMAIN</span>
                            <div style="display: flex; gap: 8px;">
                                <input type="text" id="ip-allowlist-input" placeholder="e.g. 192.168.1.5, 10.0.0.0/24, or example.com">
                                <button class="secondary" id="btn-add-ip" style="width: auto;">Add</button>
                            </div>
                        </div>
                        <div class="pill-row" id="ip-list">
                            ${(i.ipAllowlist||[]).map(L=>`<span class="pill" style="font-size: 11px; display: flex; align-items: center; gap: 4px;">${L} <span class="btn-remove-ip" data-value="${L}" style="cursor: pointer; opacity: 0.6;">\xD7</span></span>`).join("")}
                            ${!i.ipAllowlist||i.ipAllowlist.length===0?'<span class="muted">No access restrictions (all IPs allowed)</span>':""}
                        </div>
                    </div>

                    <div style="margin-top: 16px; border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                        <span style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 8px;">HARDENING & LIMITS</span>

                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Request Timeout</span>
                                <input type="number" id="timeout-input" value="${i.requestTimeoutSeconds||60}" style="width: 80px !important;">
                                <span class="muted">sec</span>
                                <button class="secondary" id="btn-set-timeout" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Max Payload</span>
                                <input type="number" id="payload-input" value="${i.maxPayloadSizeMb||1}" style="width: 80px !important;">
                                <span class="muted">MB</span>
                                <button class="secondary" id="btn-set-payload" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Max Connections/IP</span>
                                <input type="number" id="connections-input" value="${i.maxConnectionsPerIp||10}" style="width: 80px !important;">
                                <span class="muted">conn</span>
                                <button class="secondary" id="btn-set-connections" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <span class="muted" style="width: 120px; font-size: 11px;">Total Concurrency</span>
                                <input type="number" id="concurrency-input" value="${i.maxConcurrentRequests||4}" style="width: 80px !important;">
                                <span class="muted">req</span>
                                <button class="secondary" id="btn-set-concurrency" style="width: auto; padding: 4px 12px; font-size: 11px;">Set</button>
                            </div>
                            <div class="muted" style="font-size: 10px; margin-top: 2px; opacity: 0.9; line-height: 1.4;">
                                <div style="display: flex; gap: 4px; margin-bottom: 2px;">
                                    <span style="font-weight: 600; color: var(--vscode-charts-blue); min-width: 105px;">Connections/IP:</span>
                                    <span>Limits simultaneous requests from a <b>single</b> user/client.</span>
                                </div>
                                <div style="display: flex; gap: 4px;">
                                    <span style="font-weight: 600; color: var(--vscode-charts-orange); min-width: 105px;">Total Concurrency:</span>
                                    <span>Global limit across <b>all</b> users to protect the Copilot backend.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MCP Status -->
        <div class="card full-width" id="mcp-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">\u{1F50C} MCP Status <span id="mcp-status-badge" class="badge">Checking...</span></h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; opacity: 0.8;">
                        <input type="checkbox" id="mcp-enabled-toggle" style="width: 14px; height: 14px; margin: 0;"> Enabled
                    </label>
                </div>
            </div>

            <div id="mcp-content-area">
                <div class="muted" style="text-align: center; padding: 20px;">Loading tools...</div>
            </div>
        </div>

        <!-- Live Log Tail -->
        <div class="card full-width">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">\u{1F4DF} Live Log Tail <div id="log-status-indicator" class="active"></div></h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; opacity: 0.8;">
                        <input type="checkbox" id="log-autoscroll" checked style="width: 14px; height: 14px; margin: 0;"> Auto-scroll
                    </label>
                    <button class="secondary" id="btn-clear-logs" style="width: auto; padding: 4px 12px; font-size: 11px; font-weight: 500;">\u{1F9F9} Clear</button>
                </div>
            </div>
            <div id="live-log-container" class="log-container">
                <div class="muted" style="text-align: center; padding-top: 120px; opacity: 0.5;">Waiting for API requests...</div>
            </div>
        </div>

        <!-- Audit & Analytics -->
        <div class="card full-width">

            <!-- Charts removed per user request -->
            <div style="margin-bottom: 24px;"></div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h4 style="margin: 0; font-size: 13px; opacity: 0.9;">Recent Activity</h4>
                <span id="refresh-timer" class="muted" style="font-weight: normal; font-size: 11px; opacity: 0.6;"></span>
                <div style="display: flex; gap: 8px;">
                    <button class="secondary" id="btn-refresh-audit" style="padding: 4px 10px; font-size: 11px;">\u{1F504} Refresh</button>
                    <button class="secondary" id="btn-open-logs" style="padding: 4px 10px; font-size: 11px;">\u{1F4C2} Open Log Folder</button>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table id="audit-table" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 1px solid var(--vscode-widget-border);">
                            <th style="padding: 8px 12px; opacity: 0.7;">Time</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Method</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Path</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Status</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Latency</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Tokens</th>
                            <th style="padding: 8px 12px; opacity: 0.7;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="audit-table-body">
                        <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                            <td style="padding: 8px 12px; opacity: 0.6; font-style: italic;" colspan="7">Loading audit logs...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--vscode-widget-border);">
                <div class="muted" style="font-size: 11px;" id="page-info">Showing 0-0 of 0</div>
                <div style="display: flex; gap: 8px;">
                    <button class="secondary" id="btn-prev-page" disabled>Previous</button>
                    <button class="secondary" id="btn-next-page" disabled>Next</button>
                </div>
            </div>
        </div>

        <div class="card full-width">
            <h3>\u{1F6E1}\uFE0F Data Redaction</h3>
            <p class="muted" style="margin-bottom: 16px;">
                Toggle patterns to automatically redact sensitive data from logs. All patterns are applied in real-time.
            </p>

            <!-- Built-in Patterns -->
            <div style="margin-bottom: 20px;">
                <h4 style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">Built-in Patterns</h4>
                <div id="builtin-patterns-list" style="display: flex; flex-direction: column; gap: 8px;">
                    ${(i.redactionPatterns||[]).filter(L=>L.isBuiltin).map(L=>`
                        <div class="toggle-row" style="padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 6px; border: 1px solid var(--vscode-widget-border);">
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <span style="font-weight: 600; font-size: 12px;">${L.name}</span>
                                <code style="font-size: 10px; opacity: 0.6; word-break: break-all;">${L.pattern.length>40?L.pattern.substring(0,40)+"...":L.pattern}</code>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="toggle-redaction" data-id="${L.id}" ${L.enabled?"checked":""}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    `).join("")}
                </div>
            </div>

            <!-- Custom Patterns -->
            <div style="border-top: 1px solid var(--vscode-widget-border); padding-top: 16px;">
                <h4 style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">Custom Patterns</h4>

                <div id="custom-patterns-list" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
                    ${(i.redactionPatterns||[]).filter(L=>!L.isBuiltin).map(L=>`
                        <div class="toggle-row" style="padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 6px; border: 1px solid var(--vscode-widget-border);">
                            <div style="display: flex; flex-direction: column; gap: 2px; flex: 1;">
                                <span style="font-weight: 600; font-size: 12px;">${L.name}</span>
                                <code style="font-size: 10px; opacity: 0.6; word-break: break-all;">${L.pattern}</code>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label class="switch">
                                    <input type="checkbox" class="toggle-redaction" data-id="${L.id}" ${L.enabled?"checked":""}>
                                    <span class="slider"></span>
                                </label>
                                <button class="secondary btn-remove-redaction" data-id="${L.id}" style="width: 28px; height: 28px; padding: 0; font-size: 14px;" title="Remove">\xD7</button>
                            </div>
                        </div>
                    `).join("")}
                    ${(i.redactionPatterns||[]).filter(L=>!L.isBuiltin).length===0?'<span class="muted" style="text-align: center; padding: 12px;">No custom patterns added yet</span>':""}
                </div>

                <!-- Add Custom Pattern Form -->
                <div style="display: flex; flex-direction: column; gap: 8px; padding: 12px; background: var(--vscode-textBlockQuote-background); border-radius: 8px;">
                    <span style="font-size: 11px; font-weight: 600; opacity: 0.8;">ADD CUSTOM PATTERN</span>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <input type="text" id="redaction-name-input" placeholder="Pattern name (e.g. 'Bank Account')" style="flex: 1; min-width: 150px;">
                        <input type="text" id="redaction-pattern-input" placeholder="Regex pattern" style="flex: 2; min-width: 200px;">
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button class="secondary" id="btn-test-redaction" style="width: auto;">\u{1F9EA} Test</button>
                        <button class="secondary" id="btn-add-redaction" style="width: auto;">\u2795 Add Pattern</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card full-width">
            <h3>\u{1F9E0} System Prompt</h3>
            <p class="muted" style="margin-bottom: 12px;">
                Define a default system persona/instruction for all API requests that don't provide one.
            </p>
            <div class="actions">
                <button class="secondary" id="btn-edit-system-prompt" style="width: auto; padding: 8px 16px; font-weight: 600;">\u{1F4DD} Edit Default System Prompt</button>
            </div>
        </div>

        <div class="card full-width">
            <h3>\u{1F4DA} API Documentation</h3>
            <p class="muted" style="margin-bottom: 16px;">
                The gateway supports multiple API formats. Use the endpoints below with your favorite SDKs.
            </p>
            <div class="docs-grid">
                <div class="doc-card">
                    <h4><span>\u{1F916}</span> OpenAI <code>/v1</code></h4>
                    <p>Compatible with OpenAI SDKs. Supports <code>chat/completions</code>, <code>completions</code>, and <code>models</code>.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F9EA}</span> Anthropic <code>/v1</code></h4>
                    <p>Compatible with Claude SDKs. Supports <code>/v1/messages</code> with full streaming (SSE).</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F31F}</span> Google <code>/v1beta</code></h4>
                    <p>Compatible with Gemini SDKs. Supports <code>generateContent</code> and <code>streamGenerateContent</code>.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F999}</span> Llama <code>/llama/v1</code></h4>
                    <p>Compatible with Meta Llama SDKs. Supports <code>chat/completions</code> with streaming.</p>
                </div>
                <div class="doc-card">
                    <h4><span>\u{1F50C}</span> MCP Tools</h4>
                    <p>MCP tools are automatically prefixed with <code>mcp_{server}_{tool}</code>. The gateway handles execution automatically in non-streaming mode.</p>
                </div>
            </div>

            <div class="actions" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-top: 16px;">
                <a href="http://${i.host}:${i.port}/docs" target="_blank" class="secondary" style="display: inline-flex; justify-content: center; align-items: center; gap: 6px; padding: 10px 12px; background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: 1px solid color-mix(in srgb, var(--vscode-button-secondaryBackground) 50%, transparent); border-radius: 6px; text-decoration: none; font-weight: 600;">\u{1F4D1} Swagger UI</a>
                <a href="http://${i.host}:${i.port}/openapi.json" target="_blank" class="secondary" style="display: inline-flex; justify-content: center; align-items: center; gap: 6px; padding: 10px 12px; background-color: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border: 1px solid color-mix(in srgb, var(--vscode-button-secondaryBackground) 50%, transparent); border-radius: 6px; text-decoration: none; font-weight: 600;">\u{1F4C4} OpenAPI JSON</a>
            </div>
        </div>

        <div class="card full-width" style="background: linear-gradient(135deg, color-mix(in srgb, var(--vscode-editor-background) 90%, #3b82f6 10%), color-mix(in srgb, var(--vscode-editor-background) 95%, #8b5cf6 5%));">
            <h3>\u{1F468}\u200D\u{1F4BB} About</h3>
            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Suhaib Bin Younis</div>
                    <div class="muted" style="margin-bottom: 8px;">Developer & Creator</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <a href="https://suhaibbinyounis.com" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F310} Website</a>
                        <a href="https://suhaib.in" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F517} suhaib.in</a>
                        <a href="mailto:vscode@suhaib.in" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u{1F4E7} Email</a>
                        <a href="https://github.com/suhaibbinyounis/github-copilot-api-vscode" target="_blank" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--vscode-button-secondaryBackground); border-radius: 4px; text-decoration: none; font-size: 12px;">\u2B50 Star on GitHub</a>
                    </div>
                </div>
                <div class="muted" style="font-size: 11px; text-align: right;">
                    GitHub Copilot API Gateway v${r.getVersion()}<br>
                    Made with \u2764\uFE0F and \u2615
                </div>
            </div>
        </div>

    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--vscode-sideBar-background); padding: 24px; border-radius: 12px; width: 80%; max-width: 800px; max-height: 80vh; display: flex; flex-direction: column; overflow: hidden; border: 1px solid var(--vscode-widget-border); box-shadow: 0 4px 24px rgba(0,0,0,0.25);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0;">Request Details</h3>
                <button class="secondary" id="btn-close-modal" style="width: auto; padding: 6px 12px;">Close</button>
            </div>
            <div style="overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 16px; padding-right: 8px;">
                <div style="position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; opacity: 0.8;">Request</h4>
                        <button class="secondary btn-copy-modal" data-target="modal-request" style="width: auto; padding: 2px 8px; font-size: 10px;">\u{1F4CB} Copy</button>
                    </div>
                    <pre id="modal-request" style="font-size: 11px; max-height: 300px; overflow: auto; margin: 0;"></pre>
                </div>
                <div style="position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; opacity: 0.8;">Response</h4>
                        <button class="secondary btn-copy-modal" data-target="modal-response" style="width: auto; padding: 2px 8px; font-size: 10px;">\u{1F4CB} Copy</button>
                    </div>
                    <pre id="modal-response" style="font-size: 11px; max-height: 300px; overflow: auto; margin: 0;"></pre>
                </div>
            </div>
        </div>
    </div>

    <script nonce="${n}">
        var vscode = acquireVsCodeApi();

        // Pagination state - declare at top to avoid hoisting issues
        var currentPage = 1;
        var pageSize = 10;
        var totalLogs = 0;
        var lastLogs = [];

        document.getElementById('btn-toggle-server').onclick = function() {
            var running = this.getAttribute('data-running') === 'true';
            vscode.postMessage({ type: running ? 'stopServer' : 'startServer' });
        };

        document.getElementById('btn-open-chat').onclick = function() {
            vscode.postMessage({ type: 'openChat' });
        };

        document.getElementById('btn-ask-copilot').onclick = function() {
            vscode.postMessage({ type: 'askCopilot' });
        };

        document.getElementById('btn-settings').onclick = function() {
            vscode.postMessage({ type: 'showControls' });
        };

        const btnDocs = document.getElementById('btn-docs');
        if (btnDocs) {
            btnDocs.onclick = function() {
                vscode.postMessage({ type: 'openUrl', value: 'https://notes.suhaib.in/docs/vscode/extensions/github-copilot-api-gateway/' });
            };
        }

        const btnEditSystemPrompt = document.getElementById('btn-edit-system-prompt');
        if (btnEditSystemPrompt) {
            btnEditSystemPrompt.onclick = function() {
                vscode.postMessage({ type: 'editSystemPrompt' });
            };
        }

        document.getElementById('btn-copy-url').onclick = function() {
            var url = document.getElementById('server-url').innerText;
            navigator.clipboard.writeText(url).then(function() {
                var btn = document.getElementById('btn-copy-url');
                btn.innerText = '\u2705 Copied!';
                setTimeout(function() { btn.innerText = '\u{1F4CB} Copy'; }, 1500);
            });
        };

        document.getElementById('toggle-http').onchange = function() {
            vscode.postMessage({ type: 'toggleHttp' });
        };

        document.getElementById('toggle-ws').onchange = function() {
            vscode.postMessage({ type: 'toggleWs' });
        };

        document.getElementById('toggle-logging').onchange = function() {
            vscode.postMessage({ type: 'toggleLogging' });
        };

        document.getElementById('toggle-https').onchange = function() {
            vscode.postMessage({ type: 'toggleHttps' });
        };

        // Store the current API key for copy functionality
        var currentApiKey = '${i.apiKey||""}';

        document.getElementById('toggle-auth').onchange = function() {
            if (!this.checked) {
                // Disable auth by clearing API key
                currentApiKey = '';
                vscode.postMessage({ type: 'setApiKey', value: '' });
            } else {
                // Generate a random key when enabling
                var key = 'sk-' + Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
                document.getElementById('api-key-input').value = key;
                document.getElementById('api-key-input').type = 'text';
                currentApiKey = key;
                vscode.postMessage({ type: 'setApiKey', value: key });
            }
        };

        document.getElementById('btn-set-apikey').onclick = function() {
            var v = document.getElementById('api-key-input').value.trim();
            currentApiKey = v;
            vscode.postMessage({ type: 'setApiKey', value: v });
            if (v) {
                document.getElementById('toggle-auth').checked = true;
            }
        };

        document.getElementById('btn-generate-key').onclick = function() {
            var key = 'sk-' + Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
            document.getElementById('api-key-input').value = key;
            document.getElementById('api-key-input').type = 'text';
            currentApiKey = key;
            vscode.postMessage({ type: 'setApiKey', value: key });
            document.getElementById('toggle-auth').checked = true;
        };

        document.getElementById('btn-copy-key').onclick = function() {
            var input = document.getElementById('api-key-input');
            var keyToCopy = input.value.trim() || currentApiKey;
            if (keyToCopy) {
                navigator.clipboard.writeText(keyToCopy).then(function() {
                    var btn = document.getElementById('btn-copy-key');
                    btn.textContent = '\u2713';
                    setTimeout(function() { btn.textContent = '\u{1F4CB}'; }, 1500);
                });
            }
        };

        document.getElementById('btn-show-key').onclick = function() {
            var input = document.getElementById('api-key-input');
            var btn = document.getElementById('btn-show-key');
            if (input.type === 'password') {
                input.type = 'text';
                if (!input.value && currentApiKey) {
                    input.value = currentApiKey;
                }
                btn.textContent = '\u{1F648}';
            } else {
                input.type = 'password';
                btn.textContent = '\u{1F441}';
            }
        };

        document.getElementById('btn-set-ratelimit').onclick = function() {
            var v = document.getElementById('rate-limit-input').value;
            vscode.postMessage({ type: 'setRateLimit', value: Number(v) || 0 });
        };

        // Initialize on load
        // try { initCharts(); } catch (e) { console.error('Failed to init charts', e); }

        // Request initial data
        setTimeout(() => vscode.postMessage({ type: 'getAuditStats' }), 500);

        document.getElementById('btn-refresh-audit').onclick = function() {
            startCountdown(); // Reset timer
            vscode.postMessage({ type: 'getAuditStats' });
            vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
            this.textContent = '\u{1F504} Loading...';
            setTimeout(() => { this.textContent = '\u{1F504} Refresh'; }, 1000);
        };

        document.getElementById('btn-open-logs').onclick = function() {
            vscode.postMessage({ type: 'openLogFolder' });
        };

        // Modal Logic
        // Modal Logic
        const modal = document.getElementById('detail-modal');
        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scrolling
        }

        document.getElementById('btn-close-modal').onclick = closeModal;

        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        // Global function for View button
        window.showDetails = function(index) {
            if (!lastLogs || !lastLogs[index]) return;
            const log = lastLogs[index];

            const reqContent = {
                headers: log.requestHeaders,
                body: log.requestBody
            };
            const resContent = {
                headers: log.responseHeaders,
                body: log.responseBody,
                error: log.error
            };

            document.getElementById('modal-request').textContent = JSON.stringify(reqContent, null, 2);
            document.getElementById('modal-response').textContent = JSON.stringify(resContent, null, 2);

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Lock scrolling
        };

        // Copy content from modal
        document.querySelectorAll('.btn-copy-modal').forEach(btn => {
            btn.onclick = function() {
                const targetId = this.getAttribute('data-target');
                const content = document.getElementById(targetId).textContent;
                if (content) {
                    navigator.clipboard.writeText(content).then(() => {
                        const originalText = this.textContent;
                        this.textContent = '\u2713 Copied';
                        setTimeout(() => { this.textContent = originalText; }, 1500);
                    });
                }
            };
        });

        // Wiki tab switching
        document.querySelectorAll('.wiki-tab').forEach(function(tab) {
            tab.onclick = function() {
                var targetPanel = this.getAttribute('data-tab');
                // Update active tab styling
                document.querySelectorAll('.wiki-tab').forEach(function(t) {
                    t.classList.remove('active');
                    t.style.background = 'var(--vscode-button-secondaryBackground)';
                    t.style.color = 'var(--vscode-button-secondaryForeground)';
                });
                this.classList.add('active');
                this.style.background = 'var(--vscode-editor-background)';
                this.style.color = 'var(--vscode-foreground)';
                // Show corresponding panel
                document.querySelectorAll('.wiki-panel').forEach(function(p) {
                    p.style.display = 'none';
                });
                var panel = document.querySelector('.wiki-panel[data-panel="' + targetPanel + '"]');
                if (panel) panel.style.display = 'block';
            };
            // Initialize styling
            if (tab.classList.contains('active')) {
                tab.style.background = 'var(--vscode-editor-background)';
                tab.style.color = 'var(--vscode-foreground)';
            } else {
                tab.style.background = 'var(--vscode-button-secondaryBackground)';
                tab.style.color = 'var(--vscode-button-secondaryForeground)';
            }
        });

        // Auto-refresh Countdown Logic
        let refreshTimer = 10;
        let refreshIntervalVal = null;
        const refreshSpan = document.getElementById('refresh-timer');

        function startCountdown() {
            if (refreshIntervalVal) clearInterval(refreshIntervalVal);

            refreshTimer = 10;
            updateTimerDisplay();

            refreshIntervalVal = setInterval(() => {
                refreshTimer--;
                updateTimerDisplay();

                if (refreshTimer <= 0) {
                    refreshTimer = 10;
                    vscode.postMessage({ type: 'getAuditStats' });
                    // Also refresh current page of logs
                    vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            if (refreshSpan) {
                refreshSpan.textContent = \`Refreshing in \${refreshTimer}s...\`;
            }
        }

        startCountdown();

        // Request fresh stats after a short delay to ensure extension message listener is ready
        setTimeout(function() {
            vscode.postMessage({ type: 'getStats' });
            vscode.postMessage({ type: 'getAuditStats' });
            vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
        }, 100);

        // IP Allowlist handlers
        document.getElementById('btn-add-ip').onclick = function() {
            var ip = document.getElementById('ip-allowlist-input').value.trim();
            if (ip) {
                vscode.postMessage({ type: 'addIpAllowlistEntry', value: ip });
                document.getElementById('ip-allowlist-input').value = '';
            }
        };

        document.querySelectorAll('.btn-remove-ip').forEach(function(btn) {
            btn.onclick = function() {
                var ip = btn.getAttribute('data-value');
                if (ip) {
                    vscode.postMessage({ type: 'removeIpAllowlistEntry', value: ip });
                }
            };
        });

        document.getElementById('btn-host-local').onclick = function() {
            vscode.postMessage({ type: 'hostLocal' });
        };

        document.getElementById('btn-host-lan').onclick = function() {
            vscode.postMessage({ type: 'hostLan' });
        };

        // Copy URL buttons for shareable LAN URLs
        document.querySelectorAll('.btn-copy-url').forEach(function(btn) {
            btn.onclick = function() {
                var url = btn.getAttribute('data-url');
                if (url) {
                    navigator.clipboard.writeText(url).then(function() {
                        var originalText = btn.textContent;
                        btn.textContent = '\u2713 Copied!';
                        setTimeout(function() { btn.textContent = originalText; }, 1500);
                    });
                }
            };
        });

        // MCP Toggle
        var mcpToggle = document.getElementById('mcp-enabled-toggle');
        if (mcpToggle) {
            mcpToggle.onchange = function() {
                vscode.postMessage({ type: 'toggleMcp', value: mcpToggle.checked });
            };
        }

        document.getElementById('btn-set-host').onclick = function() {
            var host = document.getElementById('custom-host').value;
            var port = document.getElementById('custom-port').value;
            if (host) vscode.postMessage({ type: 'setHost', value: host });
            if (port) vscode.postMessage({ type: 'setPort', value: Number(port) });
        };

        // btn-set-port removed - consolidated with btn-set-host Apply button

        document.getElementById('btn-set-timeout').onclick = function() {
            var val = document.getElementById('timeout-input').value;
            vscode.postMessage({ type: 'setRequestTimeout', value: Number(val) });
        };

        document.getElementById('btn-set-payload').onclick = function() {
            var val = document.getElementById('payload-input').value;
            vscode.postMessage({ type: 'setMaxPayloadSize', value: Number(val) });
        };

        document.getElementById('btn-set-connections').onclick = function() {
            var val = document.getElementById('connections-input').value;
            vscode.postMessage({ type: 'setMaxConnectionsPerIp', value: Number(val) });
        };

        document.getElementById('btn-set-concurrency').onclick = function() {
            var val = document.getElementById('concurrency-input').value;
            vscode.postMessage({ type: 'setMaxConcurrency', value: Number(val) });
        };

        // btn-set-model removed - element doesn't exist in current UI

        // Redaction pattern handlers
        document.getElementById('btn-add-redaction').onclick = function() {
            var name = document.getElementById('redaction-name-input').value.trim();
            var pattern = document.getElementById('redaction-pattern-input').value.trim();
            if (!name) {
                alert('Please enter a pattern name');
                return;
            }
            if (!pattern) {
                alert('Please enter a regex pattern');
                return;
            }
            try {
                new RegExp(pattern); // Validate
                vscode.postMessage({ type: 'addRedactionPattern', value: { name: name, pattern: pattern } });
                document.getElementById('redaction-name-input').value = '';
                document.getElementById('redaction-pattern-input').value = '';
            } catch (e) {
                alert('Invalid regex pattern: ' + e.message);
            }
        };

        document.getElementById('btn-test-redaction').onclick = function() {
            var pattern = document.getElementById('redaction-pattern-input').value.trim();
            if (!pattern) {
                alert('Enter a pattern first');
                return;
            }
            try {
                var regex = new RegExp(pattern, 'gi');
                var testStr = prompt('Enter test string to check redaction:', 'my-api-key-12345 or test@email.com');
                if (testStr) {
                    var result = testStr.replace(regex, '[REDACTED]');
                    alert('Result: ' + result);
                }
            } catch (e) {
                alert('Invalid regex pattern: ' + e.message);
            }
        };

        // Toggle redaction pattern on/off
        document.querySelectorAll('.toggle-redaction').forEach(function(toggle) {
            toggle.onchange = function() {
                var id = toggle.getAttribute('data-id');
                var enabled = toggle.checked;
                vscode.postMessage({ type: 'toggleRedactionPattern', value: { id: id, enabled: enabled } });
            };
        });

        // Remove redaction pattern buttons
        document.querySelectorAll('.btn-remove-redaction').forEach(function(btn) {
            btn.onclick = function() {
                var id = btn.getAttribute('data-id');
                if (id && confirm('Remove this pattern?')) {
                    vscode.postMessage({ type: 'removeRedactionPattern', value: id });
                }
            };
        });

        // Handle messages from extension
        window.addEventListener('message', function(event) {
            var message = event.data;
            console.log('[Dashboard] Received message:', message.type, message);
            if (message.type === 'historyData') {
                // Legacy support if needed
            } else if (message.type === 'statsData') {
                updateStats(message.data);
            } else if (message.type === 'realtimeStats') {
                // Update specific realtime cards
                if (message.data.requestsPerMinute !== undefined) document.getElementById('stat-rpm').textContent = message.data.requestsPerMinute;
                if (message.data.avgLatencyMs !== undefined) document.getElementById('stat-latency').innerHTML = message.data.avgLatencyMs + '<span style="font-size: 10px; opacity: 0.6;">ms</span>';
                if (message.data.errorRate !== undefined) document.getElementById('stat-errors').innerHTML = message.data.errorRate + '<span style="font-size: 10px; opacity: 0.6;">%</span>';
                if (message.data.activeConnections !== undefined) {
                    var connEl = document.getElementById('stat-connections');
                    if (connEl) connEl.textContent = message.data.activeConnections;
                }
            } else if (message.type === 'auditStatsData') {
                updateCharts(message.data);
            } else if (message.type === 'auditLogData') {
                console.log('[Dashboard] Updating log table with', message.data?.length || 0, 'entries');
                updateLogTable(message.data, message.page, message.total, message.pageSize);
            } else if (message.type === 'liveLogStart') {
                appendLogStart(message.value);
            } else if (message.type === 'liveLog') {
                appendLog(message.value);
            } else if (message.type === 'scrollTo') {
                // Scroll to a specific section
                var target = message.target;
                if (target === 'wiki') {
                    var wikiSection = document.getElementById('wiki-section');
                    if (wikiSection) {
                        wikiSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            }
        });

        // Pagination state variables moved to top of script

        document.getElementById('btn-prev-page').onclick = function() {
            if (currentPage > 1) {
                currentPage--;
                vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                document.getElementById('audit-table-body').innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; opacity: 0.7;">Loading...</td></tr>';
            }
        };

        document.getElementById('btn-next-page').onclick = function() {
            if (currentPage * pageSize < totalLogs) {
                currentPage++;
                vscode.postMessage({ type: 'getAuditLogs', value: { page: currentPage, pageSize: pageSize } });
                document.getElementById('audit-table-body').innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; opacity: 0.7;">Loading...</td></tr>';
            }
        };

        function updateCharts(stats) {
            // Charts removed per user request
        }

        // lastLogs declared at top of script

        function formatNumber(num) {
            if (num === undefined || num === null) return '0';
            if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toString();
        }

// Live Log Tail Logic
        const logContainer = document.getElementById('live-log-container');
        const autoScroll = document.getElementById('log-autoscroll');
        const logStatus = document.getElementById('log-status-indicator');
        let linesCount = 0;



        function appendLogStart(startLog) {
            if (!logContainer) return;
            if (linesCount === 0) logContainer.innerHTML = '';

            const line = document.createElement('div');
            line.className = 'log-line pending';
            line.setAttribute('data-request-id', startLog.requestId);

            const time = new Date(startLog.timestamp).toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });

            line.innerHTML = '<span class="log-time">[' + time + ']</span>' +
                             '<span class="log-method">' + (startLog.method || 'UNK') + '</span>' +
                             '<span class="log-path">' + (startLog.path || '/') + '</span>' +
                             '<span class="log-status">...</span>' +
                             '<span class="log-latency">pending</span>';

            logContainer.appendChild(line);
            linesCount++;

            // Pulse status indicator
            if (logStatus) {
                logStatus.classList.remove('active');
                void logStatus.offsetWidth; // Trigger reflow
                logStatus.classList.add('active');
            }

            // Limit shown lines to 100 for performance
            if (linesCount > 100) {
                logContainer.removeChild(logContainer.firstChild);
                linesCount--;
            }

            if (autoScroll && autoScroll.checked) {
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        function appendLog(log) {
            if (!logContainer) return;
            
            // Check if there's a pending entry for this request
            const existingLine = logContainer.querySelector('[data-request-id="' + log.requestId + '"]');
            
            const isError = log.status >= 400;
            const statusClass = isError ? 'error' : 'success';
            const time = new Date(log.timestamp).toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            if (existingLine) {
                // Update the existing pending entry
                existingLine.className = 'log-line';
                existingLine.innerHTML = '<span class="log-time">[' + time + ']</span>' +
                                 '<span class="log-method">' + (log.method || 'UNK') + '</span>' +
                                 '<span class="log-path">' + (log.path || '/') + '</span>' +
                                 '<span class="log-status ' + statusClass + '">' + (log.status || 0) + '</span>' +
                                 '<span class="log-latency">' + (log.durationMs || 0) + 'ms</span>';
            } else {
                // No pending entry, create a new line (fallback if start event was missed)
                if (linesCount === 0) logContainer.innerHTML = '';

                const line = document.createElement('div');
                line.className = 'log-line';

                line.innerHTML = '<span class="log-time">[' + time + ']</span>' +
                                 '<span class="log-method">' + (log.method || 'UNK') + '</span>' +
                                 '<span class="log-path">' + (log.path || '/') + '</span>' +
                                 '<span class="log-status ' + statusClass + '">' + (log.status || 0) + '</span>' +
                                 '<span class="log-latency">' + (log.durationMs || 0) + 'ms</span>';

                logContainer.appendChild(line);
                linesCount++;

                // Limit shown lines to 100 for performance
                if (linesCount > 100) {
                    logContainer.removeChild(logContainer.firstChild);
                    linesCount--;
                }
            }

            // Pulse status indicator
            if (logStatus) {
                logStatus.classList.remove('active');
                void logStatus.offsetWidth; // Trigger reflow
                logStatus.classList.add('active');
            }

            if (autoScroll && autoScroll.checked) {
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        document.getElementById('btn-clear-logs').onclick = function() {
            if (logContainer) {
                logContainer.innerHTML = '<div class="muted" style="text-align: center; padding-top: 120px; opacity: 0.5;">Waiting for API requests...</div>';
                linesCount = 0;
            }
        };

        function updateLogTable(logs, page, total, pSize) {
            lastLogs = logs;
            currentPage = page;
            totalLogs = total;
            pageSize = pSize || 10;

            const tbody = document.getElementById('audit-table-body');
            const pageInfo = document.getElementById('page-info');
            const btnPrev = document.getElementById('btn-prev-page');
            const btnNext = document.getElementById('btn-next-page');

            if (pageInfo) {
                const start = (page - 1) * pageSize + 1;
                const end = Math.min(page * pageSize, total);
                pageInfo.textContent = \`Showing \${total === 0 ? 0 : start}-\${end} of \${total}\`;
            }
            if (btnPrev) btnPrev.disabled = page <= 1;
            if (btnNext) btnNext.disabled = page * pageSize >= total;

            if (!tbody) return;

            // Clear checks to force refresh
            tbody.innerHTML = '';

            if (!logs || logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="padding: 24px; text-align: center; opacity: 0.6; font-style: italic;">No audit logs found.<br><span style="font-size: 11px; opacity: 0.8; margin-top: 4px; display: block;">Make a request to generate logs.</span></td></tr>';
                return;
            }

            tbody.innerHTML = logs.map((log, index) => {
                const date = new Date(log.timestamp);
                const time = date.toLocaleTimeString();
                const statusColor = log.status >= 400 ? 'var(--vscode-testing-iconFailed)' : (log.status >= 300 ? 'var(--vscode-charts-yellow)' : 'var(--vscode-testing-iconPassed)');

                return \`
                <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                    <td style="padding: 8px 12px; white-space: nowrap; opacity: 0.8;">\${time}</td>
                    <td style="padding: 8px 12px; white-space: nowrap;"><span style="padding: 2px 6px; border-radius: 4px; background: var(--vscode-textCodeBlock-background); font-size: 11px; font-family: var(--vscode-editor-font-family);">\${log.method || 'UNK'}</span></td>
                    <td style="padding: 8px 12px; word-break: break-all; font-family: var(--vscode-editor-font-family);">\${log.path || '/'}</td>
                    <td style="padding: 8px 12px; color: \${statusColor}; font-weight: 600;">\${log.status || 0}</td>
                    <td style="padding: 8px 12px;">\${log.durationMs || 0}ms</td>
                    <td style="padding: 8px 12px;" title="\${(log.tokensIn || 0) + (log.tokensOut || 0)} tokens">\${formatNumber ? formatNumber((log.tokensIn || 0) + (log.tokensOut || 0)) : 0}</td>
                    <td style="padding: 8px 12px;">
                        <button class="secondary btn-view-details" data-index="\${index}" style="padding: 2px 8px; font-size: 10px; width: auto;">\u{1F50D}</button>
                    </td>
                </tr>\`;
    }).join('');

    // Add event listeners for view buttons (CSP safe)
    document.querySelectorAll('.btn-view-details').forEach(btn => {
        btn.addEventListener('click', () => {
             const index = parseInt(btn.getAttribute('data-index') || '0');
             showDetails(index);
        });
    });
}

function updateStats(stats) {
    if (stats.totalRequests !== undefined) {
        document.getElementById('stat-requests').textContent = formatNumber(stats.totalRequests);
        document.getElementById('stat-requests').title = stats.totalRequests + ' requests';
    }
    if (stats.requestsPerMinute !== undefined) document.getElementById('stat-rpm').textContent = stats.requestsPerMinute;
    if (stats.avgLatencyMs !== undefined) document.getElementById('stat-latency').innerHTML = stats.avgLatencyMs + '<span style="font-size: 12px;">ms</span>';
    if (stats.totalTokensIn !== undefined) {
        document.getElementById('stat-tokens-in').textContent = formatNumber(stats.totalTokensIn);
        document.getElementById('stat-tokens-in').title = stats.totalTokensIn;
    }
    if (stats.totalTokensOut !== undefined) {
        document.getElementById('stat-tokens-out').textContent = formatNumber(stats.totalTokensOut);
        document.getElementById('stat-tokens-out').title = stats.totalTokensOut;
    }
    if (stats.errorRate !== undefined) document.getElementById('stat-errors').innerHTML = stats.errorRate + '<span style="font-size: 12px;">%</span>';
    if (stats.uptimeMs !== undefined) {
        var minutes = Math.floor(stats.uptimeMs / 60000);
        var hours = Math.floor(minutes / 60);
        var display = hours > 0 ? hours + 'h ' + (minutes % 60) + 'm' : minutes + 'm';
        document.getElementById('stat-uptime').textContent = display;
    }

    // Update MCP Status
    if (stats.mcp) {
        var mcpEnabled = stats.mcp.enabled;
        var statusBadge = document.getElementById('mcp-status-badge');
        if (statusBadge) {
            statusBadge.textContent = mcpEnabled ? (stats.mcp.servers.length > 0 ? 'Connected' : 'Ready') : 'Disabled';
            statusBadge.style.background = mcpEnabled ? (stats.mcp.servers.length > 0 ? 'var(--vscode-charts-green)' : 'var(--vscode-charts-blue)') : 'var(--vscode-charts-red)';
            statusBadge.style.color = 'white';
            statusBadge.style.padding = '2px 8px';
            statusBadge.style.borderRadius = '10px';
            statusBadge.style.fontSize = '10px';
        }

        var toggle = document.getElementById('mcp-enabled-toggle');
        if (toggle) toggle.checked = mcpEnabled;

        // Render Tools Grouped by Server
        var contentArea = document.getElementById('mcp-content-area');
        if (contentArea && stats.mcp.tools) {
            if (!mcpEnabled) {
                contentArea.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">MCP is disabled. Enable it in settings or toggle above.</div>';
                return;
            }

            if (stats.mcp.tools.length === 0) {
                 contentArea.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">No tools available. Connect a server or enable built-in tools.</div>';
                 return;
            }

            // Group tools
            var groups = {};
            stats.mcp.tools.forEach(function(tool) {
                if (!groups[tool.serverName]) { groups[tool.serverName] = []; }
                groups[tool.serverName].push(tool);
            });

            var html = '<div style="display: flex; flex-direction: column; gap: 24px;">';

            Object.keys(groups).sort().forEach(function(serverName) {
                var serverTools = groups[serverName];
                html += '<div>';
                html += '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">';
                html += '<span class="badge" style="background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); font-size: 10px;">' + serverName + '</span>';
                html += '<div style="height: 1px; flex: 1; background: var(--vscode-widget-border); opacity: 0.5;"></div>';
                html += '</div>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px;">';
                serverTools.forEach(function(t) {
                    html += '<div style="padding: 12px; border: 1px solid var(--vscode-widget-border); border-radius: 8px; background: rgba(0,0,0,0.02);">';
                    html += '<div style="font-family: var(--vscode-editor-font-family); font-weight: 600; font-size: 12px; margin-bottom: 4px; color: var(--vscode-textPreformat-foreground);">' + t.name + '</div>';
                    html += '<div style="font-size: 11px; opacity: 0.7; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;" title="' + (t.description || '') + '">' + (t.description || 'No description') + '</div>';
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            });

html += '</div>';

// Only update if changed to avoid flicker (hashing would be better but simple string comparison works for now)
// Actually, innerHTML rewrite is fine for this dashboard frequency
contentArea.innerHTML = html;
}
    }
}

// Auto-refresh stats every 5 seconds
setInterval(function () {
    vscode.postMessage({ type: 'getStats' });
}, 5000);

// Load audit data on page load
// Load audit data on page load
vscode.postMessage({ type: 'getAuditStats' });
vscode.postMessage({ type: 'getAuditLogs', value: { page: 1, pageSize: 10 } });
</script>
    </body>
    </html>`}};function PD(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}var s$=It(require("vscode")),a$=It(require("os")),CD=It(require("path")),TD=It(require("fs"));async function WG(){if(a$.platform()!=="darwin"){s$.window.showErrorMessage("Desktop shortcut creation is currently only supported on macOS.");return}try{let e=a$.homedir(),r=CD.join(e,"Desktop"),o=`#!/bin/bash
open "vscode://suhaibbinyounis.github-copilot-api-vscode/dashboard"
`,i=CD.join(r,"Copilot Dashboard.command");await TD.promises.writeFile(i,o,"utf8"),await TD.promises.chmod(i,493),s$.window.showInformationMessage('SHORTCUT CREATED: "Copilot Dashboard.command" has been added to your Desktop.')}catch(e){s$.window.showErrorMessage(`Failed to create desktop shortcut: ${e instanceof Error?e.message:String(e)}`)}}var Qu;function pve(t){let e=le.window.createOutputChannel("GitHub Copilot API Server");t.subscriptions.push(e);let r=le.window.createStatusBarItem(le.StatusBarAlignment.Left,100);r.command="github-copilot-api-vscode.showServerControls",t.subscriptions.push(r);let n=async()=>{if(!Qu){r.text="$(circle-slash) Copilot API: OFF",r.tooltip="Copilot API Gateway is stopped (Standby Mode)",r.backgroundColor=void 0,r.show();return}let b=await Qu.getStatus();if(b.running){let x=b.stats.requestsPerMinute,C=b.stats.avgLatencyMs,$=b.stats.errorRate||0,L="$(broadcast) Copilot API: ON";(x>0||b.activeRequests>0)&&(L+=`  $(graph) ${x} RPM`),C>0&&(L+=`  $(pulse) ${C}ms`),$>=5&&(L+=`  $(warning) ${$}%`),b.activeRequests>0?(r.text=`$(sync~spin) Processing (${b.activeRequests}) | ${x} RPM`,r.backgroundColor=new le.ThemeColor("statusBarItem.warningBackground")):(r.text=L,r.backgroundColor=void 0);let xe=b.isHttps?"https":"http",ve=b.config.host==="0.0.0.0"&&b.networkInfo?.localIPs?.length?b.networkInfo.localIPs[0]:b.config.host,Se=`${xe}://${ve}:${b.config.port}`;r.tooltip=new le.MarkdownString(`
**$(broadcast) Copilot API Gateway**

| Metric | Value |
|--------|-------|
| Status | \u{1F7E2} Active |
| Endpoint | \`${Se}\` |
| Requests/min | ${x} |
| Avg Latency | ${C}ms |
| Error Rate | ${$}% |
| Total Requests | ${b.stats.totalRequests.toLocaleString()} |
| Tokens In/Out | ${(b.stats.totalTokensIn||0).toLocaleString()} / ${(b.stats.totalTokensOut||0).toLocaleString()} |

*Click to open controls*
			`),r.tooltip.isTrusted=!0,r.show()}else r.text="$(circle-slash) Copilot API: OFF",r.tooltip=new le.MarkdownString(`
**$(circle-slash) Copilot API Gateway**

Server is stopped. Click to start or manage.

*Tip: Enable auto-start in settings for convenience*
			`),r.backgroundColor=new le.ThemeColor("statusBarItem.errorBackground"),r.show()},o=!1,i=async()=>{if(Qu)return Qu;let b=new o$(e,r,t);return Qu=b,t.subscriptions.push(b),t.subscriptions.push(b.onDidChangeStatus(async()=>{await n();let x=await b.getStatus();if(x.running&&!o&&le.workspace.getConfiguration("githubCopilotApi.server").get("showNotifications",!0)){let $=x.config.host==="0.0.0.0"&&x.networkInfo?.localIPs?.length?x.networkInfo.localIPs[0]:x.config.host,L=x.isHttps?"https":"http";await le.window.showInformationMessage(`GitHub Copilot API Server started at ${L}://${$}:${x.config.port}`,"Open Dashboard")==="Open Dashboard"&&le.commands.executeCommand("github-copilot-api-vscode.openDashboard")}o=x.running})),await n(),b},s=new La(t.extensionUri,i);t.subscriptions.push(le.window.registerWebviewViewProvider(La.viewType,s));let a=le.commands.registerCommand("github-copilot-api-vscode.showServerControls",async()=>{let b=await i(),x=await b.getStatus(),C=[];x.running?(C.push({label:"$(check) Server is Running",description:`http://${x.config.host}:${x.config.port}`,detail:`Requests/min: ${x.stats.requestsPerMinute} | Avg Latency: ${x.stats.avgLatencyMs}ms | Errors: ${x.stats.errorRate}%`,kind:le.QuickPickItemKind.Separator}),C.push({label:"$(stop-circle) Stop Server",description:"Stop the API gateway"}),C.push({label:"$(refresh) Restart Server",description:"Reload configuration and restart"})):(C.push({label:"$(x) Server is Stopped",kind:le.QuickPickItemKind.Separator}),C.push({label:"$(play-circle) Start Server",description:"Start the API gateway"})),C.push({label:"",kind:le.QuickPickItemKind.Separator}),C.push({label:"$(dashboard) Open Full Dashboard",description:"View detailed charts, logs, and configuration"}),C.push({label:"$(output) Show Logs",description:"Open the output channel"});let $=await le.window.showQuickPick(C,{placeHolder:"Manage Copilot API Gateway",title:"Copilot API Controls"});$&&($.label.includes("Stop Server")?await b.stopServer():$.label.includes("Start Server")?await b.startServer():$.label.includes("Restart Server")?await b.restart():$.label.includes("Open Full Dashboard")?La.createOrShow(t.extensionUri,i):$.label.includes("Show Logs")&&e.show())});r.text="$(circle-slash) Copilot API: OFF",r.show();let c=le.workspace.getConfiguration("githubCopilotApi.server"),u=c.get("enabled",!1),l=c.get("autoStart",!1);e.appendLine(`[DEBUG] Activation. Enabled: ${u}, AutoStart: ${l}`),(u||l)&&i().then(b=>b.start().catch(x=>{e.appendLine(`[${new Date().toISOString()}] ERROR Failed to start API server: ${Xu(x)}`),le.window.showErrorMessage(`Failed to start Copilot API server: ${Xu(x)}`)}));let d=le.commands.registerCommand("github-copilot-api-vscode.openCopilotChat",async()=>{await i$()&&await le.commands.executeCommand("workbench.action.chat.open")}),p=le.commands.registerCommand("github-copilot-api-vscode.askCopilot",async b=>{if(!await i$())return;let x=AD(b)??await le.window.showInputBox({title:"Ask GitHub Copilot Chat",prompt:"What do you want to ask Copilot?",ignoreFocusOut:!0});x&&await le.commands.executeCommand("workbench.action.chat.open",{query:x,isPartialQuery:!1})}),f=le.commands.registerTextEditorCommand("github-copilot-api-vscode.askSelectionWithCopilot",async(b,x,C)=>{if(!await i$())return;let $=b.selection;if($.isEmpty){le.window.showWarningMessage("Select some code before asking Copilot about it.");return}let L=AD(C)??await le.window.showInputBox({title:"Ask Copilot About Selection",prompt:"Describe what you want to know about the selected code.",value:"Explain this code.",ignoreFocusOut:!0});L&&await le.commands.executeCommand("workbench.action.chat.open",{query:L,isPartialQuery:!1,attachFiles:[{uri:b.document.uri,range:new le.Range($.start,$.end)}],blockOnResponse:!1})}),h=le.commands.registerCommand("github-copilot-api-vscode.openDashboard",()=>{La.createOrShow(t.extensionUri,i)}),m=le.commands.registerCommand("github-copilot-api-vscode.createDesktopShortcut",async()=>{await WG()});t.subscriptions.push(le.window.registerUriHandler({handleUri(b){let x=b.path;e.appendLine(`[URI Handler] Received URI: ${b.toString()} (path: ${x})`),x==="/dashboard"?La.createOrShow(t.extensionUri,i):x==="/start"?i().then(C=>C.startServer().then(()=>{le.window.showInformationMessage("Copilot API Server started via shortcut")})):x==="/stop"?Qu&&Qu.stopServer().then(()=>{le.window.showInformationMessage("Copilot API Server stopped via shortcut")}):le.window.showWarningMessage(`Unknown shortcut path: ${x}`)}}));let y=`
# \u2139\uFE0F DEFAULT SYSTEM PROMPT
# -------------------------------------------------------------------------------------
# This prompt is valid ONLY when no system instruction is provided by the client tool.
# It acts as a fallback and does NOT permanently override API requests.
#
# EDIT BELOW THIS LINE - SAVE TO APPLY
# -------------------------------------------------------------------------------------

`.trimStart(),v=le.commands.registerCommand("github-copilot-api-vscode.editSystemPrompt",async()=>{let b=t.globalStorageUri;try{await le.workspace.fs.createDirectory(b)}catch{}let x=le.Uri.joinPath(b,"system_prompt.md"),$=le.workspace.getConfiguration("githubCopilotApi.server").get("defaultSystemPrompt",""),L=y+($||"");await le.workspace.fs.writeFile(x,Buffer.from(L,"utf8"));let xe=await le.workspace.openTextDocument(x);await le.window.showTextDocument(xe)});t.subscriptions.push(le.workspace.onDidSaveTextDocument(async b=>{if(b.uri.scheme==="file"&&b.uri.fsPath.endsWith("system_prompt.md")&&b.uri.fsPath.includes(t.globalStorageUri.fsPath)){let x=b.getText(),C="# -------------------------------------------------------------------------------------",$=x.lastIndexOf(C),L=x;$!==-1?L=x.substring($+C.length).trim():L=x.trim(),await le.workspace.getConfiguration("githubCopilotApi.server").update("defaultSystemPrompt",L,le.ConfigurationTarget.Global),le.window.setStatusBarMessage("$(check) Default system prompt updated",3e3)}})),t.subscriptions.push(d,p,f,m,h,a,v)}function fve(){}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

pvtsutils/build/index.js:
  (*!
   * MIT License
   * 
   * Copyright (c) 2017-2024 Peculiar Ventures, LLC
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

pvutils/build/utils.js:
  (*!
   Copyright (c) Peculiar Ventures, LLC
  *)

asn1js/build/index.js:
  (*!
   * Copyright (c) 2014, GMO GlobalSign
   * Copyright (c) 2015-2022, Peculiar Ventures
   * All rights reserved.
   * 
   * Author 2014-2019, Yury Strozhevsky
   * 
   * Redistribution and use in source and binary forms, with or without modification,
   * are permitted provided that the following conditions are met:
   * 
   * * Redistributions of source code must retain the above copyright notice, this
   *   list of conditions and the following disclaimer.
   * 
   * * Redistributions in binary form must reproduce the above copyright notice, this
   *   list of conditions and the following disclaimer in the documentation and/or
   *   other materials provided with the distribution.
   * 
   * * Neither the name of the copyright holder nor the names of its
   *   contributors may be used to endorse or promote products derived from
   *   this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
   * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
   * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   * 
   *)

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@peculiar/x509/build/x509.cjs.js:
  (*!
   * MIT License
   * 
   * Copyright (c) Peculiar Ventures. All rights reserved.
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)
*/
